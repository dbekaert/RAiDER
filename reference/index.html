
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../reference_td/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>API Reference - RAiDER API Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#raider-v053-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RAiDER API Documentation" class="md-header__button md-logo" aria-label="RAiDER API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RAiDER API Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dbekaert/RAiDER" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RAiDER
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RAiDER API Documentation" class="md-nav__button md-logo" aria-label="RAiDER API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RAiDER API Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dbekaert/RAiDER" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RAiDER
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home page
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://nbviewer.org/github/dbekaert/RAiDER-docs/blob/main/notebooks/RAiDER_tutorial/RAiDER_tutorial.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAiDER tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://nbviewer.org/github/dbekaert/RAiDER-docs/blob/main/notebooks/RAiDER_tutorial/RAiDER_Python_access.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAiDER Python tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://nbviewer.org/github/dbekaert/RAiDER-docs/blob/main/notebooks/raiderStats/raiderStats_tutorial.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    raiderStats tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://nbviewer.org/github/dbekaert/RAiDER-docs/blob/main/notebooks/raiderDownloadGNSS/raiderDownloadGNSS_tutorial.ipynb"  target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloading GNSS tropospheric delays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://nbviewer.org/github/dbekaert/RAiDER-docs/blob/main/notebooks/Pandas_tutorial/Pandas_tutorial.ipynb"  target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GNSS delay manipulation with Pandas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../WeatherModels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Model Access
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference_td/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delay Calculation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#RAiDER" class="md-nav__link">
    <span class="md-ellipsis">
      RAiDER
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.aria" class="md-nav__link">
    <span class="md-ellipsis">
      aria
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aria">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW" class="md-nav__link">
    <span class="md-ellipsis">
      calcGUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calcGUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc" class="md-nav__link">
    <span class="md-ellipsis">
      compute_delays_slc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_delays_slc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc" class="md-nav__link">
    <span class="md-ellipsis">
      tropo_gunw_slc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tropo_gunw_slc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.update_gunw_slc" class="md-nav__link">
    <span class="md-ellipsis">
      update_gunw_slc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.update_gunw_version" class="md-nav__link">
    <span class="md-ellipsis">
      update_gunw_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW" class="md-nav__link">
    <span class="md-ellipsis">
      prepFromGUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="prepFromGUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW" class="md-nav__link">
    <span class="md-ellipsis">
      GUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.calc_spacing_UTM" class="md-nav__link">
    <span class="md-ellipsis">
      calc_spacing_UTM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.getHeights" class="md-nav__link">
    <span class="md-ellipsis">
      getHeights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      get_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_datetimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_datetimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbit_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_slc_dt" class="md-nav__link">
    <span class="md-ellipsis">
      get_slc_dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.makeLatLonGrid_native" class="md-nav__link">
    <span class="md-ellipsis">
      makeLatLonGrid_native
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.make_cube" class="md-nav__link">
    <span class="md-ellipsis">
      make_cube
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.make_fname" class="md-nav__link">
    <span class="md-ellipsis">
      make_fname
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability" class="md-nav__link">
    <span class="md-ellipsis">
      check_weather_model_availability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="check_weather_model_availability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.update_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      update_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.checkArgs" class="md-nav__link">
    <span class="md-ellipsis">
      checkArgs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkArgs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.checkArgs" class="md-nav__link">
    <span class="md-ellipsis">
      checkArgs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.makeDelayFileNames" class="md-nav__link">
    <span class="md-ellipsis">
      makeDelayFileNames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="makeDelayFileNames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.makeDelayFileNames--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.parser" class="md-nav__link">
    <span class="md-ellipsis">
      parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider" class="md-nav__link">
    <span class="md-ellipsis">
      raider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="raider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.calcDelays" class="md-nav__link">
    <span class="md-ellipsis">
      calcDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combineZTDFiles" class="md-nav__link">
    <span class="md-ellipsis">
      combineZTDFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combine_files_using_azimuth_time" class="md-nav__link">
    <span class="md-ellipsis">
      combine_files_using_azimuth_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combine_weather_files" class="md-nav__link">
    <span class="md-ellipsis">
      combine_weather_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.downloadGNSS" class="md-nav__link">
    <span class="md-ellipsis">
      downloadGNSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile" class="md-nav__link">
    <span class="md-ellipsis">
      getWeatherFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="getWeatherFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--time-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      Time interpolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--need-to-handle-various-cases-including-if-the-exact-weather-model-time-is" class="md-nav__link">
    <span class="md-ellipsis">
      Need to handle various cases, including if the exact weather model time is
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--requested-or-if-one-or-more-datetimes-are-not-available-from-the-weather" class="md-nav__link">
    <span class="md-ellipsis">
      requested, or if one or more datetimes are not available from the weather
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--model-data-provider" class="md-nav__link">
    <span class="md-ellipsis">
      model data provider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.get_time_grid_for_aztime_interp" class="md-nav__link">
    <span class="md-ellipsis">
      get_time_grid_for_aztime_interp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.get_weights_time_interp" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights_time_interp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.read_run_config_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_run_config_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot" class="md-nav__link">
    <span class="md-ellipsis">
      statsPlot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="statsPlot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats" class="md-nav__link">
    <span class="md-ellipsis">
      RaiderStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RaiderStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats.create_DF" class="md-nav__link">
    <span class="md-ellipsis">
      create_DF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis" class="md-nav__link">
    <span class="md-ellipsis">
      VariogramAnalysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VariogramAnalysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.__exponential__" class="md-nav__link">
    <span class="md-ellipsis">
      __exponential__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.__gaussian__" class="md-nav__link">
    <span class="md-ellipsis">
      __gaussian__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.create_variograms" class="md-nav__link">
    <span class="md-ellipsis">
      create_variograms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.plot_variogram" class="md-nav__link">
    <span class="md-ellipsis">
      plot_variogram
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.convert_SI" class="md-nav__link">
    <span class="md-ellipsis">
      convert_SI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.load_gridfile" class="md-nav__link">
    <span class="md-ellipsis">
      load_gridfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.midpoint" class="md-nav__link">
    <span class="md-ellipsis">
      midpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.save_gridfile" class="md-nav__link">
    <span class="md-ellipsis">
      save_gridfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.stats_analyses" class="md-nav__link">
    <span class="md-ellipsis">
      stats_analyses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators" class="md-nav__link">
    <span class="md-ellipsis">
      validators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.BBoxAction" class="md-nav__link">
    <span class="md-ellipsis">
      BBoxAction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.DateListAction" class="md-nav__link">
    <span class="md-ellipsis">
      DateListAction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerMappingType" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerMappingType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntegerMappingType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerMappingType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerType" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntegerType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType" class="md-nav__link">
    <span class="md-ellipsis">
      MappingType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MappingType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.date_type" class="md-nav__link">
    <span class="md-ellipsis">
      date_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_time" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_valid_dates" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_valid_dates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.getBufferedExtent" class="md-nav__link">
    <span class="md-ellipsis">
      getBufferedExtent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.get_heights" class="md-nav__link">
    <span class="md-ellipsis">
      get_heights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.get_query_region" class="md-nav__link">
    <span class="md-ellipsis">
      get_query_region
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.isInside" class="md-nav__link">
    <span class="md-ellipsis">
      isInside
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.isOutside" class="md-nav__link">
    <span class="md-ellipsis">
      isOutside
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.modelName2Module" class="md-nav__link">
    <span class="md-ellipsis">
      modelName2Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.parse_dates" class="md-nav__link">
    <span class="md-ellipsis">
      parse_dates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.delay" class="md-nav__link">
    <span class="md-ellipsis">
      delay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.transformPoints" class="md-nav__link">
    <span class="md-ellipsis">
      transformPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.tropo_delay" class="md-nav__link">
    <span class="md-ellipsis">
      tropo_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.writeResultsToXarray" class="md-nav__link">
    <span class="md-ellipsis">
      writeResultsToXarray
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.delayFcns" class="md-nav__link">
    <span class="md-ellipsis">
      delayFcns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delayFcns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.delayFcns.getInterpolators" class="md-nav__link">
    <span class="md-ellipsis">
      getInterpolators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delayFcns.make_shared_raw" class="md-nav__link">
    <span class="md-ellipsis">
      make_shared_raw
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.dem" class="md-nav__link">
    <span class="md-ellipsis">
      dem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.dem.download_dem" class="md-nav__link">
    <span class="md-ellipsis">
      download_dem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays" class="md-nav__link">
    <span class="md-ellipsis">
      getStationDelays
    </span>
  </a>
  
    <nav class="md-nav" aria-label="getStationDelays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_delays_UNR" class="md-nav__link">
    <span class="md-ellipsis">
      get_delays_UNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_station_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_station_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.seconds_of_day" class="md-nav__link">
    <span class="md-ellipsis">
      seconds_of_day
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.gnss" class="md-nav__link">
    <span class="md-ellipsis">
      gnss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gnss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays" class="md-nav__link">
    <span class="md-ellipsis">
      downloadGNSSDelays
    </span>
  </a>
  
    <nav class="md-nav" aria-label="downloadGNSSDelays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.check_url" class="md-nav__link">
    <span class="md-ellipsis">
      check_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_UNR" class="md-nav__link">
    <span class="md-ellipsis">
      download_UNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_tropo_delays" class="md-nav__link">
    <span class="md-ellipsis">
      download_tropo_delays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_url" class="md-nav__link">
    <span class="md-ellipsis">
      download_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.filterToBBox" class="md-nav__link">
    <span class="md-ellipsis">
      filterToBBox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.fix_lons" class="md-nav__link">
    <span class="md-ellipsis">
      fix_lons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_ID" class="md-nav__link">
    <span class="md-ellipsis">
      get_ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_station_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_station_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_stats_by_llh" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats_by_llh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.in_box" class="md-nav__link">
    <span class="md-ellipsis">
      in_box
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.parse_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      parse_bbox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles" class="md-nav__link">
    <span class="md-ellipsis">
      processDelayFiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processDelayFiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.addDateTimeToFiles" class="md-nav__link">
    <span class="md-ellipsis">
      addDateTimeToFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.concatDelayFiles" class="md-nav__link">
    <span class="md-ellipsis">
      concatDelayFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.getDateTime" class="md-nav__link">
    <span class="md-ellipsis">
      getDateTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.local_time_filter" class="md-nav__link">
    <span class="md-ellipsis">
      local_time_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.pass_common_obs" class="md-nav__link">
    <span class="md-ellipsis">
      pass_common_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.readZTDFile" class="md-nav__link">
    <span class="md-ellipsis">
      readZTDFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.update_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__doc__" class="md-nav__link">
    <span class="md-ellipsis">
      __doc__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.interpolate_along_axis" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_along_axis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.interpolator" class="md-nav__link">
    <span class="md-ellipsis">
      interpolator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.RegularGridInterpolator" class="md-nav__link">
    <span class="md-ellipsis">
      RegularGridInterpolator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.fillna3D" class="md-nav__link">
    <span class="md-ellipsis">
      fillna3D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpV" class="md-nav__link">
    <span class="md-ellipsis">
      interpV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpVector" class="md-nav__link">
    <span class="md-ellipsis">
      interpVector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interp_along_axis" class="md-nav__link">
    <span class="md-ellipsis">
      interp_along_axis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpolateDEM" class="md-nav__link">
    <span class="md-ellipsis">
      interpolateDEM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.llreader" class="md-nav__link">
    <span class="md-ellipsis">
      llreader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="llreader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI" class="md-nav__link">
    <span class="md-ellipsis">
      AOI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.add_buffer" class="md-nav__link">
    <span class="md-ellipsis">
      add_buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.calc_buffer_ray" class="md-nav__link">
    <span class="md-ellipsis">
      calc_buffer_ray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.get_output_spacing" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_spacing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.set_output_spacing" class="md-nav__link">
    <span class="md-ellipsis">
      set_output_spacing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.set_output_xygrid" class="md-nav__link">
    <span class="md-ellipsis">
      set_output_xygrid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.BoundingBox" class="md-nav__link">
    <span class="md-ellipsis">
      BoundingBox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile" class="md-nav__link">
    <span class="md-ellipsis">
      GeocodedFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeocodedFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.Geocube" class="md-nav__link">
    <span class="md-ellipsis">
      Geocube
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.RasterRDR" class="md-nav__link">
    <span class="md-ellipsis">
      RasterRDR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RasterRDR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.RasterRDR.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile" class="md-nav__link">
    <span class="md-ellipsis">
      StationFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StationFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile.readLL" class="md-nav__link">
    <span class="md-ellipsis">
      readLL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.bounds_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      bounds_from_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.bounds_from_latlon_rasters" class="md-nav__link">
    <span class="md-ellipsis">
      bounds_from_latlon_rasters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.logger.CustomFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      CustomFormatter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.losreader" class="md-nav__link">
    <span class="md-ellipsis">
      losreader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="losreader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Conventional" class="md-nav__link">
    <span class="md-ellipsis">
      Conventional
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conventional">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Conventional.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.LOS" class="md-nav__link">
    <span class="md-ellipsis">
      LOS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.LOS.setPoints" class="md-nav__link">
    <span class="md-ellipsis">
      setPoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing" class="md-nav__link">
    <span class="md-ellipsis">
      Raytracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Raytracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.calculateDelays" class="md-nav__link">
    <span class="md-ellipsis">
      calculateDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getIntersectionWithHeight" class="md-nav__link">
    <span class="md-ellipsis">
      getIntersectionWithHeight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getIntersectionWithLevels" class="md-nav__link">
    <span class="md-ellipsis">
      getIntersectionWithLevels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getLookVectors" class="md-nav__link">
    <span class="md-ellipsis">
      getLookVectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith" class="md-nav__link">
    <span class="md-ellipsis">
      Zenith
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Zenith">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith.setLookVectors" class="md-nav__link">
    <span class="md-ellipsis">
      setLookVectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.build_ray" class="md-nav__link">
    <span class="md-ellipsis">
      build_ray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.cut_times" class="md-nav__link">
    <span class="md-ellipsis">
      cut_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      filter_ESA_orbit_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="filter_ESA_orbit_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.getTopOfAtmosphere" class="md-nav__link">
    <span class="md-ellipsis">
      getTopOfAtmosphere
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.getZenithLookVecs" class="md-nav__link">
    <span class="md-ellipsis">
      getZenithLookVecs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_orbit" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos" class="md-nav__link">
    <span class="md-ellipsis">
      get_radar_pos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_radar_pos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_sv" class="md-nav__link">
    <span class="md-ellipsis">
      get_sv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.inc_hd_to_enu" class="md-nav__link">
    <span class="md-ellipsis">
      inc_hd_to_enu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.pick_ESA_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      pick_ESA_orbit_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_ESA_Orbit_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_ESA_Orbit_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_txt_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_txt_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los" class="md-nav__link">
    <span class="md-ellipsis">
      state_to_los
    </span>
  </a>
  
    <nav class="md-nav" aria-label="state_to_los">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los--download-the-orbit-file-beforehand" class="md-nav__link">
    <span class="md-ellipsis">
      download the orbit file beforehand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.makePoints" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="makePoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__test__" class="md-nav__link">
    <span class="md-ellipsis">
      __test__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints0D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints0D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints1D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints1D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints2D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints2D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints3D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints3D
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ERA5" class="md-nav__link">
    <span class="md-ellipsis">
      ERA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ERA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ERA5.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.GMAO" class="md-nav__link">
    <span class="md-ellipsis">
      GMAO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GMAO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.GMAO.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRES" class="md-nav__link">
    <span class="md-ellipsis">
      HRES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRES.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR" class="md-nav__link">
    <span class="md-ellipsis">
      HRRR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRRR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.MERRA2" class="md-nav__link">
    <span class="md-ellipsis">
      MERRA2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MERRA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.MERRA2.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.credentials" class="md-nav__link">
    <span class="md-ellipsis">
      credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf" class="md-nav__link">
    <span class="md-ellipsis">
      ecmwf
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ecmwf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf.ECMWF" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECMWF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf.ECMWF.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5" class="md-nav__link">
    <span class="md-ellipsis">
      era5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="era5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5.ERA5" class="md-nav__link">
    <span class="md-ellipsis">
      ERA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ERA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5.ERA5.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5t" class="md-nav__link">
    <span class="md-ellipsis">
      era5t
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.erai" class="md-nav__link">
    <span class="md-ellipsis">
      erai
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT" class="md-nav__link">
    <span class="md-ellipsis">
      generateGACOSVRT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generateGACOSVRT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.convertAllFiles" class="md-nav__link">
    <span class="md-ellipsis">
      convertAllFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.makeVRT" class="md-nav__link">
    <span class="md-ellipsis">
      makeVRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.writeStringToFile" class="md-nav__link">
    <span class="md-ellipsis">
      writeStringToFile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao" class="md-nav__link">
    <span class="md-ellipsis">
      gmao
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gmao">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao.GMAO" class="md-nav__link">
    <span class="md-ellipsis">
      GMAO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GMAO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao.GMAO.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres" class="md-nav__link">
    <span class="md-ellipsis">
      hres
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hres">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres.HRES" class="md-nav__link">
    <span class="md-ellipsis">
      HRES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres.HRES.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr" class="md-nav__link">
    <span class="md-ellipsis">
      hrrr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hrrr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR" class="md-nav__link">
    <span class="md-ellipsis">
      HRRR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRRR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.check_hrrr_dataset_availability" class="md-nav__link">
    <span class="md-ellipsis">
      check_hrrr_dataset_availability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.download_hrrr_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_hrrr_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.get_bounds_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_bounds_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.load_weather_hrrr" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather_hrrr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2" class="md-nav__link">
    <span class="md-ellipsis">
      merra2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merra2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2.MERRA2" class="md-nav__link">
    <span class="md-ellipsis">
      MERRA2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MERRA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2.MERRA2.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.model_levels" class="md-nav__link">
    <span class="md-ellipsis">
      model_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr" class="md-nav__link">
    <span class="md-ellipsis">
      ncmr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ncmr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr.NCMR" class="md-nav__link">
    <span class="md-ellipsis">
      NCMR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NCMR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr.NCMR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather" class="md-nav__link">
    <span class="md-ellipsis">
      plotWeather
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plotWeather">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather.plot_pqt" class="md-nav__link">
    <span class="md-ellipsis">
      plot_pqt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather.plot_wh" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template" class="md-nav__link">
    <span class="md-ellipsis">
      template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template.customModelReader" class="md-nav__link">
    <span class="md-ellipsis">
      customModelReader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="customModelReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template.customModelReader.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      weatherModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="weatherModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      WeatherModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WeatherModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox" class="md-nav__link">
    <span class="md-ellipsis">
      bbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment" class="md-nav__link">
    <span class="md-ellipsis">
      checkContainment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkContainment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkTime" class="md-nav__link">
    <span class="md-ellipsis">
      checkTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.fetch--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.filename" class="md-nav__link">
    <span class="md-ellipsis">
      filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.getProjection" class="md-nav__link">
    <span class="md-ellipsis">
      getProjection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.get_wmLoc" class="md-nav__link">
    <span class="md-ellipsis">
      get_wmLoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.setLevelType" class="md-nav__link">
    <span class="md-ellipsis">
      setLevelType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.setTime" class="md-nav__link">
    <span class="md-ellipsis">
      setTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.set_latlon_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      set_latlon_bounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.set_wmLoc" class="md-nav__link">
    <span class="md-ellipsis">
      set_wmLoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw" class="md-nav__link">
    <span class="md-ellipsis">
      checkContainment_raw
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkContainment_raw">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.find_svp" class="md-nav__link">
    <span class="md-ellipsis">
      find_svp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.get_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.make_raw_weather_data_filename" class="md-nav__link">
    <span class="md-ellipsis">
      make_raw_weather_data_filename
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf" class="md-nav__link">
    <span class="md-ellipsis">
      wrf
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.UnitTypeError" class="md-nav__link">
    <span class="md-ellipsis">
      UnitTypeError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.WRF" class="md-nav__link">
    <span class="md-ellipsis">
      WRF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.WRF.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.checkUnits" class="md-nav__link">
    <span class="md-ellipsis">
      checkUnits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.getNullValue" class="md-nav__link">
    <span class="md-ellipsis">
      getNullValue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.processWM" class="md-nav__link">
    <span class="md-ellipsis">
      processWM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processWM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.processWM.prepareWeatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      prepareWeatherModel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing" class="md-nav__link">
    <span class="md-ellipsis">
      s1_azimuth_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="s1_azimuth_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_azimuth_time_grid" class="md-nav__link">
    <span class="md-ellipsis">
      get_azimuth_time_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates" class="md-nav__link">
    <span class="md-ellipsis">
      get_inverse_weights_for_dates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_inverse_weights_for_dates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_n_closest_datetimes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_n_closest_datetimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid" class="md-nav__link">
    <span class="md-ellipsis">
      get_s1_azimuth_time_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_s1_azimuth_time_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_slc_id_from_point_and_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_slc_id_from_point_and_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      get_times_for_azimuth_interpolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_times_for_azimuth_interpolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits" class="md-nav__link">
    <span class="md-ellipsis">
      s1_orbits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="s1_orbits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.download_eofs" class="md-nav__link">
    <span class="md-ellipsis">
      download_eofs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.ensure_orbit_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_orbit_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.get_orbits_from_slc_ids" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbits_from_slc_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.get_orbits_from_slc_ids_hyp3lib" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbits_from_slc_ids_hyp3lib
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.utilFcns" class="md-nav__link">
    <span class="md-ellipsis">
      utilFcns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utilFcns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.calcgeoh" class="md-nav__link">
    <span class="md-ellipsis">
      calcgeoh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calcgeoh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.calcgeoh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.clip_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      clip_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.convertLons" class="md-nav__link">
    <span class="md-ellipsis">
      convertLons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.cosd" class="md-nav__link">
    <span class="md-ellipsis">
      cosd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.ecef2enu" class="md-nav__link">
    <span class="md-ellipsis">
      ecef2enu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.enu2ecef" class="md-nav__link">
    <span class="md-ellipsis">
      enu2ecef
    </span>
  </a>
  
    <nav class="md-nav" aria-label="enu2ecef">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.enu2ecef--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.floorish" class="md-nav__link">
    <span class="md-ellipsis">
      floorish
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht" class="md-nav__link">
    <span class="md-ellipsis">
      geo_to_ht
    </span>
  </a>
  
    <nav class="md-nav" aria-label="geo_to_ht">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht--h-geopotential-re-g0-re-geopotential" class="md-nav__link">
    <span class="md-ellipsis">
      h = (geopotential * Re) / (g0 * Re - geopotential)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht--assumes-a-sphere-instead-of-an-ellipsoid" class="md-nav__link">
    <span class="md-ellipsis">
      Assumes a sphere instead of an ellipsoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.getChunkSize" class="md-nav__link">
    <span class="md-ellipsis">
      getChunkSize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.getTimeFromFile" class="md-nav__link">
    <span class="md-ellipsis">
      getTimeFromFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_Re" class="md-nav__link">
    <span class="md-ellipsis">
      get_Re
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_dt" class="md-nav__link">
    <span class="md-ellipsis">
      get_dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_file_and_band" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_and_band
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_nearest_wmtimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nearest_wmtimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.nodataToNan" class="md-nav__link">
    <span class="md-ellipsis">
      nodataToNan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.padLower" class="md-nav__link">
    <span class="md-ellipsis">
      padLower
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.projectDelays" class="md-nav__link">
    <span class="md-ellipsis">
      projectDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.requests_retry_session" class="md-nav__link">
    <span class="md-ellipsis">
      requests_retry_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_extents" class="md-nav__link">
    <span class="md-ellipsis">
      rio_extents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_open" class="md-nav__link">
    <span class="md-ellipsis">
      rio_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_profile" class="md-nav__link">
    <span class="md-ellipsis">
      rio_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_stats" class="md-nav__link">
    <span class="md-ellipsis">
      rio_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.robmax" class="md-nav__link">
    <span class="md-ellipsis">
      robmax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.robmin" class="md-nav__link">
    <span class="md-ellipsis">
      robmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.round_time" class="md-nav__link">
    <span class="md-ellipsis">
      round_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.show_progress" class="md-nav__link">
    <span class="md-ellipsis">
      show_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.sind" class="md-nav__link">
    <span class="md-ellipsis">
      sind
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.transform_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      transform_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.transform_coords" class="md-nav__link">
    <span class="md-ellipsis">
      transform_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.writeArrayToRaster" class="md-nav__link">
    <span class="md-ellipsis">
      writeArrayToRaster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.writeDelays" class="md-nav__link">
    <span class="md-ellipsis">
      writeDelays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#RAiDER" class="md-nav__link">
    <span class="md-ellipsis">
      RAiDER
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.aria" class="md-nav__link">
    <span class="md-ellipsis">
      aria
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aria">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW" class="md-nav__link">
    <span class="md-ellipsis">
      calcGUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calcGUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc" class="md-nav__link">
    <span class="md-ellipsis">
      compute_delays_slc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_delays_slc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.compute_delays_slc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc" class="md-nav__link">
    <span class="md-ellipsis">
      tropo_gunw_slc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tropo_gunw_slc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.tropo_gunw_slc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.update_gunw_slc" class="md-nav__link">
    <span class="md-ellipsis">
      update_gunw_slc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.calcGUNW.update_gunw_version" class="md-nav__link">
    <span class="md-ellipsis">
      update_gunw_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW" class="md-nav__link">
    <span class="md-ellipsis">
      prepFromGUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="prepFromGUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW" class="md-nav__link">
    <span class="md-ellipsis">
      GUNW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GUNW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.calc_spacing_UTM" class="md-nav__link">
    <span class="md-ellipsis">
      calc_spacing_UTM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.getHeights" class="md-nav__link">
    <span class="md-ellipsis">
      getHeights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      get_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_datetimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_datetimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbit_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.get_slc_dt" class="md-nav__link">
    <span class="md-ellipsis">
      get_slc_dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.makeLatLonGrid_native" class="md-nav__link">
    <span class="md-ellipsis">
      makeLatLonGrid_native
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.make_cube" class="md-nav__link">
    <span class="md-ellipsis">
      make_cube
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.GUNW.make_fname" class="md-nav__link">
    <span class="md-ellipsis">
      make_fname
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability" class="md-nav__link">
    <span class="md-ellipsis">
      check_weather_model_availability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="check_weather_model_availability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.check_weather_model_availability--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.aria.prepFromGUNW.update_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      update_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.checkArgs" class="md-nav__link">
    <span class="md-ellipsis">
      checkArgs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkArgs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.checkArgs" class="md-nav__link">
    <span class="md-ellipsis">
      checkArgs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.makeDelayFileNames" class="md-nav__link">
    <span class="md-ellipsis">
      makeDelayFileNames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="makeDelayFileNames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.checkArgs.makeDelayFileNames--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.parser" class="md-nav__link">
    <span class="md-ellipsis">
      parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider" class="md-nav__link">
    <span class="md-ellipsis">
      raider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="raider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.calcDelays" class="md-nav__link">
    <span class="md-ellipsis">
      calcDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combineZTDFiles" class="md-nav__link">
    <span class="md-ellipsis">
      combineZTDFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combine_files_using_azimuth_time" class="md-nav__link">
    <span class="md-ellipsis">
      combine_files_using_azimuth_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.combine_weather_files" class="md-nav__link">
    <span class="md-ellipsis">
      combine_weather_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.downloadGNSS" class="md-nav__link">
    <span class="md-ellipsis">
      downloadGNSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile" class="md-nav__link">
    <span class="md-ellipsis">
      getWeatherFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="getWeatherFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--time-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      Time interpolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--need-to-handle-various-cases-including-if-the-exact-weather-model-time-is" class="md-nav__link">
    <span class="md-ellipsis">
      Need to handle various cases, including if the exact weather model time is
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--requested-or-if-one-or-more-datetimes-are-not-available-from-the-weather" class="md-nav__link">
    <span class="md-ellipsis">
      requested, or if one or more datetimes are not available from the weather
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.getWeatherFile--model-data-provider" class="md-nav__link">
    <span class="md-ellipsis">
      model data provider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.get_time_grid_for_aztime_interp" class="md-nav__link">
    <span class="md-ellipsis">
      get_time_grid_for_aztime_interp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.get_weights_time_interp" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights_time_interp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.raider.read_run_config_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_run_config_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot" class="md-nav__link">
    <span class="md-ellipsis">
      statsPlot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="statsPlot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats" class="md-nav__link">
    <span class="md-ellipsis">
      RaiderStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RaiderStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.RaiderStats.create_DF" class="md-nav__link">
    <span class="md-ellipsis">
      create_DF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis" class="md-nav__link">
    <span class="md-ellipsis">
      VariogramAnalysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VariogramAnalysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.__exponential__" class="md-nav__link">
    <span class="md-ellipsis">
      __exponential__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.__gaussian__" class="md-nav__link">
    <span class="md-ellipsis">
      __gaussian__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.create_variograms" class="md-nav__link">
    <span class="md-ellipsis">
      create_variograms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.VariogramAnalysis.plot_variogram" class="md-nav__link">
    <span class="md-ellipsis">
      plot_variogram
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.convert_SI" class="md-nav__link">
    <span class="md-ellipsis">
      convert_SI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.load_gridfile" class="md-nav__link">
    <span class="md-ellipsis">
      load_gridfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.midpoint" class="md-nav__link">
    <span class="md-ellipsis">
      midpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.save_gridfile" class="md-nav__link">
    <span class="md-ellipsis">
      save_gridfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.statsPlot.stats_analyses" class="md-nav__link">
    <span class="md-ellipsis">
      stats_analyses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators" class="md-nav__link">
    <span class="md-ellipsis">
      validators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.BBoxAction" class="md-nav__link">
    <span class="md-ellipsis">
      BBoxAction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.DateListAction" class="md-nav__link">
    <span class="md-ellipsis">
      DateListAction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerMappingType" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerMappingType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntegerMappingType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerMappingType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerType" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntegerType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.IntegerType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType" class="md-nav__link">
    <span class="md-ellipsis">
      MappingType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MappingType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.MappingType.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.date_type" class="md-nav__link">
    <span class="md-ellipsis">
      date_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_time" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.enforce_valid_dates" class="md-nav__link">
    <span class="md-ellipsis">
      enforce_valid_dates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.getBufferedExtent" class="md-nav__link">
    <span class="md-ellipsis">
      getBufferedExtent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.get_heights" class="md-nav__link">
    <span class="md-ellipsis">
      get_heights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.get_query_region" class="md-nav__link">
    <span class="md-ellipsis">
      get_query_region
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.isInside" class="md-nav__link">
    <span class="md-ellipsis">
      isInside
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.isOutside" class="md-nav__link">
    <span class="md-ellipsis">
      isOutside
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.modelName2Module" class="md-nav__link">
    <span class="md-ellipsis">
      modelName2Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.cli.validators.parse_dates" class="md-nav__link">
    <span class="md-ellipsis">
      parse_dates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.delay" class="md-nav__link">
    <span class="md-ellipsis">
      delay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.transformPoints" class="md-nav__link">
    <span class="md-ellipsis">
      transformPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.tropo_delay" class="md-nav__link">
    <span class="md-ellipsis">
      tropo_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delay.writeResultsToXarray" class="md-nav__link">
    <span class="md-ellipsis">
      writeResultsToXarray
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.delayFcns" class="md-nav__link">
    <span class="md-ellipsis">
      delayFcns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delayFcns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.delayFcns.getInterpolators" class="md-nav__link">
    <span class="md-ellipsis">
      getInterpolators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.delayFcns.make_shared_raw" class="md-nav__link">
    <span class="md-ellipsis">
      make_shared_raw
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.dem" class="md-nav__link">
    <span class="md-ellipsis">
      dem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.dem.download_dem" class="md-nav__link">
    <span class="md-ellipsis">
      download_dem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays" class="md-nav__link">
    <span class="md-ellipsis">
      getStationDelays
    </span>
  </a>
  
    <nav class="md-nav" aria-label="getStationDelays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_delays_UNR" class="md-nav__link">
    <span class="md-ellipsis">
      get_delays_UNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.get_station_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_station_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.getStationDelays.seconds_of_day" class="md-nav__link">
    <span class="md-ellipsis">
      seconds_of_day
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.gnss" class="md-nav__link">
    <span class="md-ellipsis">
      gnss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gnss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays" class="md-nav__link">
    <span class="md-ellipsis">
      downloadGNSSDelays
    </span>
  </a>
  
    <nav class="md-nav" aria-label="downloadGNSSDelays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.check_url" class="md-nav__link">
    <span class="md-ellipsis">
      check_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_UNR" class="md-nav__link">
    <span class="md-ellipsis">
      download_UNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_tropo_delays" class="md-nav__link">
    <span class="md-ellipsis">
      download_tropo_delays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.download_url" class="md-nav__link">
    <span class="md-ellipsis">
      download_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.filterToBBox" class="md-nav__link">
    <span class="md-ellipsis">
      filterToBBox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.fix_lons" class="md-nav__link">
    <span class="md-ellipsis">
      fix_lons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_ID" class="md-nav__link">
    <span class="md-ellipsis">
      get_ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_station_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_station_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.get_stats_by_llh" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats_by_llh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.in_box" class="md-nav__link">
    <span class="md-ellipsis">
      in_box
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.downloadGNSSDelays.parse_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      parse_bbox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles" class="md-nav__link">
    <span class="md-ellipsis">
      processDelayFiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processDelayFiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.addDateTimeToFiles" class="md-nav__link">
    <span class="md-ellipsis">
      addDateTimeToFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.concatDelayFiles" class="md-nav__link">
    <span class="md-ellipsis">
      concatDelayFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.getDateTime" class="md-nav__link">
    <span class="md-ellipsis">
      getDateTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.local_time_filter" class="md-nav__link">
    <span class="md-ellipsis">
      local_time_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.pass_common_obs" class="md-nav__link">
    <span class="md-ellipsis">
      pass_common_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.readZTDFile" class="md-nav__link">
    <span class="md-ellipsis">
      readZTDFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.gnss.processDelayFiles.update_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__doc__" class="md-nav__link">
    <span class="md-ellipsis">
      __doc__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolate.interpolate_along_axis" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_along_axis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.interpolator" class="md-nav__link">
    <span class="md-ellipsis">
      interpolator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.RegularGridInterpolator" class="md-nav__link">
    <span class="md-ellipsis">
      RegularGridInterpolator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.fillna3D" class="md-nav__link">
    <span class="md-ellipsis">
      fillna3D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpV" class="md-nav__link">
    <span class="md-ellipsis">
      interpV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpVector" class="md-nav__link">
    <span class="md-ellipsis">
      interpVector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interp_along_axis" class="md-nav__link">
    <span class="md-ellipsis">
      interp_along_axis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.interpolator.interpolateDEM" class="md-nav__link">
    <span class="md-ellipsis">
      interpolateDEM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.llreader" class="md-nav__link">
    <span class="md-ellipsis">
      llreader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="llreader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI" class="md-nav__link">
    <span class="md-ellipsis">
      AOI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.add_buffer" class="md-nav__link">
    <span class="md-ellipsis">
      add_buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.calc_buffer_ray" class="md-nav__link">
    <span class="md-ellipsis">
      calc_buffer_ray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.get_output_spacing" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_spacing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.set_output_spacing" class="md-nav__link">
    <span class="md-ellipsis">
      set_output_spacing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.AOI.set_output_xygrid" class="md-nav__link">
    <span class="md-ellipsis">
      set_output_xygrid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.BoundingBox" class="md-nav__link">
    <span class="md-ellipsis">
      BoundingBox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile" class="md-nav__link">
    <span class="md-ellipsis">
      GeocodedFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeocodedFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.GeocodedFile.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.Geocube" class="md-nav__link">
    <span class="md-ellipsis">
      Geocube
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.RasterRDR" class="md-nav__link">
    <span class="md-ellipsis">
      RasterRDR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RasterRDR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.RasterRDR.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile" class="md-nav__link">
    <span class="md-ellipsis">
      StationFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StationFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile.readLL" class="md-nav__link">
    <span class="md-ellipsis">
      readLL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.StationFile.readZ" class="md-nav__link">
    <span class="md-ellipsis">
      readZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.bounds_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      bounds_from_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.llreader.bounds_from_latlon_rasters" class="md-nav__link">
    <span class="md-ellipsis">
      bounds_from_latlon_rasters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.logger.CustomFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      CustomFormatter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.losreader" class="md-nav__link">
    <span class="md-ellipsis">
      losreader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="losreader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Conventional" class="md-nav__link">
    <span class="md-ellipsis">
      Conventional
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conventional">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Conventional.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.LOS" class="md-nav__link">
    <span class="md-ellipsis">
      LOS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.LOS.setPoints" class="md-nav__link">
    <span class="md-ellipsis">
      setPoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing" class="md-nav__link">
    <span class="md-ellipsis">
      Raytracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Raytracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.calculateDelays" class="md-nav__link">
    <span class="md-ellipsis">
      calculateDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getIntersectionWithHeight" class="md-nav__link">
    <span class="md-ellipsis">
      getIntersectionWithHeight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getIntersectionWithLevels" class="md-nav__link">
    <span class="md-ellipsis">
      getIntersectionWithLevels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Raytracing.getLookVectors" class="md-nav__link">
    <span class="md-ellipsis">
      getLookVectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith" class="md-nav__link">
    <span class="md-ellipsis">
      Zenith
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Zenith">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.Zenith.setLookVectors" class="md-nav__link">
    <span class="md-ellipsis">
      setLookVectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.build_ray" class="md-nav__link">
    <span class="md-ellipsis">
      build_ray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.cut_times" class="md-nav__link">
    <span class="md-ellipsis">
      cut_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      filter_ESA_orbit_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="filter_ESA_orbit_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.filter_ESA_orbit_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.getTopOfAtmosphere" class="md-nav__link">
    <span class="md-ellipsis">
      getTopOfAtmosphere
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.getZenithLookVecs" class="md-nav__link">
    <span class="md-ellipsis">
      getZenithLookVecs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_orbit" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos" class="md-nav__link">
    <span class="md-ellipsis">
      get_radar_pos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_radar_pos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_radar_pos--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.get_sv" class="md-nav__link">
    <span class="md-ellipsis">
      get_sv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.inc_hd_to_enu" class="md-nav__link">
    <span class="md-ellipsis">
      inc_hd_to_enu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.pick_ESA_orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      pick_ESA_orbit_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_ESA_Orbit_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_ESA_Orbit_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_ESA_Orbit_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.read_txt_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_txt_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los" class="md-nav__link">
    <span class="md-ellipsis">
      state_to_los
    </span>
  </a>
  
    <nav class="md-nav" aria-label="state_to_los">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.losreader.state_to_los--download-the-orbit-file-beforehand" class="md-nav__link">
    <span class="md-ellipsis">
      download the orbit file beforehand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.makePoints" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="makePoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.__test__" class="md-nav__link">
    <span class="md-ellipsis">
      __test__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints0D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints0D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints1D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints1D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints2D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints2D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.makePoints.makePoints3D" class="md-nav__link">
    <span class="md-ellipsis">
      makePoints3D
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ERA5" class="md-nav__link">
    <span class="md-ellipsis">
      ERA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ERA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ERA5.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.GMAO" class="md-nav__link">
    <span class="md-ellipsis">
      GMAO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GMAO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.GMAO.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRES" class="md-nav__link">
    <span class="md-ellipsis">
      HRES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRES.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR" class="md-nav__link">
    <span class="md-ellipsis">
      HRRR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRRR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.HRRR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.MERRA2" class="md-nav__link">
    <span class="md-ellipsis">
      MERRA2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MERRA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.MERRA2.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.credentials" class="md-nav__link">
    <span class="md-ellipsis">
      credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf" class="md-nav__link">
    <span class="md-ellipsis">
      ecmwf
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ecmwf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf.ECMWF" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECMWF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ecmwf.ECMWF.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5" class="md-nav__link">
    <span class="md-ellipsis">
      era5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="era5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5.ERA5" class="md-nav__link">
    <span class="md-ellipsis">
      ERA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ERA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5.ERA5.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.era5t" class="md-nav__link">
    <span class="md-ellipsis">
      era5t
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.erai" class="md-nav__link">
    <span class="md-ellipsis">
      erai
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT" class="md-nav__link">
    <span class="md-ellipsis">
      generateGACOSVRT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generateGACOSVRT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.convertAllFiles" class="md-nav__link">
    <span class="md-ellipsis">
      convertAllFiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.makeVRT" class="md-nav__link">
    <span class="md-ellipsis">
      makeVRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.generateGACOSVRT.writeStringToFile" class="md-nav__link">
    <span class="md-ellipsis">
      writeStringToFile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao" class="md-nav__link">
    <span class="md-ellipsis">
      gmao
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gmao">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao.GMAO" class="md-nav__link">
    <span class="md-ellipsis">
      GMAO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GMAO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.gmao.GMAO.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres" class="md-nav__link">
    <span class="md-ellipsis">
      hres
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hres">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres.HRES" class="md-nav__link">
    <span class="md-ellipsis">
      HRES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hres.HRES.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr" class="md-nav__link">
    <span class="md-ellipsis">
      hrrr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hrrr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR" class="md-nav__link">
    <span class="md-ellipsis">
      HRRR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HRRR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.HRRR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.check_hrrr_dataset_availability" class="md-nav__link">
    <span class="md-ellipsis">
      check_hrrr_dataset_availability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.download_hrrr_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_hrrr_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.get_bounds_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_bounds_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.hrrr.load_weather_hrrr" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather_hrrr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2" class="md-nav__link">
    <span class="md-ellipsis">
      merra2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merra2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2.MERRA2" class="md-nav__link">
    <span class="md-ellipsis">
      MERRA2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MERRA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.merra2.MERRA2.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.model_levels" class="md-nav__link">
    <span class="md-ellipsis">
      model_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr" class="md-nav__link">
    <span class="md-ellipsis">
      ncmr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ncmr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr.NCMR" class="md-nav__link">
    <span class="md-ellipsis">
      NCMR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NCMR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.ncmr.NCMR.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather" class="md-nav__link">
    <span class="md-ellipsis">
      plotWeather
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plotWeather">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather.plot_pqt" class="md-nav__link">
    <span class="md-ellipsis">
      plot_pqt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.plotWeather.plot_wh" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template" class="md-nav__link">
    <span class="md-ellipsis">
      template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template.customModelReader" class="md-nav__link">
    <span class="md-ellipsis">
      customModelReader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="customModelReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.template.customModelReader.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      weatherModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="weatherModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      WeatherModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WeatherModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox" class="md-nav__link">
    <span class="md-ellipsis">
      bbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.bbox--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment" class="md-nav__link">
    <span class="md-ellipsis">
      checkContainment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkContainment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkContainment--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkTime" class="md-nav__link">
    <span class="md-ellipsis">
      checkTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.checkValidBounds" class="md-nav__link">
    <span class="md-ellipsis">
      checkValidBounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.fetch--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.filename" class="md-nav__link">
    <span class="md-ellipsis">
      filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.getProjection" class="md-nav__link">
    <span class="md-ellipsis">
      getProjection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.get_wmLoc" class="md-nav__link">
    <span class="md-ellipsis">
      get_wmLoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.setLevelType" class="md-nav__link">
    <span class="md-ellipsis">
      setLevelType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.setTime" class="md-nav__link">
    <span class="md-ellipsis">
      setTime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.set_latlon_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      set_latlon_bounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.set_wmLoc" class="md-nav__link">
    <span class="md-ellipsis">
      set_wmLoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.WeatherModel.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw" class="md-nav__link">
    <span class="md-ellipsis">
      checkContainment_raw
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkContainment_raw">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.checkContainment_raw--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.find_svp" class="md-nav__link">
    <span class="md-ellipsis">
      find_svp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.get_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.weatherModel.make_raw_weather_data_filename" class="md-nav__link">
    <span class="md-ellipsis">
      make_raw_weather_data_filename
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf" class="md-nav__link">
    <span class="md-ellipsis">
      wrf
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.UnitTypeError" class="md-nav__link">
    <span class="md-ellipsis">
      UnitTypeError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.WRF" class="md-nav__link">
    <span class="md-ellipsis">
      WRF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.WRF.load_weather" class="md-nav__link">
    <span class="md-ellipsis">
      load_weather
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.checkUnits" class="md-nav__link">
    <span class="md-ellipsis">
      checkUnits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.models.wrf.getNullValue" class="md-nav__link">
    <span class="md-ellipsis">
      getNullValue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.processWM" class="md-nav__link">
    <span class="md-ellipsis">
      processWM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processWM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.processWM.prepareWeatherModel" class="md-nav__link">
    <span class="md-ellipsis">
      prepareWeatherModel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing" class="md-nav__link">
    <span class="md-ellipsis">
      s1_azimuth_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="s1_azimuth_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_azimuth_time_grid" class="md-nav__link">
    <span class="md-ellipsis">
      get_azimuth_time_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates" class="md-nav__link">
    <span class="md-ellipsis">
      get_inverse_weights_for_dates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_inverse_weights_for_dates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_n_closest_datetimes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_n_closest_datetimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_n_closest_datetimes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid" class="md-nav__link">
    <span class="md-ellipsis">
      get_s1_azimuth_time_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_s1_azimuth_time_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_slc_id_from_point_and_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_slc_id_from_point_and_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      get_times_for_azimuth_interpolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_times_for_azimuth_interpolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits" class="md-nav__link">
    <span class="md-ellipsis">
      s1_orbits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="s1_orbits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.download_eofs" class="md-nav__link">
    <span class="md-ellipsis">
      download_eofs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.ensure_orbit_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_orbit_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.get_orbits_from_slc_ids" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbits_from_slc_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.s1_orbits.get_orbits_from_slc_ids_hyp3lib" class="md-nav__link">
    <span class="md-ellipsis">
      get_orbits_from_slc_ids_hyp3lib
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RAiDER.utilFcns" class="md-nav__link">
    <span class="md-ellipsis">
      utilFcns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utilFcns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.calcgeoh" class="md-nav__link">
    <span class="md-ellipsis">
      calcgeoh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calcgeoh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.calcgeoh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.clip_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      clip_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.convertLons" class="md-nav__link">
    <span class="md-ellipsis">
      convertLons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.cosd" class="md-nav__link">
    <span class="md-ellipsis">
      cosd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.ecef2enu" class="md-nav__link">
    <span class="md-ellipsis">
      ecef2enu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.enu2ecef" class="md-nav__link">
    <span class="md-ellipsis">
      enu2ecef
    </span>
  </a>
  
    <nav class="md-nav" aria-label="enu2ecef">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.enu2ecef--args" class="md-nav__link">
    <span class="md-ellipsis">
      Args:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.floorish" class="md-nav__link">
    <span class="md-ellipsis">
      floorish
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht" class="md-nav__link">
    <span class="md-ellipsis">
      geo_to_ht
    </span>
  </a>
  
    <nav class="md-nav" aria-label="geo_to_ht">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht--h-geopotential-re-g0-re-geopotential" class="md-nav__link">
    <span class="md-ellipsis">
      h = (geopotential * Re) / (g0 * Re - geopotential)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.geo_to_ht--assumes-a-sphere-instead-of-an-ellipsoid" class="md-nav__link">
    <span class="md-ellipsis">
      Assumes a sphere instead of an ellipsoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.getChunkSize" class="md-nav__link">
    <span class="md-ellipsis">
      getChunkSize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.getTimeFromFile" class="md-nav__link">
    <span class="md-ellipsis">
      getTimeFromFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_Re" class="md-nav__link">
    <span class="md-ellipsis">
      get_Re
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_dt" class="md-nav__link">
    <span class="md-ellipsis">
      get_dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_file_and_band" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_and_band
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.get_nearest_wmtimes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nearest_wmtimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.nodataToNan" class="md-nav__link">
    <span class="md-ellipsis">
      nodataToNan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.padLower" class="md-nav__link">
    <span class="md-ellipsis">
      padLower
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.projectDelays" class="md-nav__link">
    <span class="md-ellipsis">
      projectDelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.requests_retry_session" class="md-nav__link">
    <span class="md-ellipsis">
      requests_retry_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_extents" class="md-nav__link">
    <span class="md-ellipsis">
      rio_extents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_open" class="md-nav__link">
    <span class="md-ellipsis">
      rio_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_profile" class="md-nav__link">
    <span class="md-ellipsis">
      rio_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.rio_stats" class="md-nav__link">
    <span class="md-ellipsis">
      rio_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.robmax" class="md-nav__link">
    <span class="md-ellipsis">
      robmax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.robmin" class="md-nav__link">
    <span class="md-ellipsis">
      robmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.round_time" class="md-nav__link">
    <span class="md-ellipsis">
      round_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.show_progress" class="md-nav__link">
    <span class="md-ellipsis">
      show_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.sind" class="md-nav__link">
    <span class="md-ellipsis">
      sind
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.transform_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      transform_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.transform_coords" class="md-nav__link">
    <span class="md-ellipsis">
      transform_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.writeArrayToRaster" class="md-nav__link">
    <span class="md-ellipsis">
      writeArrayToRaster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#RAiDER.utilFcns.writeDelays" class="md-nav__link">
    <span class="md-ellipsis">
      writeDelays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="raider-v053-api-reference">RAiDER <em>v0.5.3</em> API Reference</h1>


<div class="doc doc-object doc-module">



<a id="RAiDER"></a>
    <div class="doc doc-contents first">

      <p>Raytracing Atmospheric Delay Estimation for RADAR</p>
<p>Copyright (c) 2019-2022, California Institute of Technology ("Caltech"). All rights reserved.</p>



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="RAiDER.aria" class="doc doc-heading">
            <code>aria</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="RAiDER.aria.calcGUNW" class="doc doc-heading">
            <code>calcGUNW</code>


</h3>

    <div class="doc doc-contents ">

      <p>Calculate the interferometric phase from the 4 delays files of a GUNW
Write it to disk</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.calcGUNW.compute_delays_slc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_delays_slc</span><span class="p">(</span><span class="n">cube_filenames</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get delays from standard RAiDER output formatting ouput including radian
conversion and metadata.</p>
<h6 id="RAiDER.aria.calcGUNW.compute_delays_slc--parameters">Parameters</h6>
<p>cube_filenames : list
    List of xarray datasets/cubes (for each date) output from raider.py CalcDelays
wavelength : float
    Depends on sensor, e.g. for Sentinel-1 it is ~.05</p>
<h6 id="RAiDER.aria.calcGUNW.compute_delays_slc--returns">Returns</h6>
<p>xr.Dataset
    Formatted dataset for GUNW</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/calcGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_delays_slc</span><span class="p">(</span><span class="n">cube_filenames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get delays from standard RAiDER output formatting ouput including radian</span>
<span class="sd">    conversion and metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cube_filenames : list</span>
<span class="sd">        List of xarray datasets/cubes (for each date) output from raider.py CalcDelays</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        Depends on sensor, e.g. for Sentinel-1 it is ~.05</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>
<span class="sd">        Formatted dataset for GUNW</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># parse date from filename</span>
    <span class="n">dct_delays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cube_filenames</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
        <span class="n">dct_delays</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>

    <span class="n">sec</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dct_delays</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">wet_delays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hyd_delays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">attrs_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">phase2range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ref</span><span class="p">,</span> <span class="n">sec</span><span class="p">]:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">dct_delays</span><span class="p">[</span><span class="n">dt</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">da_wet</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">phase2range</span>
            <span class="n">da_hydro</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">phase2range</span>

            <span class="n">wet_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da_wet</span><span class="p">)</span>
            <span class="n">hyd_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da_hydro</span><span class="p">)</span>
            <span class="n">attrs_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

    <span class="n">chunk_sizes</span> <span class="o">=</span> <span class="n">da_wet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">da_wet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">da_wet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span>

    <span class="c1"># open one to copy and store new data</span>
    <span class="n">ds_slc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">ds_slc</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encoding</span>  <span class="c1"># chunksizes and fill value</span>
    <span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;contiguous&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;_FillValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;chunksizes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">chunk_sizes</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">ds_slc</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">],</span> <span class="n">ds_slc</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;reference secondary&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
        <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">TROPO_NAMES</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wet_delays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">TROPO_NAMES</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyd_delays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;radians&#39;</span><span class="p">,</span>
             <span class="s1">&#39;grid_mapping&#39;</span><span class="p">:</span> <span class="s1">&#39;crs&#39;</span><span class="p">,</span>
             <span class="p">}</span>

    <span class="c1">## no data (fill value?) chunk size?</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">TROPO_NAMES</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;reference&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary&#39;</span><span class="p">]):</span>
            <span class="n">descrip</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Delay due to </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;troposphere&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> component of troposphere&quot;</span>
            <span class="n">da_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">attrs</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">descrip</span><span class="p">,</span>
                        <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;standard_name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;RAiDER version&#39;</span><span class="p">:</span> <span class="n">RAiDER</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                        <span class="s1">&#39;model_times_used&#39;</span><span class="p">:</span> <span class="n">attrs_lst</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;model_times_used&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;scene_center_time&#39;</span><span class="p">:</span> <span class="n">attrs_lst</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;reference_time&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;time_interpolation_method&#39;</span><span class="p">:</span> <span class="n">attrs_lst</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">da_attrs</span><span class="p">)</span>
            <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
    <span class="n">ds_slc</span> <span class="o">=</span> <span class="n">ds_slc</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                 <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ray tracing&#39;</span>
                                 <span class="p">)</span>

    <span class="c1"># force these to float32 to prevent stitching errors</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="n">coord</span><span class="p">:</span> <span class="n">ds_slc</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ds_slc</span><span class="o">.</span><span class="n">coords</span><span class="p">}</span>
    <span class="n">ds_slc</span> <span class="o">=</span> <span class="n">ds_slc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ds_slc</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">DIM_NAMES</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">DIM_NAMES</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">DIM_NAMES</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.calcGUNW.tropo_gunw_slc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tropo_gunw_slc</span><span class="p">(</span><span class="n">cube_filenames</span><span class="p">,</span> <span class="n">path_gunw</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Computes and formats the troposphere phase delay for GUNW from RAiDER outputs.</p>
<h6 id="RAiDER.aria.calcGUNW.tropo_gunw_slc--parameters">Parameters</h6>
<p>cube_filenames : list
    list with filename of delay cube for ref and sec date (netcdf)
path_gunw : str
    GUNW netcdf path
wavelength : float
    Wavelength of SAR</p>
<h6 id="RAiDER.aria.calcGUNW.tropo_gunw_slc--returns">Returns</h6>
<p>xr.Dataset
    Output cube that will be included in GUNW</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/calcGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tropo_gunw_slc</span><span class="p">(</span><span class="n">cube_filenames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                   <span class="n">path_gunw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">wavelength</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes and formats the troposphere phase delay for GUNW from RAiDER outputs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cube_filenames : list</span>
<span class="sd">        list with filename of delay cube for ref and sec date (netcdf)</span>
<span class="sd">    path_gunw : str</span>
<span class="sd">        GUNW netcdf path</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        Wavelength of SAR</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>
<span class="sd">        Output cube that will be included in GUNW</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds_slc</span> <span class="o">=</span> <span class="n">compute_delays_slc</span><span class="p">(</span><span class="n">cube_filenames</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>

    <span class="c1"># write the interferometric delay to disk</span>
    <span class="n">update_gunw_slc</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">ds_slc</span><span class="p">)</span>
    <span class="n">update_gunw_version</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote slc delays to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path_gunw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ds_slc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.calcGUNW.update_gunw_slc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_gunw_slc</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">ds_slc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Update the path_gunw file using the slc delays in ds_slc</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/calcGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_gunw_slc</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">ds_slc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update the path_gunw file using the slc delays in ds_slc &quot;&quot;&quot;</span>
    <span class="c1">## first need to delete the variable; only can seem to with h5</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">TROPO_GROUP</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">h5</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="c1"># in case GUNW has already been updated once before</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">h5</span><span class="p">[</span><span class="n">TROPO_NAMES</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">del</span> <span class="n">h5</span><span class="p">[</span><span class="n">TROPO_NAMES</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="s1">&#39;crs&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">h5</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">h5</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


    <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">ds_grp</span>    <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">TROPO_GROUP</span><span class="p">]</span>
        <span class="n">ds_grp</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">ds_slc</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">ds_grp_wm</span> <span class="o">=</span> <span class="n">ds_grp</span><span class="p">[</span><span class="n">ds_slc</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>


        <span class="c1">## create and store new data e.g., corrections/troposphere/GMAO/reference/troposphereWet</span>
        <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="s1">&#39;reference secondary&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">ds_grp_wm</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
            <span class="n">ds_grp_rs</span> <span class="o">=</span> <span class="n">ds_grp_wm</span><span class="p">[</span><span class="n">rs</span><span class="p">]</span>

            <span class="c1">## create the new dimensions e.g., corrections/troposphere/GMAO/reference/latitudeMeta</span>
            <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">DIM_NAMES</span><span class="p">:</span>
                <span class="c1">## dimension may already exist if updating</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ds_grp_rs</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_slc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">dim</span><span class="p">]))</span>
                    <span class="c1">## necessary for transform</span>
                    <span class="n">v</span>  <span class="o">=</span> <span class="n">ds_grp_rs</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
                    <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ds_slc</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">setncatts</span><span class="p">(</span><span class="n">ds_slc</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1">## add the projection if it doesnt exist</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v_proj</span> <span class="o">=</span> <span class="n">ds_grp_rs</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;crs&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">v_proj</span> <span class="o">=</span> <span class="n">ds_grp_rs</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">]</span>
            <span class="n">v_proj</span><span class="o">.</span><span class="n">setncatts</span><span class="p">(</span><span class="n">ds_slc</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

            <span class="c1">## update the actual tropo data</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">TROPO_NAMES</span><span class="p">:</span>
                <span class="n">da</span>        <span class="o">=</span> <span class="n">ds_slc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
                <span class="n">nodata</span>    <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;_FillValue&#39;</span><span class="p">]</span>
                <span class="n">chunksize</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;chunksizes&#39;</span><span class="p">]</span>

                <span class="c1">## in case updating</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span>    <span class="o">=</span> <span class="n">ds_grp_rs</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">DIM_NAMES</span><span class="p">,</span>
                                        <span class="n">chunksizes</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                    <span class="n">v</span>    <span class="o">=</span> <span class="n">ds_grp_rs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

                <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">data</span>
                <span class="n">v</span><span class="o">.</span><span class="n">setncatts</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>


    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Updated </span><span class="si">%s</span><span class="s1"> group in: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">TROPO_GROUP</span><span class="p">),</span> <span class="n">path_gunw</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.calcGUNW.update_gunw_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_gunw_version</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>temporary hack for updating version to test aria-tools</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/calcGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_gunw_version</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; temporary hack for updating version to test aria-tools &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1c&#39;</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.aria.prepFromGUNW" class="doc doc-heading">
            <code>prepFromGUNW</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.aria.prepFromGUNW.GUNW" class="doc doc-heading">
            <code>GUNW</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GUNW</span><span class="p">:</span>
    <span class="n">path_gunw</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">wm</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SNWE</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heights</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">9500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># self.heights   = [-500, 0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datetimes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">look_dir</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_look_dir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_fname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OrbitFile</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orbit_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacing_m</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DCT_POSTING</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wm</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e5</span><span class="p">)</span>

        <span class="c1">## not implemented</span>
        <span class="c1"># self.spacing_m = self.calc_spacing_UTM() # probably wrong/unnecessary</span>
        <span class="c1"># self.lat_file, self.lon_file = self.makeLatLonGrid_native()</span>
        <span class="c1"># self.path_cube  = self.make_cube() # not needed</span>


    <span class="k">def</span> <span class="nf">get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the bounding box (SNWE) from an ARIA GUNW product &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">poly_str</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;productBoundingBox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="n">poly</span>     <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">wkt</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">poly_str</span><span class="p">)</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">bounds</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">make_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Match the ref/sec filename (SLC dates may be different around edge cases) &quot;&quot;&quot;</span>
        <span class="n">ref</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">mid_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">sec</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">mid_time</span><span class="si">}</span><span class="s1">&#39;</span>


    <span class="k">def</span> <span class="nf">get_datetimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the datetimes and set the satellite for orbit &quot;&quot;&quot;</span>
        <span class="n">ref_sec</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slc_dt</span><span class="p">()</span>
        <span class="n">middates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aq</span> <span class="ow">in</span> <span class="n">ref_sec</span><span class="p">:</span>
            <span class="n">st</span><span class="p">,</span> <span class="n">en</span>   <span class="o">=</span> <span class="n">aq</span>
            <span class="n">midpt</span>    <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="p">(</span><span class="n">en</span><span class="o">-</span><span class="n">st</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">middates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">midpt</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)))</span>
            <span class="n">midtime</span> <span class="o">=</span> <span class="n">midpt</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">middates</span><span class="p">,</span> <span class="n">midtime</span>


    <span class="k">def</span> <span class="nf">get_slc_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Grab the SLC start date and time from the GUNW &quot;&quot;&quot;</span>
        <span class="n">group</span>    <span class="o">=</span> <span class="s1">&#39;science/radarMetaData/inputSLC&#39;</span>
        <span class="n">lst_sten</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;reference secondary&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
            <span class="n">ds</span>   <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">slcs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;L1InputGranules&#39;</span><span class="p">]</span>
            <span class="n">nslcs</span> <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="c1"># single slc</span>
            <span class="k">if</span> <span class="n">nslcs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">slc</span>    <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">slc</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Missing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> SLC  metadata in GUNW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
                <span class="n">en</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">st</span><span class="p">,</span> <span class="n">en</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nslcs</span><span class="p">):</span>
                    <span class="n">slc</span> <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">slc</span><span class="p">:</span>
                        <span class="c1">## get the maximum range</span>
                        <span class="n">st_tmp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
                        <span class="n">en_tmp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>

                        <span class="c1">## check the second SLC is within one day of the previous</span>
                        <span class="k">if</span> <span class="n">st</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">stdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">st_tmp</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
                            <span class="n">endiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">en_tmp</span> <span class="o">-</span> <span class="n">en</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
                            <span class="k">assert</span> <span class="n">stdiff</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">endiff</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SLCs granules are too far apart in time. Incorrect metadata&#39;</span>


                        <span class="n">st</span> <span class="o">=</span> <span class="n">st_tmp</span> <span class="k">if</span> <span class="n">st_tmp</span> <span class="o">&gt;</span> <span class="n">st</span> <span class="k">else</span> <span class="n">st</span>
                        <span class="n">en</span> <span class="o">=</span> <span class="n">en_tmp</span> <span class="k">if</span> <span class="n">en_tmp</span> <span class="o">&gt;</span> <span class="n">en</span> <span class="k">else</span> <span class="n">en</span>

                <span class="k">assert</span> <span class="n">st</span><span class="o">&gt;</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Missing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> SLC metadata in GUNW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="n">lst_sten</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">st</span><span class="p">,</span> <span class="n">en</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">lst_sten</span>


    <span class="k">def</span> <span class="nf">get_look_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">look_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;right&#39;</span> <span class="k">if</span> <span class="n">look_dir</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span> <span class="k">else</span> <span class="s1">&#39;left&#39;</span>


    <span class="k">def</span> <span class="nf">get_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span><span class="s1">&#39;science/radarMetaData&#39;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">wavelength</span>


    <span class="k">def</span> <span class="nf">get_orbit_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get orbit file for reference (GUNW: first &amp; later date)&quot;&quot;&quot;</span>
        <span class="n">orbit_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;orbits&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">orbit_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># just to get the correct satellite</span>
        <span class="n">group</span>    <span class="o">=</span> <span class="s1">&#39;science/radarMetaData/inputSLC/reference&#39;</span>

        <span class="n">ds</span>   <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">slcs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;L1InputGranules&#39;</span><span class="p">]</span>
        <span class="c1"># Convert to list of strings</span>
        <span class="n">slcs_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">slc</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="n">slcs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">slc</span><span class="p">]</span>
        <span class="c1"># Remove .zip from the granule ids included in this field</span>
        <span class="n">slcs_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">slc</span><span class="p">:</span> <span class="n">slc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">slcs_lst</span><span class="p">))</span>

        <span class="n">path_orb</span> <span class="o">=</span> <span class="n">get_orbits_from_slc_ids_hyp3lib</span><span class="p">(</span><span class="n">slcs_lst</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">path_orb</span><span class="p">]</span>


    <span class="c1">## ------ methods below are not used</span>
    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">version</span>


    <span class="k">def</span> <span class="nf">getHeights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the 4 height levels within a GUNW &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span><span class="s1">&#39;science/grids/imagingGeometry&#39;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">hgts</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">heightsMeta</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hgts</span>


    <span class="k">def</span> <span class="nf">calc_spacing_UTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convert desired horizontal posting in degrees to meters</span>

<span class="sd">        Want to calculate delays close to native model resolution (3 km for HRR)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">WGS84_to_UTM</span>
        <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>


        <span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">lat0</span> <span class="o">+</span> <span class="n">posting</span><span class="p">,</span> <span class="n">lon0</span> <span class="o">+</span> <span class="n">posting</span>
        <span class="n">res</span>        <span class="o">=</span> <span class="n">WGS84_to_UTM</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon0</span><span class="p">,</span> <span class="n">lon1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">]))</span>
        <span class="n">lon_spacing_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lat_spacing_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">lon_spacing_m</span><span class="p">,</span> <span class="n">lat_spacing_m</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">makeLatLonGrid_native</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Make LatLonGrid at GUNW spacing (90m = 0.00083333) &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>

        <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

        <span class="n">dims</span>   <span class="o">=</span> <span class="s1">&#39;longitude latitude&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">da_lon</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Lon</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Lat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">da_lat</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Lat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Lat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>

        <span class="n">dst_lat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;latitude.geo&#39;</span><span class="p">)</span>
        <span class="n">dst_lon</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;longitude.geo&#39;</span><span class="p">)</span>

        <span class="n">da_lat</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_lat</span><span class="p">)</span>
        <span class="n">da_lon</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_lon</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_lat</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_lon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dst_lat</span><span class="p">,</span> <span class="n">dst_lon</span>


    <span class="k">def</span> <span class="nf">make_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Make LatLonGrid at GUNW spacing (90m = 0.00083333) &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
            <span class="n">lats0</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
            <span class="n">lons0</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>

        <span class="n">lat_st</span><span class="p">,</span> <span class="n">lat_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">lats0</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lats0</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">lon_st</span><span class="p">,</span> <span class="n">lon_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">lons0</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lons0</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lat_st</span><span class="p">,</span> <span class="n">lat_en</span><span class="p">,</span> <span class="n">DCT_POSTING</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wmodel</span><span class="p">])</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lon_st</span><span class="p">,</span> <span class="n">lon_en</span><span class="p">,</span> <span class="n">DCT_POSTING</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wmodel</span><span class="p">])</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">lats</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s1">&#39;heights&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">heights</span><span class="p">})</span>
        <span class="n">dst_cube</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;GeoCube_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_cube</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote cube to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_cube</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dst_cube</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.calc_spacing_UTM" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_spacing_UTM</span><span class="p">(</span><span class="n">posting</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Convert desired horizontal posting in degrees to meters</p>
<p>Want to calculate delays close to native model resolution (3 km for HRR)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_spacing_UTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert desired horizontal posting in degrees to meters</span>

<span class="sd">    Want to calculate delays close to native model resolution (3 km for HRR)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">WGS84_to_UTM</span>
    <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>


    <span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">lat0</span> <span class="o">+</span> <span class="n">posting</span><span class="p">,</span> <span class="n">lon0</span> <span class="o">+</span> <span class="n">posting</span>
    <span class="n">res</span>        <span class="o">=</span> <span class="n">WGS84_to_UTM</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon0</span><span class="p">,</span> <span class="n">lon1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">]))</span>
    <span class="n">lon_spacing_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lat_spacing_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">lon_spacing_m</span><span class="p">,</span> <span class="n">lat_spacing_m</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.getHeights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getHeights</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Get the 4 height levels within a GUNW</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getHeights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get the 4 height levels within a GUNW &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span><span class="s1">&#39;science/grids/imagingGeometry&#39;</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">hgts</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">heightsMeta</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hgts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.get_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bbox</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Get the bounding box (SNWE) from an ARIA GUNW product</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get the bounding box (SNWE) from an ARIA GUNW product &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">poly_str</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;productBoundingBox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="n">poly</span>     <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">wkt</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">poly_str</span><span class="p">)</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">bounds</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.get_datetimes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_datetimes</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Get the datetimes and set the satellite for orbit</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_datetimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get the datetimes and set the satellite for orbit &quot;&quot;&quot;</span>
    <span class="n">ref_sec</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slc_dt</span><span class="p">()</span>
    <span class="n">middates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aq</span> <span class="ow">in</span> <span class="n">ref_sec</span><span class="p">:</span>
        <span class="n">st</span><span class="p">,</span> <span class="n">en</span>   <span class="o">=</span> <span class="n">aq</span>
        <span class="n">midpt</span>    <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="p">(</span><span class="n">en</span><span class="o">-</span><span class="n">st</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">middates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">midpt</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)))</span>
        <span class="n">midtime</span> <span class="o">=</span> <span class="n">midpt</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">middates</span><span class="p">,</span> <span class="n">midtime</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.get_orbit_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_orbit_file</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Get orbit file for reference (GUNW: first &amp; later date)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_orbit_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get orbit file for reference (GUNW: first &amp; later date)&quot;&quot;&quot;</span>
    <span class="n">orbit_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;orbits&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">orbit_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># just to get the correct satellite</span>
    <span class="n">group</span>    <span class="o">=</span> <span class="s1">&#39;science/radarMetaData/inputSLC/reference&#39;</span>

    <span class="n">ds</span>   <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">slcs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;L1InputGranules&#39;</span><span class="p">]</span>
    <span class="c1"># Convert to list of strings</span>
    <span class="n">slcs_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">slc</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="n">slcs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">slc</span><span class="p">]</span>
    <span class="c1"># Remove .zip from the granule ids included in this field</span>
    <span class="n">slcs_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">slc</span><span class="p">:</span> <span class="n">slc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">slcs_lst</span><span class="p">))</span>

    <span class="n">path_orb</span> <span class="o">=</span> <span class="n">get_orbits_from_slc_ids_hyp3lib</span><span class="p">(</span><span class="n">slcs_lst</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">path_orb</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.get_slc_dt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_slc_dt</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Grab the SLC start date and time from the GUNW</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_slc_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Grab the SLC start date and time from the GUNW &quot;&quot;&quot;</span>
    <span class="n">group</span>    <span class="o">=</span> <span class="s1">&#39;science/radarMetaData/inputSLC&#39;</span>
    <span class="n">lst_sten</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;reference secondary&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
        <span class="n">ds</span>   <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">slcs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;L1InputGranules&#39;</span><span class="p">]</span>
        <span class="n">nslcs</span> <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1"># single slc</span>
        <span class="k">if</span> <span class="n">nslcs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slc</span>    <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">slc</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Missing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> SLC  metadata in GUNW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
            <span class="n">en</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="p">,</span> <span class="n">en</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nslcs</span><span class="p">):</span>
                <span class="n">slc</span> <span class="o">=</span> <span class="n">slcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">slc</span><span class="p">:</span>
                    <span class="c1">## get the maximum range</span>
                    <span class="n">st_tmp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
                    <span class="n">en_tmp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">slc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>

                    <span class="c1">## check the second SLC is within one day of the previous</span>
                    <span class="k">if</span> <span class="n">st</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">stdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">st_tmp</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
                        <span class="n">endiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">en_tmp</span> <span class="o">-</span> <span class="n">en</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="n">stdiff</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">endiff</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SLCs granules are too far apart in time. Incorrect metadata&#39;</span>


                    <span class="n">st</span> <span class="o">=</span> <span class="n">st_tmp</span> <span class="k">if</span> <span class="n">st_tmp</span> <span class="o">&gt;</span> <span class="n">st</span> <span class="k">else</span> <span class="n">st</span>
                    <span class="n">en</span> <span class="o">=</span> <span class="n">en_tmp</span> <span class="k">if</span> <span class="n">en_tmp</span> <span class="o">&gt;</span> <span class="n">en</span> <span class="k">else</span> <span class="n">en</span>

            <span class="k">assert</span> <span class="n">st</span><span class="o">&gt;</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Missing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> SLC metadata in GUNW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">lst_sten</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">st</span><span class="p">,</span> <span class="n">en</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">lst_sten</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.makeLatLonGrid_native" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makeLatLonGrid_native</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Make LatLonGrid at GUNW spacing (90m = 0.00083333)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">makeLatLonGrid_native</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make LatLonGrid at GUNW spacing (90m = 0.00083333) &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>

    <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

    <span class="n">dims</span>   <span class="o">=</span> <span class="s1">&#39;longitude latitude&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">da_lon</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Lon</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Lat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
    <span class="n">da_lat</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Lat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Lat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>

    <span class="n">dst_lat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;latitude.geo&#39;</span><span class="p">)</span>
    <span class="n">dst_lon</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;longitude.geo&#39;</span><span class="p">)</span>

    <span class="n">da_lat</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_lat</span><span class="p">)</span>
    <span class="n">da_lon</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_lon</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_lat</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_lon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dst_lat</span><span class="p">,</span> <span class="n">dst_lon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.make_cube" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_cube</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Make LatLonGrid at GUNW spacing (90m = 0.00083333)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make LatLonGrid at GUNW spacing (90m = 0.00083333) &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;science/grids/data&#39;</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds0</span><span class="p">:</span>
        <span class="n">lats0</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
        <span class="n">lons0</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>

    <span class="n">lat_st</span><span class="p">,</span> <span class="n">lat_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">lats0</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lats0</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">lon_st</span><span class="p">,</span> <span class="n">lon_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">lons0</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lons0</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lat_st</span><span class="p">,</span> <span class="n">lat_en</span><span class="p">,</span> <span class="n">DCT_POSTING</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wmodel</span><span class="p">])</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lon_st</span><span class="p">,</span> <span class="n">lon_en</span><span class="p">,</span> <span class="n">DCT_POSTING</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wmodel</span><span class="p">])</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">lats</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s1">&#39;heights&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">heights</span><span class="p">})</span>
    <span class="n">dst_cube</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;GeoCube_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dst_cube</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote cube to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dst_cube</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dst_cube</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.aria.prepFromGUNW.GUNW.make_fname" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_fname</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Match the ref/sec filename (SLC dates may be different around edge cases)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Match the ref/sec filename (SLC dates may be different around edge cases) &quot;&quot;&quot;</span>
    <span class="n">ref</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">mid_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_gunw</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">sec</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">mid_time</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation</span><span class="p">(</span><span class="n">gunw_id</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Determines if all the times for azimuth interpolation are available using Herbie; note that not all 1 hour times
are available within the said date range of HRRR.</p>
<h6 id="RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--parameters">Parameters</h6>
<p>gunw_id : str</p>
<h6 id="RAiDER.aria.prepFromGUNW.check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation--returns">Returns</h6>
<p>bool</p>
<p>Example: 
check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation(S1-GUNW-A-R-106-tops-20220115_20211222-225947-00078W_00041N-PP-4be8-v3_0_0)
should return True</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation</span><span class="p">(</span><span class="n">gunw_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if all the times for azimuth interpolation are available using Herbie; note that not all 1 hour times</span>
<span class="sd">    are available within the said date range of HRRR.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gunw_id : str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>

<span class="sd">    Example: </span>
<span class="sd">    check_hrrr_dataset_availablity_for_s1_azimuth_time_interpolation(S1-GUNW-A-R-106-tops-20220115_20211222-225947-00078W_00041N-PP-4be8-v3_0_0)</span>
<span class="sd">    should return True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_acq_time</span> <span class="o">=</span> <span class="n">_get_acq_time_from_gunw_id</span><span class="p">(</span><span class="n">gunw_id</span><span class="p">,</span> <span class="s1">&#39;reference&#39;</span><span class="p">)</span>
    <span class="n">sec_acq_time</span> <span class="o">=</span> <span class="n">_get_acq_time_from_gunw_id</span><span class="p">(</span><span class="n">gunw_id</span><span class="p">,</span> <span class="s1">&#39;secondary&#39;</span><span class="p">)</span>

    <span class="n">model_step_hours</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ref_times_for_interp</span> <span class="o">=</span> <span class="n">get_times_for_azimuth_interpolation</span><span class="p">(</span><span class="n">ref_acq_time</span><span class="p">,</span> <span class="n">model_step_hours</span><span class="p">)</span>
    <span class="n">sec_times_for_interp</span> <span class="o">=</span> <span class="n">get_times_for_azimuth_interpolation</span><span class="p">(</span><span class="n">sec_acq_time</span><span class="p">,</span> <span class="n">model_step_hours</span><span class="p">)</span>
    <span class="n">ref_dataset_availability</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">check_hrrr_dataset_availability</span><span class="p">,</span> <span class="n">ref_times_for_interp</span><span class="p">))</span>
    <span class="n">sec_dataset_availability</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">check_hrrr_dataset_availability</span><span class="p">,</span> <span class="n">sec_times_for_interp</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">ref_dataset_availability</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">sec_dataset_availability</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.prepFromGUNW.check_weather_model_availability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_weather_model_availability</span><span class="p">(</span><span class="n">gunw_path</span><span class="p">,</span> <span class="n">weather_model_name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Checks weather reference and secondary dates of GUNW occur within
weather model valid range</p>
<h6 id="RAiDER.aria.prepFromGUNW.check_weather_model_availability--parameters">Parameters</h6>
<p>gunw_path : str
weather_model_name : str
    Should be one of 'HRRR', 'HRES', 'ERA5', 'ERA5T', 'GMAO', 'MERRA2'.
Returns</p>
<hr />
<p>bool:
    True if both reference and secondary acquisitions are within the valid range. We assume that
    reference_date &gt; secondary_date (i.e. reference scenes are most recent)</p>
<h6 id="RAiDER.aria.prepFromGUNW.check_weather_model_availability--raises">Raises</h6>
<p>ValueError
    - If weather model is not correctly referencing the Class from RAiDER.models
    - HRRR was requested and it's not in the HRRR CONUS or HRRR AK coverage area</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_weather_model_availability</span><span class="p">(</span><span class="n">gunw_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                     <span class="n">weather_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks weather reference and secondary dates of GUNW occur within</span>
<span class="sd">    weather model valid range</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gunw_path : str</span>
<span class="sd">    weather_model_name : str</span>
<span class="sd">        Should be one of &#39;HRRR&#39;, &#39;HRES&#39;, &#39;ERA5&#39;, &#39;ERA5T&#39;, &#39;GMAO&#39;, &#39;MERRA2&#39;.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool:</span>
<span class="sd">        True if both reference and secondary acquisitions are within the valid range. We assume that</span>
<span class="sd">        reference_date &gt; secondary_date (i.e. reference scenes are most recent)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        - If weather model is not correctly referencing the Class from RAiDER.models</span>
<span class="sd">        - HRRR was requested and it&#39;s not in the HRRR CONUS or HRRR AK coverage area</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_slc_ids</span> <span class="o">=</span> <span class="n">get_slc_ids_from_gunw</span><span class="p">(</span><span class="n">gunw_path</span><span class="p">,</span> <span class="n">reference_or_secondary</span><span class="o">=</span><span class="s1">&#39;reference&#39;</span><span class="p">)</span>
    <span class="n">sec_slc_ids</span> <span class="o">=</span> <span class="n">get_slc_ids_from_gunw</span><span class="p">(</span><span class="n">gunw_path</span><span class="p">,</span> <span class="n">reference_or_secondary</span><span class="o">=</span><span class="s1">&#39;secondary&#39;</span><span class="p">)</span>

    <span class="n">ref_ts</span> <span class="o">=</span> <span class="n">get_acq_time_from_slc_id</span><span class="p">(</span><span class="n">ref_slc_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">timedelta</span><span class="p">()))</span>
    <span class="n">sec_ts</span> <span class="o">=</span> <span class="n">get_acq_time_from_slc_id</span><span class="p">(</span><span class="n">sec_slc_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">timedelta</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">weather_model_name</span> <span class="o">==</span> <span class="s1">&#39;HRRR&#39;</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;/science/grids/data/&#39;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="s1">&#39;coherence&#39;</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;netcdf:</span><span class="si">{</span><span class="n">gunw_path</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">gunw_poly</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">HRRR_CONUS_COVERAGE_POLYGON</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">gunw_poly</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">AK_GEO</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">gunw_poly</span><span class="p">):</span>
            <span class="n">weather_model_name</span> <span class="o">=</span> <span class="s1">&#39;HRRRAK&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HRRR was requested but it is not available in this area&#39;</span><span class="p">)</span>

    <span class="c1"># source: https://stackoverflow.com/a/7668273</span>
    <span class="c1"># Allows us to get weather models as strings</span>
    <span class="c1"># getattr(module, &#39;HRRR&#39;) will return HRRR class</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RAiDER.models&#39;</span><span class="p">]</span>
    <span class="n">weather_model_names</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__all__</span>
    <span class="k">if</span> <span class="n">weather_model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">weather_model_names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The &quot;weather_model_name&quot; must be in </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weather_model_names</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">weather_model_cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">weather_model_name</span><span class="p">)</span>
    <span class="n">weather_model</span> <span class="o">=</span> <span class="n">weather_model_cls</span><span class="p">()</span>

    <span class="n">wm_start_date</span><span class="p">,</span> <span class="n">wm_end_date</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">_valid_range</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wm_end_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the weather model</span><span class="se">\&#39;</span><span class="s1">s end date is not valid: </span><span class="si">{</span><span class="n">wm_end_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ref_cond</span> <span class="o">=</span> <span class="n">ref_ts</span> <span class="o">&lt;=</span> <span class="n">wm_end_date</span>
    <span class="n">sec_cond</span> <span class="o">=</span> <span class="n">sec_ts</span> <span class="o">&gt;=</span> <span class="n">wm_start_date</span>
    <span class="k">return</span> <span class="n">ref_cond</span> <span class="ow">and</span> <span class="n">sec_cond</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.prepFromGUNW.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read parameters needed for RAiDER from ARIA Standard Products (GUNW)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Read parameters needed for RAiDER from ARIA Standard Products (GUNW) &quot;&quot;&quot;</span>

    <span class="c1"># Check if WEATHER MODEL API credentials hidden file exists, if not create it or raise ERROR</span>
    <span class="n">credentials</span><span class="o">.</span><span class="n">check_api</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">api_uid</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>

    <span class="n">GUNWObj</span> <span class="o">=</span> <span class="n">GUNW</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">)</span>

    <span class="n">raider_cfg</span>  <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;weather_model&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="p">,</span>
           <span class="s1">&#39;look_dir&#39;</span><span class="p">:</span>  <span class="n">GUNWObj</span><span class="o">.</span><span class="n">look_dir</span><span class="p">,</span>
           <span class="s1">&#39;cube_spacing_in_m&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">spacing_m</span><span class="p">,</span>
           <span class="s1">&#39;aoi_group&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">SNWE</span><span class="p">},</span>
           <span class="s1">&#39;height_group&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;height_levels&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">heights</span><span class="p">},</span>
           <span class="s1">&#39;date_group&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;date_list&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">dates</span><span class="p">},</span>
           <span class="s1">&#39;time_group&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">mid_time</span><span class="p">,</span>
                          <span class="c1"># Options are &#39;none&#39;, &#39;center_time&#39;, and &#39;azimuth_time_grid&#39;</span>
                          <span class="s1">&#39;interpolate_time&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">interpolate_time</span><span class="p">},</span>
           <span class="s1">&#39;los_group&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ray_trace&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="s1">&#39;orbit_file&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">OrbitFile</span><span class="p">,</span>
                          <span class="s1">&#39;wavelength&#39;</span><span class="p">:</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
                          <span class="p">},</span>

           <span class="s1">&#39;runtime_group&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;raster_format&#39;</span><span class="p">:</span> <span class="s1">&#39;nc&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;output_directory&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                             <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">path_cfg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;GUNW_</span><span class="si">{</span><span class="n">GUNWObj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.yaml&#39;</span>
    <span class="n">update_yaml</span><span class="p">(</span><span class="n">raider_cfg</span><span class="p">,</span> <span class="n">path_cfg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_cfg</span><span class="p">,</span> <span class="n">GUNWObj</span><span class="o">.</span><span class="n">wavelength</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.aria.prepFromGUNW.update_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_yaml</span><span class="p">(</span><span class="n">dct_cfg</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="s1">&#39;GUNW.yaml&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Write a new yaml file from a dictionary.</p>
<p>Updates parameters in the default 'template.yaml' file.
Each key:value pair will in 'dct_cfg' will overwrite that in the default</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/aria/prepFromGUNW.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_yaml</span><span class="p">(</span><span class="n">dct_cfg</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;GUNW.yaml&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Write a new yaml file from a dictionary.</span>

<span class="sd">    Updates parameters in the default &#39;template.yaml&#39; file.</span>
<span class="sd">    Each key:value pair will in &#39;dct_cfg&#39; will overwrite that in the default</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">run_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">RAiDER</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span>
        <span class="s1">&#39;cli&#39;</span><span class="p">,</span>
        <span class="s1">&#39;examples&#39;</span><span class="p">,</span>
        <span class="s1">&#39;template&#39;</span><span class="p">,</span>
        <span class="s1">&#39;template.yaml&#39;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">run_config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Something is wrong with the yaml file </span><span class="si">{</span><span class="n">run_config_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">dct_cfg</span><span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span>  <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote new cfg file: %s&#39;</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dst</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.checkArgs" class="doc doc-heading">
            <code>checkArgs</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.checkArgs.checkArgs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Helper fcn for checking argument compatibility and returns the
correct variables</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/checkArgs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkArgs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper fcn for checking argument compatibility and returns the</span>
<span class="sd">    correct variables</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#########################################################################################################################</span>
    <span class="c1"># Directories</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">weather_model_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">weather_model_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="s1">&#39;weather_files&#39;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">weather_model_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">args</span><span class="p">[</span><span class="s1">&#39;weather_model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_wmLoc</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">weather_model_directory</span><span class="p">)</span>

    <span class="c1">#########################################################################################################################</span>
    <span class="c1"># Date and Time parsing</span>
    <span class="n">args</span><span class="o">.</span><span class="n">date_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">date_list</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">orbit_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Only one orbit file is being used to get the &#39;</span>
                        <span class="s1">&#39;look vectors for all requested times, if you &#39;</span>
                        <span class="s1">&#39;want to use separate orbit files you will &#39;</span>
                        <span class="s1">&#39;need to run raider separately for each time.&#39;</span><span class="p">)</span>

    <span class="n">args</span><span class="o">.</span><span class="n">los</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1">#########################################################################################################################</span>
    <span class="c1"># filenames</span>
    <span class="n">wetNames</span><span class="p">,</span> <span class="n">hydroNames</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">date_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;bounding_box&#39;</span><span class="p">):</span>

            <span class="c1"># Handle the GNSS station file</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;station_file&#39;</span><span class="p">):</span>
                <span class="n">wetFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">_Delay&#39;</span>\
                    <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_ztd.csv&#39;</span>
                <span class="p">)</span>

                <span class="n">hydroFilename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># only the &#39;wetFilename&#39; is used for the station_file</span>

                <span class="c1"># copy the input station file to the output location for editing</span>
                <span class="n">indf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
                <span class="n">indf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">wetFilename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This implies rasters</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">get_raster_ext</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file_format</span><span class="p">)</span>
                <span class="n">wetFilename</span><span class="p">,</span> <span class="n">hydroFilename</span> <span class="o">=</span> <span class="n">makeDelayFileNames</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">los</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                <span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># In this case a cube file format is needed</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">file_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;.nc .h5 h5 hdf5 .hdf5 nc&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;nc&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Invalid extension </span><span class="si">%s</span><span class="s1"> for cube. Defaulting to .nc&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">file_format</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_format</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">wetFilename</span><span class="p">,</span> <span class="n">hydroFilename</span> <span class="o">=</span> <span class="n">makeDelayFileNames</span><span class="p">(</span>
                <span class="n">d</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">los</span><span class="p">,</span>
                <span class="n">fmt</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">wetNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wetFilename</span><span class="p">)</span>
        <span class="n">hydroNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hydroFilename</span><span class="p">)</span>

    <span class="n">args</span><span class="o">.</span><span class="n">wetFilenames</span> <span class="o">=</span> <span class="n">wetNames</span>
    <span class="n">args</span><span class="o">.</span><span class="n">hydroFilenames</span> <span class="o">=</span> <span class="n">hydroNames</span>

    <span class="k">return</span> <span class="n">args</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.checkArgs.makeDelayFileNames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makeDelayFileNames</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">los</span><span class="p">,</span> <span class="n">outformat</span><span class="p">,</span> <span class="n">weather_model_name</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>return names for the wet and hydrostatic delays.</p>
<h4 id="RAiDER.checkArgs.makeDelayFileNames--examples">Examples:</h4>
<blockquote>
<blockquote>
<blockquote>
<p>makeDelayFileNames(datetime(2020, 1, 1, 0, 0, 0), None, "h5", "model_name", "some_dir")
('some_dir/model_name_wet_00_00_00_ztd.h5', 'some_dir/model_name_hydro_00_00_00_ztd.h5')
makeDelayFileNames(None, None, "h5", "model_name", "some_dir")
('some_dir/model_name_wet_ztd.h5', 'some_dir/model_name_hydro_ztd.h5')</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/checkArgs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">makeDelayFileNames</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">los</span><span class="p">,</span> <span class="n">outformat</span><span class="p">,</span> <span class="n">weather_model_name</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    return names for the wet and hydrostatic delays.</span>

<span class="sd">    # Examples:</span>
<span class="sd">    &gt;&gt;&gt; makeDelayFileNames(datetime(2020, 1, 1, 0, 0, 0), None, &quot;h5&quot;, &quot;model_name&quot;, &quot;some_dir&quot;)</span>
<span class="sd">    (&#39;some_dir/model_name_wet_00_00_00_ztd.h5&#39;, &#39;some_dir/model_name_hydro_00_00_00_ztd.h5&#39;)</span>
<span class="sd">    &gt;&gt;&gt; makeDelayFileNames(None, None, &quot;h5&quot;, &quot;model_name&quot;, &quot;some_dir&quot;)</span>
<span class="sd">    (&#39;some_dir/model_name_wet_ztd.h5&#39;, &#39;some_dir/model_name_hydro_ztd.h5&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{model_name}</span><span class="s2">_{{}}_</span><span class="si">{time}{los}</span><span class="s2">.</span><span class="si">{ext}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">weather_model_name</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S_&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">los</span><span class="o">=</span><span class="s2">&quot;ztd&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">los</span><span class="p">,</span> <span class="n">Zenith</span><span class="p">)</span> <span class="ow">or</span> <span class="n">los</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span>
        <span class="n">ext</span><span class="o">=</span><span class="n">outformat</span>
    <span class="p">)</span>
    <span class="n">hydroname</span><span class="p">,</span> <span class="n">wetname</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">format_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtyp</span><span class="p">)</span> <span class="k">for</span> <span class="n">dtyp</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hydro&#39;</span><span class="p">,</span> <span class="s1">&#39;wet&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">hydro_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">hydroname</span><span class="p">)</span>
    <span class="n">wet_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">wetname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wet_file_name</span><span class="p">,</span> <span class="n">hydro_file_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.cli" class="doc doc-heading">
            <code>cli</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="RAiDER.cli.parser" class="doc doc-heading">
            <code>parser</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.cli.raider" class="doc doc-heading">
            <code>raider</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.calcDelays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calcDelays</span><span class="p">(</span><span class="n">iargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse command line arguments using argparse.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calcDelays</span><span class="p">(</span><span class="n">iargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Parse command line arguments using argparse. &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">RAiDER</span>
    <span class="kn">import</span> <span class="nn">RAiDER.processWM</span>
    <span class="kn">from</span> <span class="nn">RAiDER.delay</span> <span class="kn">import</span> <span class="n">tropo_delay</span>
    <span class="kn">from</span> <span class="nn">RAiDER.checkArgs</span> <span class="kn">import</span> <span class="n">checkArgs</span>
    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">writeDelays</span><span class="p">,</span> <span class="n">get_nearest_wmtimes</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="s1">&#39;Examples of use:&#39;</span> \
        <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1"> raider.py run_config_file.yaml&#39;</span> \
        <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1"> raider.py --generate_config template&#39;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">HELP_MESSAGE</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="n">examples</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--download_only&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;only download a weather model.&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Generate an example configuration file, OR</span>
    <span class="c1"># run with a configuration file.</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--generate_config&#39;</span><span class="p">,</span> <span class="s1">&#39;-g&#39;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;template&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example_LA_bbox&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example_LA_GNSS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example_UK_isce&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate an example run configuration and exit&#39;</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;run_config_file&#39;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;a YAML file with arguments to RAiDER&#39;</span>
    <span class="p">)</span>

    <span class="c1"># if not None, will replace first argument (run_config_file)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">iargs</span><span class="p">)</span>

    <span class="c1"># Default example run configuration file</span>
    <span class="n">ex_run_config_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_config</span> <span class="ow">or</span> <span class="s1">&#39;template&#39;</span>
    <span class="n">ex_run_config_dir</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">RAiDER</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span>
        <span class="s1">&#39;cli/examples&#39;</span> <span class="o">/</span> <span class="n">ex_run_config_name</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ex_run_config_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">/</span> <span class="n">filename</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">dest_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s1"> already exists. Overwrite? [y/n]&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="c1"># args.generate_config now guaranteed to be None</span>

    <span class="c1"># If no run configuration file is provided, look for a ./raider.yaml</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">run_config_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">run_config_file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">run_config_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">DEFAULT_RUN_CONFIG_PATH</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;No run configuration file provided! Specify a run configuration &quot;</span>
                <span class="s2">&quot;file or have a &#39;raider.yaml&#39; file in the current directory.&quot;</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">print_usage</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ERROR: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">run_config_file</span> <span class="o">=</span> <span class="n">DEFAULT_RUN_CONFIG_PATH</span>

    <span class="c1"># Read the run config file</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">read_run_config_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">run_config_file</span><span class="p">)</span>

    <span class="c1"># Verify the run config file&#39;s parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">checkArgs</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">dl_only</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;download_only&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">download_only</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="c1"># Extract and buffer the AOI</span>
    <span class="n">los</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;los&#39;</span><span class="p">]</span>
    <span class="n">aoi</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;aoi&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;weather_model&#39;</span><span class="p">]</span>

    <span class="c1"># adjust user requested AOI by grid size and buffer slightly</span>
    <span class="n">aoi</span><span class="o">.</span><span class="n">add_buffer</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">getLLRes</span><span class="p">())</span>

    <span class="c1"># define the xy grid within the buffered bounding box</span>
    <span class="n">aoi</span><span class="o">.</span><span class="n">set_output_xygrid</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_projection&#39;</span><span class="p">])</span>

    <span class="c1"># add a buffer determined by latitude for ray tracing</span>
    <span class="k">if</span> <span class="n">los</span><span class="o">.</span><span class="n">ray_trace</span><span class="p">():</span>
        <span class="n">wm_bounds</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">calc_buffer_ray</span><span class="p">(</span><span class="n">los</span><span class="o">.</span><span class="n">getSensorDirection</span><span class="p">(),</span>
                                        <span class="n">lookDir</span><span class="o">=</span><span class="n">los</span><span class="o">.</span><span class="n">getLookDirection</span><span class="p">(),</span> <span class="n">incAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wm_bounds</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>

    <span class="n">model</span><span class="o">.</span><span class="n">set_latlon_bounds</span><span class="p">(</span><span class="n">wm_bounds</span><span class="p">,</span> <span class="n">output_spacing</span><span class="o">=</span><span class="n">aoi</span><span class="o">.</span><span class="n">get_output_spacing</span><span class="p">())</span>

    <span class="n">wet_filenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;date_list&#39;</span><span class="p">],</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;wetFilenames&#39;</span><span class="p">],</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hydroFilenames&#39;</span><span class="p">]</span>
    <span class="p">):</span>

        <span class="c1">###########################################################</span>
        <span class="c1"># Weather model calculation</span>
        <span class="c1">###########################################################</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting to run the weather model calculation&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested date,time: </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">, %H:%M&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Beginning weather model pre-processing&#39;</span><span class="p">)</span>

        <span class="n">interp_method</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolate_time&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interp_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;interp_method is not specified, defaulting to </span><span class="se">\&#39;</span><span class="s1">none</span><span class="se">\&#39;</span><span class="s1">, i.e. nearest datetime for delay &#39;</span>
                           <span class="s1">&#39;calculation&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">interp_method</span> <span class="o">!=</span> <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">):</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">get_nearest_wmtimes</span><span class="p">(</span>
                <span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dtime</span><span class="p">()</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">dtime</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span> <span class="k">if</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;center_time&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dtime</span><span class="p">()</span>
            <span class="n">time_step_hours</span> <span class="o">=</span> <span class="n">step</span> <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">6</span>
            <span class="c1"># Will yield 2 or 3 dates depending if t is within 5 minutes of time step</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">get_times_for_azimuth_interpolation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">time_step_hours</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only none, center_time, and azimuth_time_grid are accepted values for &#39;</span>
                                      <span class="s1">&#39;interp_method.&#39;</span><span class="p">)</span>
        <span class="n">wfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wfile</span> <span class="o">=</span> <span class="n">RAiDER</span><span class="o">.</span><span class="n">processWM</span><span class="o">.</span><span class="n">prepareWeatherModel</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">tt</span><span class="p">,</span>
                    <span class="n">aoi</span><span class="o">.</span><span class="n">bounds</span><span class="p">(),</span>
                    <span class="n">makePlots</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">wfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wfile</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">TryToKeepGoingError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">interp_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">DatetimeFailed</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">tt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># log when something else happens and then continue with the next time</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">wm_bounds</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Weather model point bounds are &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">S</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">N</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">W</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">E</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Query datetime: </span><span class="si">{</span><span class="n">tt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Weather model files are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wfiles</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Downloading and/or preparation of </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1"> failed.&#39;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># dont process the delays for download only</span>
        <span class="k">if</span> <span class="n">dl_only</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Get the weather model file</span>
        <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">getWeatherFile</span><span class="p">(</span>
            <span class="n">wfiles</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span> <span class="n">interp_method</span><span class="p">)</span>

        <span class="c1"># Now process the delays</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wet_delay</span><span class="p">,</span> <span class="n">hydro_delay</span> <span class="o">=</span> <span class="n">tropo_delay</span><span class="p">(</span>
                <span class="n">t</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">los</span><span class="p">,</span>
                <span class="n">height_levels</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;height_levels&#39;</span><span class="p">],</span>
                <span class="n">out_proj</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_projection&#39;</span><span class="p">],</span>
                <span class="n">zref</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zref&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Datetime </span><span class="si">%s</span><span class="s2"> failed&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Different options depending on the inputs</span>
        <span class="k">if</span> <span class="n">los</span><span class="o">.</span><span class="n">is_Projected</span><span class="p">():</span>
            <span class="n">out_filename</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_ztd&quot;</span><span class="p">,</span> <span class="s2">&quot;_std&quot;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_ztd&quot;</span><span class="p">,</span> <span class="s2">&quot;_std&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">los</span><span class="o">.</span><span class="n">ray_trace</span><span class="p">():</span>
            <span class="n">out_filename</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_std&quot;</span><span class="p">,</span> <span class="s2">&quot;_ray&quot;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_std&quot;</span><span class="p">,</span> <span class="s2">&quot;_ray&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_filename</span> <span class="o">=</span> <span class="n">w</span>

        <span class="c1"># A dataset was returned by the above</span>
        <span class="c1"># Dataset returned: Cube e.g. GUNW workflow</span>
        <span class="k">if</span> <span class="n">hydro_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">wet_delay</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">out_filename</span> <span class="o">=</span> <span class="n">out_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;wet&#39;</span><span class="p">,</span> <span class="s1">&#39;tropo&#39;</span><span class="p">)</span>

            <span class="c1"># data provenance: include metadata for model and times used</span>
            <span class="n">times_str</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">times</span><span class="p">)]</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span>
                                 <span class="n">model_times_used</span><span class="o">=</span><span class="n">times_str</span><span class="p">,</span>
                                 <span class="n">interpolation_method</span><span class="o">=</span><span class="n">interp_method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="s1">&#39;.h5&#39;</span><span class="p">]:</span>
                <span class="n">out_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.nc&#39;</span>

            <span class="k">if</span> <span class="n">out_filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nc&quot;</span><span class="p">):</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">out_filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">):</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span>
                             <span class="n">invalid_netcdf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Successfully wrote delay cube to: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">)</span>
        <span class="c1"># Dataset returned: station files, radar_raster, geocoded_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;station_file&#39;</span><span class="p">:</span>
                <span class="n">out_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.csv&#39;</span>

            <span class="k">if</span> <span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;station_file&#39;</span><span class="p">,</span> <span class="s1">&#39;radar_rasters&#39;</span><span class="p">,</span> <span class="s1">&#39;geocoded_file&#39;</span><span class="p">]:</span>
                <span class="n">writeDelays</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">wet_delay</span><span class="p">,</span> <span class="n">hydro_delay</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span>
                            <span class="n">f</span><span class="p">,</span> <span class="n">outformat</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;raster_format&#39;</span><span class="p">])</span>

        <span class="n">wet_filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wet_filenames</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.combineZTDFiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combineZTDFiles</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Command-line program to process delay files from RAiDER and GNSS into a single file.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combineZTDFiles</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Command-line program to process delay files from RAiDER and GNSS into a single file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.gnss.processDelayFiles</span> <span class="kn">import</span> <span class="n">main</span><span class="p">,</span> <span class="n">combineDelayFiles</span><span class="p">,</span> <span class="n">create_parser</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">create_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">raider_file</span><span class="p">):</span>
        <span class="n">combineDelayFiles</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">raider_file</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">raider_folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gnss_file</span><span class="p">):</span>
        <span class="n">combineDelayFiles</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gnss_file</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">gnss_folder</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;GNSS&#39;</span><span class="p">,</span>
                          <span class="n">ref</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">raider_file</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">column_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">gnss_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">raider_file</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">gnss_file</span><span class="p">,</span>
            <span class="n">col_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">column_name</span><span class="p">,</span>
            <span class="n">raider_delay</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">raider_column_name</span><span class="p">,</span>
            <span class="n">outName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">out_name</span><span class="p">,</span>
            <span class="n">localTime</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">local_time</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.combine_files_using_azimuth_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_files_using_azimuth_time</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Combine files using azimuth time interpolation</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_files_using_azimuth_time</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Combine files using azimuth time interpolation&#39;&#39;&#39;</span>

    <span class="c1"># read the individual datetime datasets</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">wfiles</span><span class="p">]</span>

    <span class="c1"># Pull the datetimes from the datasets</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">T%H_%M_%S&#39;</span><span class="p">))</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">]</span>

    <span class="n">time_grid</span> <span class="o">=</span> <span class="n">get_time_grid_for_aztime_interp</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

    <span class="n">wgts</span> <span class="o">=</span> <span class="n">get_inverse_weights_for_dates</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="c1"># combine datasets</span>
    <span class="n">ds_out</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro&#39;</span><span class="p">,</span> <span class="s1">&#39;wet_total&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro_total&#39;</span><span class="p">]:</span>
        <span class="n">ds_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">wgt</span> <span class="o">*</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wgts</span><span class="p">,</span> <span class="n">datasets</span><span class="p">)])</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Date1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Date2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Give the weighted combination a new file name</span>
    <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">T%H_%M_%S&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_timeInterpAziGrid_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]),</span>
    <span class="p">)</span>

    <span class="c1"># write the combined results to disk</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">weather_model_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weather_model_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.combine_weather_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_weather_files</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;center_time&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Interpolate downloaded weather files and save to a single file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_weather_files</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;center_time&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Interpolate downloaded weather files and save to a single file&#39;&#39;&#39;</span>

    <span class="n">STYLE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;center_time&#39;</span><span class="p">:</span> <span class="s1">&#39;_timeInterp_&#39;</span><span class="p">,</span>
             <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">:</span> <span class="s1">&#39;_timeInterpAziGrid_&#39;</span><span class="p">}</span>

    <span class="c1"># read the individual datetime datasets</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">wfiles</span><span class="p">]</span>

    <span class="c1"># Pull the datetimes from the datasets</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">T%H_%M_%S&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoWeatherModelData</span><span class="p">()</span>

    <span class="c1"># calculate relative weights of each dataset</span>
    <span class="k">if</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;center_time&#39;</span><span class="p">:</span>
        <span class="n">wgts</span> <span class="o">=</span> <span class="n">get_weights_time_interp</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">:</span>
        <span class="n">time_grid</span> <span class="o">=</span> <span class="n">get_time_grid_for_aztime_interp</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="n">wgts</span> <span class="o">=</span> <span class="n">get_inverse_weights_for_dates</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="c1"># combine datasets</span>
    <span class="n">ds_out</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro&#39;</span><span class="p">,</span> <span class="s1">&#39;wet_total&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro_total&#39;</span><span class="p">]:</span>
        <span class="n">ds_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">wgt</span> <span class="o">*</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wgts</span><span class="p">,</span> <span class="n">datasets</span><span class="p">)])</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Date1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Date2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Give the weighted combination a new file name</span>
    <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>
        <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">T%H_%M_%S&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">STYLE</span><span class="p">[</span><span class="n">interp_method</span><span class="p">]</span> <span class="o">+</span>
        <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]),</span>
    <span class="p">)</span>

    <span class="c1"># write the combined results to disk</span>
    <span class="n">ds_out</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">weather_model_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weather_model_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.downloadGNSS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downloadGNSS</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse command line arguments using argparse.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">downloadGNSS</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command line arguments using argparse.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.gnss.downloadGNSSDelays</span> <span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">dlGNSS</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot; </span><span class="se">\</span>
<span class="s2">    Check for and download tropospheric zenith delays for a set of GNSS stations from UNR</span>

<span class="s2">    Example call to virtually access and append zenith delay information to a CSV table in specified output</span>
<span class="s2">    directory, across specified range of time (in YYMMDD YYMMDD) and all available times of day, and confined to specified</span>
<span class="s2">    geographic bounding box :</span>
<span class="s2">    downloadGNSSdelay.py --out products -y 20100101 20141231 -b &#39;39 40 -79 -78&#39;</span>

<span class="s2">    Example call to virtually access and append zenith delay information to a CSV table in specified output</span>
<span class="s2">    directory, across specified range of time (in YYMMDD YYMMDD) and specified time of day, and distributed globally :</span>
<span class="s2">    downloadGNSSdelay.py --out products -y 20100101 20141231 --returntime &#39;00:00:00&#39;</span>


<span class="s2">    Example call to virtually access and append zenith delay information to a CSV table in specified output</span>
<span class="s2">    directory, across specified range of time in 12 day steps (in YYMMDD YYMMDD days) and specified time of day, and distributed globally :</span>
<span class="s2">    downloadGNSSdelay.py --out products -y 20100101 20141231 12 --returntime &#39;00:00:00&#39;</span>

<span class="s2">    Example call to virtually access and append zenith delay information to a CSV table in specified output</span>
<span class="s2">    directory, across specified range of time (in YYMMDD YYMMDD) and specified time of day, and distributed globally but restricted</span>
<span class="s2">    to list of stations specified in input textfile :</span>
<span class="s2">    downloadGNSSdelay.py --out products -y 20100101 20141231 --returntime &#39;00:00:00&#39; -f station_list.txt</span>

<span class="s2">    NOTE, following example call to physically download zenith delay information not recommended as it is not</span>
<span class="s2">    necessary for most applications.</span>
<span class="s2">    Example call to physically download and append zenith delay information to a CSV table in specified output</span>
<span class="s2">    directory, across specified range of time (in YYMMDD YYMMDD) and specified time of day, and confined to specified</span>
<span class="s2">    geographic bounding box :</span>
<span class="s2">    downloadGNSSdelay.py --download --out products -y 20100101 20141231 --returntime &#39;00:00:00&#39; -b &#39;39 40 -79 -78&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Stations to check/download</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
        <span class="s1">&#39;Stations to check/download. Can be a lat/lon bounding box or file, or will run the whole world if not specified&#39;</span><span class="p">)</span>
    <span class="n">area</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--station_file&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_file&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Text file containing a list of 4-char station IDs separated by newlines&#39;</span><span class="p">))</span>
    <span class="n">area</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--bounding_box&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;bounding_box&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide either valid shapefile or Lat/Lon Bounding SNWE. -- Example : &#39;19 20 -99.5 -98.5&#39;&quot;</span><span class="p">)</span>
    <span class="n">area</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--gpsrepo&#39;</span><span class="p">,</span> <span class="s1">&#39;-gr&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;UNR&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;gps_repo&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Specify GPS repository you wish to query. Currently supported archives: UNR.&#39;</span><span class="p">))</span>

    <span class="n">misc</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Run parameters&quot;</span><span class="p">)</span>
    <span class="n">add_out</span><span class="p">(</span><span class="n">misc</span><span class="p">)</span>

    <span class="n">misc</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--date&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;dateList&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Date to calculate delay.</span>
<span class="s2">            Can be a single date, a list of two dates (earlier, later) with 1-day interval, or a list of two dates and interval in days (earlier, later, interval).</span>
<span class="s2">            Example accepted formats:</span>
<span class="s2">               YYYYMMDD or</span>
<span class="s2">               YYYYMMDD YYYYMMDD</span>
<span class="s2">               YYYYMMDD YYYYMMDD N</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="n">DateListAction</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">date_type</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">misc</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--returntime&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;returnTime&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Return delays closest to this specified time. If not specified, the GPS delays for all times will be returned. Input in &#39;HH:MM:SS&#39;, e.g. &#39;16:00:00&#39;&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">misc</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--download&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Physically download data. Note this option is not necessary to proceed with statistical analyses, as data can be handled virtually in the program.&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;download&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">add_cpus</span><span class="p">(</span><span class="n">misc</span><span class="p">)</span>
    <span class="n">add_verbose</span><span class="p">(</span><span class="n">misc</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">dlGNSS</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.getWeatherFile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getWeatherFile</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <h5 id="RAiDER.cli.raider.getWeatherFile--time-interpolation">Time interpolation</h5>
<h5 id="RAiDER.cli.raider.getWeatherFile--_1"></h5>
<h5 id="RAiDER.cli.raider.getWeatherFile--need-to-handle-various-cases-including-if-the-exact-weather-model-time-is">Need to handle various cases, including if the exact weather model time is</h5>
<h5 id="RAiDER.cli.raider.getWeatherFile--requested-or-if-one-or-more-datetimes-are-not-available-from-the-weather">requested, or if one or more datetimes are not available from the weather</h5>
<h5 id="RAiDER.cli.raider.getWeatherFile--model-data-provider">model data provider</h5>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getWeatherFile</span><span class="p">(</span><span class="n">wfiles</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # Time interpolation</span>
<span class="sd">    #</span>
<span class="sd">    # Need to handle various cases, including if the exact weather model time is</span>
<span class="sd">    # requested, or if one or more datetimes are not available from the weather</span>
<span class="sd">    # model data provider</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># time interpolation method: number of expected files</span>
    <span class="n">EXPECTED_NUM_FILES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;center_time&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

    <span class="n">Nfiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wfiles</span><span class="p">)</span>
    <span class="n">Ntimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">Nfiles_expected</span> <span class="o">=</span> <span class="n">EXPECTED_NUM_FILES</span><span class="p">[</span><span class="n">interp_method</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;getWeatherFile: interp_method </span><span class="si">{}</span><span class="s1"> is not known&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interp_method</span><span class="p">))</span>

    <span class="n">Nmatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nfiles_expected</span> <span class="o">==</span> <span class="n">Nfiles</span><span class="p">)</span>
    <span class="n">Tmatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nfiles</span> <span class="o">==</span> <span class="n">Ntimes</span><span class="p">)</span>

    <span class="c1"># Case 1: no files downloaded</span>
    <span class="k">if</span> <span class="n">Nfiles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No weather model data was successfully processed.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Case 2 - nearest weather model time is requested and retrieved</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;center_time&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">Nmatch</span><span class="p">:</span>  <span class="c1"># Case 3: two weather files downloaded</span>
            <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">combine_weather_files</span><span class="p">(</span>
                <span class="n">wfiles</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;center_time&#39;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Tmatch</span><span class="p">:</span>  <span class="c1"># Case 4: Exact time is available without interpolation</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;Time interpolation is not needed as exact time is available&#39;</span><span class="p">)</span>
            <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">Nfiles</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Case 5: one file does not download for some reason</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;getWeatherFile: One datetime is not available to download, defaulting to nearest available date&#39;</span><span class="p">)</span>
            <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">wfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrongNumberOfFiles</span><span class="p">(</span><span class="n">Nfiles_expected</span><span class="p">,</span> <span class="n">Nfiles</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">interp_method</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;azimuth_time_grid&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">Nmatch</span> <span class="ow">or</span> <span class="n">Tmatch</span><span class="p">:</span>  <span class="c1"># Case 6: all files downloaded</span>
            <span class="n">weather_model_file</span> <span class="o">=</span> <span class="n">combine_weather_files</span><span class="p">(</span>
                <span class="n">wfiles</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;azimuth_time_grid&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrongNumberOfFiles</span><span class="p">(</span><span class="n">Nfiles_expected</span><span class="p">,</span> <span class="n">Nfiles</span><span class="p">)</span>

    <span class="c1"># Case 7 - Anything else errors out</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wfiles</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="n">interp_method</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> retrieved weather model files was not well posed &#39;</span>
                                  <span class="s1">&#39;for the current workflow.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weather_model_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.get_time_grid_for_aztime_interp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_time_grid_for_aztime_interp</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate the time-varying grid for use with azimuth time interpolation</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_grid_for_aztime_interp</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate the time-varying grid for use with azimuth time interpolation&#39;&#39;&#39;</span>

    <span class="c1"># Each model will require some inspection here</span>
    <span class="c1"># the subsequent s1 azimuth time grid requires dimension</span>
    <span class="c1"># inputs to all have same dimensions and either be</span>
    <span class="c1"># 1d or 3d.</span>
    <span class="n">AZ_TIME_ALLOWED_MODELS</span> <span class="o">=</span> <span class="s1">&#39;hrrr hrrrak hrrr-ak&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">AZ_TIME_ALLOWED_MODELS</span><span class="p">:</span>
        <span class="n">lat_2d</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span>
        <span class="n">lon_2d</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span>
        <span class="n">z_1d</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">data</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">z_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">lat_2d</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">lon_2d</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">hgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">z_1d</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s1">&#39;Azimuth Time is currently only implemented for HRRR&#39;</span><span class="p">)</span>

    <span class="n">time_grid</span> <span class="o">=</span> <span class="n">get_s1_azimuth_time_grid</span><span class="p">(</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">hgt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># This is the acq time from loop</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">time_grid</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;The Time Grid return nans meaning no orbit was downloaded.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">time_grid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.get_weights_time_interp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_weights_time_interp</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate weights for time interpolation using simple inverse linear weighting</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_weights_time_interp</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate weights for time interpolation using simple inverse linear weighting&#39;&#39;&#39;</span>
    <span class="n">date1</span><span class="p">,</span> <span class="n">date2</span> <span class="o">=</span> <span class="n">times</span>
    <span class="n">wgts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">date1</span><span class="p">)</span> <span class="o">/</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">date2</span><span class="p">,</span> <span class="n">date1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span>
            <span class="n">get_dt</span><span class="p">(</span><span class="n">date2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">date2</span><span class="p">,</span> <span class="n">date1</span><span class="p">)]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wgts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Time interpolation weights do not sum to one; something is off with query datetime: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">wgts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.raider.read_run_config_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_run_config_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read the run config file into a dictionary structure.
Args:
    fname (str): full path to the run config file
Returns:
    dict: arguments to pass to RAiDER functions</p>
<p>Examples:</p>
<blockquote>
<blockquote>
<blockquote>
<p>run_config = read_run_config_file('raider.yaml')</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/raider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_run_config_file</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the run config file into a dictionary structure.</span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str): full path to the run config file</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: arguments to pass to RAiDER functions</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; run_config = read_run_config_file(&#39;raider.yaml&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.cli.validators</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">enforce_time</span><span class="p">,</span> <span class="n">parse_dates</span><span class="p">,</span> <span class="n">get_query_region</span><span class="p">,</span> <span class="n">get_heights</span><span class="p">,</span> <span class="n">get_los</span><span class="p">,</span> <span class="n">enforce_wm</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Something is wrong with the yaml file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="c1"># Drop any values not specified</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">drop_nans</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Need to ensure that all the groups exist, even if they are not specified by the user</span>
    <span class="n">group_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_group&#39;</span><span class="p">,</span> <span class="s1">&#39;time_group&#39;</span><span class="p">,</span> <span class="s1">&#39;aoi_group&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;height_group&#39;</span><span class="p">,</span> <span class="s1">&#39;los_group&#39;</span><span class="p">,</span> <span class="s1">&#39;runtime_group&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Parse the user-provided arguments</span>
    <span class="n">run_config</span> <span class="o">=</span> <span class="n">DEFAULT_DICT</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;runtime_group&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">run_config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;time_group&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">enforce_time</span><span class="p">(</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;date_group&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;date_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_dates</span><span class="p">(</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;aoi_group&#39;</span><span class="p">:</span>
            <span class="c1"># in case a DEM is passed and should be used</span>
            <span class="n">dct_temp</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                        <span class="o">**</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;height_group&#39;</span><span class="p">])}</span>
            <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;aoi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_query_region</span><span class="p">(</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">dct_temp</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;los_group&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;los&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_los</span><span class="p">(</span><span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;zref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zref&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;look_dir&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown look direction </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;look_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;cube_spacing_in_m&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;download_only&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># Have to guarantee that certain variables exist prior to looking at heights</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;height_group&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">get_heights</span><span class="p">(</span>
                    <span class="n">AttributeDict</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;output_directory&#39;</span><span class="p">],</span>
                    <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;station_file&#39;</span><span class="p">],</span>
                    <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;bounding_box&#39;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;weather_model&#39;</span><span class="p">:</span>
            <span class="n">run_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">enforce_wm</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;aoi&#39;</span><span class="p">])</span>

    <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;aoi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="o">=</span> <span class="n">run_config</span><span class="p">[</span><span class="s1">&#39;cube_spacing_in_m&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="n">run_config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.cli.statsPlot" class="doc doc-heading">
            <code>statsPlot</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.statsPlot.RaiderStats" class="doc doc-heading">
            <code>RaiderStats</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Class which loads standard weather model/GPS delay files and generates a series of user-requested statistics and graphics.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RaiderStats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Class which loads standard weather model/GPS delay files and generates a series of user-requested statistics and graphics.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># import dependencies</span>
    <span class="kn">import</span> <span class="nn">glob</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filearg</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timeinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">obs_errlimit</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="n">time_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">station_seasonal_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorpercentile</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span>
                 <span class="n">usr_colormap</span><span class="o">=</span><span class="s1">&#39;hot_r&#39;</span><span class="p">,</span> <span class="n">grid_heatmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_delay_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_delay_median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_delay_stdev</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">grid_seasonal_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_delay_absolute_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_delay_absolute_median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">grid_delay_absolute_stdev</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_seasonal_absolute_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_to_raster</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_span</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
                 <span class="n">period_limit</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">phaseamp_per_station</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">filearg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">col_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="n">bbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span> <span class="o">=</span> <span class="n">timeinterval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="n">seasonalinterval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_errlimit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">obs_errlimit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">time_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span> <span class="o">=</span> <span class="n">stationsongrids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_seasonal_phase</span> <span class="o">=</span> <span class="n">station_seasonal_phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span> <span class="o">=</span> <span class="n">cbounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span> <span class="o">=</span> <span class="n">colorpercentile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usr_colormap</span> <span class="o">=</span> <span class="n">usr_colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span> <span class="o">=</span> <span class="n">grid_heatmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span> <span class="o">=</span> <span class="n">grid_delay_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span> <span class="o">=</span> <span class="n">grid_delay_median</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span> <span class="o">=</span> <span class="n">grid_delay_stdev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span> <span class="o">=</span> <span class="n">grid_seasonal_phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span> <span class="o">=</span> <span class="n">grid_delay_absolute_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span> <span class="o">=</span> <span class="n">grid_delay_absolute_median</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span> <span class="o">=</span> <span class="n">grid_delay_absolute_stdev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span> <span class="o">=</span> <span class="n">grid_seasonal_absolute_phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span> <span class="o">=</span> <span class="n">grid_to_raster</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span> <span class="o">=</span> <span class="n">min_span</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_limit</span> <span class="o">=</span> <span class="n">period_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span> <span class="o">=</span> <span class="n">numCPUs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseamp_per_station</span> <span class="o">=</span> <span class="n">phaseamp_per_station</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_range</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_variance</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_variogram_rmse</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># create workdir if it doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>

        <span class="c1"># get colorbounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

        <span class="c1"># Pass color percentile and check for input error</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input colorpercentile lower threshold </span><span class="si">{}</span><span class="s1"> higher than upper threshold </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># load dataframe directly if previously generated TIF grid-file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;grid_heatmap&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_heatmap&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_mean&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_mean&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_median&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_median&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_period&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_range&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_range&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_variance&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_variance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_variance&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;grid_variogram_rmse&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="n">load_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_variogram_rmse&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># setup dataframe for statistical analyses (if CSV)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_DF</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># dataset, spacing=1, userbbox=None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the bbox, spacing in deg (by default 1deg), optionally pass user-specified bbox. Output array in WESN degrees &quot;&quot;&quot;</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]))]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfextents_poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span>
                                                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))))</span>
            <span class="n">userbbox_poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span>
                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))))</span>
            <span class="k">if</span> <span class="n">userbbox_poly</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">dfextents_poly</span><span class="p">):</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;User-specified bounds do not overlap with dataset bounds, adjust bounds and re-run program.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.</span> <span class="ow">or</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">180.</span> <span class="ow">or</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.</span> <span class="ow">or</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">90.</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Specified bounds exceed -180/180 lon and/or -90/90 lat, adjust bounds and re-run program.&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">dfextents_poly</span><span class="p">,</span> <span class="n">userbbox_poly</span>

        <span class="c1"># ensure that extents do not exceed -180/180 lon and -90/90 lat</span>
        <span class="k">if</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.</span><span class="p">:</span>
            <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
        <span class="k">if</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">180.</span><span class="p">:</span>
            <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.</span>
        <span class="k">if</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.</span><span class="p">:</span>
            <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
        <span class="k">if</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.</span>

        <span class="c1"># ensure even spacing, set spacing to 1 if specified spacing is not even multiple of bounds</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;User-specified spacing </span><span class="si">%s</span><span class="s2"> is not even multiple of bounds, resetting spacing to 1</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Create corners of rectangle to be transformed to a grid</span>
        <span class="n">nw</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">extent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="c1"># Store grid dimension [y,x]</span>
        <span class="n">grid_dim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">((</span><span class="n">extent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)]</span>

        <span class="c1"># Iterate over 2D area</span>
        <span class="n">gridpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">se</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">nw</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">se</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">nw</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">y_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">gridpoints</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>
            <span class="n">x_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>
        <span class="n">gridpoints</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">extent</span><span class="p">,</span> <span class="n">grid_dim</span><span class="p">,</span> <span class="n">gridpoints</span>

    <span class="k">def</span> <span class="nf">_check_stationgrid_intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_ID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return index of grid cell which intersects with station</span>
<span class="sd">        Note: Fast, but assumes station locations don&#39;t change</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">Point</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">stat_ID</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">stat_ID</span><span class="p">)]))</span>
        <span class="c1"># Get grid cell polygon which intersect with station coordinate</span>
        <span class="n">grid_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygon_tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="c1"># Pass corresponding grid cell index</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_int</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grid_int</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;NaN&#39;</span>

    <span class="k">def</span> <span class="nf">_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read a input file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

        <span class="c1"># check if user-specified key is valid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;User-specified key </span><span class="si">{}</span><span class="s1"> not found in input file </span><span class="si">{}</span><span class="s1">. Must specify valid key.&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">))</span>

        <span class="c1"># if user-specified key is the same as the &#39;Date&#39; field, rename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">==</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Input key </span><span class="si">{}</span><span class="s1"> same as &quot;Date&quot; field name, rename the former&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+=</span> <span class="s1">&#39;_plot&#39;</span>
            <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>

        <span class="c1"># convert to specified output unit</span>
        <span class="n">inputunit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">],</span> <span class="n">inputunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="c1"># filter out obs by error</span>
        <span class="k">if</span> <span class="s1">&#39;sigZTD&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigZTD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigZTD&#39;</span><span class="p">],</span> <span class="n">inputunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_errlimit</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_errlimit</span><span class="p">,</span> <span class="n">inputunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigZTD&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_errlimit</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Key &quot;sigZTD&quot; not found in dataset, cannot filter out obs by error&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">create_DF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Create dataframe.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Open file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">()</span>

        <span class="c1"># Filter dataframe</span>
        <span class="c1"># drop all nans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># convert to datetime object</span>

        <span class="c1"># time-interval filter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># seasonal filter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># get day of year</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2001-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">tm_yday</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2001-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span><span class="p">]</span>
            <span class="c1"># track input order and wrap around year if necessary</span>
            <span class="c1"># e.g. month/day: 03/01 to 06/01</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># non leap-year</span>
                <span class="n">filtered_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
                <span class="c1"># leap-year</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span>
                                         <span class="mi">59</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">]</span>
                <span class="n">filtered_self_ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">filtered_self</span><span class="p">,</span> <span class="n">filtered_self_ly</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">filtered_self</span>
            <span class="c1"># e.g. month/day: 12/01 to 03/01</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># non leap-year</span>
                <span class="n">filtered_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="c1"># leap-year</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span>
                                         <span class="mi">59</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">]</span>
                <span class="n">filtered_self_ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">filtered_self</span><span class="p">,</span> <span class="n">filtered_self_ly</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">filtered_self</span>

        <span class="c1"># estimate central longitude lines if &#39;--time_lines&#39; specified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="ow">and</span> <span class="s1">&#39;Datetime&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int32&quot;</span><span class="p">)</span>
            <span class="c1"># get list of unique times</span>
            <span class="n">all_hrs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]))</span>

            <span class="c1"># get central longitude bands associated with each time</span>
            <span class="n">central_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># if single time, avoid loop</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">central_points</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])],</span>
                                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">):</span>
                    <span class="c1"># last entry</span>
                    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
                    <span class="c1"># first entry</span>
                    <span class="k">elif</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                                       <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])]</span>
                    <span class="n">central_points</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])],</span>
                                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])]))</span>
            <span class="c1"># get central longitudes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">midpoint</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">central_points</span><span class="p">]</span>

        <span class="c1"># Get bbox, buffered by grid spacing.</span>
        <span class="c1"># Check if bbox input is valid list.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;Cannot understand the --bounding_box argument. String input is incorrect or path does not exist.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extent</span><span class="p">()</span>

        <span class="c1"># generate list of grid-polygons</span>
        <span class="n">append_poly</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">append_poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span>
                                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))))</span>  <span class="c1"># Pass lons/lats to create polygon</span>

        <span class="c1"># Check for grid cell intersection with each station</span>
        <span class="n">idtogrid_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
            <span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="c1"># Initiate R-tree of gridded array domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polygon_tree</span> <span class="o">=</span> <span class="n">STRtree</span><span class="p">(</span><span class="n">append_poly</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stat_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">grd_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_stationgrid_intersection</span><span class="p">(</span><span class="n">stat_ID</span><span class="p">)</span>
            <span class="n">idtogrid_dict</span><span class="p">[</span><span class="n">stat_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd_index</span>

        <span class="c1"># map gridnode dictionary to dataframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">idtogrid_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygon_tree</span><span class="p">,</span> <span class="n">idtogrid_dict</span><span class="p">,</span> <span class="n">append_poly</span>
        <span class="c1"># sort by grid and date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>

        <span class="c1"># If specified, pass station locations to superimpose on gridplots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">:</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span> <span class="o">=</span> <span class="p">[</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
                <span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

        <span class="c1"># If specified, setup gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_heatmap&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">,</span> <span class="s1">&#39;grid_heatmap&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1i</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int16&#39;</span><span class="p">,</span>
                              <span class="n">noData</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">:</span>
            <span class="c1"># Take mean of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_mean&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_mean&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">:</span>
            <span class="c1"># Take mean of station-wise medians per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_median&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_median&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">:</span>
            <span class="c1"># Take mean of station-wise stdev per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">:</span>
            <span class="c1"># Take mean of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">:</span>
            <span class="c1"># Take median of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">:</span>
            <span class="c1"># Take stdev of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="c1"># If specified, compute phase/amplitude fits</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_seasonal_phase</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">:</span>
            <span class="c1"># Sort by coordinates</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
            <span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
            <span class="c1"># Setup variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]))):</span>
                <span class="c1"># pass all values corresponding to station (ID, data = y, time = x)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_limit</span><span class="p">))</span>
            <span class="c1"># Parallelize iteration through all grid-cells and time slices</span>
            <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_and_phase</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="c1"># map phase/amplitude fits dictionary to dataframe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="p">)</span>
            <span class="c1"># check if there are any valid data values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No valid data values, adjust --min_span inputs for time span in years </span><span class="si">{}</span><span class="s2"> and/or fractional obs. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span>
                                <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="p">)</span>
            <span class="c1"># drop nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># If grid plots specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">:</span>
                <span class="c1"># Pass mean phase of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass mean amplitude of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass mean period of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1">########################################################################################################################</span>
                <span class="c1"># Pass mean phase stdev of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass mean amplitude stdev of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass mean period stdev of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass mean seasonal fit RMSE of station-wise means per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1">########################################################################################################################</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">:</span>
                <span class="c1"># Pass absolute mean phase of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass absolute mean amplitude of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass absolute mean period of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1">########################################################################################################################</span>
                <span class="c1"># Pass absolute mean phase stdev of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass absolute mean amplitude stdev of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="c1"># Pass absolute mean period stdev of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

                <span class="c1"># Pass absolute mean seasonal fit RMSE of all data per gridcell</span>
                <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
                <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># If specified, save gridded array(s)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                    <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                    <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                                  <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_amplitude_and_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">min_span</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_frac</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">period_limit</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fit sin to the input time sequence, and return fitting parameters:</span>
<span class="sd">            &quot;amp&quot;, &quot;omega&quot;, &quot;phase&quot;, &quot;offset&quot;, &quot;freq&quot;, &quot;period&quot; and &quot;fitfunc&quot;.</span>
<span class="sd">        Minimum time span in years (min_span), minimum fractional observations in span (min_frac),</span>
<span class="sd">            and period limit (period_limit) enforced for statistical analysis.</span>
<span class="sd">        Source: https://stackoverflow.com/questions/16716302/how-do-i-fit-a-sine-curve-to-my-data-with-pylab-and-numpy</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ampfit</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">phsfit</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">periodfit</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ampfit_c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">phsfit_c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">periodfit_c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seasonalfit_rmse</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ampfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">phsfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">periodfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">ampfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">phsfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">periodfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">seasonalfit_rmse</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Fit with custom fit function with fixed period, if specified</span>
        <span class="k">if</span> <span class="n">period_limit</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="c1"># convert from years to radians/seconds</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">period_limit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">31556952</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">custom_sine_function_base</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sine_function_base</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">custom_sine_function_base</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sine_function_base</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c1"># If station TS does not span specified time period, pass NaNs</span>
        <span class="n">time_span_yrs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span> <span class="o">/</span> <span class="mi">31556952</span>
        <span class="k">if</span> <span class="n">time_span_yrs</span> <span class="o">&gt;=</span> <span class="n">min_span</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tt</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">time_span_yrs</span> <span class="o">*</span> <span class="mf">365.25</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_frac</span><span class="p">:</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tt</span><span class="p">),</span> <span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># assume uniform spacing</span>
            <span class="n">Fyy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
            <span class="n">guess_freq</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">Fyy</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># excluding the zero period &quot;peak&quot;, which is related to offset</span>
            <span class="n">guess_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="n">guess_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
            <span class="n">guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">guess_amp</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">guess_freq</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">guess_offset</span><span class="p">])</span>
            <span class="c1"># Adjust frequency guess to reflect fixed period, if specified</span>
            <span class="k">if</span> <span class="n">period_limit</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">guess_amp</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">guess_offset</span><span class="p">])</span>
            <span class="c1"># Catch warning where covariance cannot be estimated</span>
            <span class="c1"># I.e. OptimizeWarning: Covariance of the parameters could not be estimated</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">OptimizeWarning</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">optimize_warning</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Note, may have to adjust max number of iterations (maxfev) higher to avoid crashes</span>
                        <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">custom_sine_function_base</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">))</span>
                    <span class="c1"># If sparse input such that fittitng is not possible, pass NaNs</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span>
                <span class="k">except</span> <span class="n">OptimizeWarning</span><span class="p">:</span>
                    <span class="n">optimize_warning</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">OptimizeWarning</span><span class="p">)</span>
                    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">custom_sine_function_base</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OptimizeWarning: Covariance for station </span><span class="si">{}</span><span class="s1"> could not be estimated. Refer to debug figure here </span><span class="si">{}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                          &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;phaseamp_per_station&#39;</span><span class="p">,</span> <span class="s1">&#39;station</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="p">))))</span>
                    <span class="k">pass</span>
            <span class="c1"># Adjust expected output to reflect fixed period, if specified</span>
            <span class="k">if</span> <span class="n">period_limit</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">A</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">popt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">popt</span>
            <span class="c1"># convert from radians/seconds to years</span>
            <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">31556952</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">f</span>

            <span class="k">def</span> <span class="nf">fitfunc</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>
            <span class="c1"># Outputs = &quot;amp&quot;: A, &quot;angular frequency&quot;: w, &quot;phase&quot;: p, &quot;offset&quot;: c, &quot;freq&quot;: f, &quot;period&quot;: 1./f,</span>
            <span class="c1">#        &quot;fitfunc&quot;: fitfunc, &quot;maxcov&quot;: np.max(pcov), &quot;rawres&quot;: (guess,popt,pcov)</span>
            <span class="c1"># Pass amplitude (specified units) and phase (days) and stdev</span>
            <span class="n">ampfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="c1"># Convert phase from rad to days, apply half wavelength shift if Amp is negative</span>
            <span class="k">if</span> <span class="n">A</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">+=</span> <span class="mf">3.14159</span>
            <span class="n">phsfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">365.25</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">periodfit</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
            <span class="c1"># Catch warning where output is so small that it gets rounded to 0</span>
            <span class="c1"># I.e. RuntimeWarning: invalid value encountered in double_scalars</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># pass covariance for each parameter</span>
                    <span class="n">ampfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
                    <span class="n">periodfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
                    <span class="n">phsfit_c</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcov</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
                    <span class="c1"># pass RMSE of fit</span>
                    <span class="n">seasonalfit_rmse</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">custom_sine_function_base</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>
                    <span class="n">seasonalfit_rmse</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">seasonalfit_rmse</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span>
                                                 <span class="p">(</span><span class="n">seasonalfit_rmse</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
                <span class="k">except</span> <span class="ne">FloatingPointError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phaseamp_per_station</span> <span class="ow">or</span> <span class="n">optimize_warning</span><span class="p">:</span>
                <span class="c1"># Debug plotting for each station</span>
                <span class="c1"># convert time (datetime seconds) to absolute years for plotting</span>
                <span class="n">tt_plot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                <span class="n">tt_plot</span> <span class="o">-=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tt_plot</span><span class="p">)</span>
                <span class="n">tt_plot</span> <span class="o">/=</span> <span class="mi">31556952</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt_plot</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (years)&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;data (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
                <span class="n">num_testpoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
                <span class="k">if</span> <span class="n">num_testpoints</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">num_testpoints</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">tt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tt</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">tt</span><span class="p">),</span> <span class="n">num_testpoints</span><span class="p">)</span>
                <span class="c1"># convert time to years for plotting</span>
                <span class="n">tt2_plot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tt2</span><span class="p">)</span>
                <span class="n">tt2_plot</span> <span class="o">-=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tt2_plot</span><span class="p">)</span>
                <span class="n">tt2_plot</span> <span class="o">/=</span> <span class="mi">31556952</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt2_plot</span><span class="p">,</span> <span class="n">fitfunc</span><span class="p">(</span><span class="n">tt2</span><span class="p">),</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;phaseamp_per_station&#39;</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;phaseamp_per_station&#39;</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;phaseamp_per_station&#39;</span><span class="p">,</span> <span class="s1">&#39;station</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="p">)),</span>
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">optimize_warning</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ampfit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phsfit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">periodfit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ampfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phsfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">periodfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seasonalfit_rmse</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span>

    <span class="k">def</span> <span class="nf">_sine_function_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Base function for modeling sinusoidal amplitude/phase fits.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridarr</span><span class="p">,</span> <span class="n">plottype</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resValue</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Visualize a suite of statistics w.r.t. stations. Pass either a list of points or a gridded array as the first argument. Alternatively, you may superimpose your gridded array with a supplementary list of points by passing the latter through the stationsongrids argument.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">cartopy</span> <span class="kn">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span>
        <span class="kn">from</span> <span class="nn">cartopy</span> <span class="kn">import</span> <span class="n">feature</span> <span class="k">as</span> <span class="n">cfeature</span>
        <span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LatitudeFormatter</span><span class="p">,</span> <span class="n">LongitudeFormatter</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span> <span class="k">as</span> <span class="n">mticker</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

        <span class="c1"># If specified workdir doesn&#39;t exist, create it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>

        <span class="c1"># Pass cbounds</span>
        <span class="n">cbounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span>
        <span class="c1"># Initiate no-data array to mask data</span>
        <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
            <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span>
            <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>
        <span class="c1"># by default set background to white</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="c1"># add coastlines</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usr_colormap</span><span class="p">))</span>
        <span class="c1"># cmap.set_bad(&#39;black&#39;, 0.)</span>
        <span class="c1"># extract all colors from the hot map</span>
        <span class="n">cmaplist</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
        <span class="c1"># create the new map</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
            <span class="s1">&#39;Custom cmap&#39;</span><span class="p">,</span> <span class="n">cmaplist</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># set ticks</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span>
            <span class="n">number_format</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">,</span> <span class="n">degree_symbol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">(</span>
            <span class="n">number_format</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">,</span> <span class="n">degree_symbol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

        <span class="c1"># draw central longitude lines corresponding to respective datetimes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">:</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># If individual stations passed</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># spatial distribution of stations</span>
            <span class="k">if</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_distribution&quot;</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gridarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

            <span class="c1"># passing 3rd column as z-value</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># set land/water background to light gray/blue respectively so station point data can be seen</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                    <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#A9A9A9&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                    <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># set masked values as nans</span>
                <span class="n">zvalues</span> <span class="o">=</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodat_arr</span><span class="p">:</span>
                    <span class="n">zvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">zvalues</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">zvalues</span><span class="p">)</span>
                <span class="n">zvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">zvalues</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="c1"># define the bins and normalize</span>
                <span class="k">if</span> <span class="n">cbounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># avoid &quot;ufunc &#39;isnan&#39;&quot; error by casting array as float</span>
                    <span class="n">cbounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">zvalues</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                        <span class="n">zvalues</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="c1"># if upper/lower bounds identical, overwrite lower bound as 75% of upper bound to avoid plotting ValueError</span>
                    <span class="k">if</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.75</span>
                        <span class="n">cbounds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="c1"># adjust precision for colorbar if necessary</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">zvalues</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> \
                            <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">zvalues</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                        <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span>

                <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">256</span><span class="p">)</span>
                <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
                <span class="n">colorbounds_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

                <span class="c1"># plot data and initiate colorbar</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gridarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">zvalues</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                  <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="c1"># initiate colorbar and control height of colorbar</span>
                <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>
                <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;proportional&#39;</span><span class="p">,</span>
                                       <span class="n">ticks</span><span class="o">=</span><span class="n">colorbounds_ticks</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">colorbounds</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

        <span class="c1"># If gridded area passed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set masked values as nans</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodat_arr</span><span class="p">:</span>
                <span class="n">gridarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">gridarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">gridarr</span><span class="p">)</span>
            <span class="n">gridarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># set land/water background to light gray/blue respectively so grid cells can be seen</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#A9A9A9&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># define the bins and normalize</span>
            <span class="k">if</span> <span class="n">cbounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cbounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                    <span class="n">gridarr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="c1"># if upper/lower bounds identical, overwrite lower bound as 75% of upper bound to avoid plotting ValueError</span>
                <span class="k">if</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.75</span>
                    <span class="n">cbounds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="c1"># plot data and initiate colorbar</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> \
                        <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                    <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span>

            <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">256</span><span class="p">)</span>
            <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
            <span class="n">colorbounds_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

            <span class="c1"># plot data</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span>
                             <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="c1"># initiate colorbar and control height of colorbar</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>
            <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;proportional&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbounds_ticks</span><span class="p">,</span>
                                   <span class="n">boundaries</span><span class="o">=</span><span class="n">colorbounds</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

            <span class="c1"># superimpose your gridded array with a supplementary list of point, if specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

            <span class="c1"># draw gridlines, if specified</span>
            <span class="k">if</span> <span class="n">drawgridlines</span><span class="p">:</span>
                <span class="n">gl</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span>
                <span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># Add labels to colorbar, if necessary</span>
        <span class="k">if</span> <span class="s1">&#39;cbar_ax&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="c1"># experimental variogram fit sill heatmap</span>
            <span class="k">if</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_variance&quot;</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                                  <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># specify appropriate units for mean/median/std/amplitude/experimental variogram fit heatmap</span>
            <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_mean&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_stdev&quot;</span> <span class="ow">or</span>  \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_range&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_mean&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_stdev&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_seasonal_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_mean&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_stdev&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_amplitude_stdev&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_amplitude_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_fit_rmse&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_fit_rmse&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_variogram_rmse&quot;</span><span class="p">:</span>
                <span class="c1"># update label if sigZTD</span>
                <span class="k">if</span> <span class="s1">&#39;sig&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">:</span>
                    <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;sig ZTD &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;delay_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                                      <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                                      <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># specify appropriate units for phase heatmap (days)</span>
            <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_seasonal_phase&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_phase&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_phase&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_phase_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_phase_stdev&quot;</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">),</span>
                                  <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># specify appropriate units for period heatmap (years)</span>
            <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_period&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_period&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_period&quot;</span> <span class="ow">or</span> \
                    <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_period_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_period_stdev&quot;</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">),</span>
                                  <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># gridmap of station density has no units</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Add title to plots, if specified</span>
        <span class="k">if</span> <span class="n">userTitle</span><span class="p">:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">userTitle</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># save/close figure</span>
        <span class="c1"># cbar_ax.ax.locator_params(nbins=10)</span>
        <span class="c1"># for label in cbar_ax.ax.xaxis.get_ticklabels()[::25]:</span>
            <span class="c1"># label.set_visible(False)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">plottype</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">plotFormat</span><span class="p">),</span>
                    <span class="nb">format</span><span class="o">=</span><span class="n">plotFormat</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.RaiderStats.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="n">plottype</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resValue</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Visualize a suite of statistics w.r.t. stations. Pass either a list of points or a gridded array as the first argument. Alternatively, you may superimpose your gridded array with a supplementary list of points by passing the latter through the stationsongrids argument.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridarr</span><span class="p">,</span> <span class="n">plottype</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resValue</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Visualize a suite of statistics w.r.t. stations. Pass either a list of points or a gridded array as the first argument. Alternatively, you may superimpose your gridded array with a supplementary list of points by passing the latter through the stationsongrids argument.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">cartopy</span> <span class="kn">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span>
    <span class="kn">from</span> <span class="nn">cartopy</span> <span class="kn">import</span> <span class="n">feature</span> <span class="k">as</span> <span class="n">cfeature</span>
    <span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LatitudeFormatter</span><span class="p">,</span> <span class="n">LongitudeFormatter</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span> <span class="k">as</span> <span class="n">mticker</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

    <span class="c1"># If specified workdir doesn&#39;t exist, create it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>

    <span class="c1"># Pass cbounds</span>
    <span class="n">cbounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbounds</span>
    <span class="c1"># Initiate no-data array to mask data</span>
    <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
        <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span>
        <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>
    <span class="c1"># by default set background to white</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
        <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="c1"># add coastlines</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usr_colormap</span><span class="p">))</span>
    <span class="c1"># cmap.set_bad(&#39;black&#39;, 0.)</span>
    <span class="c1"># extract all colors from the hot map</span>
    <span class="n">cmaplist</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
    <span class="c1"># create the new map</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s1">&#39;Custom cmap&#39;</span><span class="p">,</span> <span class="n">cmaplist</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># set ticks</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span>
        <span class="n">number_format</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">,</span> <span class="n">degree_symbol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">(</span>
        <span class="n">number_format</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">,</span> <span class="n">degree_symbol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

    <span class="c1"># draw central longitude lines corresponding to respective datetimes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">:</span>
        <span class="n">tl</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># If individual stations passed</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># spatial distribution of stations</span>
        <span class="k">if</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_distribution&quot;</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gridarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

        <span class="c1"># passing 3rd column as z-value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># set land/water background to light gray/blue respectively so station point data can be seen</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#A9A9A9&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># set masked values as nans</span>
            <span class="n">zvalues</span> <span class="o">=</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodat_arr</span><span class="p">:</span>
                <span class="n">zvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">zvalues</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">zvalues</span><span class="p">)</span>
            <span class="n">zvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">zvalues</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># define the bins and normalize</span>
            <span class="k">if</span> <span class="n">cbounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># avoid &quot;ufunc &#39;isnan&#39;&quot; error by casting array as float</span>
                <span class="n">cbounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">zvalues</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                    <span class="n">zvalues</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="c1"># if upper/lower bounds identical, overwrite lower bound as 75% of upper bound to avoid plotting ValueError</span>
                <span class="k">if</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.75</span>
                    <span class="n">cbounds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="c1"># adjust precision for colorbar if necessary</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">zvalues</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> \
                        <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">zvalues</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">zvalues</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                    <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span>

            <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">256</span><span class="p">)</span>
            <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
            <span class="n">colorbounds_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

            <span class="c1"># plot data and initiate colorbar</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gridarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gridarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">zvalues</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                              <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="c1"># initiate colorbar and control height of colorbar</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>
            <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;proportional&#39;</span><span class="p">,</span>
                                   <span class="n">ticks</span><span class="o">=</span><span class="n">colorbounds_ticks</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">colorbounds</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

    <span class="c1"># If gridded area passed</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># set masked values as nans</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodat_arr</span><span class="p">:</span>
            <span class="n">gridarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">gridarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">gridarr</span><span class="p">)</span>
        <span class="n">gridarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="c1"># set land/water background to light gray/blue respectively so grid cells can be seen</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#A9A9A9&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># define the bins and normalize</span>
        <span class="k">if</span> <span class="n">cbounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                <span class="n">gridarr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorpercentile</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="c1"># if upper/lower bounds identical, overwrite lower bound as 75% of upper bound to avoid plotting ValueError</span>
            <span class="k">if</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.75</span>
                <span class="n">cbounds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="c1"># plot data and initiate colorbar</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> \
                    <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">gridarr</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">gridarr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span>

        <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">256</span><span class="p">)</span>
        <span class="n">colorbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">colorbounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">colorbounds_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1"># plot data</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gridarr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span>
                         <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="c1"># initiate colorbar and control height of colorbar</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;proportional&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbounds_ticks</span><span class="p">,</span>
                               <span class="n">boundaries</span><span class="o">=</span><span class="n">colorbounds</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">colorbarfmt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">cbar_ax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

        <span class="c1"># superimpose your gridded array with a supplementary list of point, if specified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

        <span class="c1"># draw gridlines, if specified</span>
        <span class="k">if</span> <span class="n">drawgridlines</span><span class="p">:</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span>
            <span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># Add labels to colorbar, if necessary</span>
    <span class="k">if</span> <span class="s1">&#39;cbar_ax&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
        <span class="c1"># experimental variogram fit sill heatmap</span>
        <span class="k">if</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_variance&quot;</span><span class="p">:</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                              <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># specify appropriate units for mean/median/std/amplitude/experimental variogram fit heatmap</span>
        <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_mean&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_stdev&quot;</span> <span class="ow">or</span>  \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_range&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_mean&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_stdev&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_seasonal_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_mean&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_median&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_delay_absolute_stdev&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_amplitude&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_amplitude_stdev&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_amplitude_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_fit_rmse&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_fit_rmse&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_variogram_rmse&quot;</span><span class="p">:</span>
            <span class="c1"># update label if sigZTD</span>
            <span class="k">if</span> <span class="s1">&#39;sig&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;sig ZTD &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;delay_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                                  <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                                  <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># specify appropriate units for phase heatmap (days)</span>
        <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_seasonal_phase&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_phase&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_phase&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_phase_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_phase_stdev&quot;</span><span class="p">:</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">),</span>
                              <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># specify appropriate units for period heatmap (years)</span>
        <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;station_delay_period&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_period&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_period&quot;</span> <span class="ow">or</span> \
                <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_absolute_period_stdev&quot;</span> <span class="ow">or</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s2">&quot;grid_seasonal_period_stdev&quot;</span><span class="p">:</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">),</span>
                              <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># gridmap of station density has no units</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plottype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;grid_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Add title to plots, if specified</span>
    <span class="k">if</span> <span class="n">userTitle</span><span class="p">:</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">userTitle</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># save/close figure</span>
    <span class="c1"># cbar_ax.ax.locator_params(nbins=10)</span>
    <span class="c1"># for label in cbar_ax.ax.xaxis.get_ticklabels()[::25]:</span>
        <span class="c1"># label.set_visible(False)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">plottype</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">plotFormat</span><span class="p">),</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">plotFormat</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.RaiderStats.create_DF" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_DF</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Create dataframe.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_DF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create dataframe.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Open file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">()</span>

    <span class="c1"># Filter dataframe</span>
    <span class="c1"># drop all nans</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># convert to datetime object</span>

    <span class="c1"># time-interval filter</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

    <span class="c1"># seasonal filter</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># get day of year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2001-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">(</span>
        <span class="p">)</span><span class="o">.</span><span class="n">tm_yday</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2001-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span><span class="p">]</span>
        <span class="c1"># track input order and wrap around year if necessary</span>
        <span class="c1"># e.g. month/day: 03/01 to 06/01</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># non leap-year</span>
            <span class="n">filtered_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
            <span class="c1"># leap-year</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span>
                                     <span class="mi">59</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">]</span>
            <span class="n">filtered_self_ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">filtered_self</span><span class="p">,</span> <span class="n">filtered_self_ly</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">filtered_self</span>
        <span class="c1"># e.g. month/day: 12/01 to 03/01</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># non leap-year</span>
            <span class="n">filtered_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="c1"># leap-year</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span>
                                     <span class="mi">59</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">]</span>
            <span class="n">filtered_self_ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">filtered_self</span><span class="p">,</span> <span class="n">filtered_self_ly</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">filtered_self</span>

    <span class="c1"># estimate central longitude lines if &#39;--time_lines&#39; specified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="ow">and</span> <span class="s1">&#39;Datetime&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int32&quot;</span><span class="p">)</span>
        <span class="c1"># get list of unique times</span>
        <span class="n">all_hrs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]))</span>

        <span class="c1"># get central longitude bands associated with each time</span>
        <span class="n">central_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if single time, avoid loop</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">central_points</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])],</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">):</span>
                <span class="c1"># last entry</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_hrs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="c1"># first entry</span>
                <span class="k">elif</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                                   <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date_hr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">all_hrs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])]</span>
                <span class="n">central_points</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])],</span>
                                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">])]))</span>
        <span class="c1"># get central longitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">midpoint</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">central_points</span><span class="p">]</span>

    <span class="c1"># Get bbox, buffered by grid spacing.</span>
    <span class="c1"># Check if bbox input is valid list.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Cannot understand the --bounding_box argument. String input is incorrect or path does not exist.&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extent</span><span class="p">()</span>

    <span class="c1"># generate list of grid-polygons</span>
    <span class="n">append_poly</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">append_poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))))</span>  <span class="c1"># Pass lons/lats to create polygon</span>

    <span class="c1"># Check for grid cell intersection with each station</span>
    <span class="n">idtogrid_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
        <span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="c1"># Initiate R-tree of gridded array domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">polygon_tree</span> <span class="o">=</span> <span class="n">STRtree</span><span class="p">(</span><span class="n">append_poly</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stat_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">grd_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_stationgrid_intersection</span><span class="p">(</span><span class="n">stat_ID</span><span class="p">)</span>
        <span class="n">idtogrid_dict</span><span class="p">[</span><span class="n">stat_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd_index</span>

    <span class="c1"># map gridnode dictionary to dataframe</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">idtogrid_dict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygon_tree</span><span class="p">,</span> <span class="n">idtogrid_dict</span><span class="p">,</span> <span class="n">append_poly</span>
    <span class="c1"># sort by grid and date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>

    <span class="c1"># If specified, pass station locations to superimpose on gridplots</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">:</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span> <span class="o">=</span> <span class="p">[</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
            <span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="c1"># If specified, setup gridded array(s)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_heatmap&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">,</span> <span class="s1">&#39;grid_heatmap&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1i</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int16&#39;</span><span class="p">,</span>
                          <span class="n">noData</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">:</span>
        <span class="c1"># Take mean of station-wise means per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_mean&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_mean&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">:</span>
        <span class="c1"># Take mean of station-wise medians per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_median&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_median&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">:</span>
        <span class="c1"># Take mean of station-wise stdev per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">:</span>
        <span class="c1"># Take mean of all data per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">:</span>
        <span class="c1"># Take median of all data per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">:</span>
        <span class="c1"># Take stdev of all data per gridcell</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                          <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="c1"># If specified, compute phase/amplitude fits</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_seasonal_phase</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">:</span>
        <span class="c1"># Sort by coordinates</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
        <span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
        <span class="c1"># Setup variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]))):</span>
            <span class="c1"># pass all values corresponding to station (ID, data = y, time = x)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">unique_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_limit</span><span class="p">))</span>
        <span class="c1"># Parallelize iteration through all grid-cells and time slices</span>
        <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_and_phase</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="c1"># map phase/amplitude fits dictionary to dataframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phsfit</span><span class="p">)</span>
        <span class="c1"># check if there are any valid data values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No valid data values, adjust --min_span inputs for time span in years </span><span class="si">{}</span><span class="s2"> and/or fractional obs. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampfit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodfit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phsfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodfit_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seasonalfit_rmse</span><span class="p">)</span>
        <span class="c1"># drop nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># If grid plots specified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">:</span>
            <span class="c1"># Pass mean phase of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass mean amplitude of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass mean period of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1">########################################################################################################################</span>
            <span class="c1"># Pass mean phase stdev of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass mean amplitude stdev of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass mean period stdev of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass mean seasonal fit RMSE of station-wise means per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;gridnode&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
        <span class="c1">########################################################################################################################</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">:</span>
            <span class="c1"># Pass absolute mean phase of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass absolute mean amplitude of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass absolute mean period of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1">########################################################################################################################</span>
            <span class="c1"># Pass absolute mean phase stdev of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass absolute mean amplitude stdev of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># Pass absolute mean period stdev of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

            <span class="c1"># Pass absolute mean seasonal fit RMSE of all data per gridcell</span>
            <span class="n">unique_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gridnode&#39;</span><span class="p">])[</span><span class="s1">&#39;seasonalfit_rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;gridnode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
            <span class="p">)</span> <span class="k">else</span> <span class="n">unique_points</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># If specified, save gridded array(s)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_raster</span><span class="p">:</span>
                <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
                <span class="n">save_gridfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">stationsongrids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span>
                              <span class="n">time_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.statsPlot.VariogramAnalysis" class="doc doc-heading">
            <code>VariogramAnalysis</code>


</h4>


    <div class="doc doc-contents ">


      <p>Class which ingests dataframe output from 'RaiderStats' class and performs variogram analysis.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VariogramAnalysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Class which ingests dataframe output from &#39;RaiderStats&#39; class and performs variogram analysis.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filearg</span><span class="p">,</span> <span class="n">gridpoints</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">densitythreshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">binnedvariogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">variogram_per_timeslice</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variogram_errlimit</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">filearg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">col_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span> <span class="o">=</span> <span class="n">gridpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span> <span class="o">=</span> <span class="n">seasonalinterval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densitythreshold</span> <span class="o">=</span> <span class="n">densitythreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binnedvariogram</span> <span class="o">=</span> <span class="n">binnedvariogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span> <span class="o">=</span> <span class="n">numCPUs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variogram_per_timeslice</span> <span class="o">=</span> <span class="n">variogram_per_timeslice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variogram_errlimit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">variogram_errlimit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">Nsamp</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pull samples from a 2D image for variogram analysis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">random</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">densitythreshold</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Less than </span><span class="si">{}</span><span class="s1"> points for this gridcell&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densitythreshold</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Will pass empty list&#39;</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">indpars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indpars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indpars</span><span class="p">)</span>
            <span class="c1"># subsample</span>
            <span class="n">Nvalidsamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Only downsample if Nsamps&gt;specified value</span>
            <span class="k">if</span> <span class="n">Nvalidsamp</span> <span class="o">&gt;</span> <span class="n">Nsamp</span><span class="p">:</span>
                <span class="n">indpars</span> <span class="o">=</span> <span class="n">indpars</span><span class="p">[:</span><span class="n">Nsamp</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">data</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">data</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">indpars</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">indpars</span>

    <span class="k">def</span> <span class="nf">_get_XY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x2d</span><span class="p">,</span> <span class="n">y2d</span><span class="p">,</span> <span class="n">indpars</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a list of indices, return the x,y locations</span>
<span class="sd">        from two matrices</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x2d</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">x2d</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">indpars</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">y2d</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">y2d</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">indpars</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">_get_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XY</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the distances between each point in a list of points</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cdist</span><span class="p">(</span><span class="n">XY</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_variogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XY</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return variograms</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">XY</span> <span class="o">-</span> <span class="n">xy</span><span class="p">)</span>  <span class="c1"># XY = 1st col xy= 2nd col</span>

    <span class="k">def</span> <span class="nf">_emp_vario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">Nsamp</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute empirical semivariance</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># remove NaNs if possible</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># deramp</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">WGS84_to_UTM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">common_center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">ramp</span><span class="p">))</span>

        <span class="n">samples</span><span class="p">,</span> <span class="n">indpars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Nsamp</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_XY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">indpars</span><span class="p">)</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_distances</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">vario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_variogram</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">samples</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">dists</span><span class="p">,</span> <span class="n">vario</span>

    <span class="k">def</span> <span class="nf">_binned_vario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hEff</span><span class="p">,</span> <span class="n">rawVario</span><span class="p">,</span> <span class="n">xBin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return a binned empirical variogram</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">xBin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;All-NaN slice encountered&quot;</span><span class="p">)</span>
                <span class="n">xBin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">hEff</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.67</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="n">nBins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xBin</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">hExp</span><span class="p">,</span> <span class="n">expVario</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">iBin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nBins</span><span class="p">):</span>
            <span class="n">iBinMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">xBin</span><span class="p">[</span><span class="n">iBin</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hEff</span><span class="p">,</span> <span class="n">hEff</span> <span class="o">&lt;=</span> <span class="n">xBin</span><span class="p">[</span><span class="n">iBin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># circumvent indexing</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Mean of empty slice&quot;</span><span class="p">)</span>
                    <span class="n">hExp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">hEff</span><span class="p">[</span><span class="n">iBinMask</span><span class="p">]))</span>
                    <span class="n">expVario</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">rawVario</span><span class="p">[</span><span class="n">iBinMask</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>  <span class="c1"># TODO: Which error(s)?</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hExp</span><span class="p">):</span>
            <span class="c1"># NaNs present in binned histogram</span>
            <span class="n">hExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hExp</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;nan&#39;</span><span class="p">]</span>
            <span class="n">expVario</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">expVario</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;nan&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hExp</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">expVario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit_vario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">vario</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nparm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fit a variogram model to data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">least_squares</span>

        <span class="k">def</span> <span class="nf">resid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;All-NaN slice encountered&quot;</span><span class="p">)</span>
                <span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vario</span><span class="p">)</span>
                               <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vario</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Nparm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;Must specify either x0 or the number of model parameters&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Nparm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nparm</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vario</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vario</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">res_robust</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                   <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;soft_l1&#39;</span><span class="p">,</span> <span class="n">f_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                   <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">model</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;All-NaN slice encountered&quot;</span><span class="p">)</span>
            <span class="n">d_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dists</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
        <span class="c1"># v_test is my y., # res_robust.x =a, b, c, where a = range, b = sill, and c = nugget model, d_test=x</span>
        <span class="n">v_test</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">res_robust</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d_test</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res_robust</span><span class="p">,</span> <span class="n">d_test</span><span class="p">,</span> <span class="n">v_test</span>

    <span class="c1"># this would be expontential plus nugget</span>
    <span class="k">def</span> <span class="nf">__exponential__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">nugget</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a variogram model given a set of arguments and</span>
<span class="sd">        key-word arguments</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># a = range, b = sill, c = nugget model</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">parms</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;overflow encountered in true_divide&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nugget</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span> <span class="o">+</span> <span class="n">c</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span>

    <span class="c1"># this would be gaussian plus nugget</span>
    <span class="k">def</span> <span class="nf">__gaussian__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a Gaussian variogram model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">parms</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_append_variogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_ind</span><span class="p">,</span> <span class="n">grid_subset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For a given grid-cell, iterate through time slices to generate/append empirical variogram(s)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Comprehensive arrays recording data across all time epochs for given station</span>
        <span class="n">dists_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vario_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dists_binned_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vario_binned_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_robust_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">d_test_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">v_test_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grid_subset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]))):</span>
            <span class="c1"># If insufficient sample size, skip slice and record occurence</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">grid_subset</span><span class="p">[</span><span class="n">grid_subset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">densitythreshold</span><span class="p">:</span>
                <span class="c1"># Record skipped [gridnode, timeslice]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipped_slices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;grid</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">grid_ind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Lat:</span><span class="si">{}</span><span class="s1"> Lon:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]))])</span>
                <span class="n">lonarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">grid_subset</span><span class="p">[</span><span class="n">grid_subset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">][</span><span class="s1">&#39;Lon&#39;</span><span class="p">])</span>
                <span class="n">latarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">grid_subset</span><span class="p">[</span><span class="n">grid_subset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">][</span><span class="s1">&#39;Lat&#39;</span><span class="p">])</span>
                <span class="n">delayarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">grid_subset</span><span class="p">[</span><span class="n">grid_subset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">])</span>
                <span class="c1"># fit empirical variogram for each time AND grid</span>
                <span class="n">dists</span><span class="p">,</span> <span class="n">vario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emp_vario</span><span class="p">(</span><span class="n">lonarr</span><span class="p">,</span> <span class="n">latarr</span><span class="p">,</span> <span class="n">delayarray</span><span class="p">)</span>
                <span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binned_vario</span><span class="p">(</span>
                    <span class="n">dists</span><span class="p">,</span> <span class="n">vario</span><span class="p">)</span>
                <span class="c1"># fit experimental variogram for each time AND grid, model default is exponential</span>
                <span class="n">res_robust</span><span class="p">,</span> <span class="n">d_test</span><span class="p">,</span> <span class="n">v_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_vario</span><span class="p">(</span>
                    <span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__exponential__</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nparm</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="c1"># Plot empirical + experimental variogram for this gridnode and timeslice</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">))):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)))</span>
                <span class="c1"># Make variogram plots for each time-slice</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_per_timeslice</span><span class="p">:</span>
                    <span class="c1"># Plot empirical variogram for this gridnode and timeslice</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_variogram</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                        <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)),</span> <span class="n">dists</span><span class="o">=</span><span class="n">dists</span><span class="p">,</span> <span class="n">vario</span><span class="o">=</span><span class="n">vario</span><span class="p">,</span>
                                        <span class="n">dists_binned</span><span class="o">=</span><span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="n">vario_binned</span><span class="p">)</span>
                    <span class="c1"># Plot experimental variogram for this gridnode and timeslice</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_variogram</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                        <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)),</span> <span class="n">d_test</span><span class="o">=</span><span class="n">d_test</span><span class="p">,</span> <span class="n">v_test</span><span class="o">=</span><span class="n">v_test</span><span class="p">,</span>
                                        <span class="n">res_robust</span><span class="o">=</span><span class="n">res_robust</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dists_binned</span><span class="o">=</span><span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="n">vario_binned</span><span class="p">)</span>
                <span class="c1"># append for plotting</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">good_slices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)])</span>
                <span class="n">dists_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
                <span class="n">vario_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vario</span><span class="p">)</span>
                <span class="n">dists_binned_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists_binned</span><span class="p">)</span>
                <span class="n">vario_binned_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vario_binned</span><span class="p">)</span>
                <span class="n">res_robust_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_robust</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">d_test_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_test</span><span class="p">)</span>
                <span class="n">v_test_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_test</span><span class="p">)</span>
        <span class="c1"># fit experimental variogram for each grid</span>
        <span class="k">if</span> <span class="n">dists_binned_arr</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="c1"># TODO: need to change this from accumulating binned data to raw data</span>
            <span class="n">dists_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dists_arr</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">vario_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">vario_arr</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="c1"># if specified, passed binned empirical variograms</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binnedvariogram</span><span class="p">:</span>
                <span class="n">dists_binned_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dists_binned_arr</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">vario_binned_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">vario_binned_arr</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># dists_binned_arr = dists_arr ; vario_binned_arr = vario_arr</span>
                <span class="n">dists_binned_arr</span><span class="p">,</span> <span class="n">vario_binned_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binned_vario</span><span class="p">(</span>
                    <span class="n">dists_arr</span><span class="p">,</span> <span class="n">vario_arr</span><span class="p">)</span>
            <span class="n">TOT_res_robust</span><span class="p">,</span> <span class="n">TOT_d_test</span><span class="p">,</span> <span class="n">TOT_v_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_vario</span><span class="p">(</span>
                <span class="n">dists_binned_arr</span><span class="p">,</span> <span class="n">vario_binned_arr</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__exponential__</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nparm</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">tot_timetag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_slices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_slices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Append TOT arrays</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">tot_timetag</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TOT_res_robust</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_tot_timetag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tot_timetag</span><span class="p">)</span>
            <span class="n">var_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">TOT_res_robust</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">var_rmse</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_errlimit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_rmse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
            <span class="c1"># Plot empirical variogram for this gridnode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_variogram</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">tot_timetag</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)),</span> <span class="n">dists</span><span class="o">=</span><span class="n">dists_arr</span><span class="p">,</span> <span class="n">vario</span><span class="o">=</span><span class="n">vario_arr</span><span class="p">,</span>
                                <span class="n">dists_binned</span><span class="o">=</span><span class="n">dists_binned_arr</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="n">vario_binned_arr</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">)</span>
            <span class="c1"># Plot experimental variogram for this gridnode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_variogram</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">,</span> <span class="n">tot_timetag</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">[</span><span class="n">grid_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/grid</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)),</span> <span class="n">d_test</span><span class="o">=</span><span class="n">TOT_d_test</span><span class="p">,</span> <span class="n">v_test</span><span class="o">=</span><span class="n">TOT_v_test</span><span class="p">,</span>
                                <span class="n">res_robust</span><span class="o">=</span><span class="n">TOT_res_robust</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">,</span> <span class="n">dists_binned</span><span class="o">=</span><span class="n">dists_binned_arr</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="n">vario_binned_arr</span><span class="p">)</span>
        <span class="c1"># Record sparse grids which didn&#39;t have sufficient sample size of data through any of the timeslices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sparse_grids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_ind</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span>

    <span class="k">def</span> <span class="nf">create_variograms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Iterate through grid-cells and time slices to generate empirical variogram(s)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># track data for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TOT_tot_timetag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># track pass/rejected grids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparse_grids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">good_slices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipped_slices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># record grid-centers for lookup-table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]))):</span>
            <span class="c1"># pass subset of all stations corresponding to given grid-cell</span>
            <span class="n">grid_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_subset</span><span class="p">))</span>
        <span class="c1"># Parallelize iteration through all grid-cells and time slices</span>
        <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_append_variogram</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

        <span class="c1"># save grid-center lookup table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                                                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">gridcenter</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/gridlocation_lookup.txt&#39;</span><span class="p">)),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="p">:</span>
            <span class="n">gridcenter</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
            <span class="n">gridcenter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gridcenter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">TOT_grids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">TOT_grids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span>

    <span class="k">def</span> <span class="nf">plot_variogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">d_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">res_robust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Make empirical and/or experimental variogram fit plots</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If specified workdir doesn&#39;t exist, create it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>

        <span class="c1"># make plot title</span>
        <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\n</span><span class="s1">Lat:</span><span class="si">{:.2f}</span><span class="s1"> Lon:</span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">Time:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeslice</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">seasonalinterval</span><span class="p">:</span>
            <span class="n">title_str</span> <span class="o">+=</span> <span class="s1">&#39; Season(mm/dd): </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">timeslice</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>

        <span class="k">if</span> <span class="n">dists</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vario</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale from m to user-defined units</span>
            <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dists</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">vario</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dists_binned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vario_binned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale from m to user-defined units</span>
            <span class="n">dists_binned</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dists_binned</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;binned&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res_robust</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\u0332\u00b2</span><span class="s1">(</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
            <span class="c1"># scale from m to user-defined units</span>
            <span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">d_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale from m to user-defined units</span>
            <span class="n">d_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_test</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_test</span><span class="p">,</span> <span class="n">v_test</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;experimental fit&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dissimilarity (</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                   <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="c1"># Plot empirical variogram</span>
        <span class="k">if</span> <span class="n">d_test</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Empirical variogram&#39;</span> <span class="o">+</span> <span class="n">title_str</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;grid</span><span class="si">{}</span><span class="s1">_timeslice</span><span class="si">{}</span><span class="s1">_justEMPvariogram.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">)))</span>
        <span class="c1"># Plot just experimental variogram</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental variogram&#39;</span> <span class="o">+</span> <span class="n">title_str</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;grid</span><span class="si">{}</span><span class="s1">_timeslice</span><span class="si">{}</span><span class="s1">_justEXPvariogram.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.VariogramAnalysis.__exponential__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__exponential__</span><span class="p">(</span><span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">nugget</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>returns a variogram model given a set of arguments and
key-word arguments</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__exponential__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">nugget</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a variogram model given a set of arguments and</span>
<span class="sd">    key-word arguments</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># a = range, b = sill, c = nugget model</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">parms</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;overflow encountered in true_divide&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nugget</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span> <span class="o">+</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.VariogramAnalysis.__gaussian__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__gaussian__</span><span class="p">(</span><span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>returns a Gaussian variogram model</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__gaussian__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parms</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a Gaussian variogram model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">parms</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="n">c</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.VariogramAnalysis.create_variograms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_variograms</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Iterate through grid-cells and time slices to generate empirical variogram(s)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_variograms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterate through grid-cells and time slices to generate empirical variogram(s)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># track data for plotting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">TOT_tot_timetag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># track pass/rejected grids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparse_grids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">good_slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skipped_slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># record grid-centers for lookup-table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]))):</span>
        <span class="c1"># pass subset of all stations corresponding to given grid-cell</span>
        <span class="n">grid_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_subset</span><span class="p">))</span>
    <span class="c1"># Parallelize iteration through all grid-cells and time slices</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_append_variogram</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c1"># save grid-center lookup table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
    <span class="n">gridcenter</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
        <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;variograms/gridlocation_lookup.txt&#39;</span><span class="p">)),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridcenterlist</span><span class="p">:</span>
        <span class="n">gridcenter</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
        <span class="n">gridcenter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">gridcenter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">TOT_grids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_good_slices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">TOT_grids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOT_res_robust_rmse</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.statsPlot.VariogramAnalysis.plot_variogram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_variogram</span><span class="p">(</span><span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">d_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">res_robust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Make empirical and/or experimental variogram fit plots</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_variogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">d_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">res_robust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dists_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vario_binned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Make empirical and/or experimental variogram fit plots</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># If specified workdir doesn&#39;t exist, create it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>

    <span class="c1"># make plot title</span>
    <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\n</span><span class="s1">Lat:</span><span class="si">{:.2f}</span><span class="s1"> Lon:</span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">Time:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeslice</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">seasonalinterval</span><span class="p">:</span>
        <span class="n">title_str</span> <span class="o">+=</span> <span class="s1">&#39; Season(mm/dd): </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">timeslice</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeslice</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>

    <span class="k">if</span> <span class="n">dists</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vario</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># scale from m to user-defined units</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dists</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">vario</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dists_binned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vario_binned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># scale from m to user-defined units</span>
        <span class="n">dists_binned</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dists_binned</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists_binned</span><span class="p">,</span> <span class="n">vario_binned</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;binned&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res_robust</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\u0332\u00b2</span><span class="s1">(</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="c1"># scale from m to user-defined units</span>
        <span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_robust</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">d_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># scale from m to user-defined units</span>
        <span class="n">d_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_SI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_test</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_test</span><span class="p">,</span> <span class="n">v_test</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;experimental fit&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dissimilarity (</span><span class="si">{}</span><span class="se">\u00b2</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="c1"># Plot empirical variogram</span>
    <span class="k">if</span> <span class="n">d_test</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Empirical variogram&#39;</span> <span class="o">+</span> <span class="n">title_str</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;grid</span><span class="si">{}</span><span class="s1">_timeslice</span><span class="si">{}</span><span class="s1">_justEMPvariogram.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">)))</span>
    <span class="c1"># Plot just experimental variogram</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental variogram&#39;</span> <span class="o">+</span> <span class="n">title_str</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;grid</span><span class="si">{}</span><span class="s1">_timeslice</span><span class="si">{}</span><span class="s1">_justEXPvariogram.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridID</span><span class="p">,</span> <span class="n">timeslice</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.convert_SI" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_SI</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">unit_in</span><span class="p">,</span> <span class="n">unit_out</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Convert input to desired units</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_SI</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">unit_in</span><span class="p">,</span> <span class="n">unit_out</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Convert input to desired units</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">SI</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mm&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span> <span class="mf">1000.</span><span class="p">,</span>
          <span class="s1">&#39;mm^2&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;cm^2&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="s1">&#39;m^2&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;km^2&#39;</span><span class="p">:</span> <span class="mf">1e+6</span><span class="p">}</span>

    <span class="c1"># avoid conversion if output unit in time</span>
    <span class="k">if</span> <span class="n">unit_out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
        <span class="c1"># adjust if input isn&#39;t datetime, and assume it to be part of workflow</span>
        <span class="c1"># e.g. sigZTD filter, already extracted datetime object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;val.apply(pd.to_datetime).dt.</span><span class="si">{}</span><span class="s1">.astype(float).astype(&quot;Int32&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit_out</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span>

    <span class="c1"># check if output spatial unit is supported</span>
    <span class="k">if</span> <span class="n">unit_out</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SI</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User-specified output unit </span><span class="si">{}</span><span class="s2"> not recognized.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit_out</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">val</span> <span class="o">*</span> <span class="n">SI</span><span class="p">[</span><span class="n">unit_in</span><span class="p">]</span> <span class="o">/</span> <span class="n">SI</span><span class="p">[</span><span class="n">unit_out</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.create_parser" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_parser</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse command line arguments using argparse.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_parser</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command line arguments using argparse.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Perform basic statistical analyses concerning the spatiotemporal distribution of zenith delays.</span>

<span class="s2">Specifically, make any of the following specified plot(s):</span>
<span class="s2">scatterplot of station locations, total empirical and experimental variogram fits for data in each grid cell</span>
<span class="s2">(and for each valid time-slice if -variogram_per_timeslice specified), and gridded heatmaps of data, station distribution,</span>
<span class="s2">range and sill values associated with experimental variogram fits. The default is to generate all of these.</span>

<span class="s2">Example call to plot gridded station mean delay in a specific time interval :</span>
<span class="s2">raiderStats.py -f &lt;filename&gt; -grid_delay_mean -ti &#39;2016-01-01 2018-01-01&#39;</span>

<span class="s2">Example call to plot gridded station mean delay in a specific time interval with superimposed gridlines and station scatterplots :</span>
<span class="s2">raiderStats.py -f &lt;filename&gt; -grid_delay_mean -ti &#39;2016-01-01 2018-01-01&#39; --drawgridlines --stationsongrids</span>

<span class="s2">Example call to plot gridded station variogram in a specific time interval and through explicitly the summer seasons:</span>
<span class="s2">raiderStats.py -f &lt;filename&gt; -grid_delay_mean -ti &#39;2016-01-01 2018-01-01&#39; --seasonalinterval &#39;06-21 09-21&#39; -variogramplot</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># User inputs</span>
    <span class="n">userinps</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
        <span class="s1">&#39;User inputs/options for which especially careful review is recommended&#39;</span><span class="p">)</span>
    <span class="n">userinps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;fname&#39;</span><span class="p">,</span>
                          <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Final output file generated from downloadGNSSDelays.py which contains GPS zenith delays for a specified time period and spatial footprint. &#39;</span><span class="p">)</span>
    <span class="n">userinps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--column_name&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;col_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Name of the input column to plot. Input assumed to be in units of meters&#39;</span><span class="p">)</span>
    <span class="n">userinps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--unit&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specified output unit (as distance or time), by default m. Input unit assumed to be m following convention in downloadGNSSDelays.py. Refer to &quot;convert_SI&quot; for supported units. Note if you specify time unit here, you must specify input for &quot;--obs_errlimit&quot; to be in units of m&#39;</span><span class="p">)</span>
    <span class="n">userinps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--workdir&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;workdir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specify directory to deposit all outputs. Default is local directory where script is launched.&#39;</span><span class="p">)</span>
    <span class="n">add_cpus</span><span class="p">(</span><span class="n">userinps</span><span class="p">)</span>
    <span class="n">userinps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run in verbose (debug) mode. Default False&quot;</span><span class="p">)</span>

    <span class="c1"># Spatiotemporal subset options</span>
    <span class="n">dtsubsets</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
        <span class="s1">&#39;Controls for spatiotemporal subsetting.&#39;</span><span class="p">)</span>
    <span class="n">dtsubsets</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--bounding_box&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;bounding_box&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide either valid shapefile or Lat/Lon Bounding SNWE. -- Example : &#39;19 20 -99.5 -98.5&#39;&quot;</span><span class="p">)</span>
    <span class="n">dtsubsets</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-sp&#39;</span><span class="p">,</span> <span class="s1">&#39;--spacing&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;spacing&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specify spacing of grid-cells for statistical analyses. By default 1 deg.&#39;</span><span class="p">)</span>
    <span class="n">dtsubsets</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-ti&#39;</span><span class="p">,</span> <span class="s1">&#39;--timeinterval&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;timeinterval&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Subset in time by specifying earliest YYYY-MM-DD date followed by latest date YYYY-MM-DD. -- Example : &#39;2016-01-01 2019-01-01&#39;.&quot;</span><span class="p">)</span>
    <span class="n">dtsubsets</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-si&#39;</span><span class="p">,</span> <span class="s1">&#39;--seasonalinterval&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;seasonalinterval&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Subset in by an specific interval for each year by specifying earliest MM-DD time followed by latest MM-DD time. -- Example : &#39;03-21 06-21&#39;.&quot;</span><span class="p">)</span>
    <span class="n">dtsubsets</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-oe&#39;</span><span class="p">,</span> <span class="s1">&#39;--obs_errlimit&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;obs_errlimit&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Observation error threshold to discard observations with large uncertainties.&quot;</span><span class="p">)</span>

    <span class="c1"># Plot formatting/options</span>
    <span class="n">pltformat</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
        <span class="s1">&#39;Optional controls for plot formatting/options.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-figdpi&#39;</span><span class="p">,</span> <span class="s1">&#39;--figdpi&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;figdpi&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;DPI to use for saving figures&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-title&#39;</span><span class="p">,</span> <span class="s1">&#39;--user_title&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;user_title&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specify custom title for plots.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;--plot_format&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;plot_fmt&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Plot format to use for saving figures&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cb&#39;</span><span class="p">,</span> <span class="s1">&#39;--color_bounds&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;cbounds&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;List of two floats to use as color axis bounds&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cp&#39;</span><span class="p">,</span> <span class="s1">&#39;--colorpercentile&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;colorpercentile&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set low and upper percentile for plot colorbars. By default 25</span><span class="si">%%</span><span class="s1"> and 95</span><span class="si">%%</span><span class="s1">, respectively.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cm&#39;</span><span class="p">,</span> <span class="s1">&#39;--colormap&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;usr_colormap&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;hot_r&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specify matplotlib colorbar.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dt&#39;</span><span class="p">,</span> <span class="s1">&#39;--densitythreshold&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;densitythreshold&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;For variogram plots, given grid-cell is only valid if it contains this specified threshold of stations. By default 10 stations.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-sg&#39;</span><span class="p">,</span> <span class="s1">&#39;--stationsongrids&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;stationsongrids&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;In gridded plots, superimpose your gridded array with a scatterplot of station locations.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dg&#39;</span><span class="p">,</span> <span class="s1">&#39;--drawgridlines&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;drawgridlines&#39;</span><span class="p">,</span>
                           <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Draw gridlines on gridded plots.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-tl&#39;</span><span class="p">,</span> <span class="s1">&#39;--time_lines&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;time_lines&#39;</span><span class="p">,</span>
                           <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Draw central longitudinal lines with respect to datetime. Most useful for local-time analyses.&#39;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-plotall&#39;</span><span class="p">,</span> <span class="s1">&#39;--plotall&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;plotall&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate all supported plots, including variogram plots.&quot;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-min_span&#39;</span><span class="p">,</span> <span class="s1">&#39;--min_span&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;min_span&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum TS span (years) and minimum fractional observations in span (fraction) imposed for seasonal amplitude/phase analyses to be performed for a given station.&quot;</span><span class="p">)</span>
    <span class="n">pltformat</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-period_limit&#39;</span><span class="p">,</span> <span class="s1">&#39;--period_limit&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;period_limit&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;period limit (years) imposed for seasonal amplitude/phase analyses to be performed for a given station.&quot;</span><span class="p">)</span>

    <span class="c1"># All plot types</span>
    <span class="c1"># Station scatter-plots</span>
    <span class="n">pltscatter</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
        <span class="s1">&#39;Supported types of individual station scatter-plots.&#39;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-station_distribution&#39;</span><span class="p">,</span> <span class="s1">&#39;--station_distribution&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_distribution&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot station distribution.&quot;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-station_delay_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;--station_delay_mean&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_delay_mean&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot station mean delay.&quot;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-station_delay_median&#39;</span><span class="p">,</span> <span class="s1">&#39;--station_delay_median&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_delay_median&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot station median delay.&quot;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-station_delay_stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;--station_delay_stdev&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_delay_stdev&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot station delay stdev.&quot;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-station_seasonal_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;--station_seasonal_phase&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;station_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot station delay phase/amplitude.&quot;</span><span class="p">)</span>
    <span class="n">pltscatter</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-phaseamp_per_station&#39;</span><span class="p">,</span> <span class="s1">&#39;--phaseamp_per_station&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;phaseamp_per_station&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Save debug figures of curve-fit vs data per station.&quot;</span><span class="p">)</span>

    <span class="c1"># Gridded plots</span>
    <span class="n">pltgrids</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Supported types of gridded plots.&#39;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_heatmap&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_heatmap&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station heatmap.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_mean&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_mean&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station-wise mean delay.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_median&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_median&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_median&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station-wise median delay.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_stdev&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_stdev&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station-wise delay stdev.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station-wise delay phase/amplitude.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot absolute gridded station mean delay.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot absolute gridded station median delay.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot absolute gridded station delay stdev.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot absolute gridded station delay phase/amplitude.&quot;</span><span class="p">)</span>
    <span class="n">pltgrids</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-grid_to_raster&#39;</span><span class="p">,</span> <span class="s1">&#39;--grid_to_raster&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;grid_to_raster&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Save gridded array as raster. May directly load/plot in successive script call.&quot;</span><span class="p">)</span>

    <span class="c1"># Variogram plots</span>
    <span class="n">pltvario</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Supported types of variogram plots.&#39;</span><span class="p">)</span>
    <span class="n">pltvario</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-variogramplot&#39;</span><span class="p">,</span> <span class="s1">&#39;--variogramplot&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;variogramplot&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot gridded station variogram.&quot;</span><span class="p">)</span>
    <span class="n">pltvario</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-binnedvariogram&#39;</span><span class="p">,</span> <span class="s1">&#39;--binnedvariogram&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;binnedvariogram&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apply experimental variogram fit to total binned empirical variograms for each time slice. Default is to pass total unbinned empiricial variogram.&quot;</span><span class="p">)</span>
    <span class="n">pltvario</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-variogram_per_timeslice&#39;</span><span class="p">,</span> <span class="s1">&#39;--variogram_per_timeslice&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;variogram_per_timeslice&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate variogram plots per gridded station AND time-slice.&quot;</span><span class="p">)</span>
    <span class="n">pltvario</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-variogram_errlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;--variogram_errlimit&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;variogram_errlimit&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Variogram RMSE threshold to discard grid-cells with large uncertainties.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.load_gridfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_gridfile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Function to load gridded-arrays saved from previous runs.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_gridfile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to load gridded-arrays saved from previous runs.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">grid_array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;fname is not a valid file&#39;</span><span class="p">)</span>

    <span class="c1"># Read metadata variables needed for plotting</span>
    <span class="n">metadata_dict</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">tags</span><span class="p">()</span>

    <span class="c1"># Initiate no-data array to mask data</span>
    <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
        <span class="n">nodat_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="c1"># set masked values as nans</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodat_arr</span><span class="p">:</span>
        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">grid_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">grid_array</span><span class="p">)</span>
    <span class="n">grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Make plotting command a global variable</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;metadata_dict&#39;</span><span class="p">,</span> <span class="n">metadata_dict</span><span class="p">)</span>
    <span class="n">gridfile_type</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;gridfile_type&#39;</span><span class="p">]</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">gridfile_type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">plotbbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;plotbbox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;spacing&#39;</span><span class="p">])</span>
    <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;colorbarfmt&#39;</span><span class="p">]</span>
    <span class="n">inputunit</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="c1"># adjust conversion if native units are squared</span>
    <span class="k">if</span> <span class="s1">&#39;^2&#39;</span> <span class="ow">in</span> <span class="n">inputunit</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;^2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;^2&#39;</span>
    <span class="c1"># convert to specified output unit</span>
    <span class="n">grid_array</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">inputunit</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="c1"># Backwards compatible for cases where this key doesn&#39;t exist</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">time_lines</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;time_lines&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">time_lines</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;stationsongrids&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
        <span class="n">stationsongrids</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stationsongrids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;stationsongrids&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]]</span>

    <span class="k">if</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;time_lines&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
        <span class="n">time_lines</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_lines</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;time_lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">grid_array</span><span class="p">,</span> <span class="n">plotbbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="p">,</span> <span class="n">time_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.midpoint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">midpoint</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate central longitude for '--time_lines' option</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">midpoint</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate central longitude for &#39;--time_lines&#39; option</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">math</span>

    <span class="k">if</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dlon</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="p">)</span>
    <span class="n">lon3</span> <span class="o">=</span> <span class="n">lon1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lon3</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.save_gridfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_gridfile</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">gridfile_type</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">plotbbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">noData</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Function to save gridded-arrays as GDAL-readable file.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_gridfile</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">gridfile_type</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">plotbbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span>
                  <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="n">noData</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to save gridded-arrays as GDAL-readable file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Pass metadata</span>
    <span class="n">metadata_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;gridfile_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gridfile_type</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;plotbbox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plotbbox</span><span class="p">])</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;spacing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
        <span class="n">colorbarfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%1i</span><span class="s1">&#39;</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;colorbarfmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colorbarfmt</span>

    <span class="k">if</span> <span class="n">stationsongrids</span><span class="p">:</span>
        <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;stationsongrids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stationsongrids</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;stationsongrids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>

    <span class="k">if</span> <span class="n">time_lines</span><span class="p">:</span>
        <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;time_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time_lines</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metadata_dict</span><span class="p">[</span><span class="s1">&#39;time_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>

    <span class="c1"># Write data to file</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine</span><span class="p">(</span><span class="n">spacing</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">plotbbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">spacing</span><span class="p">,</span> <span class="n">plotbbox</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">width</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">noData</span><span class="p">,</span>
                       <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;+proj=latlong&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">update_tags</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_dict</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metadata_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.statsPlot.stats_analyses" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stats_analyses</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span> <span class="n">numCPUs</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">timeinterval</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="p">,</span> <span class="n">obs_errlimit</span><span class="p">,</span> <span class="n">figdpi</span><span class="p">,</span> <span class="n">user_title</span><span class="p">,</span> <span class="n">plot_fmt</span><span class="p">,</span> <span class="n">cbounds</span><span class="p">,</span> <span class="n">colorpercentile</span><span class="p">,</span> <span class="n">usr_colormap</span><span class="p">,</span> <span class="n">densitythreshold</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="p">,</span> <span class="n">drawgridlines</span><span class="p">,</span> <span class="n">time_lines</span><span class="p">,</span> <span class="n">plotall</span><span class="p">,</span> <span class="n">station_distribution</span><span class="p">,</span> <span class="n">station_delay_mean</span><span class="p">,</span> <span class="n">station_delay_median</span><span class="p">,</span> <span class="n">station_delay_stdev</span><span class="p">,</span> <span class="n">station_seasonal_phase</span><span class="p">,</span> <span class="n">phaseamp_per_station</span><span class="p">,</span> <span class="n">grid_heatmap</span><span class="p">,</span> <span class="n">grid_delay_mean</span><span class="p">,</span> <span class="n">grid_delay_median</span><span class="p">,</span> <span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="n">grid_to_raster</span><span class="p">,</span> <span class="n">min_span</span><span class="p">,</span> <span class="n">period_limit</span><span class="p">,</span> <span class="n">variogramplot</span><span class="p">,</span> <span class="n">binnedvariogram</span><span class="p">,</span> <span class="n">variogram_per_timeslice</span><span class="p">,</span> <span class="n">variogram_errlimit</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Main workflow for generating a suite of plots to illustrate spatiotemporal distribution
and/or character of zenith delays</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/statsPlot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stats_analyses</span><span class="p">(</span>
    <span class="n">fname</span><span class="p">,</span>
    <span class="n">col_name</span><span class="p">,</span>
    <span class="n">unit</span><span class="p">,</span>
    <span class="n">workdir</span><span class="p">,</span>
    <span class="n">numCPUs</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">,</span>
    <span class="n">spacing</span><span class="p">,</span>
    <span class="n">timeinterval</span><span class="p">,</span>
    <span class="n">seasonalinterval</span><span class="p">,</span>
    <span class="n">obs_errlimit</span><span class="p">,</span>
    <span class="n">figdpi</span><span class="p">,</span>
    <span class="n">user_title</span><span class="p">,</span>
    <span class="n">plot_fmt</span><span class="p">,</span>
    <span class="n">cbounds</span><span class="p">,</span>
    <span class="n">colorpercentile</span><span class="p">,</span>
    <span class="n">usr_colormap</span><span class="p">,</span>
    <span class="n">densitythreshold</span><span class="p">,</span>
    <span class="n">stationsongrids</span><span class="p">,</span>
    <span class="n">drawgridlines</span><span class="p">,</span>
    <span class="n">time_lines</span><span class="p">,</span>
    <span class="n">plotall</span><span class="p">,</span>
    <span class="n">station_distribution</span><span class="p">,</span>
    <span class="n">station_delay_mean</span><span class="p">,</span>
    <span class="n">station_delay_median</span><span class="p">,</span>
    <span class="n">station_delay_stdev</span><span class="p">,</span>
    <span class="n">station_seasonal_phase</span><span class="p">,</span>
    <span class="n">phaseamp_per_station</span><span class="p">,</span>
    <span class="n">grid_heatmap</span><span class="p">,</span>
    <span class="n">grid_delay_mean</span><span class="p">,</span>
    <span class="n">grid_delay_median</span><span class="p">,</span>
    <span class="n">grid_delay_stdev</span><span class="p">,</span>
    <span class="n">grid_seasonal_phase</span><span class="p">,</span>
    <span class="n">grid_delay_absolute_mean</span><span class="p">,</span>
    <span class="n">grid_delay_absolute_median</span><span class="p">,</span>
    <span class="n">grid_delay_absolute_stdev</span><span class="p">,</span>
    <span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span>
    <span class="n">grid_to_raster</span><span class="p">,</span>
    <span class="n">min_span</span><span class="p">,</span>
    <span class="n">period_limit</span><span class="p">,</span>
    <span class="n">variogramplot</span><span class="p">,</span>
    <span class="n">binnedvariogram</span><span class="p">,</span>
    <span class="n">variogram_per_timeslice</span><span class="p">,</span>
    <span class="n">variogram_errlimit</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Main workflow for generating a suite of plots to illustrate spatiotemporal distribution</span>
<span class="sd">    and/or character of zenith delays</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c1"># Control DPI for output figures</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figdpi</span>

    <span class="c1"># If user requests to generate all plots.</span>
    <span class="k">if</span> <span class="n">plotall</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&quot;-plotall&quot; == True. All plots will be made.&#39;</span><span class="p">)</span>
        <span class="n">station_distribution</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">station_delay_mean</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">station_delay_median</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">station_delay_stdev</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">station_seasonal_phase</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_heatmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_mean</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_median</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_stdev</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_seasonal_phase</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_absolute_mean</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_absolute_median</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_delay_absolute_stdev</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">grid_seasonal_absolute_phase</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">variogramplot</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Stats Function:***&quot;</span><span class="p">)</span>
    <span class="c1"># prep dataframe object for plotting/variogram analysis based off of user specifications</span>
    <span class="n">df_stats</span> <span class="o">=</span> <span class="n">RaiderStats</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span>
                           <span class="n">timeinterval</span><span class="p">,</span> <span class="n">seasonalinterval</span><span class="p">,</span> <span class="n">obs_errlimit</span><span class="p">,</span> <span class="n">time_lines</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="p">,</span> <span class="n">station_seasonal_phase</span><span class="p">,</span> <span class="n">cbounds</span><span class="p">,</span> <span class="n">colorpercentile</span><span class="p">,</span>
                           <span class="n">usr_colormap</span><span class="p">,</span> <span class="n">grid_heatmap</span><span class="p">,</span> <span class="n">grid_delay_mean</span><span class="p">,</span> <span class="n">grid_delay_median</span><span class="p">,</span> <span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="n">grid_seasonal_phase</span><span class="p">,</span>
                           <span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="n">grid_delay_absolute_stdev</span><span class="p">,</span>
                           <span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="n">grid_to_raster</span><span class="p">,</span> <span class="n">min_span</span><span class="p">,</span> <span class="n">period_limit</span><span class="p">,</span> <span class="n">numCPUs</span><span class="p">,</span> <span class="n">phaseamp_per_station</span><span class="p">)</span>

    <span class="c1"># Station plots</span>
    <span class="c1"># Plot each individual station</span>
    <span class="k">if</span> <span class="n">station_distribution</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot spatial distribution of stations.&quot;</span><span class="p">)</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">)],</span> <span class="s1">&#39;station_distribution&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean delay per station</span>
    <span class="k">if</span> <span class="n">station_delay_mean</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean delay for each station.&quot;</span><span class="p">)</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_delay_mean&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot median delay per station</span>
    <span class="k">if</span> <span class="n">station_delay_median</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot median delay for each station.&quot;</span><span class="p">)</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_delay_median&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot delay stdev per station</span>
    <span class="k">if</span> <span class="n">station_delay_stdev</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot delay stdev for each station.&quot;</span><span class="p">)</span>
        <span class="n">unique_points</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">unique_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_delay_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot delay phase/amplitude per station</span>
    <span class="k">if</span> <span class="n">station_seasonal_phase</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot delay phase/amplitude for each station.&quot;</span><span class="p">)</span>
        <span class="c1"># phase</span>
        <span class="n">unique_points_phase</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="s1">&#39;phsfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points_phase</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points_phase</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points_phase</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points_phase</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
            <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
        <span class="c1"># amplitude</span>
        <span class="n">unique_points_amplitude</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="s1">&#39;ampfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">unique_points_amplitude</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points_amplitude</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points_amplitude</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points_amplitude</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_seasonal_amplitude&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
            <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
        <span class="c1"># period</span>
        <span class="n">unique_points_period</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">])[</span><span class="s1">&#39;periodfit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_stats</span><span class="p">([</span><span class="n">unique_points_period</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">unique_points_period</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span>
        <span class="p">),</span> <span class="n">unique_points_period</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="s1">&#39;station_delay_period&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
            <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>

    <span class="c1"># Gridded station plots</span>
    <span class="c1"># Plot density of stations for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot density of stations per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_heatmap</span><span class="p">,</span> <span class="s1">&#39;grid_heatmap&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span>
                 <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise mean delay across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise mean delay across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_mean&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise median delay across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise median delay across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_median&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise stdev delay across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise stdev delay across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise delay phase across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise delay phase across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise delay amplitude across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise delay amplitude across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of station-wise delay period across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_period</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of station-wise delay period across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean stdev of station-wise delay phase across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean stdev of station-wise delay phase across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_phase_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean stdev of station-wise delay amplitude across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean stdev of station-wise delay amplitude across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean stdev of station-wise delay period across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean stdev of station-wise delay period across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_period_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot mean of seasonal fit RMSE across each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot mean of seasonal fit RMSE across each gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_fit_rmse&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute mean delay for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute mean delay per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_mean</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_mean&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute median delay for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute median delay per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_median</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_median&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute stdev delay for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay stdev per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_delay_absolute_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_delay_absolute_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay phase for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay phase per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay amplitude for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay amplitude per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay period for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay period per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay phase stdev for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay phase stdev per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_phase_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_phase_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay amplitude stdev for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay amplitude stdev per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_amplitude_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_amplitude_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute delay period stdev for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute delay period stdev per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_period_stdev</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_period_stdev&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="c1"># Plot absolute mean seasonal fit RMSE for each gridcell</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot absolute mean seasonal fit RMSE per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_seasonal_absolute_fit_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_seasonal_absolute_fit_rmse&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>

    <span class="c1"># Perform variogram analysis</span>
    <span class="k">if</span> <span class="n">variogramplot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Variogram Analysis Function:***&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
            <span class="n">df_stats</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Output unit </span><span class="si">{}</span><span class="s2"> specified for Variogram analysis. Reverted to meters&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">make_variograms</span> <span class="o">=</span> <span class="n">VariogramAnalysis</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span>
                                            <span class="n">df_stats</span><span class="o">.</span><span class="n">seasonalinterval</span><span class="p">,</span> <span class="n">densitythreshold</span><span class="p">,</span> <span class="n">binnedvariogram</span><span class="p">,</span>
                                            <span class="n">numCPUs</span><span class="p">,</span> <span class="n">variogram_per_timeslice</span><span class="p">,</span> <span class="n">variogram_errlimit</span><span class="p">)</span>
        <span class="n">TOT_grids</span><span class="p">,</span> <span class="n">TOT_res_robust_arr</span><span class="p">,</span> <span class="n">TOT_res_robust_rmse</span> <span class="o">=</span> <span class="n">make_variograms</span><span class="o">.</span><span class="n">create_variograms</span><span class="p">()</span>
        <span class="c1"># get range</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TOT_grids</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">TOT_res_robust_arr</span><span class="p">[</span><span class="n">TOT_grids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># convert range to specified output unit</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="c1"># get sill</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TOT_grids</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">TOT_res_robust_arr</span><span class="p">[</span><span class="n">TOT_grids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># convert sill to specified output unit</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="s1">&#39;m^2&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;^2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;^2&#39;</span><span class="p">)</span>
        <span class="c1"># get variogram rmse</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TOT_grids</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">TOT_res_robust_rmse</span><span class="p">[</span><span class="n">TOT_grids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">gridpoints</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_dim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># convert range to specified output unit</span>
        <span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span> <span class="o">=</span> <span class="n">convert_SI</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="c1"># If specified, save gridded array(s)</span>
        <span class="k">if</span> <span class="n">grid_to_raster</span><span class="p">:</span>
            <span class="c1"># write range</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_range&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="s1">&#39;grid_range&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="n">df_stats</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1i</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="n">df_stats</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># write sill</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_variance&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variance</span><span class="p">,</span> <span class="s1">&#39;grid_variance&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="n">df_stats</span><span class="o">.</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;^2&#39;</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3e</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="n">df_stats</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="c1"># write variogram rmse</span>
            <span class="n">gridfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="n">col_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;grid_variogram_rmse&#39;</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
            <span class="n">save_gridfile</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_variogram_rmse&#39;</span><span class="p">,</span> <span class="n">gridfile_name</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">plotbbox</span><span class="p">,</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                          <span class="n">df_stats</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">stationsongrids</span><span class="o">=</span><span class="n">df_stats</span><span class="o">.</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># plot range heatmap</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot variogram range per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_range</span><span class="p">,</span> <span class="s1">&#39;grid_range&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span>
                 <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1i</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># plot sill heatmap</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot variogram sill per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variance</span><span class="p">,</span> <span class="s1">&#39;grid_variance&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span>
                 <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># plot variogram rmse heatmap</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;- Plot variogram RMSE per gridcell.&quot;</span><span class="p">)</span>
        <span class="n">df_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="o">.</span><span class="n">grid_variogram_rmse</span><span class="p">,</span> <span class="s1">&#39;grid_variogram_rmse&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">drawgridlines</span><span class="o">=</span><span class="n">drawgridlines</span><span class="p">,</span>
                 <span class="n">colorbarfmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">stationsongrids</span><span class="o">=</span><span class="n">stationsongrids</span><span class="p">,</span> <span class="n">plotFormat</span><span class="o">=</span><span class="n">plot_fmt</span><span class="p">,</span> <span class="n">userTitle</span><span class="o">=</span><span class="n">user_title</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.cli.validators" class="doc doc-heading">
            <code>validators</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.validators.BBoxAction" class="doc doc-heading">
            <code>BBoxAction</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="argparse.Action">Action</span></code></p>


      <p>An Action that parses and stores a valid bounding box</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BBoxAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Action that parses and stores a valid bounding box&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">option_strings</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nargs must be 4!&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="n">S</span> <span class="ow">or</span> <span class="n">E</span> <span class="o">&lt;=</span> <span class="n">W</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Bounding box has no size; make sure you use &quot;S N W E&quot;&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sn</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">sn</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Lats are out of S/N bounds (-90 to 90).&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">we</span> <span class="ow">in</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">we</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">or</span> <span class="n">we</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Lons are out of W/E bounds (-180 to 180); Lons in the format of (0 to 360) are not supported.&#39;</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.validators.DateListAction" class="doc doc-heading">
            <code>DateListAction</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="argparse.Action">Action</span></code></p>


      <p>An Action that parses and stores a list of dates</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DateListAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Action that parses and stores a list of dates&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">option_strings</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">date_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type must be `date_type`!&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Only 1, 2 dates, or 2 dates and interval may be supplied&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">stepsize</span> <span class="o">=</span> <span class="n">values</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stepsize</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;The stepsize should be in integer days&quot;</span><span class="p">)</span>

            <span class="n">new_year</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">stepsize</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">stepsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">stepsize</span> <span class="o">-</span> <span class="n">new_year</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">)]</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.validators.IntegerMappingType" class="doc doc-heading">
            <code>IntegerMappingType</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.cli.validators.MappingType" href="#RAiDER.cli.validators.MappingType">MappingType</a></code>, <code><a class="autorefs autorefs-internal" title="RAiDER.cli.validators.IntegerType" href="#RAiDER.cli.validators.IntegerType">IntegerType</a></code></p>


      <p>An integer type that converts non-integer types through a mapping.</p>
<h5 id="RAiDER.cli.validators.IntegerMappingType--example">Example</h5>
<pre><code>integer = IntegerMappingType(0, 100, random=42)
assert integer(&quot;0&quot;) == 0
assert integer(&quot;100&quot;) == 100
assert integer(&quot;random&quot;) == 42
</code></pre>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IntegerMappingType</span><span class="p">(</span><span class="n">MappingType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An integer type that converts non-integer types through a mapping.</span>

<span class="sd">    # Example</span>
<span class="sd">    ```</span>
<span class="sd">    integer = IntegerMappingType(0, 100, random=42)</span>
<span class="sd">    assert integer(&quot;0&quot;) == 0</span>
<span class="sd">    assert integer(&quot;100&quot;) == 100</span>
<span class="sd">    assert integer(&quot;random&quot;) == 42</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">IntegerType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">MappingType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">IntegerType</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MappingType</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.validators.IntegerType" class="doc doc-heading">
            <code>IntegerType</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>A type that converts arguments to integers.</p>
<h5 id="RAiDER.cli.validators.IntegerType--example">Example</h5>
<pre><code>integer = IntegerType(0, 100)
assert integer(&quot;0&quot;) == 0
assert integer(&quot;100&quot;) == 100
integer(&quot;-10&quot;)  # Raises exception
</code></pre>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IntegerType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A type that converts arguments to integers.</span>

<span class="sd">    # Example</span>
<span class="sd">    ```</span>
<span class="sd">    integer = IntegerType(0, 100)</span>
<span class="sd">    assert integer(&quot;0&quot;) == 0</span>
<span class="sd">    assert integer(&quot;100&quot;) == 100</span>
<span class="sd">    integer(&quot;-10&quot;)  # Raises exception</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">lo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">integer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">integer</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s2">&quot;Must be greater than </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">integer</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s2">&quot;Must be less than </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">integer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.cli.validators.MappingType" class="doc doc-heading">
            <code>MappingType</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>A type that maps arguments to constants.</p>
<h5 id="RAiDER.cli.validators.MappingType--example">Example</h5>
<pre><code>mapping = MappingType(foo=42, bar=&quot;baz&quot;).default(None)
assert mapping(&quot;foo&quot;) == 42
assert mapping(&quot;bar&quot;) == &quot;baz&quot;
assert mapping(&quot;hello&quot;) is None
</code></pre>

              <details class="quote">
                <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MappingType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A type that maps arguments to constants.</span>

<span class="sd">    # Example</span>
<span class="sd">    ```</span>
<span class="sd">    mapping = MappingType(foo=42, bar=&quot;baz&quot;).default(None)</span>
<span class="sd">    assert mapping(&quot;foo&quot;) == 42</span>
<span class="sd">    assert mapping(&quot;bar&quot;) == &quot;baz&quot;</span>
<span class="sd">    assert mapping(&quot;hello&quot;) is None</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">UNSET</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNSET</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a default value if no mapping is found&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNSET</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid choice &#39;</span><span class="si">{}</span><span class="s2">&#39;, must be one of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">arg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.cli.validators.MappingType.default" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default</span><span class="p">(</span><span class="n">default</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Set a default value if no mapping is found</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a default value if no mapping is found&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.date_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">date_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse a date from a string in pseudo-ISO 8601 format.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">date_type</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a date from a string in pseudo-ISO 8601 format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">year_formats</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%j&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">yf</span> <span class="ow">in</span> <span class="n">year_formats</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="o">*</span><span class="n">strptime</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">yf</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">raise</span> <span class="n">ArgumentTypeError</span><span class="p">(</span>
        <span class="s1">&#39;Unable to coerce </span><span class="si">{}</span><span class="s1"> to a date. Try %Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.enforce_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enforce_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Enforce a valid bounding box</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enforce_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforce a valid bounding box</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bbox</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bbox</span><span class="p">]</span>

    <span class="c1"># Check the bbox</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bounding box must have 4 elements!&quot;</span><span class="p">)</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">bbox</span>

    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="n">S</span> <span class="ow">or</span> <span class="n">E</span> <span class="o">&lt;=</span> <span class="n">W</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Bounding box has no size; make sure you use &quot;S N W E&quot;&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sn</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">sn</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lats are out of S/N bounds (-90 to 90).&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">we</span> <span class="ow">in</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">we</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">or</span> <span class="n">we</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lons are out of W/E bounds (-180 to 180); Lons in the format of (0 to 360) are not supported.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bbox</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.enforce_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enforce_time</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse an input time (required to be ISO 8601)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enforce_time</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse an input time (required to be ISO 8601)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_time</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must specify a &quot;time&quot; in the input config file&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;end_time&#39;</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_time</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">arg_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.enforce_valid_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enforce_valid_dates</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse a date from a string in pseudo-ISO 8601 format.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enforce_valid_dates</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a date from a string in pseudo-ISO 8601 format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">year_formats</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%j&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">yf</span> <span class="ow">in</span> <span class="n">year_formats</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">yf</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s1">&#39;Unable to coerce </span><span class="si">{}</span><span class="s1"> to a date. Try %Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.getBufferedExtent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getBufferedExtent</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the bounding box around a set of lats/lons</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getBufferedExtent</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get the bounding box around a set of lats/lons</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">lats</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="n">lats</span> <span class="o">+</span> <span class="n">buf</span><span class="p">,</span> <span class="n">lons</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="n">lons</span> <span class="o">+</span> <span class="n">buf</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">lats</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="n">lats</span> <span class="o">+</span> <span class="n">buf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">lons</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="n">lons</span> <span class="o">+</span> <span class="n">buf</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">+</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">+</span> <span class="n">buf</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Not a valid lat/lon shape or variable&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.get_heights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_heights</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">station_file</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse the Height info and download a DEM if needed</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_heights</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">station_file</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse the Height info and download a DEM if needed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dem_path</span> <span class="o">=</span> <span class="n">out</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;dem&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dem&#39;</span><span class="p">),</span>
            <span class="s1">&#39;height_file_rdr&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;height_levels&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dem&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Hgt_m&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dem_path</span><span class="p">,</span> <span class="s1">&#39;GLO30.dem&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dem</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dem</span>
            <span class="c1"># crop the DEM</span>
            <span class="k">if</span> <span class="n">bounding_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dem_bounds</span> <span class="o">=</span> <span class="n">rio_extents</span><span class="p">(</span><span class="n">rio_profile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dem</span><span class="p">))</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">dem_bounds</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">dem_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">isOutside</span><span class="p">(</span>
                    <span class="n">bounding_box</span><span class="p">,</span>
                    <span class="n">getBufferedExtent</span><span class="p">(</span>
                        <span class="n">lats</span><span class="p">,</span>
                        <span class="n">lons</span><span class="p">,</span>
                        <span class="n">buf</span><span class="o">=</span><span class="n">_BUFFER_SIZE</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s1">&#39;Existing DEM does not cover the area of the input lat/lon &#39;</span>
                                <span class="s1">&#39;points; either move the DEM, delete it, or change the input &#39;</span>
                                <span class="s1">&#39;points.&#39;</span>
                            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># will download the dem later</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height_file_rdr&#39;</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;height_file_rdr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">height_file_rdr</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># download the DEM if needed</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dem_path</span><span class="p">,</span> <span class="s1">&#39;GLO30.dem&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height_levels&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">height_levels</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[-0-9]+&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">height_levels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">height_levels</span>

        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;height_levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;height_levels&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Weather model only extends to the surface topography; &#39;</span>
            <span class="s1">&#39;height levels below the topography will be interpolated from the surface &#39;</span>
            <span class="s1">&#39;and may be inaccurate.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.get_query_region" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_query_region</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse the query region from inputs</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_query_region</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse the query region from inputs</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get bounds from the inputs</span>
    <span class="c1"># make sure this is first</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_dem_latlon&#39;</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">GeocodedFile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dem</span><span class="p">,</span> <span class="n">is_dem</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lat_file&#39;</span><span class="p">):</span>
        <span class="n">hgt_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height_file_rdr&#39;</span><span class="p">)</span> <span class="c1"># only get it if exists</span>
        <span class="n">dem_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dem&#39;</span><span class="p">)</span>
        <span class="n">query</span>    <span class="o">=</span> <span class="n">RasterRDR</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">lat_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">lon_file</span><span class="p">,</span> <span class="n">hgt_file</span><span class="p">,</span> <span class="n">dem_file</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;station_file&#39;</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">StationFile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">station_file</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bounding_box&#39;</span><span class="p">):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">enforce_bbox</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lats are out of N/S bounds; are your lat/lon coordinates switched? Should be SNWE&#39;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geocoded_file&#39;</span><span class="p">):</span>
        <span class="n">gfile</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">geocoded_file</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">gfile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SRTM&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">gfile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;GLO&#39;</span><span class="p">)):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Using user DEM: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">gfile</span><span class="p">)</span>
            <span class="n">is_dem</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_dem</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">query</span>  <span class="o">=</span> <span class="n">GeocodedFile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">geocoded_file</span><span class="p">,</span> <span class="n">is_dem</span><span class="o">=</span><span class="n">is_dem</span><span class="p">)</span>

    <span class="c1">## untested</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geo_cube&#39;</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">Geocube</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">geo_cube</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO: Need to incorporate the cube</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No valid query points or bounding box found in the configuration file&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.isInside" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">isInside</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">extent2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Determine whether all of extent1 lies inside extent2
extent1/2 should be a list containing [lower_lat, upper_lat, left_lon, right_lon].
Equal extents are considered "inside"</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">isInside</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">extent2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine whether all of extent1 lies inside extent2</span>
<span class="sd">    extent1/2 should be a list containing [lower_lat, upper_lat, left_lon, right_lon].</span>
<span class="sd">    Equal extents are considered &quot;inside&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t4</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">]):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.isOutside" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">isOutside</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">extent2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Determine whether any of extent1  lies outside extent2
extent1/2 should be a list containing [lower_lat, upper_lat, left_lon, right_lon]
Equal extents are considered "inside"</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">isOutside</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">extent2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine whether any of extent1  lies outside extent2</span>
<span class="sd">    extent1/2 should be a list containing [lower_lat, upper_lat, left_lon, right_lon]</span>
<span class="sd">    Equal extents are considered &quot;inside&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t4</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">]):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.modelName2Module" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modelName2Module</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Turn an arbitrary string into a module name.
Takes as input a model name, which hopefully looks like ERA-I, and
converts it to a module name, which will look like erai. I doesn't
always produce a valid module name, but that's not the goal. The
goal is just to handle common cases.
Inputs:
   model_name  - Name of an allowed weather model (e.g., 'era-5')
Outputs:
   module_name - Name of the module
   wmObject    - callable, weather model object</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modelName2Module</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn an arbitrary string into a module name.</span>
<span class="sd">    Takes as input a model name, which hopefully looks like ERA-I, and</span>
<span class="sd">    converts it to a module name, which will look like erai. I doesn&#39;t</span>
<span class="sd">    always produce a valid module name, but that&#39;s not the goal. The</span>
<span class="sd">    goal is just to handle common cases.</span>
<span class="sd">    Inputs:</span>
<span class="sd">       model_name  - Name of an allowed weather model (e.g., &#39;era-5&#39;)</span>
<span class="sd">    Outputs:</span>
<span class="sd">       module_name - Name of the module</span>
<span class="sd">       wmObject    - callable, weather model object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="s1">&#39;RAiDER.models.&#39;</span> <span class="o">+</span> <span class="n">model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">model_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="n">wmObject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model_module</span><span class="p">,</span> <span class="n">model_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">wmObject</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.cli.validators.parse_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_dates</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Determine the requested dates from the input parameters</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/cli/validators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_dates</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine the requested dates from the input parameters</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_list&#39;</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;date_list&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">enforce_valid_dates</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;date_start&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs must include either date_list or date_start&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">enforce_valid_dates</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_end&#39;</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;date_end&#39;</span><span class="p">]</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">enforce_valid_dates</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">end</span> <span class="o">=</span> <span class="n">start</span>

        <span class="k">if</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_step&#39;</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;date_step&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">L</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.delay" class="doc doc-heading">
            <code>delay</code>


</h2>

    <div class="doc doc-contents ">

      <p>RAiDER tropospheric delay calculation</p>
<p>This module provides the main RAiDER functionality for calculating
tropospheric wet and hydrostatic delays from a weather model. Weather
models are accessed as NETCDF files and should have "wet" "hydro"
"wet_total" and "hydro_total" fields specified.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.delay.transformPoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transformPoints</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">hgts</span><span class="p">,</span> <span class="n">old_proj</span><span class="p">,</span> <span class="n">new_proj</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Transform lat/lon/hgt data to an array of points in a new
projection</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lats</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray   - WGS-84 latitude (EPSG: 4326)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lons</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray   - ditto for longitude</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hgts</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray   - Ellipsoidal height in meters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>old_proj</code></td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CRS   - the original projection of the points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>new_proj</code></td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CRS   - the new projection in which to return the points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ndarray</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the array of query points in the weather model coordinate system (YX)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/delay.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transformPoints</span><span class="p">(</span><span class="n">lats</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lons</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">hgts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">old_proj</span><span class="p">:</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">new_proj</span><span class="p">:</span> <span class="n">CRS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Transform lat/lon/hgt data to an array of points in a new</span>
<span class="sd">    projection</span>

<span class="sd">    Args:</span>
<span class="sd">        lats: ndarray   - WGS-84 latitude (EPSG: 4326)</span>
<span class="sd">        lons: ndarray   - ditto for longitude</span>
<span class="sd">        hgts: ndarray   - Ellipsoidal height in meters</span>
<span class="sd">        old_proj: CRS   - the original projection of the points</span>
<span class="sd">        new_proj: CRS   - the new projection in which to return the points</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray: the array of query points in the weather model coordinate system (YX)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Flags for flipping inputs or outputs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_proj</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
        <span class="n">new_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">new_proj</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;EPSG:&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_proj</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
        <span class="n">old_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">old_proj</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;EPSG:&#39;</span><span class="p">))</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">old_proj</span><span class="p">,</span> <span class="n">new_proj</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># in_flip = old_proj.axis_info[0].direction</span>
    <span class="c1"># out_flip = new_proj.axis_info[0].direction</span>

    <span class="n">res</span>  <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">hgts</span><span class="p">)</span>

    <span class="c1"># lat/lon/height</span>
    <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.delay.tropo_delay" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tropo_delay</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">los</span><span class="p">,</span> <span class="n">height_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_proj</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">zref</span><span class="o">=</span><span class="n">_ZREF</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate integrated delays on query points. Options are:
1. Zenith delays (ZTD)
2. Zenith delays projected to the line-of-sight (STD-projected)
3. Slant delays integrated along the raypath (STD-raytracing)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datetime                - Datetime object for determining when to calculate delays</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>weather_model_File</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string  - Name of the NETCDF file containing a pre-processed weather model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>aoi</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AOI object             - AOI object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>los</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LOS object             - LOS object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height_levels</code></td>
            <td>
                  <code><span title="typing.List">List</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list         - (optional) list of height levels on which to calculate delays. Only needed for cube generation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>out_proj</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[int, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int,str           - (optional) EPSG code for output projection</p>
              </div>
            </td>
            <td>
                  <code>4326</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zref</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[int, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int,float             - (optional) maximum height to integrate up to during raytracing</p>
              </div>
            </td>
            <td>
                  <code><span title="RAiDER.constants._ZREF">_ZREF</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray Dataset <em>or</em> ndarrays: - wet and hydrostatic delays at the grid nodes / query points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/delay.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tropo_delay</span><span class="p">(</span>
        <span class="n">dt</span><span class="p">,</span>
        <span class="n">weather_model_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">aoi</span><span class="p">,</span>
        <span class="n">los</span><span class="p">,</span>
        <span class="n">height_levels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">out_proj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">zref</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="n">_ZREF</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate integrated delays on query points. Options are:</span>
<span class="sd">    1. Zenith delays (ZTD)</span>
<span class="sd">    2. Zenith delays projected to the line-of-sight (STD-projected)</span>
<span class="sd">    3. Slant delays integrated along the raypath (STD-raytracing)</span>

<span class="sd">    Args:</span>
<span class="sd">        dt: Datetime                - Datetime object for determining when to calculate delays</span>
<span class="sd">        weather_model_File: string  - Name of the NETCDF file containing a pre-processed weather model</span>
<span class="sd">        aoi: AOI object             - AOI object</span>
<span class="sd">        los: LOS object             - LOS object</span>
<span class="sd">        height_levels: list         - (optional) list of height levels on which to calculate delays. Only needed for cube generation.</span>
<span class="sd">        out_proj: int,str           - (optional) EPSG code for output projection</span>
<span class="sd">        zref: int,float             - (optional) maximum height to integrate up to during raytracing</span>


<span class="sd">    Returns:</span>
<span class="sd">        xarray Dataset *or* ndarrays: - wet and hydrostatic delays at the grid nodes / query points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="n">out_proj</span><span class="p">)</span>

    <span class="c1"># Load CRS from weather model file</span>
    <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">weather_model_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wm_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;crs_wkt&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;WARNING: I can&#39;t find a CRS in the weather model file, so I will assume you are using WGS84&quot;</span><span class="p">)</span>
            <span class="n">wm_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

    <span class="c1"># get heights</span>
    <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">weather_model_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">wm_levels</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">values</span>
        <span class="n">toa</span>       <span class="o">=</span> <span class="n">wm_levels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">height_levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Geocube&#39;</span><span class="p">:</span>
            <span class="n">height_levels</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">readZ</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height_levels</span> <span class="o">=</span> <span class="n">wm_levels</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">zref</span><span class="p">:</span>
        <span class="n">zref</span> <span class="o">=</span> <span class="n">toa</span>

    <span class="k">if</span> <span class="n">zref</span> <span class="o">&gt;</span> <span class="n">toa</span><span class="p">:</span>
        <span class="n">zref</span> <span class="o">=</span> <span class="n">toa</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Requested integration height (zref) is higher than top of weather model. Forcing to top (</span><span class="si">{toa}</span><span class="s1">).&#39;</span><span class="p">)</span>


    <span class="c1">#TODO: expose this as library function</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">_get_delays_on_cube</span><span class="p">(</span>
        <span class="n">dt</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">,</span> <span class="n">wm_proj</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">height_levels</span><span class="p">,</span> <span class="n">los</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">zref</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;bounding_box&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Geocube&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ds</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># CRS can be an int, str, or CRS object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">out_proj</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">CRSError</span><span class="p">:</span>
            <span class="n">out_proj</span> <span class="o">=</span> <span class="n">out_proj</span>

        <span class="n">pnt_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
        <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">readLL</span><span class="p">()</span>
        <span class="n">hgts</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">readZ</span><span class="p">()</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="n">transformPoints</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">hgts</span><span class="p">,</span> <span class="n">pnt_proj</span><span class="p">,</span> <span class="n">out_proj</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ifWet</span><span class="p">,</span> <span class="n">ifHydro</span> <span class="o">=</span> <span class="n">getInterpolators</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;ztd&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed to get weather model </span><span class="si">%s</span><span class="s1"> interpolators.&#39;</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">)</span>

        <span class="n">wetDelay</span> <span class="o">=</span> <span class="n">ifWet</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span>
        <span class="n">hydroDelay</span> <span class="o">=</span> <span class="n">ifHydro</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span>

        <span class="c1"># return the delays (ZTD or STD)</span>
        <span class="k">if</span> <span class="n">los</span><span class="o">.</span><span class="n">is_Projected</span><span class="p">():</span>
            <span class="n">los</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">los</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">hgts</span><span class="p">)</span>
            <span class="n">wetDelay</span>   <span class="o">=</span> <span class="n">los</span><span class="p">(</span><span class="n">wetDelay</span><span class="p">)</span>
            <span class="n">hydroDelay</span> <span class="o">=</span> <span class="n">los</span><span class="p">(</span><span class="n">hydroDelay</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wetDelay</span><span class="p">,</span> <span class="n">hydroDelay</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.delay.writeResultsToXarray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">writeResultsToXarray</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">zpts</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">wetDelay</span><span class="p">,</span> <span class="n">hydroDelay</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">,</span> <span class="n">out_type</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>write a 1-D array to a NETCDF5 file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/delay.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">writeResultsToXarray</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">zpts</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">wetDelay</span><span class="p">,</span> <span class="n">hydroDelay</span><span class="p">,</span> <span class="n">weather_model_file</span><span class="p">,</span> <span class="n">out_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    write a 1-D array to a NETCDF5 file</span>
<span class="sd">    &#39;&#39;&#39;</span>
       <span class="c1"># Modify this as needed for NISAR / other projects</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
        <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">wet</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span>
                 <span class="n">wetDelay</span><span class="p">,</span>
                 <span class="p">{</span><span class="s2">&quot;units&quot;</span> <span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;wet </span><span class="si">{</span><span class="n">out_type</span><span class="si">}</span><span class="s2"> delay&quot;</span><span class="p">,</span>
                  <span class="c1"># &#39;crs&#39;: crs.to_epsg(),</span>
                  <span class="s2">&quot;grid_mapping&quot;</span><span class="p">:</span> <span class="s2">&quot;crs&quot;</span><span class="p">,</span>

                 <span class="p">}),</span>
            <span class="n">hydro</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span>
                   <span class="n">hydroDelay</span><span class="p">,</span>
                   <span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                    <span class="c1"># &#39;crs&#39;: crs.to_epsg(),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;hydrostatic </span><span class="si">{</span><span class="n">out_type</span><span class="si">}</span><span class="s2"> delay&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;grid_mapping&quot;</span><span class="p">:</span> <span class="s2">&quot;crs&quot;</span><span class="p">,</span>
                   <span class="p">}),</span>
        <span class="p">),</span>
        <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">xpts</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">ypts</span><span class="p">),</span>
            <span class="n">z</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">zpts</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">attrs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">Conventions</span><span class="o">=</span><span class="s2">&quot;CF-1.7&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;RAiDER geo cube&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">weather_model_file</span><span class="p">),</span>
            <span class="n">history</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; RAiDER&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RAiDER geo cube - </span><span class="si">{</span><span class="n">out_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">reference_time</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Write projection system mapping</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mi">2147483647</span><span class="p">)</span> <span class="c1"># dummy placeholder</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">crs</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># Write z-axis information</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;height above ellipsoid&quot;</span>

    <span class="c1"># If in degrees</span>
    <span class="k">if</span> <span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit_name</span> <span class="o">==</span> <span class="s2">&quot;degree&quot;</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees_north&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;standard_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;latitude&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;latitude&quot;</span>

        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees_east&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;standard_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;longitude&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;longitude&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;standard_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;projection_y_coordinate&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;y-coordinate in projected coordinate system&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>

        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;standard_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;projection_x_coordinate&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;x-coordinate in projected coordinate system&quot;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>

    <span class="k">return</span> <span class="n">ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.delayFcns" class="doc doc-heading">
            <code>delayFcns</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.delayFcns.getInterpolators" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getInterpolators</span><span class="p">(</span><span class="n">wm_file</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pointwise&#39;</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read 3D gridded data from a processed weather model file and wrap it with
the scipy RegularGridInterpolator</p>
<p>The interpolator grid is (y, x, z)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/delayFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getInterpolators</span><span class="p">(</span><span class="n">wm_file</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pointwise&#39;</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read 3D gridded data from a processed weather model file and wrap it with</span>
<span class="sd">    the scipy RegularGridInterpolator</span>

<span class="sd">    The interpolator grid is (y, x, z)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get the weather model data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">wm_file</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">wm_file</span>

    <span class="n">xs_wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:])</span>
    <span class="n">ys_wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][:])</span>
    <span class="n">zs_wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][:])</span>

    <span class="n">wet</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wet_total&#39;</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;total&#39;</span> <span class="k">else</span> <span class="s1">&#39;wet&#39;</span><span class="p">][:]</span>
    <span class="n">hydro</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;hydro_total&#39;</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;total&#39;</span> <span class="k">else</span> <span class="s1">&#39;hydro&#39;</span><span class="p">][:]</span>

    <span class="n">wet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wet</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">hydro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hydro</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">wet</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hydro</span><span class="p">)):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Weather model contains NaNs!&#39;</span><span class="p">)</span>

    <span class="c1"># If shared interpolators are requested</span>
    <span class="c1"># The arrays are not modified - so turning off lock for performance</span>
    <span class="k">if</span> <span class="n">shared</span><span class="p">:</span>
        <span class="n">xs_wm</span> <span class="o">=</span> <span class="n">make_shared_raw</span><span class="p">(</span><span class="n">xs_wm</span><span class="p">)</span>
        <span class="n">ys_wm</span> <span class="o">=</span> <span class="n">make_shared_raw</span><span class="p">(</span><span class="n">ys_wm</span><span class="p">)</span>
        <span class="n">zs_wm</span> <span class="o">=</span> <span class="n">make_shared_raw</span><span class="p">(</span><span class="n">zs_wm</span><span class="p">)</span>
        <span class="n">wet</span>   <span class="o">=</span> <span class="n">make_shared_raw</span><span class="p">(</span><span class="n">wet</span><span class="p">)</span>
        <span class="n">hydro</span> <span class="o">=</span> <span class="n">make_shared_raw</span><span class="p">(</span><span class="n">hydro</span><span class="p">)</span>


    <span class="n">ifWet</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">ys_wm</span><span class="p">,</span> <span class="n">xs_wm</span><span class="p">,</span> <span class="n">zs_wm</span><span class="p">),</span> <span class="n">wet</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bounds_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ifHydro</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">ys_wm</span><span class="p">,</span> <span class="n">xs_wm</span><span class="p">,</span> <span class="n">zs_wm</span><span class="p">),</span> <span class="n">hydro</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bounds_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ifWet</span><span class="p">,</span> <span class="n">ifHydro</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.delayFcns.make_shared_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_shared_raw</span><span class="p">(</span><span class="n">inarr</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Make numpy view array of mp.Array</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/delayFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_shared_raw</span><span class="p">(</span><span class="n">inarr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make numpy view array of mp.Array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create flat shared array</span>
    <span class="k">if</span> <span class="n">mp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;multiprocessing is not available&#39;</span><span class="p">)</span>

    <span class="n">shared_arr</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">RawArray</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">inarr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="c1"># Create a numpy view of it</span>
    <span class="n">shared_arr_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">inarr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                               <span class="n">buffer</span><span class="o">=</span><span class="n">shared_arr</span><span class="p">)</span>
    <span class="c1"># Copy data to shared array</span>
    <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">shared_arr_np</span><span class="p">,</span> <span class="n">inarr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">shared_arr_np</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.dem" class="doc doc-heading">
            <code>dem</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.dem.download_dem" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_dem</span><span class="p">(</span><span class="n">ll_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">demName</span><span class="o">=</span><span class="s1">&#39;warpedDEM.dem&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">writeDEM</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Download a DEM if one is not already present. 
Args:
        llbounds: list/ndarry of floats   -lat/lon bounds of the area to download. Values should be ordered in the following way: [S, N, W, E]
        writeDEM: boolean                 -write the DEM to file
        outName: string                   -name of the DEM file <br />
        buf: float                        -buffer to add to the bounds
        overwrite: boolean                -overwrite existing DEM
Returns:
        zvals: np.array         -DEM heights
        metadata:               -metadata for the DEM</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/dem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_dem</span><span class="p">(</span>
        <span class="n">ll_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">demName</span><span class="o">=</span><span class="s1">&#39;warpedDEM.dem&#39;</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">writeDEM</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">buf</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    Download a DEM if one is not already present. </span>
<span class="sd">    Args:</span>
<span class="sd">            llbounds: list/ndarry of floats   -lat/lon bounds of the area to download. Values should be ordered in the following way: [S, N, W, E]</span>
<span class="sd">            writeDEM: boolean                 -write the DEM to file</span>
<span class="sd">            outName: string                   -name of the DEM file   </span>
<span class="sd">            buf: float                        -buffer to add to the bounds</span>
<span class="sd">            overwrite: boolean                -overwrite existing DEM</span>
<span class="sd">    Returns:</span>
<span class="sd">            zvals: np.array         -DEM heights</span>
<span class="sd">            metadata:               -metadata for the DEM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">demName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">download</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">download</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">download</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">download</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ll_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;download_dem: Either an existing file or lat/lon bounds must be passed&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">download</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Using existing DEM: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">demName</span><span class="p">)</span>
        <span class="n">zvals</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">rio_open</span><span class="p">(</span><span class="n">demName</span><span class="p">,</span> <span class="n">returnProj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># download the dem</span>
        <span class="c1"># inExtent is SNWE</span>
        <span class="c1"># dem-stitcher wants WSEN</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">buf</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">buf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">buf</span>
        <span class="p">]</span>

        <span class="n">zvals</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">stitch_dem</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">,</span>
            <span class="n">dem_name</span><span class="o">=</span><span class="s1">&#39;glo_30&#39;</span><span class="p">,</span>
            <span class="n">dst_ellipsoidal_height</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dst_area_or_point</span><span class="o">=</span><span class="s1">&#39;Area&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">writeDEM</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">demName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zvals</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">update_tags</span><span class="p">(</span><span class="n">AREA_OR_POINT</span><span class="o">=</span><span class="s1">&#39;Point&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote DEM: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">demName</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">zvals</span><span class="p">,</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.getStationDelays" class="doc doc-heading">
            <code>getStationDelays</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.getStationDelays.get_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_date</span><span class="p">(</span><span class="n">stationFile</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>extract the date from a station delay file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/getStationDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_date</span><span class="p">(</span><span class="n">stationFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    extract the date from a station delay file</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># find the date info</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stationFile</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">doy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stationFile</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">doy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">doy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.getStationDelays.get_delays_UNR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_delays_UNR</span><span class="p">(</span><span class="n">stationFile</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dateList</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Parses and returns a dictionary containing either (1) all
the GPS delays, if returnTime is None, or (2) only the delay
at the closest times to to returnTime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>stationFile</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>binary        - a .gz station delay file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>?                - ? </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dateList</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of datetime - ?</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>returnTime</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>datetime       - specified time of GPS delay (default all times)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function writes a CSV file containing the times and delay information
(delay in mm, delay uncertainty, delay gradients)</p>
<p>Refer to the following sites to interpret stationFile variable names:
ftp://igs.org/pub/data/format/sinex_tropo.txt
http://geodesy.unr.edu/gps_timeseries/README_trop2.txt
Wet and hydrostratic delays were derived as so:
Constants &gt; k1 = 0.704, k2 = 0.776, k3 = 3739.0, m = 18.0152/28.9644,
k2' = k2-(k1*m) = 0.33812796398337275, Rv = 461.5 J/(kgK), l = 997 kg/m^3</p>
<p>*NOTE: wet delays passed here are computed using 
PMV = precipitable water vapor, 
P = total atm pressure, 
Tm = mean temp of the column, as:</p>
<pre><code>Wet zenith delay = 10^-6 lRv(k2' + k3/Tm) PMV
Hydrostatic zenith delay = Total zenith delay - wet zenith delay = k1*(P/Tm)
</code></pre>
<p>Source &gt; Hanssen, R. F. (2001) eqns. 6.2.7-10</p>
<p>*NOTE: Due to a formatting error in the tropo SINEX files, the two 
tropospheric gradient columns (TGNTOT and TGETOT) are interchanged, 
as are the formal error columns (_SIG).</p>
<p>Source  &gt; http://geodesy.unr.edu/gps_timeseries/README_trop2.txt)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/getStationDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_delays_UNR</span><span class="p">(</span><span class="n">stationFile</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dateList</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parses and returns a dictionary containing either (1) all</span>
<span class="sd">    the GPS delays, if returnTime is None, or (2) only the delay</span>
<span class="sd">    at the closest times to to returnTime.</span>

<span class="sd">    Args:</span>
<span class="sd">         stationFile: binary        - a .gz station delay file</span>
<span class="sd">         filename: ?                - ? </span>
<span class="sd">         dateList: list of datetime - ?</span>
<span class="sd">         returnTime: datetime       - specified time of GPS delay (default all times)</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function writes a CSV file containing the times and delay information</span>
<span class="sd">    (delay in mm, delay uncertainty, delay gradients)</span>

<span class="sd">    Refer to the following sites to interpret stationFile variable names:</span>
<span class="sd">    ftp://igs.org/pub/data/format/sinex_tropo.txt</span>
<span class="sd">    http://geodesy.unr.edu/gps_timeseries/README_trop2.txt</span>
<span class="sd">    Wet and hydrostratic delays were derived as so:</span>
<span class="sd">    Constants &gt; k1 = 0.704, k2 = 0.776, k3 = 3739.0, m = 18.0152/28.9644,</span>
<span class="sd">    k2&#39; = k2-(k1*m) = 0.33812796398337275, Rv = 461.5 J/(kgK), l = 997 kg/m^3</span>

<span class="sd">    *NOTE: wet delays passed here are computed using </span>
<span class="sd">    PMV = precipitable water vapor, </span>
<span class="sd">    P = total atm pressure, </span>
<span class="sd">    Tm = mean temp of the column, as:</span>

<span class="sd">        Wet zenith delay = 10^-6 lRv(k2&#39; + k3/Tm) PMV</span>
<span class="sd">        Hydrostatic zenith delay = Total zenith delay - wet zenith delay = k1*(P/Tm)</span>

<span class="sd">    Source &gt; Hanssen, R. F. (2001) eqns. 6.2.7-10</span>

<span class="sd">    *NOTE: Due to a formatting error in the tropo SINEX files, the two </span>
<span class="sd">    tropospheric gradient columns (TGNTOT and TGETOT) are interchanged, </span>
<span class="sd">    as are the formal error columns (_SIG).</span>

<span class="sd">    Source  &gt; http://geodesy.unr.edu/gps_timeseries/README_trop2.txt)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># sort through station zip files</span>
    <span class="n">allstationTarfiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if URL</span>
    <span class="k">if</span> <span class="n">stationFile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stationFile</span><span class="p">)</span>
        <span class="n">ziprepo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
    <span class="c1"># if downloaded file</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ziprepo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">stationFile</span><span class="p">)</span>
    <span class="c1"># iterate through tarfiles</span>
    <span class="n">stationTarlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ziprepo</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>

    <span class="n">final_stationTarlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">stationTarlist</span><span class="p">:</span>
        <span class="c1"># get the date of the file</span>
        <span class="n">time</span><span class="p">,</span> <span class="n">yearFromFile</span><span class="p">,</span> <span class="n">doyFromFile</span> <span class="o">=</span> <span class="n">get_date</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
        <span class="c1"># check if in list of specified input dates</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dateList</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">final_stationTarlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ziprepo</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="c1"># initialize variables</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">Sig</span><span class="p">,</span> <span class="n">dwet</span><span class="p">,</span> <span class="n">dhydro</span><span class="p">,</span> <span class="n">timesList</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                <span class="c1"># Do not attempt to read header</span>
                <span class="k">if</span> <span class="s1">&#39;SITE&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Attempt to read data</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">split_lines</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># units: mm, mm, mm, deg, deg, deg, deg, mm, mm, K</span>
                    <span class="n">trotot</span><span class="p">,</span> <span class="n">trototSD</span><span class="p">,</span> <span class="n">trwet</span><span class="p">,</span> <span class="n">tgetot</span><span class="p">,</span> <span class="n">tgetotSD</span><span class="p">,</span> <span class="n">tgntot</span><span class="p">,</span> <span class="n">tgntotSD</span><span class="p">,</span> <span class="n">wvapor</span><span class="p">,</span> <span class="n">wvaporSD</span><span class="p">,</span> <span class="n">mtemp</span> <span class="o">=</span> \
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">split_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
                <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>  <span class="c1"># TODO: What error(s)?</span>
                    <span class="k">continue</span>
                <span class="n">site</span> <span class="o">=</span> <span class="n">split_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">year</span><span class="p">,</span> <span class="n">doy</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">split_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)]</span>
                <span class="c1"># Break iteration if time from line in file does not match date reported in filename</span>
                <span class="k">if</span> <span class="n">doy</span> <span class="o">!=</span> <span class="n">doyFromFile</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;time </span><span class="si">%s</span><span class="s1"> from line in conflict with time </span><span class="si">%s</span><span class="s1"> from file &#39;</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, will continue reading next tarfile(s)&#39;</span><span class="p">,</span>
                        <span class="n">doy</span><span class="p">,</span> <span class="n">doyFromFile</span><span class="p">,</span> <span class="n">j</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># convert units from mm to m</span>
                <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trotot</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">)</span>
                <span class="n">Sig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trototSD</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">)</span>
                <span class="n">dwet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trwet</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">)</span>
                <span class="n">dhydro</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">trotot</span> <span class="o">-</span> <span class="n">trwet</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">)</span>
                <span class="n">timesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;TROP/SOLUTION&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">del</span> <span class="n">f</span>
        <span class="c1"># Break iteration if file contains no data.</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;file </span><span class="si">%s</span><span class="s1"> for station </span><span class="si">%s</span><span class="s1"> is empty, will continue reading next &#39;</span>
                <span class="s1">&#39;tarfile(s)&#39;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># check for missing times</span>
        <span class="n">true_times</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">86400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_times</span><span class="p">):</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span>
                <span class="kc">True</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">timesList</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">true_times</span><span class="p">]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="n">delay</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">wet_delay</span><span class="p">,</span> <span class="n">hydro_delay</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">288</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">delay</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
            <span class="n">sig</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sig</span>
            <span class="n">wet_delay</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">dwet</span>
            <span class="n">hydro_delay</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">dhydro</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">true_times</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timesList</span><span class="p">)</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Sig</span><span class="p">)</span>
            <span class="n">wet_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dwet</span><span class="p">)</span>
            <span class="n">hydro_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dhydro</span><span class="p">)</span>

        <span class="c1"># if time not specified, pass all times</span>
        <span class="k">if</span> <span class="n">returnTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filtoutput</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wet_delay</span><span class="p">),</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wet_delay</span><span class="p">),</span> <span class="s1">&#39;ZTD&#39;</span><span class="p">:</span> <span class="n">delay</span><span class="p">,</span> <span class="s1">&#39;wet_delay&#39;</span><span class="p">:</span> <span class="n">wet_delay</span><span class="p">,</span>
                          <span class="s1">&#39;hydrostatic_delay&#39;</span><span class="p">:</span> <span class="n">hydro_delay</span><span class="p">,</span> <span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span> <span class="s1">&#39;sigZTD&#39;</span><span class="p">:</span> <span class="n">sig</span><span class="p">}</span>
            <span class="n">filtoutput</span> <span class="o">=</span> <span class="p">[{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filtoutput</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtoutput</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timesList</span><span class="p">)</span> <span class="o">-</span> <span class="n">returnTime</span><span class="p">))</span>
            <span class="n">filtoutput</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s1">&#39;ZTD&#39;</span><span class="p">:</span> <span class="n">delay</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s1">&#39;wet_delay&#39;</span><span class="p">:</span> <span class="n">wet_delay</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="s1">&#39;hydrostatic_delay&#39;</span><span class="p">:</span> <span class="n">hydro_delay</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="n">times</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s1">&#39;sigZTD&#39;</span><span class="p">:</span> <span class="n">sig</span><span class="p">[</span><span class="n">index</span><span class="p">]}]</span>
        <span class="c1"># setup pandas array and write output to CSV, making sure to update existing CSV.</span>
        <span class="n">filtoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">filtoutput</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filtoutput</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtoutput</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># record all used tar files</span>
    <span class="n">allstationTarfiles</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stationFile</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">stationTarlist</span><span class="p">])</span>
    <span class="n">allstationTarfiles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">ziprepo</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.getStationDelays.get_station_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_station_data</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span> <span class="n">dateList</span><span class="p">,</span> <span class="n">gps_repo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">outDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Pull tropospheric delay data for a given station name</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/getStationDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_station_data</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span> <span class="n">dateList</span><span class="p">,</span> <span class="n">gps_repo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">outDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pull tropospheric delay data for a given station name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">outDir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">pathbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span> <span class="s1">&#39;GPS_delays&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pathbase</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">pathbase</span><span class="p">)</span>

    <span class="n">returnTime</span> <span class="o">=</span> <span class="n">seconds_of_day</span><span class="p">(</span><span class="n">returnTime</span><span class="p">)</span>
    <span class="c1"># print warning if not divisible by 3 seconds</span>
    <span class="k">if</span> <span class="n">returnTime</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">86400</span><span class="p">,</span> <span class="mi">300</span><span class="p">)))</span> <span class="o">-</span> <span class="n">returnTime</span><span class="p">))</span>
        <span class="n">updatedreturnTime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
            <span class="n">seconds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">86400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))[</span><span class="n">index</span><span class="p">]))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;input time </span><span class="si">%s</span><span class="s1"> not divisible by 3 seconds, so next closest time </span><span class="si">%s</span><span class="s1"> &#39;</span>
            <span class="s1">&#39;will be chosen&#39;</span><span class="p">,</span> <span class="n">returnTime</span><span class="p">,</span> <span class="n">updatedreturnTime</span>
        <span class="p">)</span>
        <span class="n">returnTime</span> <span class="o">=</span> <span class="n">updatedreturnTime</span>

    <span class="c1"># get list of station zip files</span>
    <span class="n">inFile_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inFile</span><span class="p">)</span>
    <span class="n">stationFiles</span> <span class="o">=</span> <span class="n">inFile_df</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">inFile_df</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stationFiles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">outputfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># parse delays from UNR</span>
        <span class="k">if</span> <span class="n">gps_repo</span> <span class="o">==</span> <span class="s1">&#39;UNR&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sf</span> <span class="ow">in</span> <span class="n">stationFiles</span><span class="p">:</span>
                <span class="n">StationID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathbase</span><span class="p">,</span> <span class="n">StationID</span> <span class="o">+</span> <span class="s1">&#39;_ztd.csv&#39;</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sf</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dateList</span><span class="p">,</span> <span class="n">returnTime</span><span class="p">))</span>
                <span class="n">outputfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Parallelize remote querying of zenith delays</span>
            <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
                <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">get_delays_UNR</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="c1"># confirm file exists (i.e. valid delays exists for specified time/region).</span>
    <span class="n">outputfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outputfiles</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
    <span class="c1"># Consolidate all CSV files into one object</span>
    <span class="k">if</span> <span class="n">outputfiles</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No valid delays found for specified time/region.&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">combinedGPS_ztd.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">))</span>
    <span class="n">statsFile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outputfiles</span><span class="p">])</span>
    <span class="c1"># drop all duplicate lines</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Convert the above object into a csv file and export</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">statsFile</span>

    <span class="c1"># Add lat/lon/height info</span>
    <span class="n">origstatsFile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inFile</span><span class="p">)</span>
    <span class="n">statsFile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">statsFile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">statsFile</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">origstatsFile</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Hgt_m&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>
    <span class="c1"># drop all lines with nans and sort by station ID and year</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop all duplicate lines</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
    <span class="n">statsFile</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">origstatsFile</span><span class="p">,</span> <span class="n">statsFile</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.getStationDelays.seconds_of_day" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">seconds_of_day</span><span class="p">(</span><span class="n">returnTime</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert HH:MM:SS format time-tag to seconds of day.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/getStationDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">seconds_of_day</span><span class="p">(</span><span class="n">returnTime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert HH:MM:SS format time-tag to seconds of day.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">returnTime</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">returnTime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">.</span><span class="n">second</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">returnTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))</span>

    <span class="k">return</span>  <span class="n">h</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">s</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.gnss" class="doc doc-heading">
            <code>gnss</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="RAiDER.gnss.downloadGNSSDelays" class="doc doc-heading">
            <code>downloadGNSSDelays</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.check_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Check whether a file exists at a URL. Modified from
https://stackoverflow.com/questions/9419162/download-returned-zip-file-from-url</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check whether a file exists at a URL. Modified from</span>
<span class="sd">    https://stackoverflow.com/questions/9419162/download-returned-zip-file-from-url</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests_retry_session</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.download_UNR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_UNR</span><span class="p">(</span><span class="n">statID</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">writeDir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseURL</span><span class="o">=</span><span class="n">_UNR_URL</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Download a zip file containing tropospheric delays for a given station and year
The URL format is http://geodesy.unr.edu/gps_timeseries/trop/<ssss>/<ssss>.<yyyy>.trop.zip
Inputs:
    statID   - 4-character station identifier
    year     - 4-numeral year</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_UNR</span><span class="p">(</span><span class="n">statID</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">writeDir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseURL</span><span class="o">=</span><span class="n">_UNR_URL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Download a zip file containing tropospheric delays for a given station and year</span>
<span class="sd">    The URL format is http://geodesy.unr.edu/gps_timeseries/trop/&lt;ssss&gt;/&lt;ssss&gt;.&lt;yyyy&gt;.trop.zip</span>
<span class="sd">    Inputs:</span>
<span class="sd">        statID   - 4-character station identifier</span>
<span class="sd">        year     - 4-numeral year</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">baseURL</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_UNR_URL</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Data repository </span><span class="si">{}</span><span class="s1"> has not yet been implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseURL</span><span class="p">))</span>

    <span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">gps_timeseries/trop/</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">.</span><span class="si">{2}</span><span class="s2">.trop.zip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">baseURL</span><span class="p">,</span> <span class="n">statID</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">year</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Currently checking station </span><span class="si">%s</span><span class="s1"> in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">statID</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">download</span><span class="p">:</span>
        <span class="n">saveLoc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">writeDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}</span><span class="s1">.trop.zip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statID</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">year</span><span class="p">)))</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">download_url</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">saveLoc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Year or station ID does not exist&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">check_url</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">statID</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">filepath</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.download_tropo_delays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_tropo_delays</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">gps_repo</span><span class="o">=</span><span class="s1">&#39;UNR&#39;</span><span class="p">,</span> <span class="n">writeDir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Check for and download GNSS tropospheric delays from an archive. If 
download is True then files will be physically downloaded, but this<br />
is not necessary as data can be virtually accessed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>stats</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stations     - Stations to access</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>years</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of int  - A list of years to be downloaded</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>gps_repo</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string    - SNWE bounds target area to ensure weather model contains them</p>
              </div>
            </td>
            <td>
                  <code>&#39;UNR&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>writeDir</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string    - False if preprocessing weather model data</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>numCPUs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int        - whether to write debug plots</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>download</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool      - True if you want to download even when the weather model exists</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_tropo_delays</span><span class="p">(</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span>
    <span class="n">gps_repo</span><span class="o">=</span><span class="s1">&#39;UNR&#39;</span><span class="p">,</span>
    <span class="n">writeDir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="n">numCPUs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check for and download GNSS tropospheric delays from an archive. If </span>
<span class="sd">    download is True then files will be physically downloaded, but this  </span>
<span class="sd">    is not necessary as data can be virtually accessed.</span>

<span class="sd">    Args:</span>
<span class="sd">        stats: stations     - Stations to access</span>
<span class="sd">        years: list of int  - A list of years to be downloaded</span>
<span class="sd">        gps_repo: string    - SNWE bounds target area to ensure weather model contains them</span>
<span class="sd">        writeDir: string    - False if preprocessing weather model data</span>
<span class="sd">        numCPUs: int        - whether to write debug plots</span>
<span class="sd">        download: bool      - True if you want to download even when the weather model exists</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># argument checking</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;stats should be a string or a list of strings&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;years should be an int or a list of ints&#39;</span><span class="p">)</span>

    <span class="c1"># Iterate over stations and years and check or download data</span>
    <span class="n">stat_year_tup</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
    <span class="n">stat_year_tup</span> <span class="o">=</span> <span class="p">((</span><span class="o">*</span><span class="n">tup</span><span class="p">,</span> <span class="n">writeDir</span><span class="p">,</span> <span class="n">download</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">stat_year_tup</span><span class="p">)</span>

    <span class="c1"># Parallelize remote querying of station locations</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">numCPUs</span><span class="p">)</span> <span class="k">as</span> <span class="n">multipool</span><span class="p">:</span>
        <span class="c1"># only record valid path</span>
        <span class="k">if</span> <span class="n">gps_repo</span> <span class="o">==</span> <span class="s1">&#39;UNR&#39;</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">fileurl</span> <span class="k">for</span> <span class="n">fileurl</span> <span class="ow">in</span> <span class="n">multipool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">download_UNR</span><span class="p">,</span> <span class="n">stat_year_tup</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fileurl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;download_tropo_delays: gps_repo &quot;</span><span class="si">{}</span><span class="s1">&quot; not yet implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">))</span>

    <span class="c1"># Write results to file</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoStationDataFoundError</span><span class="p">(</span>
            <span class="n">station_list</span><span class="o">=</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
    <span class="n">statDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>
    <span class="n">statDF</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">writeDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">gnssStationList_overbbox_withpaths.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.download_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Download a file from a URL. Modified from
https://stackoverflow.com/questions/9419162/download-returned-zip-file-from-url</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Download a file from a URL. Modified from</span>
<span class="sd">    https://stackoverflow.com/questions/9419162/download-returned-zip-file-from-url</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests_retry_session</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Beginning download of </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Completed download of </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">save_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.filterToBBox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filterToBBox</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">llhBox</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Filter a dataframe by lat/lon.
*NOTE: llhBox longitude format should be [0, 360]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>stations</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame     - a pandas dataframe with "Lat" and "Lon" columns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>llhBox</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of float   - 4-element list: [S, N, W, E]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a Pandas Dataframe with stations removed that are not inside llhBox</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filterToBBox</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">llhBox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter a dataframe by lat/lon.</span>
<span class="sd">    *NOTE: llhBox longitude format should be [0, 360]</span>

<span class="sd">    Args:</span>
<span class="sd">        stations: DataFrame     - a pandas dataframe with &quot;Lat&quot; and &quot;Lon&quot; columns</span>
<span class="sd">        llhBox: list of float   - 4-element list: [S, N, W, E]</span>

<span class="sd">    Returns:</span>
<span class="sd">        a Pandas Dataframe with stations removed that are not inside llhBox</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">llhBox</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">W</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">E</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;llhBox longitude format should 0-360&#39;</span><span class="p">)</span>

    <span class="c1"># For a user-provided file, need to check the column names</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">lat_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">]</span>
    <span class="n">lon_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Longitude&#39;</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lat_keys</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s1">&#39;filterToBBox: No valid column names found for latitude and longitude&#39;</span><span class="p">)</span>
    <span class="n">lon_key</span> <span class="o">=</span> <span class="n">lon_keys</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">lat_key</span> <span class="o">=</span> <span class="n">lat_keys</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">stations</span><span class="p">[</span><span class="n">lon_key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># convert lon format to -180 to 180</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="p">[((</span><span class="n">D</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span> <span class="k">for</span> <span class="n">D</span> <span class="ow">in</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">]]</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="n">lat_key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">S</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="n">lat_key</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">stations</span><span class="p">[</span><span class="n">lon_key</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">E</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="n">lon_key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">W</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stations</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.fix_lons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fix_lons</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Fix the given longitudes into the range <code>[-180, 180]</code>.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fix_lons</span><span class="p">(</span><span class="n">lon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fix the given longitudes into the range `[-180, 180]`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fixed_lon</span> <span class="o">=</span> <span class="p">((</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="c1"># Make the positive 180s positive again.</span>
    <span class="k">if</span> <span class="n">fixed_lon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fixed_lon</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">fixed_lon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.get_ID" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ID</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Pulls the station ID, lat, lon, and height for a given entry in the UNR text file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_ID</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pulls the station ID, lat, lon, and height for a given entry in the UNR text file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">stat_id</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">stat_id</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.get_station_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_station_list</span><span class="p">(</span><span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stationFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writeLoc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_appendix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">writeStationFile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Creates a list of stations inside a lat/lon bounding box from a source</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bbox</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of float     - length-4 list of floats that describes a bounding box. 
                      Format is S N W E</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>station_file</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str       - Name of a .csv or .txt file to read containing station IDs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>writeStationFile</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool  - Whether to write out the station dataframe to a .csv file</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>writeLoc</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string    - Directory to write data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name_appendix</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str  - name to append to output file</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stations</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of strings        - station IDs to access</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>output_file</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string or dataframe - file to write delays</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_station_list</span><span class="p">(</span>
        <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stationFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">writeLoc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name_appendix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">writeStationFile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a list of stations inside a lat/lon bounding box from a source</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox: list of float     - length-4 list of floats that describes a bounding box. </span>
<span class="sd">                                  Format is S N W E</span>
<span class="sd">        station_file: str       - Name of a .csv or .txt file to read containing station IDs</span>
<span class="sd">        writeStationFile: bool  - Whether to write out the station dataframe to a .csv file</span>
<span class="sd">        writeLoc: string    - Directory to write data</span>
<span class="sd">        name_appendix: str  - name to append to output file</span>

<span class="sd">    Returns:</span>
<span class="sd">        stations: list of strings        - station IDs to access</span>
<span class="sd">        output_file: string or dataframe - file to write delays</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">station_data</span> <span class="o">=</span> <span class="n">get_stats_by_llh</span><span class="p">(</span><span class="n">llhBox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">station_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">stationFile</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stationFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">names</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
            <span class="n">station_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

    <span class="c1"># write to file and pass final stations list</span>
    <span class="k">if</span> <span class="n">writeStationFile</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">writeLoc</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> 
            <span class="s1">&#39;gnssStationList_overbbox&#39;</span> <span class="o">+</span> <span class="n">name_appendix</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
        <span class="p">)</span>
        <span class="n">station_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">station_data</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="p">[</span><span class="n">output_file</span> <span class="k">if</span> <span class="n">writeStationFile</span> <span class="k">else</span> <span class="n">station_data</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.get_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_stats</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">long_cross_zero</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">station_file</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Pull the stations needed</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">long_cross_zero</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">station_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pull the stations needed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">long_cross_zero</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bbox1</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bbox2</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bbox1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">360.0</span>
        <span class="n">bbox2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">stats1</span><span class="p">,</span> <span class="n">statdata1</span> <span class="o">=</span> <span class="n">get_station_list</span><span class="p">(</span>
            <span class="n">bbox</span><span class="o">=</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">stationFile</span><span class="o">=</span><span class="n">station_file</span><span class="p">,</span> <span class="n">name_appendix</span><span class="o">=</span><span class="s1">&#39;_a&#39;</span><span class="p">,</span> <span class="n">writeStationFile</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">stats2</span><span class="p">,</span> <span class="n">statdata2</span> <span class="o">=</span> <span class="n">get_station_list</span><span class="p">(</span>
            <span class="n">bbox</span><span class="o">=</span><span class="n">bbox2</span><span class="p">,</span> <span class="n">stationFile</span><span class="o">=</span><span class="n">station_file</span><span class="p">,</span> <span class="n">name_appendix</span><span class="o">=</span><span class="s1">&#39;_b&#39;</span><span class="p">,</span> <span class="n">writeStationFile</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats1</span> <span class="o">+</span> <span class="n">stats2</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">statdata1</span><span class="p">,</span> <span class="n">statdata2</span><span class="p">]</span>
        <span class="n">statdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">360.0</span>
        <span class="n">stats</span><span class="p">,</span> <span class="n">statdata</span> <span class="o">=</span> <span class="n">get_station_list</span><span class="p">(</span>
            <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">stationFile</span><span class="o">=</span><span class="n">station_file</span><span class="p">,</span> <span class="n">writeStationFile</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">statdata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stats</span><span class="p">,</span> <span class="n">statdata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.get_stats_by_llh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_stats_by_llh</span><span class="p">(</span><span class="n">llhBox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">baseURL</span><span class="o">=</span><span class="n">_UNR_URL</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Function to pull lat, lon, height, beginning date, end date, and number of solutions for stations inside the bounding box llhBox.
llhBox should be a tuple in SNWE format.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stats_by_llh</span><span class="p">(</span><span class="n">llhBox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">baseURL</span><span class="o">=</span><span class="n">_UNR_URL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to pull lat, lon, height, beginning date, end date, and number of solutions for stations inside the bounding box llhBox.</span>
<span class="sd">    llhBox should be a tuple in SNWE format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">llhBox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">llhBox</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">]</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">llhBox</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">W</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">E</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;get_stats_by_llh: bounding box must be on lon range [0, 360]&#39;</span><span class="p">)</span>

    <span class="n">stationHoldings</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">NGLStationPages/llh.out&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseURL</span><span class="p">)</span>
    <span class="c1"># it&#39;s a file like object and works just like a file</span>

    <span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">stationHoldings</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Hgt_m&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># convert lons from [0, 360] to [-180, 180]</span>
    <span class="n">stations</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="n">stations</span> <span class="o">=</span> <span class="n">filterToBBox</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">llhBox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.in_box" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">in_box</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">llhbox</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Checks whether the given lat, lon pair are inside the bounding box llhbox</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">in_box</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">llhbox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the given lat, lon pair are inside the bounding box llhbox</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="n">llhbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="n">llhbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="n">llhbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="n">llhbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">inps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Main workflow for querying supported GPS repositories for zenith delay information.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">inps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main workflow for querying supported GPS repositories for zenith delay information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dateList</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">date_list</span>
        <span class="n">returnTime</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">time</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">dateList</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">dateList</span>
        <span class="n">returnTime</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">returnTime</span>

    <span class="n">station_file</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">station_file</span>
    <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">bounding_box</span>
    <span class="n">gps_repo</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">gps_repo</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">out</span>
    <span class="n">download</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">download</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">cpus</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">inps</span><span class="o">.</span><span class="n">verbose</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c1"># Create specified output directory if it does not exist.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># Setup bounding box</span>
    <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
        <span class="n">bbox</span><span class="p">,</span> <span class="n">long_cross_zero</span> <span class="o">=</span> <span class="n">parse_bbox</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">)</span>
    <span class="c1"># If bbox not specified, query stations across the entire globe</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">]</span>
        <span class="n">long_cross_zero</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Handle station query</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">statdf</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">long_cross_zero</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">station_file</span><span class="p">)</span>

    <span class="c1"># iterate over years</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dateList</span><span class="p">]))</span>
    <span class="n">download_tropo_delays</span><span class="p">(</span>
        <span class="n">stats</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">gps_repo</span><span class="o">=</span><span class="n">gps_repo</span><span class="p">,</span> <span class="n">writeDir</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="n">download</span>
    <span class="p">)</span>

    <span class="c1"># Combine station data with URL info</span>
    <span class="n">pathsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">gnssStationList_overbbox_withpaths.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">)))</span>
    <span class="n">pathsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">pathsdf</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">statdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>
    <span class="n">pathsdf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">gnssStationList_overbbox_withpaths.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">statdf</span><span class="p">,</span> <span class="n">pathsdf</span>

    <span class="c1"># Extract delays for each station</span>
    <span class="n">dateList</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dateList</span><span class="p">]</span>
    <span class="n">get_station_data</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">gnssStationList_overbbox_withpaths.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gps_repo</span><span class="p">)),</span>
        <span class="n">dateList</span><span class="p">,</span>
        <span class="n">gps_repo</span><span class="o">=</span><span class="n">gps_repo</span><span class="p">,</span>
        <span class="n">numCPUs</span><span class="o">=</span><span class="n">cpus</span><span class="p">,</span>
        <span class="n">outDir</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
        <span class="n">returnTime</span><span class="o">=</span><span class="n">returnTime</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Completed processing&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.downloadGNSSDelays.parse_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_bbox</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse bounding box arguments</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/downloadGNSSDelays.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_bbox</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse bounding box arguments</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bounding_box</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Cannot understand the --bbox argument. String input is incorrect or path does not exist.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">bounding_box</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s1">&#39;Passing a file with a bounding box not yet supported.&#39;</span><span class="p">)</span>

    <span class="n">long_cross_zero</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># if necessary, convert negative longitudes to positive</span>
    <span class="k">if</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>

    <span class="k">if</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>

    <span class="k">return</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">long_cross_zero</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.gnss.processDelayFiles" class="doc doc-heading">
            <code>processDelayFiles</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.addDateTimeToFiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addDateTimeToFiles</span><span class="p">(</span><span class="n">fileList</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Run through a list of files and add the datetime of each file as a column</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">addDateTimeToFiles</span><span class="p">(</span><span class="n">fileList</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Run through a list of files and add the datetime of each file as a column &#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Datetime to delay files&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">fileList</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;Datetime&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;File </span><span class="si">{}</span><span class="s1"> already has a &quot;Datetime&quot; column, pass&#39;</span>
                    <span class="s1">&#39;&quot;force = True&quot; if you want to override and &#39;</span>
                    <span class="s1">&#39;re-process&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">getDateTime</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>
                <span class="c1"># drop all lines with nans</span>
                <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># drop all duplicate lines</span>
                <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;File </span><span class="si">{}</span><span class="s1"> does not contain datetime info, skipping&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">del</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.concatDelayFiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">concatDelayFiles</span><span class="p">(</span><span class="n">fileList</span><span class="p">,</span> <span class="n">sort_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Datetime&#39;</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read a list of .csv files containing the same columns and append them
together, sorting by specified columns</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">concatDelayFiles</span><span class="p">(</span>
    <span class="n">fileList</span><span class="p">,</span>
    <span class="n">sort_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Datetime&#39;</span><span class="p">],</span>
    <span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span>
    <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read a list of .csv files containing the same columns and append them</span>
<span class="sd">    together, sorting by specified columns</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dfList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Concatenating delay files&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">fileList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
            <span class="n">dfList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">readZTDFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="n">col_name</span><span class="p">))</span>
    <span class="c1"># drop lines not found in reference file</span>
    <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
        <span class="n">dfr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfList</span><span class="p">):</span>
            <span class="n">dfList</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pass_common_obs</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">dfr</span>

    <span class="n">df_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="n">dfList</span><span class="p">,</span>
        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_c</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows in the concatenated file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows containing NaNs: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">df_c</span><span class="p">[</span><span class="n">df_c</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">return_df</span> <span class="ow">or</span> <span class="n">outName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df_c</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># drop all lines with nans</span>
        <span class="n">df_c</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># drop all duplicate lines</span>
        <span class="n">df_c</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_c</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outName</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.create_parser" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_parser</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse command line arguments using argparse.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_parser</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command line arguments using argparse.&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Combine delay files from a weather model and GPS Zenith delays</span>
<span class="s2">            Usage examples:</span>
<span class="s2">            raiderCombine.py --raiderDir &#39;./*&#39; --raider &#39;combined_raider_delays.csv&#39;</span>
<span class="s2">            raiderCombine.py  --raiderDir ERA5/ --raider ERA5_combined_delays.csv --raider_column totalDelay --gnssDir GNSS/ --gnss UNRCombined_gnss.csv --column ZTD -o Combined_delays.csv</span>
<span class="s2">            raiderCombine.py  --raiderDir ERA5_2019/ --raider ERA5_combined_delays_2019.csv --raider_column totalDelay --gnssDir GNSS_2019/ --gnss UNRCombined_gnss_2019.csv --column ZTD -o Combined_delays_2019_UTTC18.csv --localtime &#39;18:00:00 1&#39;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--raider&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;raider_file&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            .csv file containing RAiDER-derived Zenith Delays.</span>
<span class="s2">            Should contain columns &quot;ID&quot; and &quot;Datetime&quot; in addition to the delay column</span>
<span class="s2">            If the file does not exist, I will attempt to create it from a directory of</span>
<span class="s2">            delay files.</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--raiderDir&#39;</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;raider_folder&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Directory containing RAiDER-derived Zenith Delay files.</span>
<span class="s2">            Files should be named with a Datetime in the name and contain the</span>
<span class="s2">            column &quot;ID&quot; as the delay column names.</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--gnssDir&#39;</span><span class="p">,</span> <span class="s1">&#39;-gd&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;gnss_folder&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Directory containing GNSS-derived Zenith Delay files.</span>
<span class="s2">            Files should contain the column &quot;ID&quot; as the delay column names</span>
<span class="s2">            and times should be denoted by the &quot;Date&quot; key.</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--gnss&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;gnss_file&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Optional .csv file containing GPS Zenith Delays. Should contain columns &quot;ID&quot;, &quot;ZTD&quot;, and &quot;Datetime&quot;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--raider_column&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-r&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;raider_column_name&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Name of the column containing RAiDER delays. Only used with the &quot;--gnss&quot; option</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;totalDelay&#39;</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--column&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-c&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;column_name&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Name of the column containing GPS Zenith delays. Only used with the &quot;--gnss&quot; option</span>

<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--out&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;out_name&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            Name to use for the combined delay file. Only used with the &quot;--gnss&quot; option</span>

<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Combined_delays.csv&#39;</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--localtime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-lt&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;local_time&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            &quot;Optional control to pass only data at local-time (in integer hours) WRT user-defined time at 0 longitude (1st argument),</span>
<span class="s2">             and within +/- specified hour threshold (2nd argument).</span>
<span class="s2">             By default UTC is passed as is without local-time conversions.</span>
<span class="s2">             Input in &#39;HH H&#39;, e.g. &#39;16 1&#39;&quot;</span>

<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.getDateTime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getDateTime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Parse a datetime from a RAiDER delay filename</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getDateTime</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Parse a datetime from a RAiDER delay filename &#39;&#39;&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">dtr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{8}</span><span class="s1">T\d</span><span class="si">{6}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">dtr</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">group</span><span class="p">(),</span>
        <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.local_time_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">local_time_filter</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">,</span> <span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span><span class="p">,</span> <span class="n">localTime</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Convert to local-time reference frame WRT 0 longitude</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">local_time_filter</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">,</span> <span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span><span class="p">,</span> <span class="n">localTime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert to local-time reference frame WRT 0 longitude</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">localTime_hrs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">localTime_hrthreshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># with rotation rate and distance to 0 lon, get localtime shift WRT 00 UTC at 0 lon</span>
    <span class="c1"># *rotation rate at given point = (360deg/23.9333333333hr) = 15.041782729825965 deg/hr</span>
    <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">15.041782729825965</span><span class="p">)</span>
    <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">15.041782729825965</span><span class="p">)</span>

    <span class="c1"># estimate local-times</span>
    <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">update_time</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">localTime_hrs</span><span class="p">),</span>
                                 <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfz</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">update_time</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">localTime_hrs</span><span class="p">),</span>
                                 <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># filter out data outside of --localtime hour threshold</span>
    <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">+</span> \
        <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">localTime_hrthreshold</span><span class="p">)</span>
    <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">-</span> \
        <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">localTime_hrthreshold</span><span class="p">)</span>
    <span class="n">OG_total</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;Localtime_u&#39;</span><span class="p">])]</span>

    <span class="c1"># only keep observation closest to Localtime</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of datapoints dropped in </span><span class="si">{}</span><span class="s1"> for not being within &#39;</span>
          <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> hrs of specified local-time </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> out of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="n">raiderFile</span><span class="p">,</span> <span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OG_total</span><span class="p">))</span>
    <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">+</span> \
        <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">localTime_hrthreshold</span><span class="p">)</span>
    <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span> <span class="o">-</span> \
        <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">localTime_hrthreshold</span><span class="p">)</span>
    <span class="n">OG_total</span> <span class="o">=</span> <span class="n">dfz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dfz</span> <span class="o">=</span> <span class="n">dfz</span><span class="p">[(</span><span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dfz</span><span class="p">[</span><span class="s1">&#39;Localtime_u&#39;</span><span class="p">])]</span>
    <span class="c1"># only keep observation closest to Localtime</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of datapoints dropped in </span><span class="si">{}</span><span class="s1"> for not being within &#39;</span>
          <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> hrs of specified local-time </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> out of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="n">ztdFile</span><span class="p">,</span> <span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">localTime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">dfz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OG_total</span><span class="p">))</span>

    <span class="c1"># drop all lines with nans</span>
    <span class="n">dfr</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfz</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop all duplicate lines</span>
    <span class="n">dfr</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfz</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop and rename columns</span>
    <span class="n">dfr</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">,</span> <span class="s1">&#39;Localtime_u&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfz</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Localtime_l&#39;</span><span class="p">,</span> <span class="s1">&#39;Localtime_u&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">,</span> <span class="n">raider_delay</span><span class="o">=</span><span class="s1">&#39;totalDelay&#39;</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">localTime</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Merge a combined RAiDER delays file with a GPS ZTD delay file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">,</span> <span class="n">raider_delay</span><span class="o">=</span><span class="s1">&#39;totalDelay&#39;</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">localTime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Merge a combined RAiDER delays file with a GPS ZTD delay file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merging delay files </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">))</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">])</span>
    <span class="c1"># drop extra columns</span>
    <span class="n">expected_data_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Hgt_m&#39;</span><span class="p">,</span> <span class="s1">&#39;Datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;wetDelay&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;hydroDelay&#39;</span><span class="p">,</span> <span class="n">raider_delay</span><span class="p">]</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dfr</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span>
                            <span class="n">expected_data_columns</span><span class="p">])</span>
    <span class="n">dfz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ztdFile</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Datetime&#39;</span> <span class="ow">in</span> <span class="n">dfz</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">dfz</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="s1">&#39;Datetime&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop extra columns</span>
    <span class="n">expected_data_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;wet_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;hydrostatic_delay&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;times&#39;</span><span class="p">,</span> <span class="s1">&#39;sigZTD&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Hgt_m&#39;</span><span class="p">,</span>
                             <span class="n">col_name</span><span class="p">]</span>
    <span class="n">dfz</span> <span class="o">=</span> <span class="n">dfz</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dfz</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span>
                            <span class="n">expected_data_columns</span><span class="p">])</span>
    <span class="c1"># only pass common locations and times</span>
    <span class="n">dfz</span> <span class="o">=</span> <span class="n">pass_common_obs</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span><span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">pass_common_obs</span><span class="p">(</span><span class="n">dfz</span><span class="p">,</span> <span class="n">dfr</span><span class="p">)</span>

    <span class="c1"># If specified, convert to local-time reference frame WRT 0 longitude</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">localTime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span> <span class="o">=</span> <span class="n">local_time_filter</span><span class="p">(</span><span class="n">raiderFile</span><span class="p">,</span> <span class="n">ztdFile</span><span class="p">,</span> <span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span><span class="p">,</span> <span class="n">localTime</span><span class="p">)</span>
        <span class="n">common_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Localtime&#39;</span><span class="p">)</span>
        <span class="c1"># only pass common locations and times</span>
        <span class="n">dfz</span> <span class="o">=</span> <span class="n">pass_common_obs</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span> <span class="n">dfz</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="s1">&#39;Localtime&#39;</span><span class="p">)</span>
        <span class="n">dfr</span> <span class="o">=</span> <span class="n">pass_common_obs</span><span class="p">(</span><span class="n">dfz</span><span class="p">,</span> <span class="n">dfr</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="s1">&#39;Localtime&#39;</span><span class="p">)</span>

    <span class="c1"># drop all lines with nans</span>
    <span class="n">dfr</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfz</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop all duplicate lines</span>
    <span class="n">dfr</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfz</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning merge&#39;</span><span class="p">)</span>

    <span class="n">dfc</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">dfz</span><span class="p">[</span><span class="n">common_keys</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;ZTD&#39;</span><span class="p">,</span> <span class="s1">&#39;sigZTD&#39;</span><span class="p">]],</span>
        <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">left_on</span><span class="o">=</span><span class="n">common_keys</span><span class="p">,</span>
        <span class="n">right_on</span><span class="o">=</span><span class="n">common_keys</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># only keep observation closest to Localtime</span>
    <span class="k">if</span> <span class="s1">&#39;Localtime&#39;</span> <span class="ow">in</span> <span class="n">dfc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;Localtimediff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">-</span>
                                    <span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">dfc</span> <span class="o">=</span> <span class="n">dfc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dfc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Localtime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">Localtimediff</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
                      <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dfc</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Localtimediff&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># estimate residual</span>
    <span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;ZTD_minus_RAiDER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;ZTD&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dfc</span><span class="p">[</span><span class="n">raider_delay</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows in the concatenated file: &#39;</span>
          <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows containing NaNs: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">dfc</span><span class="p">[</span><span class="n">dfc</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merge finished&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dfc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># drop all lines with nans</span>
        <span class="n">dfc</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># drop all duplicate lines</span>
        <span class="n">dfc</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dfc</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outName</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.pass_common_obs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pass_common_obs</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Pass only observations in target spatiotemporally common to reference</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pass_common_obs</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Pass only observations in target spatiotemporally common to reference&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">target</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                          <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">localtime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target</span><span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span>
                      <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="n">target</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
                      <span class="n">target</span><span class="p">[</span><span class="n">localtime</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">localtime</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target</span><span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span>
                      <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="n">target</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.readZTDFile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readZTDFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read and parse a GPS zenith delay file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readZTDFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s1">&#39;ZTD&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read and parse a GPS zenith delay file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">x</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">times</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">])</span>

    <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col_name</span><span class="p">:</span> <span class="s1">&#39;ZTD&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.gnss.processDelayFiles.update_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_time</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">localTime_hrs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Update with local origin time</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/gnss/processDelayFiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_time</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">localTime_hrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Update with local origin time&#39;&#39;&#39;</span>
    <span class="n">localTime_estimate</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">localTime_hrs</span><span class="p">,</span>
                                                 <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># determine if you need to shift days</span>
    <span class="n">time_shift</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># round to nearest hour</span>
    <span class="n">days_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Datetime&#39;</span><span class="p">]</span> <span class="o">-</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                     <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">))</span><span class="o">.</span><span class="n">day</span> <span class="o">-</span> \
        <span class="n">localTime_estimate</span><span class="o">.</span><span class="n">day</span>
    <span class="c1"># if lon &lt;0, check if you need to add day</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># add day</span>
        <span class="k">if</span> <span class="n">days_diff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time_shift</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># if lon &gt;0, check if you need to subtract day</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># subtract day</span>
        <span class="k">if</span> <span class="n">days_diff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time_shift</span> <span class="o">=</span> <span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">localTime_estimate</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Localtime&#39;</span><span class="p">]</span>
                                                   <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_shift</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.interpolate" class="doc doc-heading">
            <code>interpolate</code>


</h2>

    <div class="doc doc-contents ">

      <p>Fast linear interpolator over a regular grid</p>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.interpolate.__doc__" class="doc doc-heading">
            <code class="highlight language-python"><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;Fast linear interpolator over a regular grid&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.interpolate.__file__" class="doc doc-heading">
            <code class="highlight language-python"><span class="vm">__file__</span> <span class="o">=</span> <span class="s1">&#39;/home/runner/micromamba-root/envs/RAiDER/lib/python3.10/site-packages/RAiDER/interpolate.cpython-310-x86_64-linux-gnu.so&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.interpolate.__name__" class="doc doc-heading">
            <code class="highlight language-python"><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;RAiDER.interpolate&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.interpolate.__package__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__package__</span> <span class="o">=</span> <span class="s1">&#39;RAiDER&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolate.interpolate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolate</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>interpolate(points: list[numpy.ndarray[numpy.float64]], values: numpy.ndarray[numpy.float64], interp_points: numpy.ndarray[numpy.float64], fill_value: Optional[float] = None, assume_sorted: bool = False, max_threads: int = 8) -&gt; numpy.ndarray[numpy.float64]</p>
<p>Linear interpolator in any dimension. Arguments are similar to
scipy.interpolate.RegularGridInterpolator</p>
<p>:param points: Tuple of N axis coordinates specifying the grid.
:param values: Nd array containing the grid point values.
:param interp_points: List of points to interpolate, should have
    dimension (x, N). If this list is guaranteed to be sorted make sure
    to use the <code>assume_sorted</code> option.
:param fill_value: The value to return for interpolation points
      outside of the grid range.
:param assume_sorted: Enable optimization when the list of interpolation
    points is sorted.
:param max_threads: Limit the number of threads to a certain amount.
    Note: The number of threads will always be one of {1, 2, 4, 8}</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolate.interpolate_along_axis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolate_along_axis</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>interpolate_along_axis(points: numpy.ndarray[numpy.float64], values: numpy.ndarray[numpy.float64], interp_points: numpy.ndarray[numpy.float64], axis: int = -1, fill_value: Optional[float] = None, assume_sorted: bool = False, max_threads: int = 8) -&gt; numpy.ndarray[numpy.float64]</p>
<p>1D linear interpolator along a specific axis.</p>
<p>:param points: N-dimensional x coordinates. Axis specified by
      'axis' must contain at least 2 points.
:param values: N-dimensional y values. Must have the same shape as
      'points'.
:param interp_points: N-dimensional x coordinates to interpolate at.
      The shape may only differ from that of 'points' at the axis
      specified by 'axis'. For example if 'points' has shape (1, 2, 3)
      and 'axis' is 2, then and shape like (1, 2, X) is valid.
:param axis: The axis to interpolate along.
:param fill_value: The value to return for interpolation points
      outside of the grid range.
:param assume_sorted: Enable optimization when the list of interpolation
      points is sorted along the axis of interpolation.
:param max_threads: Limit the number of threads to a certain amount.</p>

    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.interpolator" class="doc doc-heading">
            <code>interpolator</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="RAiDER.interpolator.RegularGridInterpolator" class="doc doc-heading">
            <code>RegularGridInterpolator</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Provides a wrapper around RAiDER.interpolate.interpolate with a similar
interface to scipy.interpolate.RegularGridInterpolator.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegularGridInterpolator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a wrapper around RAiDER.interpolate.interpolate with a similar</span>
<span class="sd">    interface to scipy.interpolate.RegularGridInterpolator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">grid</span><span class="p">,</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assume_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="o">=</span><span class="mi">8</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assume_sorted</span> <span class="o">=</span> <span class="n">assume_sorted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span> <span class="o">=</span> <span class="n">max_threads</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;All dimensions must contain the same number of points!&quot;</span>
            <span class="n">interp_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">in_shape</span> <span class="o">=</span> <span class="n">interp_points</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">elif</span> <span class="n">points</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">in_shape</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">interp_points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),)</span> <span class="o">+</span> <span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interp_points</span> <span class="o">=</span> <span class="n">points</span>
            <span class="n">in_shape</span> <span class="o">=</span> <span class="n">interp_points</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">interp_points</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">,</span>
            <span class="n">assume_sorted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assume_sorted</span><span class="p">,</span>
            <span class="n">max_threads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">in_shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolator.fillna3D" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fillna3D</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This function fills in NaNs in 3D arrays, specifically using the nearest non-nan value
for "low" NaNs and 0s for "high" NaNs. </p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D array with low NaNs filled as nearest neighbors and high NaNs filled as 0s</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fillna3D</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function fills in NaNs in 3D arrays, specifically using the nearest non-nan value</span>
<span class="sd">    for &quot;low&quot; NaNs and 0s for &quot;high&quot; NaNs. </span>

<span class="sd">    Arguments: </span>
<span class="sd">        array   - 3D array, where the last axis is the &quot;z&quot; dimension</span>

<span class="sd">    Returns: </span>
<span class="sd">        3D array with low NaNs filled as nearest neighbors and high NaNs filled as 0s</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># fill lower NaNs with nearest neighbor</span>
    <span class="n">narr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nars</span> <span class="o">=</span> <span class="n">narr</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">narr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),)</span> <span class="o">+</span> <span class="p">(</span><span class="n">narr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],))</span>
    <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">nars</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># fill upper NaNs with 0s</span>
    <span class="n">outmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">outmat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">outmat</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fill_value</span>
    <span class="k">return</span> <span class="n">outmat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolator.interpV" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpV</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Rearrange np.interp's arguments</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpV</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Rearrange np.interp&#39;s arguments</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolator.interpVector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpVector</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Interpolate data from a single vector containing the original
x, the original y, and the new x, in that order. Nx tells the
number of original x-points.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpVector</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">Nx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Interpolate data from a single vector containing the original</span>
<span class="sd">    x, the original y, and the new x, in that order. Nx tells the</span>
<span class="sd">    number of original x-points.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:</span><span class="n">Nx</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="n">Nx</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nx</span><span class="p">]</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nx</span><span class="p">:]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolator.interp_along_axis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interp_along_axis</span><span class="p">(</span><span class="n">oldCoord</span><span class="p">,</span> <span class="n">newCoord</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>DEPRECATED: Use RAiDER.interpolate.interpolate_along_axis instead (it is
much faster). This function now primarily exists to verify the behavior of
the new one.</p>
<p>Interpolate an array of 3-D data along one axis. This function
assumes that the x-coordinate increases monotonically.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interp_along_axis</span><span class="p">(</span><span class="n">oldCoord</span><span class="p">,</span> <span class="n">newCoord</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEPRECATED: Use RAiDER.interpolate.interpolate_along_axis instead (it is</span>
<span class="sd">    much faster). This function now primarily exists to verify the behavior of</span>
<span class="sd">    the new one.</span>

<span class="sd">    Interpolate an array of 3-D data along one axis. This function</span>
<span class="sd">    assumes that the x-coordinate increases monotonically.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">oldCoord</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">stackedData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">oldCoord</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">newCoord</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">interpVector</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">stackedData</span><span class="p">,</span> <span class="n">Nx</span><span class="o">=</span><span class="n">oldCoord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">interpV</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">old_x</span><span class="o">=</span><span class="n">oldCoord</span><span class="p">,</span> <span class="n">new_x</span><span class="o">=</span><span class="n">newCoord</span><span class="p">,</span>
                                  <span class="n">left</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.interpolator.interpolateDEM" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="n">outLL</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Interpolate a DEM raster to a set of lat/lon query points using rioxarray</p>
<p>outLL will be a tuple of (lats, lons). lats/lons can either be 1D arrays or 2
    For now will only use first row/col of 2D</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/interpolator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="n">outLL</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Interpolate a DEM raster to a set of lat/lon query points using rioxarray</span>

<span class="sd">    outLL will be a tuple of (lats, lons). lats/lons can either be 1D arrays or 2</span>
<span class="sd">        For now will only use first row/col of 2D</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">rioxarray</span> <span class="k">as</span> <span class="nn">xrr</span>
    <span class="n">da_dem</span>     <span class="o">=</span> <span class="n">xrr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="n">band_as_variable</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;band_1&#39;</span><span class="p">]</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">outLL</span>
    <span class="n">lats</span>  <span class="o">=</span> <span class="n">lats</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">lats</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="n">lats</span>
    <span class="n">lons</span>  <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">lons</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="n">lons</span>
    <span class="n">z_out</span> <span class="o">=</span> <span class="n">da_dem</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">lats</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">lons</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
    <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.llreader" class="doc doc-heading">
            <code>llreader</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.AOI" class="doc doc-heading">
            <code>AOI</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>This instantiates a generic AOI class object.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AOI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This instantiates a generic AOI class object.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       _bounding_box    - S N W E bounding box</span>
<span class="sd">       _proj            - pyproj-compatible CRS</span>
<span class="sd">       _type            - Type of AOI</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>           <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>


    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">geotransform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span>


    <span class="k">def</span> <span class="nf">projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>


    <span class="k">def</span> <span class="nf">get_output_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the output spacing in desired units &quot;&quot;&quot;</span>
        <span class="n">output_spacing_deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>

        <span class="c1">## convert it to meters users wants a projected coordinate system</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">axis_info</span><span class="o">.</span><span class="n">unit_name</span> <span class="o">==</span> <span class="s1">&#39;degree&#39;</span> <span class="k">for</span> <span class="n">axis_info</span> <span class="ow">in</span> <span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span><span class="p">):</span>
            <span class="n">output_spacing</span> <span class="o">=</span> <span class="n">output_spacing_deg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_spacing</span> <span class="o">=</span> <span class="n">output_spacing_deg</span><span class="o">*</span><span class="mf">1e5</span>

        <span class="k">return</span> <span class="n">output_spacing</span>


    <span class="k">def</span> <span class="nf">set_output_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_res</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the spacing for the output grid and weather model</span>

<span class="sd">        Use the requested spacing if exists or the weather model grid itself</span>

<span class="sd">        Returns:</span>
<span class="sd">            None. Sets self._output_spacing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">ll_res</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span><span class="p">,</span> \
            <span class="s1">&#39;Must pass lat/lon resolution if _cube_spacing_m is None&#39;</span>

        <span class="n">out_spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="o">/</span> <span class="mf">1e5</span>  \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="k">else</span> <span class="n">ll_res</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Output cube spacing: </span><span class="si">{</span><span class="n">out_spacing</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span> <span class="o">=</span> <span class="n">out_spacing</span>


    <span class="k">def</span> <span class="nf">add_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_res</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a fixed buffer to the AOI, accounting for the cube spacing.</span>

<span class="sd">        Ensures cube is slighly larger than requested area.</span>
<span class="sd">        The AOI will always be in EPSG:4326</span>
<span class="sd">        Args:</span>
<span class="sd">            ll_res          - weather model lat/lon resolution</span>
<span class="sd">            digits          - number of decimal digits to include in the output</span>

<span class="sd">        Returns:</span>
<span class="sd">            None. Updates self._bounding_box</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; from RAiDER.models.hrrr import HRRR</span>
<span class="sd">        &gt;&gt;&gt; from RAiDER.llreader import BoundingBox</span>
<span class="sd">        &gt;&gt;&gt; wm = HRRR()</span>
<span class="sd">        &gt;&gt;&gt; aoi = BoundingBox([37, 38, -92, -91])</span>
<span class="sd">        &gt;&gt;&gt; aoi.add_buffer(buffer = 1.5 * wm.getLLRes())</span>
<span class="sd">        &gt;&gt;&gt; aoi.bounds()</span>
<span class="sd">         [36.93, 38.07, -92.07, -90.93]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">clip_bbox</span>

        <span class="c1">## add an extra buffer around the user specified region</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
        <span class="n">buffer</span>     <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">ll_res</span><span class="p">)</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">S</span><span class="o">-</span><span class="n">buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">]),</span>  <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">N</span><span class="o">+</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">W</span><span class="o">-</span><span class="n">buffer</span><span class="p">,</span> <span class="n">E</span><span class="o">+</span><span class="n">buffer</span> <span class="c1"># TODO: handle dateline crossings</span>

        <span class="c1">## clip the buffered region to a multiple of the spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_output_spacing</span><span class="p">(</span><span class="n">ll_res</span><span class="p">)</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span>  <span class="o">=</span> <span class="n">clip_bbox</span><span class="p">([</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bounds extend past +/- 180. Results may be incorrect.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">calc_buffer_ray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">lookDir</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">incAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxZ</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the buffer for ray tracing. This only needs to be done in the east-west</span>
<span class="sd">        direction due to satellite orbits, and only needs extended on the side closest to</span>
<span class="sd">        the sensor.</span>

<span class="sd">        Args:</span>
<span class="sd">            lookDir (str)      - Sensor look direction, can be &quot;right&quot; or &quot;left&quot;</span>
<span class="sd">            losAngle (float)   - Incidence angle in degrees</span>
<span class="sd">            maxZ (float)       - maximum integration elevation in km</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># for isce object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lookDir</span> <span class="o">=</span> <span class="n">lookDir</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">lookDir</span> <span class="o">=</span> <span class="n">lookDir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">direction</span> <span class="ow">in</span> <span class="s1">&#39;asc desc&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s1">&#39;Incorrection orbital direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s1">. Choose asc or desc.&#39;</span>
        <span class="k">assert</span> <span class="n">lookDir</span> <span class="ow">in</span> <span class="s1">&#39;right light&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s1">&#39;Incorrection look direction: </span><span class="si">{</span><span class="n">lookDir</span><span class="si">}</span><span class="s1">. Choose right or left.&#39;</span>

        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>

        <span class="c1"># use a small look angle to calculate near range</span>
        <span class="n">lat_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
        <span class="n">near</span>    <span class="o">=</span> <span class="n">maxZ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">incAngle</span><span class="p">))</span>
        <span class="n">buffer</span>  <span class="o">=</span> <span class="n">near</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat_max</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># buffer on the side nearest the sensor</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lookDir</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;asc&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">((</span><span class="n">lookDir</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;desc&#39;</span><span class="p">)):</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">buffer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="n">buffer</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bounds extend past +/- 180. Results may be incorrect.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bounds</span>


    <span class="k">def</span> <span class="nf">set_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">output_directory</span>
        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">set_output_xygrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Define the locations where the delays will be returned &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">transform_bbox</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">dst_crs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;EPSG:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">CRSError</span><span class="p">:</span>
                <span class="n">out_proj</span> <span class="o">=</span> <span class="n">dst_crs</span>


        <span class="n">out_snwe</span> <span class="o">=</span> <span class="n">transform_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">(),</span> <span class="n">src_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">dest_crs</span><span class="o">=</span><span class="n">out_proj</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output SNWE: </span><span class="si">{</span><span class="n">out_snwe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Build the output grid</span>
        <span class="n">out_spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_spacing</span><span class="p">(</span><span class="n">out_proj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">out_snwe</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">out_snwe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">out_spacing</span><span class="p">,</span> <span class="n">out_spacing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">out_snwe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_snwe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">out_spacing</span><span class="p">,</span> <span class="o">-</span><span class="n">out_spacing</span><span class="p">)</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.AOI.add_buffer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_buffer</span><span class="p">(</span><span class="n">ll_res</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Add a fixed buffer to the AOI, accounting for the cube spacing.</p>
<p>Ensures cube is slighly larger than requested area.
The AOI will always be in EPSG:4326
Args:
    ll_res          - weather model lat/lon resolution
    digits          - number of decimal digits to include in the output</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None. Updates self._bounding_box</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>from RAiDER.models.hrrr import HRRR
from RAiDER.llreader import BoundingBox
wm = HRRR()
aoi = BoundingBox([37, 38, -92, -91])
aoi.add_buffer(buffer = 1.5 * wm.getLLRes())
aoi.bounds()
 [36.93, 38.07, -92.07, -90.93]</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_res</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a fixed buffer to the AOI, accounting for the cube spacing.</span>

<span class="sd">    Ensures cube is slighly larger than requested area.</span>
<span class="sd">    The AOI will always be in EPSG:4326</span>
<span class="sd">    Args:</span>
<span class="sd">        ll_res          - weather model lat/lon resolution</span>
<span class="sd">        digits          - number of decimal digits to include in the output</span>

<span class="sd">    Returns:</span>
<span class="sd">        None. Updates self._bounding_box</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.models.hrrr import HRRR</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.llreader import BoundingBox</span>
<span class="sd">    &gt;&gt;&gt; wm = HRRR()</span>
<span class="sd">    &gt;&gt;&gt; aoi = BoundingBox([37, 38, -92, -91])</span>
<span class="sd">    &gt;&gt;&gt; aoi.add_buffer(buffer = 1.5 * wm.getLLRes())</span>
<span class="sd">    &gt;&gt;&gt; aoi.bounds()</span>
<span class="sd">     [36.93, 38.07, -92.07, -90.93]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">clip_bbox</span>

    <span class="c1">## add an extra buffer around the user specified region</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
    <span class="n">buffer</span>     <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">ll_res</span><span class="p">)</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">S</span><span class="o">-</span><span class="n">buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">]),</span>  <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">N</span><span class="o">+</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">W</span><span class="o">-</span><span class="n">buffer</span><span class="p">,</span> <span class="n">E</span><span class="o">+</span><span class="n">buffer</span> <span class="c1"># TODO: handle dateline crossings</span>

    <span class="c1">## clip the buffered region to a multiple of the spacing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_output_spacing</span><span class="p">(</span><span class="n">ll_res</span><span class="p">)</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span>  <span class="o">=</span> <span class="n">clip_bbox</span><span class="p">([</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bounds extend past +/- 180. Results may be incorrect.&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.AOI.calc_buffer_ray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_buffer_ray</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">lookDir</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">incAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxZ</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate the buffer for ray tracing. This only needs to be done in the east-west
direction due to satellite orbits, and only needs extended on the side closest to
the sensor.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_buffer_ray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">lookDir</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">incAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxZ</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the buffer for ray tracing. This only needs to be done in the east-west</span>
<span class="sd">    direction due to satellite orbits, and only needs extended on the side closest to</span>
<span class="sd">    the sensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        lookDir (str)      - Sensor look direction, can be &quot;right&quot; or &quot;left&quot;</span>
<span class="sd">        losAngle (float)   - Incidence angle in degrees</span>
<span class="sd">        maxZ (float)       - maximum integration elevation in km</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># for isce object</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lookDir</span> <span class="o">=</span> <span class="n">lookDir</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">lookDir</span> <span class="o">=</span> <span class="n">lookDir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">direction</span> <span class="ow">in</span> <span class="s1">&#39;asc desc&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s1">&#39;Incorrection orbital direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s1">. Choose asc or desc.&#39;</span>
    <span class="k">assert</span> <span class="n">lookDir</span> <span class="ow">in</span> <span class="s1">&#39;right light&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s1">&#39;Incorrection look direction: </span><span class="si">{</span><span class="n">lookDir</span><span class="si">}</span><span class="s1">. Choose right or left.&#39;</span>

    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>

    <span class="c1"># use a small look angle to calculate near range</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
    <span class="n">near</span>    <span class="o">=</span> <span class="n">maxZ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">incAngle</span><span class="p">))</span>
    <span class="n">buffer</span>  <span class="o">=</span> <span class="n">near</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat_max</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># buffer on the side nearest the sensor</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">lookDir</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;asc&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">((</span><span class="n">lookDir</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;desc&#39;</span><span class="p">)):</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">buffer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="n">buffer</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bounds extend past +/- 180. Results may be incorrect.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bounds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.AOI.get_output_spacing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_spacing</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Return the output spacing in desired units</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_output_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the output spacing in desired units &quot;&quot;&quot;</span>
    <span class="n">output_spacing_deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>

    <span class="c1">## convert it to meters users wants a projected coordinate system</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">axis_info</span><span class="o">.</span><span class="n">unit_name</span> <span class="o">==</span> <span class="s1">&#39;degree&#39;</span> <span class="k">for</span> <span class="n">axis_info</span> <span class="ow">in</span> <span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span><span class="p">):</span>
        <span class="n">output_spacing</span> <span class="o">=</span> <span class="n">output_spacing_deg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_spacing</span> <span class="o">=</span> <span class="n">output_spacing_deg</span><span class="o">*</span><span class="mf">1e5</span>

    <span class="k">return</span> <span class="n">output_spacing</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.AOI.set_output_spacing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_output_spacing</span><span class="p">(</span><span class="n">ll_res</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate the spacing for the output grid and weather model</p>
<p>Use the requested spacing if exists or the weather model grid itself</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None. Sets self._output_spacing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_output_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_res</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the spacing for the output grid and weather model</span>

<span class="sd">    Use the requested spacing if exists or the weather model grid itself</span>

<span class="sd">    Returns:</span>
<span class="sd">        None. Sets self._output_spacing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">ll_res</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span><span class="p">,</span> \
        <span class="s1">&#39;Must pass lat/lon resolution if _cube_spacing_m is None&#39;</span>

    <span class="n">out_spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="o">/</span> <span class="mf">1e5</span>  \
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cube_spacing_m</span> <span class="k">else</span> <span class="n">ll_res</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Output cube spacing: </span><span class="si">{</span><span class="n">out_spacing</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output_spacing</span> <span class="o">=</span> <span class="n">out_spacing</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.AOI.set_output_xygrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_output_xygrid</span><span class="p">(</span><span class="n">dst_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Define the locations where the delays will be returned</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_output_xygrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Define the locations where the delays will be returned &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">transform_bbox</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">out_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">dst_crs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;EPSG:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">CRSError</span><span class="p">:</span>
            <span class="n">out_proj</span> <span class="o">=</span> <span class="n">dst_crs</span>


    <span class="n">out_snwe</span> <span class="o">=</span> <span class="n">transform_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">(),</span> <span class="n">src_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">dest_crs</span><span class="o">=</span><span class="n">out_proj</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output SNWE: </span><span class="si">{</span><span class="n">out_snwe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Build the output grid</span>
    <span class="n">out_spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_spacing</span><span class="p">(</span><span class="n">out_proj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">out_snwe</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">out_snwe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">out_spacing</span><span class="p">,</span> <span class="n">out_spacing</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">out_snwe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_snwe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">out_spacing</span><span class="p">,</span> <span class="o">-</span><span class="n">out_spacing</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.BoundingBox" class="doc doc-heading">
            <code>BoundingBox</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.llreader.AOI" href="#RAiDER.llreader.AOI">AOI</a></code></p>


      <p>Parse a bounding box AOI</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BoundingBox</span><span class="p">(</span><span class="n">AOI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Parse a bounding box AOI&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">):</span>
        <span class="n">AOI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="n">bbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;bounding_box&#39;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.GeocodedFile" class="doc doc-heading">
            <code>GeocodedFile</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.llreader.AOI" href="#RAiDER.llreader.AOI">AOI</a></code></p>


      <p>Parse a Geocoded file for coordinates</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GeocodedFile</span><span class="p">(</span><span class="n">AOI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Parse a Geocoded file for coordinates&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">is_dem</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">rio_profile</span><span class="p">,</span> <span class="n">rio_extents</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>     <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span>             <span class="o">=</span> <span class="n">rio_profile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="n">rio_extents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dem</span>       <span class="o">=</span> <span class="n">is_dem</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span> <span class="o">=</span> <span class="n">rio_stats</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;geocoded_file&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">readLL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ll_bounds are SNWE</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        <span class="n">px</span>   <span class="o">=</span> <span class="p">(</span><span class="n">E</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span>
        <span class="n">py</span>   <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">W</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">px</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">)])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">py</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">)])</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="c1"># lats, lons</span>


    <span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Download a DEM for the file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
        <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

        <span class="n">demFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dem</span> <span class="k">else</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span>
        <span class="n">bbox</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">)</span>
        <span class="n">z_out</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.GeocodedFile.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">is_dem</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">is_dem</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">rio_profile</span><span class="p">,</span> <span class="n">rio_extents</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>     <span class="o">=</span> <span class="n">filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p</span>             <span class="o">=</span> <span class="n">rio_profile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="n">rio_extents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_dem</span>       <span class="o">=</span> <span class="n">is_dem</span>
    <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span> <span class="o">=</span> <span class="n">rio_stats</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;geocoded_file&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.GeocodedFile.readZ" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readZ</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Download a DEM for the file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Download a DEM for the file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
    <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

    <span class="n">demFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dem</span> <span class="k">else</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span>
    <span class="n">bbox</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">)</span>
    <span class="n">z_out</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.Geocube" class="doc doc-heading">
            <code>Geocube</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.llreader.AOI" href="#RAiDER.llreader.AOI">AOI</a></code></p>


      <p>Pull lat/lon/height from a georeferenced data cube</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Geocube</span><span class="p">(</span><span class="n">AOI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Pull lat/lon/height from a georeferenced data cube &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_cube</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>  <span class="o">=</span> <span class="n">path_cube</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;Geocube&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span> <span class="o">=</span> <span class="n">rio_stats</span><span class="p">(</span><span class="n">path_cube</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">S</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">]</span>

    <span class="c1">## untested</span>
    <span class="k">def</span> <span class="nf">readLL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitutde</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="n">Lats</span><span class="p">,</span> <span class="n">Lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Lats</span><span class="p">,</span> <span class="n">Lons</span>

    <span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">heights</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">heights</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">heights</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.RasterRDR" class="doc doc-heading">
            <code>RasterRDR</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.llreader.AOI" href="#RAiDER.llreader.AOI">AOI</a></code></p>


      <p>Use a 2-band raster file containing lat/lon coordinates.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RasterRDR</span><span class="p">(</span><span class="n">AOI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use a 2-band raster file containing lat/lon coordinates. </span>
<span class="sd">    &#39;&#39;&#39;</span>    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat_file</span><span class="p">,</span> <span class="n">lon_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hgt_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dem_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convention</span><span class="o">=</span><span class="s1">&#39;isce&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;radar_rasters&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latfile</span> <span class="o">=</span> <span class="n">lat_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lonfile</span> <span class="o">=</span> <span class="n">lon_file</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You need to specify a 2-band file or two single-band files&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latfile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_latfile</span><span class="si">}</span><span class="s1"> cannot be found!&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bpg</span> <span class="o">=</span> <span class="n">bounds_from_latlon_rasters</span><span class="p">(</span><span class="n">lat_file</span><span class="p">,</span> <span class="n">lon_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geotransform</span> <span class="o">=</span> <span class="n">bpg</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not read lat/lon rasters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># keep track of the height file, dem and convention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span> <span class="o">=</span> <span class="n">hgt_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span> <span class="o">=</span> <span class="n">dem_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span> <span class="o">=</span> <span class="n">convention</span>


    <span class="k">def</span> <span class="nf">readLL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># allow for 2-band lat/lon raster</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latfile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lats</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lats</span><span class="p">,</span> <span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lonfile</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read the heights from the raster file, or download a DEM if not present</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Using existing heights at: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Download the DEM</span>
            <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
            <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

            <span class="n">demFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span><span class="p">)</span> \
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">,</span>
                <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">z_out</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.RasterRDR.readZ" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readZ</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read the heights from the raster file, or download a DEM if not present</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read the heights from the raster file, or download a DEM if not present</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Using existing heights at: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hgtfile</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Download the DEM</span>
        <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
        <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

        <span class="n">demFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span><span class="p">)</span> \
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">,</span>
            <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">z_out</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.llreader.StationFile" class="doc doc-heading">
            <code>StationFile</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.llreader.AOI" href="#RAiDER.llreader.AOI">AOI</a></code></p>


      <p>Use a .csv file containing at least Lat, Lon, and optionally Hgt_m columns</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/llreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StationFile</span><span class="p">(</span><span class="n">AOI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Use a .csv file containing at least Lat, Lon, and optionally Hgt_m columns&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_file</span><span class="p">,</span> <span class="n">demFile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">station_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span>  <span class="o">=</span> <span class="n">demFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span> <span class="o">=</span> <span class="n">bounds_from_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;station_file&#39;</span>


    <span class="k">def</span> <span class="nf">readLL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Read the station lat/lons from the csv file&#39;&#39;&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>


    <span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read the station heights from the file, or download a DEM if not present</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;Hgt_m&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Hgt_m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Download the DEM</span>
            <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
            <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

            <span class="n">demFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span><span class="p">)</span> \
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">,</span>
                <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1">## interpolate the DEM to the query points</span>
            <span class="n">z_out0</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_out0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;DEM interpolation failed. Check DEM bounds and station coords.&#39;</span><span class="p">)</span>
            <span class="n">z_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">z_out0</span><span class="p">)</span>  <span class="c1"># the diagonal is the actual stations coordinates</span>

            <span class="c1"># write the elevations to the file</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Hgt_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_out</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.StationFile.readLL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readLL</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read the station lat/lons from the csv file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readLL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Read the station lat/lons from the csv file&#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.llreader.StationFile.readZ" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readZ</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read the station heights from the file, or download a DEM if not present</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read the station heights from the file, or download a DEM if not present</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;Hgt_m&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Hgt_m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Download the DEM</span>
        <span class="kn">from</span> <span class="nn">RAiDER.dem</span> <span class="kn">import</span> <span class="n">download_dem</span>
        <span class="kn">from</span> <span class="nn">RAiDER.interpolator</span> <span class="kn">import</span> <span class="n">interpolateDEM</span>

        <span class="n">demFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span> <span class="s1">&#39;GLO30_fullres_dem.tif&#39;</span><span class="p">)</span> \
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demfile</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">download_dem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_box</span><span class="p">,</span>
            <span class="n">writeDEM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">demName</span><span class="o">=</span><span class="n">demFile</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">## interpolate the DEM to the query points</span>
        <span class="n">z_out0</span> <span class="o">=</span> <span class="n">interpolateDEM</span><span class="p">(</span><span class="n">demFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLL</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_out0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;DEM interpolation failed. Check DEM bounds and station coords.&#39;</span><span class="p">)</span>
        <span class="n">z_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">z_out0</span><span class="p">)</span>  <span class="c1"># the diagonal is the actual stations coordinates</span>

        <span class="c1"># write the elevations to the file</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Hgt_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_out</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="RAiDER.llreader.bounds_from_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bounds_from_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>station_file should be a comma-delimited file with at least "Lat"
and "Lon" columns, which should be EPSG: 4326 projection (i.e WGS84)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bounds_from_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    station_file should be a comma-delimited file with at least &quot;Lat&quot;</span>
<span class="sd">    and &quot;Lon&quot; columns, which should be EPSG: 4326 projection (i.e WGS84)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">station_file</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>
    <span class="n">snwe</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;Lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">snwe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.llreader.bounds_from_latlon_rasters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bounds_from_latlon_rasters</span><span class="p">(</span><span class="n">latfile</span><span class="p">,</span> <span class="n">lonfile</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Parse lat/lon/height inputs and return
the appropriate outputs</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/llreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bounds_from_latlon_rasters</span><span class="p">(</span><span class="n">latfile</span><span class="p">,</span> <span class="n">lonfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse lat/lon/height inputs and return</span>
<span class="sd">    the appropriate outputs</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">RAiDER.utilFcns</span> <span class="kn">import</span> <span class="n">get_file_and_band</span>
    <span class="n">latinfo</span> <span class="o">=</span> <span class="n">get_file_and_band</span><span class="p">(</span><span class="n">latfile</span><span class="p">)</span>
    <span class="n">loninfo</span> <span class="o">=</span> <span class="n">get_file_and_band</span><span class="p">(</span><span class="n">lonfile</span><span class="p">)</span>
    <span class="n">lat_stats</span><span class="p">,</span> <span class="n">lat_proj</span><span class="p">,</span> <span class="n">lat_gt</span> <span class="o">=</span> <span class="n">rio_stats</span><span class="p">(</span><span class="n">latinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band</span><span class="o">=</span><span class="n">latinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lon_stats</span><span class="p">,</span> <span class="n">lon_proj</span><span class="p">,</span> <span class="n">lon_gt</span> <span class="o">=</span> <span class="n">rio_stats</span><span class="p">(</span><span class="n">loninfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band</span><span class="o">=</span><span class="n">loninfo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">lat_proj</span> <span class="o">!=</span> <span class="n">lon_proj</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Projection information for Latitude and Longitude files does not match&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lat_gt</span> <span class="o">!=</span> <span class="n">lon_gt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Affine transform for Latitude and Longitude files does not match&#39;</span><span class="p">)</span>

    <span class="c1"># TODO - handle dateline crossing here</span>
    <span class="n">snwe</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_stats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">lat_stats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="n">lon_stats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">lon_stats</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lat_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Assuming lat/lon files are in EPSG:4326&#39;</span><span class="p">)</span>
        <span class="n">lat_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">snwe</span><span class="p">,</span> <span class="n">lat_proj</span><span class="p">,</span> <span class="n">lat_gt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.logger" class="doc doc-heading">
            <code>logger</code>


</h2>

    <div class="doc doc-contents ">

      <p>Global logging configuration</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="RAiDER.logger.CustomFormatter" class="doc doc-heading">
            <code>CustomFormatter</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="RAiDER.logger.UnixColorFormatter">UnixColorFormatter</span></code></p>


      <p>Adds levelname prefixes to the message on warning or above.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CustomFormatter</span><span class="p">(</span><span class="n">UnixColorFormatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds levelname prefixes to the message on warning or above.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">formatMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">formatMessage</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&gt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;: &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">record</span><span class="o">.</span><span class="n">levelname</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.losreader" class="doc doc-heading">
            <code>losreader</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="RAiDER.losreader.Conventional" class="doc doc-heading">
            <code>Conventional</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.losreader.LOS" href="#RAiDER.losreader.LOS">LOS</a></code></p>


      <p>Special value indicating that the zenith delay will
be projected using the standard cos(inc) scaling.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/losreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Conventional</span><span class="p">(</span><span class="n">LOS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Special value indicating that the zenith delay will</span>
<span class="sd">    be projected using the standard cos(inc) scaling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">los_convention</span><span class="o">=</span><span class="s1">&#39;isce&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span>  <span class="o">=</span> <span class="n">pad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_projected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span>   <span class="o">=</span> <span class="n">los_convention</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;isce&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read the LOS file and convert it to look vectors</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target points not set&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;LOS file not set&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># if an ISCE-style los file is passed open it with GDAL</span>
            <span class="n">LOS_enu</span> <span class="o">=</span> <span class="n">inc_hd_to_enu</span><span class="p">(</span><span class="o">*</span><span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="c1"># Otherwise, treat it as an orbit / statevector file</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
                <span class="n">get_sv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">LOS_enu</span> <span class="o">=</span> <span class="n">state_to_los</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span>
                                   <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span><span class="p">],</span>
                                   <span class="p">)</span>

        <span class="k">if</span> <span class="n">delays</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">LOS_enu</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">delays</span> <span class="o">/</span> <span class="n">LOS_enu</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">delays</span> <span class="o">/</span> <span class="n">LOS_enu</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Conventional.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read the LOS file and convert it to look vectors</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read the LOS file and convert it to look vectors</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target points not set&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;LOS file not set&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># if an ISCE-style los file is passed open it with GDAL</span>
        <span class="n">LOS_enu</span> <span class="o">=</span> <span class="n">inc_hd_to_enu</span><span class="p">(</span><span class="o">*</span><span class="n">rio_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="c1"># Otherwise, treat it as an orbit / statevector file</span>
        <span class="n">svs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
            <span class="n">get_sv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">LOS_enu</span> <span class="o">=</span> <span class="n">state_to_los</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span>
                               <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span><span class="p">],</span>
                               <span class="p">)</span>

    <span class="k">if</span> <span class="n">delays</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">LOS_enu</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">delays</span> <span class="o">/</span> <span class="n">LOS_enu</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">delays</span> <span class="o">/</span> <span class="n">LOS_enu</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.losreader.LOS" class="doc doc-heading">
            <code>LOS</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


      <p>LOS Class definition for handling look vectors</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/losreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LOS</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    LOS Class definition for handling look vectors</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_zenith</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_projected</span> <span class="o">=</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">setPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">heights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Set the pixel locations&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;You haven&#39;t given any point locations yet&quot;</span><span class="p">)</span>

        <span class="c1"># Will overwrite points by default</span>
        <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">llh</span> <span class="o">=</span> <span class="n">lats</span>  <span class="c1"># assume points are [lats lons heights]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">heights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">heights</span>


    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">dt</span>


    <span class="k">def</span> <span class="nf">is_Zenith</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zenith</span>


    <span class="k">def</span> <span class="nf">is_Projected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_projected</span>


    <span class="k">def</span> <span class="nf">ray_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_trace</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.LOS.setPoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setPoints</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">heights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Set the pixel locations</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">heights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Set the pixel locations&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;You haven&#39;t given any point locations yet&quot;</span><span class="p">)</span>

    <span class="c1"># Will overwrite points by default</span>
    <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">llh</span> <span class="o">=</span> <span class="n">lats</span>  <span class="c1"># assume points are [lats lons heights]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">llh</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">heights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">=</span> <span class="n">heights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.losreader.Raytracing" class="doc doc-heading">
            <code>Raytracing</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.losreader.LOS" href="#RAiDER.losreader.LOS">LOS</a></code></p>


      <p>Special value indicating that full raytracing will be
used to calculate slant delays.</p>
<p>Get unit look vectors pointing from the ground (target) pixels to the sensor,
or to Zenith. Can be accomplished using an ISCE-style 2-band LOS file or a
file containing orbital statevectors.</p>
<p><em>NOTE</em>:
These line-of-sight vectors will NOT match ordinary LOS vectors for InSAR
because they are in an ECEF reference frame instead of a local ENU. This is done
because the construction of rays is done in ECEF rather than the local ENU.</p>
<h5 id="RAiDER.losreader.Raytracing--args">Args:</h5>
<p>time: python datetime                  - user-requested query time. Must be
                                         compatible with the orbit file passed.
                                         Only required for a statevector file.
pad: int                               - integer number of seconds to pad around
                                         the user-specified time; default 10 min
                                         Only required for a statevector file.</p>
<h5 id="RAiDER.losreader.Raytracing--returns">Returns:</h5>
<p>ndarray - an <in_shape> x 3 array of unit look vectors, defined in
        an Earth-centered, earth-fixed reference frame (ECEF).
        Convention is vectors point from the target pixel to the
        sensor.
ndarray - array of <in_shape> of the distnce from the surface to
        the top of the troposphere (denoted by zref)</p>
<h5 id="RAiDER.losreader.Raytracing--example">Example:</h5>
<blockquote>
<blockquote>
<blockquote>
<p>from RAiDER.losreader import Raytracing
import numpy as np</p>
</blockquote>
</blockquote>
</blockquote>

              <details class="quote">
                <summary>Source code in <code>RAiDER/losreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Raytracing</span><span class="p">(</span><span class="n">LOS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Special value indicating that full raytracing will be</span>
<span class="sd">    used to calculate slant delays.</span>

<span class="sd">    Get unit look vectors pointing from the ground (target) pixels to the sensor,</span>
<span class="sd">    or to Zenith. Can be accomplished using an ISCE-style 2-band LOS file or a</span>
<span class="sd">    file containing orbital statevectors.</span>

<span class="sd">    *NOTE*:</span>
<span class="sd">    These line-of-sight vectors will NOT match ordinary LOS vectors for InSAR</span>
<span class="sd">    because they are in an ECEF reference frame instead of a local ENU. This is done</span>
<span class="sd">    because the construction of rays is done in ECEF rather than the local ENU.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    time: python datetime                  - user-requested query time. Must be</span>
<span class="sd">                                             compatible with the orbit file passed.</span>
<span class="sd">                                             Only required for a statevector file.</span>
<span class="sd">    pad: int                               - integer number of seconds to pad around</span>
<span class="sd">                                             the user-specified time; default 10 min</span>
<span class="sd">                                             Only required for a statevector file.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray - an &lt;in_shape&gt; x 3 array of unit look vectors, defined in</span>
<span class="sd">            an Earth-centered, earth-fixed reference frame (ECEF).</span>
<span class="sd">            Convention is vectors point from the target pixel to the</span>
<span class="sd">            sensor.</span>
<span class="sd">    ndarray - array of &lt;in_shape&gt; of the distnce from the surface to</span>
<span class="sd">            the top of the troposphere (denoted by zref)</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.losreader import Raytracing</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">los_convention</span><span class="o">=</span><span class="s1">&#39;isce&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">look_dir</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;read in and parse a statevector file&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this class. Use conda to install isce3`&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_trace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span>  <span class="o">=</span> <span class="n">pad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span> <span class="o">=</span> <span class="n">los_convention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;isce&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

        <span class="c1"># ISCE3 data structures</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># __call__ called in checkArgs; keep for modularity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="o">=</span> <span class="n">get_orbit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elp</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dop</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LUT2d</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">look_dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Right</span>
        <span class="k">elif</span> <span class="n">look_dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Left</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown look direction: </span><span class="si">{</span><span class="n">look_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getSensorDirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The orbit has not been set&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="o">.</span><span class="n">time</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">[</span><span class="n">end</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s1">&#39;desc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;asc&#39;</span>


    <span class="k">def</span> <span class="nf">getLookDirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span>

    <span class="c1"># Called in checkArgs</span>
    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="o">=</span> <span class="n">get_orbit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getLookVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">llh</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">yy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate look vectors for raytracing</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this method. Use conda to install isce3`&#39;</span><span class="p">)</span>

        <span class="c1"># TODO - Modify when isce3 vectorization is available</span>
        <span class="n">los</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">llh</span> <span class="o">=</span> <span class="n">llh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> <span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> <span class="n">ht</span><span class="p">])</span>
                <span class="n">inp_xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span>

                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">inp_xyz</span><span class="p">)):</span>
                    <span class="k">continue</span>

                <span class="c1"># Wavelength does not matter for</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">aztime</span><span class="p">,</span> <span class="n">slant_range</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geo2rdr</span><span class="p">(</span>
                        <span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dop</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span>
                        <span class="n">maxiter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                        <span class="n">delta_range</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
                    <span class="n">sat_xyz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">aztime</span><span class="p">)</span>
                    <span class="n">los</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sat_xyz</span> <span class="o">-</span> <span class="n">inp_xyz</span><span class="p">)</span> <span class="o">/</span> <span class="n">slant_range</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">los</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">los</span>


    <span class="k">def</span> <span class="nf">getIntersectionWithHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function computes the intersection point of a ray at a height</span>
<span class="sd">        level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We just leverage the same code as finding top of atmosphere here</span>
        <span class="k">return</span> <span class="n">getTopOfAtmosphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getIntersectionWithLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns the points at which rays intersect the</span>
<span class="sd">        given height levels. This way we have same number of points in</span>
<span class="sd">        each ray and only at level transitions.</span>

<span class="sd">        For targets that are above a given height level, the ray points are set</span>
<span class="sd">        to nan to indicate that it does not contribute to the integration of</span>
<span class="sd">        rays.</span>

<span class="sd">        Output:</span>
<span class="sd">            rays: (self._lats.shape, len(levels),  3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>

        <span class="c1"># This can be further vectorized, if there is enough memory</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
            <span class="n">rays</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIntersectionWithHeight</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

            <span class="c1"># Set pixels above level to nan</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">rays</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">value</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">return</span> <span class="n">rays</span>


    <span class="k">def</span> <span class="nf">calculateDelays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Here &quot;delays&quot; is point-wise delays (i.e. refractivities), not</span>
<span class="sd">        integrated ZTD/STD.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Create rays  (Use getIntersectionWithLevels above)</span>
        <span class="c1"># Interpolate delays to rays</span>
        <span class="c1"># Integrate along rays</span>
        <span class="c1"># Return STD</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Raytracing.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">los_convention</span><span class="o">=</span><span class="s1">&#39;isce&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">look_dir</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>read in and parse a statevector file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">los_convention</span><span class="o">=</span><span class="s1">&#39;isce&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">look_dir</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;read in and parse a statevector file&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this class. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ray_trace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span>  <span class="o">=</span> <span class="n">pad</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span> <span class="o">=</span> <span class="n">los_convention</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convention</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;isce&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="c1"># ISCE3 data structures</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># __call__ called in checkArgs; keep for modularity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span> <span class="o">=</span> <span class="n">get_orbit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_elp</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dop</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LUT2d</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">look_dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Right</span>
    <span class="k">elif</span> <span class="n">look_dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Left</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown look direction: </span><span class="si">{</span><span class="n">look_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Raytracing.calculateDelays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculateDelays</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Here "delays" is point-wise delays (i.e. refractivities), not
integrated ZTD/STD.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculateDelays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Here &quot;delays&quot; is point-wise delays (i.e. refractivities), not</span>
<span class="sd">    integrated ZTD/STD.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Create rays  (Use getIntersectionWithLevels above)</span>
    <span class="c1"># Interpolate delays to rays</span>
    <span class="c1"># Integrate along rays</span>
    <span class="c1"># Return STD</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Raytracing.getIntersectionWithHeight" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getIntersectionWithHeight</span><span class="p">(</span><span class="n">height</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>This function computes the intersection point of a ray at a height
level</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getIntersectionWithHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function computes the intersection point of a ray at a height</span>
<span class="sd">    level</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We just leverage the same code as finding top of atmosphere here</span>
    <span class="k">return</span> <span class="n">getTopOfAtmosphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Raytracing.getIntersectionWithLevels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getIntersectionWithLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>This function returns the points at which rays intersect the
given height levels. This way we have same number of points in
each ray and only at level transitions.</p>
<p>For targets that are above a given height level, the ray points are set
to nan to indicate that it does not contribute to the integration of
rays.</p>


<details class="output" open>
  <summary>Output</summary>
  <p>rays: (self._lats.shape, len(levels),  3)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getIntersectionWithLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns the points at which rays intersect the</span>
<span class="sd">    given height levels. This way we have same number of points in</span>
<span class="sd">    each ray and only at level transitions.</span>

<span class="sd">    For targets that are above a given height level, the ray points are set</span>
<span class="sd">    to nan to indicate that it does not contribute to the integration of</span>
<span class="sd">    rays.</span>

<span class="sd">    Output:</span>
<span class="sd">        rays: (self._lats.shape, len(levels),  3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>

    <span class="c1"># This can be further vectorized, if there is enough memory</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">rays</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIntersectionWithHeight</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="c1"># Set pixels above level to nan</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">rays</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">value</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_heights</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">rays</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Raytracing.getLookVectors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getLookVectors</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">llh</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate look vectors for raytracing</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getLookVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">llh</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">yy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate look vectors for raytracing</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this method. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="c1"># TODO - Modify when isce3 vectorization is available</span>
    <span class="n">los</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">llh</span> <span class="o">=</span> <span class="n">llh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">llh</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> <span class="n">llh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> <span class="n">ht</span><span class="p">])</span>
            <span class="n">inp_xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">inp_xyz</span><span class="p">)):</span>
                <span class="k">continue</span>

            <span class="c1"># Wavelength does not matter for</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aztime</span><span class="p">,</span> <span class="n">slant_range</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geo2rdr</span><span class="p">(</span>
                    <span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dop</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_dir</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span>
                    <span class="n">maxiter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                    <span class="n">delta_range</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
                <span class="n">sat_xyz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbit</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">aztime</span><span class="p">)</span>
                <span class="n">los</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sat_xyz</span> <span class="o">-</span> <span class="n">inp_xyz</span><span class="p">)</span> <span class="o">/</span> <span class="n">slant_range</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">los</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">los</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.losreader.Zenith" class="doc doc-heading">
            <code>Zenith</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.losreader.LOS" href="#RAiDER.losreader.LOS">LOS</a></code></p>


      <p>Class definition for a "Zenith" object.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/losreader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Zenith</span><span class="p">(</span><span class="n">LOS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class definition for a &quot;Zenith&quot; object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_zenith</span> <span class="o">=</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">setLookVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Set point locations and calculate Zenith look vectors&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target points not set&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span> <span class="o">=</span> <span class="n">getZenithLookVecs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Placeholder method for consistency with the other classes&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">delays</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Zenith.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Placeholder method for consistency with the other classes</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delays</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Placeholder method for consistency with the other classes&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">delays</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.losreader.Zenith.setLookVectors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setLookVectors</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Set point locations and calculate Zenith look vectors</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setLookVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Set point locations and calculate Zenith look vectors&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target points not set&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_look_vecs</span> <span class="o">=</span> <span class="n">getZenithLookVecs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.build_ray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_ray</span><span class="p">(</span><span class="n">model_zs</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">LOS</span><span class="p">,</span> <span class="n">MAX_TROPO_HEIGHT</span><span class="o">=</span><span class="n">_ZREF</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Compute the ray length in ECEF between each  weather model layers</p>
<p>Only heights up to MAX_TROPO_HEIGHT are considered
Assumption: model_zs (model) are assumed to be sorted in height
We start integrating bottom up</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_ray</span><span class="p">(</span><span class="n">model_zs</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">LOS</span><span class="p">,</span> <span class="n">MAX_TROPO_HEIGHT</span><span class="o">=</span><span class="n">_ZREF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the ray length in ECEF between each  weather model layers</span>

<span class="sd">    Only heights up to MAX_TROPO_HEIGHT are considered</span>
<span class="sd">    Assumption: model_zs (model) are assumed to be sorted in height</span>
<span class="sd">    We start integrating bottom up</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">low_xyz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">high_xyz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cos_factor</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ray_lengths</span><span class="p">,</span> <span class="n">low_xyzs</span><span class="p">,</span> <span class="n">high_xyzs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_zs</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Low and High for model interval</span>
        <span class="n">low_ht</span> <span class="o">=</span> <span class="n">model_zs</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span>
        <span class="n">high_ht</span> <span class="o">=</span> <span class="n">model_zs</span><span class="p">[</span><span class="n">zz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># this will force ray lengths to stay within the weather model domain</span>
        <span class="k">if</span> <span class="n">high_ht</span> <span class="o">==</span> <span class="n">model_zs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">high_ht</span> <span class="o">-=</span> <span class="mf">0.01</span>

        <span class="c1"># If high_ht &lt; height of point - no contribution to integral</span>
        <span class="c1"># If low_ht &gt; max_tropo_height - no contribution to integral</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">high_ht</span> <span class="o">&lt;</span> <span class="n">ht</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">low_ht</span> <span class="o">&gt;=</span> <span class="n">MAX_TROPO_HEIGHT</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># If low_ht &lt; requested height, start integral at requested height</span>
        <span class="k">if</span> <span class="n">low_ht</span> <span class="o">&lt;</span> <span class="n">ht</span><span class="p">:</span>
            <span class="n">low_ht</span> <span class="o">=</span> <span class="n">ht</span>

        <span class="c1"># If high_ht &gt; max_tropo_height - integral only up to max tropo height</span>
        <span class="k">if</span> <span class="n">high_ht</span> <span class="o">&gt;</span> <span class="n">MAX_TROPO_HEIGHT</span><span class="p">:</span>
            <span class="n">high_ht</span> <span class="o">=</span> <span class="n">MAX_TROPO_HEIGHT</span>

        <span class="c1"># Continue only if needed - 1m troposphere does nothing</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">high_ht</span> <span class="o">-</span> <span class="n">low_ht</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># If high_xyz was defined, make new low_xyz - save computation</span>
        <span class="k">if</span> <span class="n">high_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">low_xyz</span> <span class="o">=</span> <span class="n">high_xyz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">low_xyz</span> <span class="o">=</span> <span class="n">getTopOfAtmosphere</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">LOS</span><span class="p">,</span> <span class="n">low_ht</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">cos_factor</span><span class="p">)</span>

        <span class="c1"># Compute high_xyz (upper model level)</span>
        <span class="n">high_xyz</span> <span class="o">=</span> <span class="n">getTopOfAtmosphere</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">LOS</span><span class="p">,</span> <span class="n">high_ht</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">cos_factor</span><span class="p">)</span>

        <span class="c1"># Compute ray length</span>
        <span class="n">ray_length</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">high_xyz</span> <span class="o">-</span> <span class="n">low_xyz</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute cos_factor for first iteration</span>
        <span class="k">if</span> <span class="n">cos_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cos_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_ht</span> <span class="o">-</span> <span class="n">low_ht</span><span class="p">)</span> <span class="o">/</span> <span class="n">ray_length</span>

        <span class="n">ray_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray_length</span><span class="p">)</span>
        <span class="n">low_xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">low_xyz</span><span class="p">)</span>
        <span class="n">high_xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">high_xyz</span><span class="p">)</span>

    <span class="c1">## if all weather model levels are requested the top most layer might not contribute anything</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ray_lengths</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ray_lengths</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">low_xyzs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">high_xyzs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.cut_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cut_times</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Slice the orbit file around the reference aquisition time. This is done
by default using a three-hour window, which for Sentinel-1 empirically
works out to be roughly the largest window allowed by the orbit time.
Args:</p>
<hr />
<p>times: Nt x 1 ndarray     - Vector of orbit times as datetime
ref_time: datetime        - Reference time
pad: int                  - integer time in seconds to use as padding
Returns:</p>
<hr />
<p>idx: Nt x 1 logical ndarray - a mask of times within the padded request time.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cut_times</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Slice the orbit file around the reference aquisition time. This is done</span>
<span class="sd">    by default using a three-hour window, which for Sentinel-1 empirically</span>
<span class="sd">    works out to be roughly the largest window allowed by the orbit time.</span>
<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    times: Nt x 1 ndarray     - Vector of orbit times as datetime</span>
<span class="sd">    ref_time: datetime        - Reference time</span>
<span class="sd">    pad: int                  - integer time in seconds to use as padding</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    idx: Nt x 1 logical ndarray - a mask of times within the padded request time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="n">ref_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pad</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.filter_ESA_orbit_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_ESA_orbit_file</span><span class="p">(</span><span class="n">orbit_xml</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Returns true or false depending on whether orbit file contains ref time</p>
<h5 id="RAiDER.losreader.filter_ESA_orbit_file--parameters">Parameters</h5>
<p>orbit_xml : str
    ESA orbit xml
ref_time : datetime.datetime</p>
<h5 id="RAiDER.losreader.filter_ESA_orbit_file--returns">Returns</h5>
<p>bool
    True if ref time is within orbit_xml</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_ESA_orbit_file</span><span class="p">(</span><span class="n">orbit_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">ref_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns true or false depending on whether orbit file contains ref time</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orbit_xml : str</span>
<span class="sd">        ESA orbit xml</span>
<span class="sd">    ref_time : datetime.datetime</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if ref time is within orbit_xml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">orbit_xml</span><span class="p">)</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.EOF&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">t0</span> <span class="o">&lt;</span> <span class="n">ref_time</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.getTopOfAtmosphere" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTopOfAtmosphere</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">look_vecs</span><span class="p">,</span> <span class="n">toaheight</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get ray intersection at given height.</p>
<p>We use simple Newton-Raphson for this computation. This cannot be done
exactly since closed form expression from xyz to llh is super compliated.</p>
<p>If a factor (cos of inc angle) is provided - iterations are lot faster.
If factor is not provided solutions converges to
    - 0.01 mm at heights near zero in 10 iterations
    - 10 cm at heights above 40km in 10 iterations</p>
<p>If factor is know, we converge in 3 iterations to less than a micron.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getTopOfAtmosphere</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">look_vecs</span><span class="p">,</span> <span class="n">toaheight</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get ray intersection at given height.</span>

<span class="sd">    We use simple Newton-Raphson for this computation. This cannot be done</span>
<span class="sd">    exactly since closed form expression from xyz to llh is super compliated.</span>

<span class="sd">    If a factor (cos of inc angle) is provided - iterations are lot faster.</span>
<span class="sd">    If factor is not provided solutions converges to</span>
<span class="sd">        - 0.01 mm at heights near zero in 10 iterations</span>
<span class="sd">        - 10 cm at heights above 40km in 10 iterations</span>

<span class="sd">    If factor is know, we converge in 3 iterations to less than a micron.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxIter</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxIter</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="c1"># Guess top point</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">+</span> <span class="n">toaheight</span> <span class="o">*</span> <span class="n">look_vecs</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxIter</span><span class="p">):</span>
        <span class="n">pos_llh</span> <span class="o">=</span> <span class="n">ecef2lla</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">look_vecs</span> <span class="o">*</span> <span class="p">((</span><span class="n">toaheight</span> <span class="o">-</span> <span class="n">pos_llh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">factor</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.getZenithLookVecs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getZenithLookVecs</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">heights</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Returns look vectors when Zenith is used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lats/lons/heights</code></td>
            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>Numpy arrays containing WGS-84 target locations</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>zenLookVecs</code></td>            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>(in_shape) x 3 unit look vectors in an ECEF reference frame</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getZenithLookVecs</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">heights</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns look vectors when Zenith is used.</span>

<span class="sd">    Args:</span>
<span class="sd">        lats/lons/heights (ndarray):  - Numpy arrays containing WGS-84 target locations</span>

<span class="sd">    Returns:</span>
<span class="sd">        zenLookVecs (ndarray):        - (in_shape) x 3 unit look vectors in an ECEF reference frame</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.get_orbit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_orbit</span><span class="p">(</span><span class="n">orbit_file</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Returns state vectors from an orbit file; state vectors are unique and ordered in terms of time
orbit file (str | list):   - user-passed file(s) containing statevectors
                             for the sensor (can be download with sentineleof libray). Lists of files
                             are only accepted for Sentinel-1 EOF files.
pad (int):                 - number of seconds to keep around the
                             requested time (should be about 600 seconds)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_orbit</span><span class="p">(</span><span class="n">orbit_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
              <span class="n">ref_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
              <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns state vectors from an orbit file; state vectors are unique and ordered in terms of time</span>
<span class="sd">    orbit file (str | list):   - user-passed file(s) containing statevectors</span>
<span class="sd">                                 for the sensor (can be download with sentineleof libray). Lists of files</span>
<span class="sd">                                 are only accepted for Sentinel-1 EOF files.</span>
<span class="sd">    pad (int):                 - number of seconds to keep around the</span>
<span class="sd">                                 requested time (should be about 600 seconds)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this function. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="c1"># First load the state vectors into an isce orbit</span>
    <span class="n">svs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">get_sv</span><span class="p">(</span><span class="n">orbit_file</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sv_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># format for ISCE</span>
    <span class="k">for</span> <span class="n">sv</span> <span class="ow">in</span> <span class="n">svs</span><span class="p">:</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StateVector</span><span class="p">(</span><span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">sv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">sv</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">sv_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>

    <span class="n">sv_objs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sv_objs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">sv</span><span class="p">:</span> <span class="n">sv</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
    <span class="c1"># Ensure only unique state vectors; unfortunately builtin set does not work.</span>
    <span class="n">visited_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sv_objs_filtered</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sv</span> <span class="ow">in</span> <span class="n">sv_objs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sv</span><span class="o">.</span><span class="n">datetime</span> <span class="ow">in</span> <span class="n">visited_times</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">visited_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sv</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
        <span class="n">sv_objs_filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Orbit</span><span class="p">(</span><span class="n">sv_objs_filtered</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">orb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.get_radar_pos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_radar_pos</span><span class="p">(</span><span class="n">llh</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate the coordinate of the sensor in ECEF at the time corresponding to ***.</p>
<h5 id="RAiDER.losreader.get_radar_pos--args">Args:</h5>
<p>orb: isce3.core.Orbit   - Nt x 7 matrix of statevectors: [t x y z vx vy vz]
llh: ndarray   - position of the target in LLH
out: str    - either lookangle or ecef for vector</p>
<h5 id="RAiDER.losreader.get_radar_pos--returns">Returns:</h5>
<p>los: ndarray  - Satellite incidence angle
sr:  ndarray  - Slant range in meters</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_radar_pos</span><span class="p">(</span><span class="n">llh</span><span class="p">,</span> <span class="n">orb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate the coordinate of the sensor in ECEF at the time corresponding to ***.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    orb: isce3.core.Orbit   - Nt x 7 matrix of statevectors: [t x y z vx vy vz]</span>
<span class="sd">    llh: ndarray   - position of the target in LLH</span>
<span class="sd">    out: str    - either lookangle or ecef for vector</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    los: ndarray  - Satellite incidence angle</span>
<span class="sd">    sr:  ndarray  - Slant range in meters</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this function. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="n">num_iteration</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">residual_threshold</span> <span class="o">=</span> <span class="mf">1.0e-7</span>

    <span class="c1"># Get xyz positions of targets here from lat/lon/height</span>
    <span class="n">targ_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
        <span class="n">lla2ecef</span><span class="p">(</span><span class="n">llh</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">llh</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">llh</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Get some isce3 constants for this inversion</span>
    <span class="c1"># TODO - Assuming right-looking for now</span>
    <span class="n">elp</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">()</span>
    <span class="n">dop</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LUT2d</span><span class="p">()</span>
    <span class="n">look</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Right</span>

    <span class="c1"># Iterate for each point</span>
    <span class="c1"># TODO - vectorize / parallelize</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">llh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">llh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llh</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pt</span><span class="p">)):</span>
            <span class="c1"># ISCE3 always uses xy convention</span>
            <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="c1"># Local normal vector</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="n">elp</span><span class="o">.</span><span class="n">n_vector</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Wavelength does not matter  for zero doppler</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aztime</span><span class="p">,</span> <span class="n">slant_range</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geo2rdr</span><span class="p">(</span>
                    <span class="n">inp</span><span class="p">,</span> <span class="n">elp</span><span class="p">,</span> <span class="n">orb</span><span class="p">,</span> <span class="n">dop</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="n">look</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">residual_threshold</span><span class="p">,</span>
                    <span class="n">maxiter</span><span class="o">=</span><span class="n">num_iteration</span><span class="p">,</span>
                    <span class="n">delta_range</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
                <span class="n">sat_xyz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">aztime</span><span class="p">)</span>
                <span class="n">sr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">slant_range</span>


                <span class="n">delta</span> <span class="o">=</span> <span class="n">sat_xyz</span> <span class="o">-</span> <span class="n">targ_xyz</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>

                <span class="c1"># TODO - if we only ever need cos(lookang),</span>
                <span class="c1"># skip the arccos here and cos above</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
                <span class="n">output</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">nv</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="c1"># in case nans in hgt field</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">output</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">sr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.get_sv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sv</span><span class="p">(</span><span class="n">los_file</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read an LOS file and return orbital state vectors</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>los_file</code></td>
            <td>
                  <code>(str, Path, list)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>user-passed file containing either look
                              vectors or statevectors for the sensor</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ref_time</code></td>
            <td>
                  <code>datetime</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>User-requested datetime; if not encompassed
                              by the orbit times will raise a ValueError</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pad</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>number of seconds to keep around the
                              requested time (should be about 600 seconds)</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>svs</code></td>            <td>
                  <code>list of ndarrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>the times, x/y/z positions and velocities</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>of the sensor for the given window around the reference time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Warning - if multiple orbit files are pasted the svs returned are not organized and returned in the order
with respect to the files inputted (and statevectors within them).</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sv</span><span class="p">(</span><span class="n">los_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">PosixPath</span><span class="p">],</span>
           <span class="n">ref_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
           <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read an LOS file and return orbital state vectors</span>

<span class="sd">    Args:</span>
<span class="sd">        los_file (str, Path, list):     - user-passed file containing either look</span>
<span class="sd">                                          vectors or statevectors for the sensor</span>
<span class="sd">        ref_time (datetime):            - User-requested datetime; if not encompassed</span>
<span class="sd">                                          by the orbit times will raise a ValueError</span>
<span class="sd">        pad (int):                      - number of seconds to keep around the</span>
<span class="sd">                                          requested time (should be about 600 seconds)</span>

<span class="sd">    Returns:</span>
<span class="sd">        svs (list of ndarrays): - the times, x/y/z positions and velocities</span>
<span class="sd">        of the sensor for the given window around the reference time</span>

<span class="sd">    Warning - if multiple orbit files are pasted the svs returned are not organized and returned in the order</span>
<span class="sd">    with respect to the files inputted (and statevectors within them).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">svs</span> <span class="o">=</span> <span class="n">read_txt_file</span><span class="p">(</span><span class="n">los_file</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">los_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">los_file</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">los_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">PosixPath</span><span class="p">))</span> <span class="k">else</span> <span class="n">los_file</span>
            <span class="c1"># Do not need duplicate xml files</span>
            <span class="c1"># It appears that we want to make sure that we get data from first available orbit file first in our tests</span>
            <span class="c1"># TODO: figure out why - maybe tests data occur before midnight and has to do with midnight crossing</span>
            <span class="c1"># Will need to more thoroughly test and investigate the `sorted` piece</span>
            <span class="n">los_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">los_files</span><span class="p">)))</span>

            <span class="k">def</span> <span class="nf">filter_ESA_orbit_file_p</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">filter_ESA_orbit_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">)</span>
            <span class="n">los_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_ESA_orbit_file_p</span><span class="p">,</span> <span class="n">los_files</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">los_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;There are no valid orbit files provided&#39;</span><span class="p">)</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">orb_path</span> <span class="ow">in</span> <span class="n">los_files</span><span class="p">:</span>
                <span class="n">svs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">read_ESA_Orbit_file</span><span class="p">(</span><span class="n">orb_path</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">svs</span> <span class="o">=</span> <span class="n">read_shelve</span><span class="p">(</span><span class="n">los_file</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;get_sv: I cannot parse the statevector file </span><span class="si">{</span><span class="n">los_file</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;get_sv: I cannot parse the statevector file </span><span class="si">{</span><span class="n">los_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">ref_time</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">cut_times</span><span class="p">(</span><span class="n">svs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref_time</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
        <span class="n">svs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">svs</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">svs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.inc_hd_to_enu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inc_hd_to_enu</span><span class="p">(</span><span class="n">incidence</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert incidence and heading to line-of-sight vectors from the ground to the top of
the troposphere.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>incidence</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray             - incidence angle in deg from vertical</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>heading</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray               - heading angle in deg clockwise from north</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lats/lons/heights</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray - WGS84 ellipsoidal target (ground pixel) locations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LOS</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray  - (input_shape) x 3 array of unit look vectors in local ENU</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Algorithm referenced from http://earthdef.caltech.edu/boards/4/topics/327</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inc_hd_to_enu</span><span class="p">(</span><span class="n">incidence</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert incidence and heading to line-of-sight vectors from the ground to the top of</span>
<span class="sd">    the troposphere.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidence: ndarray	       - incidence angle in deg from vertical</span>
<span class="sd">        heading: ndarray 	       - heading angle in deg clockwise from north</span>
<span class="sd">        lats/lons/heights: ndarray - WGS84 ellipsoidal target (ground pixel) locations</span>

<span class="sd">    Returns:</span>
<span class="sd">        LOS: ndarray  - (input_shape) x 3 array of unit look vectors in local ENU</span>

<span class="sd">    Algorithm referenced from http://earthdef.caltech.edu/boards/4/topics/327</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">incidence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;inc_hd_to_enu: Incidence angle cannot be less than 0&#39;</span><span class="p">)</span>

    <span class="n">east</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">incidence</span><span class="p">)</span> <span class="o">*</span> <span class="n">cosd</span><span class="p">(</span><span class="n">heading</span> <span class="o">+</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">north</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">incidence</span><span class="p">)</span> <span class="o">*</span> <span class="n">sind</span><span class="p">(</span><span class="n">heading</span> <span class="o">+</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">incidence</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">east</span><span class="p">,</span> <span class="n">north</span><span class="p">,</span> <span class="n">up</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.pick_ESA_orbit_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pick_ESA_orbit_file</span><span class="p">(</span><span class="n">list_files</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>From list of .EOF orbit files, pick the one that contains 'ref_time'</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pick_ESA_orbit_file</span><span class="p">(</span><span class="n">list_files</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">ref_time</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; From list of .EOF orbit files, pick the one that contains &#39;ref_time&#39; &quot;&quot;&quot;</span>
    <span class="n">orb_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
        <span class="n">f</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.EOF&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t0</span> <span class="o">&lt;</span> <span class="n">ref_time</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">orb_file</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">break</span>

    <span class="k">assert</span> <span class="n">orb_file</span><span class="p">,</span> <span class="s1">&#39;Given orbit files did not match given date/time&#39;</span>

    <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.read_ESA_Orbit_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_ESA_Orbit_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read orbit data from an orbit file supplied by ESA</p>
<h5 id="RAiDER.losreader.read_ESA_Orbit_file--args">Args:</h5>
<p>filename: str             - string of the orbit filename</p>
<h5 id="RAiDER.losreader.read_ESA_Orbit_file--returns">Returns:</h5>
<p>t: Nt x 1 ndarray   - a numpy vector with Nt elements containing time
                      in python datetime
x, y, z: Nt x 1 ndarrays    - x/y/z positions of the sensor at the times t
vx, vy, vz: Nt x 1 ndarrays - x/y/z velocities of the sensor at the times t</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_ESA_Orbit_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read orbit data from an orbit file supplied by ESA</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    filename: str             - string of the orbit filename</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    t: Nt x 1 ndarray   - a numpy vector with Nt elements containing time</span>
<span class="sd">                          in python datetime</span>
<span class="sd">    x, y, z: Nt x 1 ndarrays    - x/y/z positions of the sensor at the times t</span>
<span class="sd">    vx, vy, vz: Nt x 1 ndarrays - x/y/z velocities of the sensor at the times t</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ET</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;read_ESA_Orbit_file: cannot import xml.etree.ElementTree&#39;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">data_block</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">numOSV</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numOSV</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="s1">&#39;UTC=%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">vx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">vy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">vz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.read_txt_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_txt_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read a 7-column text file containing orbit statevectors. Time
should be denoted as integer time in seconds since the reference
epoch (user-requested time).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>user-supplied space-delimited text file with no header
            containing orbital statevectors as 7 columns:
            - time in seconds since the user-supplied epoch
            - x / y / z locations in ECEF cartesian coordinates
            - vx / vy / vz velocities in m/s in ECEF coordinates</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns:
    svs (list):     - a length-7 list of numpy vectors containing the above
                    variables</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_txt_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read a 7-column text file containing orbit statevectors. Time</span>
<span class="sd">    should be denoted as integer time in seconds since the reference</span>
<span class="sd">    epoch (user-requested time).</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): - user-supplied space-delimited text file with no header</span>
<span class="sd">                        containing orbital statevectors as 7 columns:</span>
<span class="sd">                        - time in seconds since the user-supplied epoch</span>
<span class="sd">                        - x / y / z locations in ECEF cartesian coordinates</span>
<span class="sd">                        - vx / vy / vz velocities in m/s in ECEF coordinates</span>
<span class="sd">    Returns:</span>
<span class="sd">        svs (list):     - a length-7 list of numpy vectors containing the above</span>
<span class="sd">                        variables</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">t_</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">z_</span><span class="p">,</span> <span class="n">vx_</span><span class="p">,</span> <span class="n">vy_</span><span class="p">,</span> <span class="n">vz_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;I need </span><span class="si">{}</span><span class="s2"> to be a 7 column text file, with &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot;columns t, x, y, z, vx, vy, vz (Couldn&#39;t parse line &quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">)</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_</span><span class="p">)</span>
            <span class="n">vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vx_</span><span class="p">)</span>
            <span class="n">vy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vy_</span><span class="p">)</span>
            <span class="n">vz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vz_</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;read_txt_file: File </span><span class="si">{}</span><span class="s1"> does not have enough statevectors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.losreader.state_to_los" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">state_to_los</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span> <span class="n">llh_targets</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Converts information from a state vector for a satellite orbit, given in terms of
position and velocity, to line-of-sight information at each (lon,lat, height)
coordinate requested by the user.
Args:</p>
<hr />
<p>svs            - t, x, y, z, vx, vy, vz - time, position, and velocity in ECEF of the sensor
llh_targets    - lats, lons, heights - Ellipsoidal (WGS84) positions of target ground pixels</p>
<h5 id="RAiDER.losreader.state_to_los--returns">Returns:</h5>
<p>LOS                         - * x 3 matrix of LOS unit vectors in ECEF (<em>not</em> ENU)
Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import datetime
import numpy
from RAiDER.utilFcns import rio_open
import RAiDER.losreader as losr
lats, lons, heights = np.array([-76.1]), np.array([36.83]), np.array([0])
time = datetime.datetime(2018,11,12,23,0,0)</p>
<h4 id="RAiDER.losreader.state_to_los--download-the-orbit-file-beforehand">download the orbit file beforehand</h4>
<p>esa_orbit_file = 'S1A_OPER_AUX_POEORB_OPOD_20181203T120749_V20181112T225942_20181114T005942.EOF'
svs = losr.read_ESA_Orbit_file(esa_orbit_file)
LOS = losr.state_to_los(*svs, [lats, lons, heights], xyz)</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/losreader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">state_to_los</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span> <span class="n">llh_targets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts information from a state vector for a satellite orbit, given in terms of</span>
<span class="sd">    position and velocity, to line-of-sight information at each (lon,lat, height)</span>
<span class="sd">    coordinate requested by the user.</span>
<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    svs            - t, x, y, z, vx, vy, vz - time, position, and velocity in ECEF of the sensor</span>
<span class="sd">    llh_targets    - lats, lons, heights - Ellipsoidal (WGS84) positions of target ground pixels</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    LOS 			- * x 3 matrix of LOS unit vectors in ECEF (*not* ENU)</span>
<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import datetime</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.utilFcns import rio_open</span>
<span class="sd">    &gt;&gt;&gt; import RAiDER.losreader as losr</span>
<span class="sd">    &gt;&gt;&gt; lats, lons, heights = np.array([-76.1]), np.array([36.83]), np.array([0])</span>
<span class="sd">    &gt;&gt;&gt; time = datetime.datetime(2018,11,12,23,0,0)</span>
<span class="sd">    &gt;&gt;&gt; # download the orbit file beforehand</span>
<span class="sd">    &gt;&gt;&gt; esa_orbit_file = &#39;S1A_OPER_AUX_POEORB_OPOD_20181203T120749_V20181112T225942_20181114T005942.EOF&#39;</span>
<span class="sd">    &gt;&gt;&gt; svs = losr.read_ESA_Orbit_file(esa_orbit_file)</span>
<span class="sd">    &gt;&gt;&gt; LOS = losr.state_to_los(*svs, [lats, lons, heights], xyz)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isce3 is required for this function. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="c1"># check the inputs</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">svs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;state_to_los: At least 4 state vectors are required&#39;</span>
            <span class="s1">&#39; for orbit interpolation&#39;</span>
        <span class="p">)</span>

    <span class="c1"># Convert svs to isce3 orbit</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Orbit</span><span class="p">([</span>
        <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StateVector</span><span class="p">(</span>
            <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">svs</span>
    <span class="p">])</span>

    <span class="c1"># Flatten the input array for convenience</span>
    <span class="n">in_shape</span>   <span class="o">=</span> <span class="n">llh_targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">target_llh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">llh_targets</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Npts</span>       <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_llh</span><span class="p">)</span>

    <span class="c1"># Iterate through targets and compute LOS</span>
    <span class="n">los_ang</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_radar_pos</span><span class="p">(</span><span class="n">target_llh</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span>
    <span class="n">los_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">los_ang</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">in_shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">los_factor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.makePoints" class="doc doc-heading">
            <code>makePoints</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.makePoints.__file__" class="doc doc-heading">
            <code class="highlight language-python"><span class="vm">__file__</span> <span class="o">=</span> <span class="s1">&#39;/home/runner/micromamba-root/envs/RAiDER/lib/python3.10/site-packages/RAiDER/makePoints.cpython-310-x86_64-linux-gnu.so&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.makePoints.__name__" class="doc doc-heading">
            <code class="highlight language-python"><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;RAiDER.makePoints&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.makePoints.__package__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__package__</span> <span class="o">=</span> <span class="s1">&#39;RAiDER&#39;</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="RAiDER.makePoints.__test__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__test__</span> <span class="o">=</span> <span class="p">{}</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>dict() -&gt; new empty dictionary
dict(mapping) -&gt; new dictionary initialized from a mapping object's
    (key, value) pairs
dict(iterable) -&gt; new dictionary initialized as if via:
    d = {}
    for k, v in iterable:
        d[k] = v
dict(**kwargs) -&gt; new dictionary initialized with the name=value pairs
    in the keyword argument list.  For example:  dict(one=1, two=2)</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="RAiDER.makePoints.makePoints0D" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makePoints0D</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">Rays_SP</span><span class="p">,</span> <span class="n">Rays_SLV</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-method descriptor"><code>method descriptor</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Fast cython code to create the rays needed for ray-tracing. 
Inputs: 
  max_len: maximum length of the rays
  Rays_SP: 1 x 3 numpy array of the location of the ground pixels in an earth-centered, 
           earth-fixed coordinate system
  Rays_SLV: 1 x 3 numpy array of the look vectors pointing from the ground pixel to the sensor
  stepSize: Distance between points along the ray-path
Output:
  ray: a 3 x Npts array containing the rays tracing a path from the ground pixels, along the 
       line-of-sight vectors, up to the maximum length specified.</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.makePoints.makePoints1D" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makePoints1D</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">Rays_SP</span><span class="p">,</span> <span class="n">Rays_SLV</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-method descriptor"><code>method descriptor</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Fast cython code to create the rays needed for ray-tracing. 
Inputs: 
  max_len: maximum length of the rays
  Rays_SP: Nx x 3 numpy array of the location of the ground pixels in an earth-centered, 
           earth-fixed coordinate system
  Rays_SLV: Nx x 3 numpy array of the look vectors pointing from the ground pixel to the sensor
  stepSize: Distance between points along the ray-path
Output:
  ray: a Nx x 3 x Npts array containing the rays tracing a path from the ground pixels, along the 
       line-of-sight vectors, up to the maximum length specified.</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.makePoints.makePoints2D" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makePoints2D</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">Rays_SP</span><span class="p">,</span> <span class="n">Rays_SLV</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-method descriptor"><code>method descriptor</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Fast cython code to create the rays needed for ray-tracing. 
Inputs: 
  max_len: maximum length of the rays
  Rays_SP: Nx x Ny x 3 numpy array of the location of the ground pixels in an earth-centered, 
           earth-fixed coordinate system
  Rays_SLV: Nx x Ny x 3 numpy array of the look vectors pointing from the ground pixel to the sensor
  stepSize: Distance between points along the ray-path
Output:
  ray: a Nx x Ny x 3 x Npts array containing the rays tracing a path from the ground pixels, along the 
       line-of-sight vectors, up to the maximum length specified.</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.makePoints.makePoints3D" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makePoints3D</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">Rays_SP</span><span class="p">,</span> <span class="n">Rays_SLV</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-method descriptor"><code>method descriptor</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Fast cython code to create the rays needed for ray-tracing
Inputs: 
  max_len: maximum length of the rays
  Rays_SP: Nx x Ny x Nz x 3 numpy array of the location of the ground pixels in an earth-centered, 
           earth-fixed coordinate system
  Rays_SLV: Nx x Ny x Nz x 3 numpy array of the look vectors pointing from the ground pixel to the sensor
  stepSize: Distance between points along the ray-path
Output:
  ray: a Nx x Ny x Nz x 3 x Npts array containing the rays tracing a path from the ground pixels, along the 
       line-of-sight vectors, up to the maximum length specified.</p>

    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.models" class="doc doc-heading">
            <code>models</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="RAiDER.models.ERA5" class="doc doc-heading">
            <code>ERA5</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.ecmwf.ECMWF" href="#RAiDER.models.ecmwf.ECMWF">ECMWF</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/era5.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ERA5</span><span class="p">(</span><span class="n">ECMWF</span><span class="p">):</span>
    <span class="c1"># I took this from</span>
    <span class="c1"># https://www.ecmwf.int/en/forecasts/documentation-and-support/137-model-levels.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ECMWF</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;ea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;era5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;ERA-5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="n">lag_time</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># months</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">lag_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
            <span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>
        <span class="p">)</span>

        <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">lag_time</span><span class="p">)</span>

        <span class="c1"># Default, need to change to ml</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch a weather model from ECMWF</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="c1"># execute the search at ECMWF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_from_cds</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Load either pressure or model level data&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="si">}</span><span class="s1"> is not a valid model type&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.ERA5.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Load either pressure or model level data</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Load either pressure or model level data&#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="si">}</span><span class="s1"> is not a valid model type&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.models.GMAO" class="doc doc-heading">
            <code>GMAO</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/gmao.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GMAO</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="c1"># I took this from GMAO model level weblink</span>
    <span class="c1"># https://opendap.nccs.nasa.gov/dods/GEOS-5/fp/0.25_deg/assim/inst3_3d_asm_Nv</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;gmao&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;gmao&#39;</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mf">24.0</span><span class="p">)</span>  <span class="c1"># Availability lag time in hours</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>


        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">0.3125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">0.3125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">0.25</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;GMAO&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from GMAO</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">acqTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="c1"># calculate the array indices for slicing the GMAO variable arrays</span>
        <span class="n">lat_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lat_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>

        <span class="n">T0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># round time to nearest third hour</span>
        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">round_date</span><span class="p">(</span><span class="n">acqTime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="n">acqTime</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">acqTime</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="n">DT</span> <span class="o">=</span> <span class="n">corrected_DT</span> <span class="o">-</span> <span class="n">T0</span>
        <span class="n">time_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DT</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">)</span>

        <span class="n">ml_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ml_max</span> <span class="o">=</span> <span class="mi">71</span>
        <span class="k">if</span> <span class="n">corrected_DT</span> <span class="o">&gt;=</span> <span class="n">T0</span><span class="p">:</span>
            <span class="c1"># open the dataset and pull the data</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://opendap.nccs.nasa.gov/dods/GEOS-5/fp/0.25_deg/assim/inst3_3d_asm_Nv&#39;</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">cas</span><span class="o">.</span><span class="n">urs</span><span class="o">.</span><span class="n">setup_session</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">check_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
            <span class="n">qv</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;qv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;https://portal.nccs.nasa.gov/datashare/gmao/geos-fp/das/Y</span><span class="si">{}</span><span class="s1">/M</span><span class="si">{:02d}</span><span class="s1">/D</span><span class="si">{:02d}</span><span class="s1">&#39;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;GEOS.fp.asm.inst3_3d_asm_Nv.</span><span class="si">{</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">00.V01.nc4&#39;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_raw</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fetching URL: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="n">session</span> <span class="o">=</span> <span class="n">requests_retry_session</span><span class="p">()</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Could not access url for datetime: </span><span class="si">{</span><span class="n">corrected_DT</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="n">fh</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Weather model already exists, skipping download&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">lat_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="p">(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span>
        <span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">lon_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="p">(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Note that lat/lon gets written twice for GMAO because they are the same as y/x</span>
            <span class="n">writeWeatherVarsXarray</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">NoDataValue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">144</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unable to save weathermodel to file&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_load_model_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the variables from the GMAO link using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># adding the import here should become absolute when transition to netcdf</span>
        <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:])</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][:])</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][:])</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][:])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][:])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:])</span>

        <span class="c1"># restructure the 1-D lat/lon in regular 2D grid</span>
        <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="c1"># check this</span>
        <span class="c1"># data cube format should be lats,lons,heights</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># For some reason z is opposite the others</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># assign the regular-grid (lat/lon/h) variables</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.GMAO.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/gmao.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.models.HRES" class="doc doc-heading">
            <code>HRES</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.ecmwf.ECMWF" href="#RAiDER.models.ecmwf.ECMWF">ECMWF</a></code></p>


      <p>Implement ECMWF models</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/hres.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HRES</span><span class="p">(</span><span class="n">ECMWF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement ECMWF models</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level_type</span><span class="o">=</span><span class="s1">&#39;ml&#39;</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>


        <span class="c1"># 9 km horizontal grid spacing. This is only used for extending the download-buffer, i.e. not in subsequent processing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;od&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;hres&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;HRES&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1983</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_a_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Before 2013-06-26, there were only 91 model levels. The mapping coefficients below are extracted</span>
        <span class="c1"># based on https://www.ecmwf.int/en/forecasts/documentation-and-support/91-model-levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_91_HEIGHTS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A_91_HRES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">B_91_HRES</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch a weather model from ECMWF</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>

        <span class="c1"># execute the search at ECMWF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_ecmwf</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.HRES.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hres.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.models.HRRR" class="doc doc-heading">
            <code>HRRR</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HRRR</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;pl&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;hrrr&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;hrrr&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Availability lag time in days</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># 3 km horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">3.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">3.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Nproc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;HRRR&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Npl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="c1"># NOTE: The HRRR projection will get read directly from the downloaded weather model file; however,</span>
        <span class="c1"># we also define it here so that the projection can be used without downloading any data. This is</span>
        <span class="c1"># used for consistency with the other weather models and allows for some nice features, such as</span>
        <span class="c1"># buffering.</span>

        <span class="c1"># See https://github.com/blaylockbk/pyBKB_v2/blob/master/demos/HRRR_earthRelative_vs_gridRelative_winds.ipynb and code lower down</span>
        <span class="c1"># &#39;262.5:38.5:38.5:38.5 237.280472:1799:3000.00 21.138123:1059:3000.00&#39;</span>
        <span class="c1"># &#39;lov:latin1:latin2:latd lon1:nx:dx lat1:ny:dy&#39;</span>
        <span class="c1"># LCC parameters</span>
        <span class="n">lon0</span> <span class="o">=</span> <span class="mf">262.5</span>
        <span class="n">lat0</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">earth_radius</span> <span class="o">=</span> <span class="mi">6371229</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+proj=lcc +lat_1=</span><span class="si">{</span><span class="n">lat1</span><span class="si">}</span><span class="s1"> +lat_2=</span><span class="si">{</span><span class="n">lat2</span><span class="si">}</span><span class="s1"> +lat_0=</span><span class="si">{</span><span class="n">lat0</span><span class="si">}</span><span class="s1"> &#39;</span>\
                 <span class="sa">f</span><span class="s1">&#39;+lon_0=</span><span class="si">{</span><span class="n">lon0</span><span class="si">}</span><span class="s1"> +x_0=</span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1"> +y_0=</span><span class="si">{</span><span class="n">y0</span><span class="si">}</span><span class="s1"> +a=</span><span class="si">{</span><span class="n">earth_radius</span><span class="si">}</span><span class="s1"> &#39;</span>\
                 <span class="sa">f</span><span class="s1">&#39;+b=</span><span class="si">{</span><span class="n">earth_radius</span><span class="si">}</span><span class="s1"> +units=m +no_defs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span> <span class="o">=</span> <span class="n">HRRR_CONUS_COVERAGE_POLYGON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;nat&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__model_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span>  <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_50_HEIGHTS</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__pressure_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Pressure levels do not go high enough for HRRR.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from HRRR</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">out</span>
        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">round_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkTime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="c1"># HRRR uses 0-360 longitude, so we need to convert the bounds to that</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">360</span><span class="p">)</span>

        <span class="n">download_hrrr_file</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;hrrr&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load a weather model into a python weatherModel object, from self.files if no</span>
<span class="sd">        filename is passed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span>


        <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">temps</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="n">load_weather_hrrr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># convert geopotential height to geometric height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">_lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">temps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">pres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_ys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">proj</span>


    <span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">WeatherModel</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks whether the given bounding box is valid for the HRRR or HRRRAK</span>
<span class="sd">        (i.e., intersects with the model domain at all)</span>

<span class="sd">        Args:</span>
<span class="sd">        ll_bounds : np.ndarray</span>

<span class="sd">        Returns:</span>
<span class="sd">            The weather model object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
        <span class="n">aoi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="n">HRRRAK</span><span class="p">()</span>
            <span class="c1"># valid bounds are in 0-&gt;360 to account for dateline crossing</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">aoi</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR-AK weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The requested location is unavailable for HRRR&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Mod</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.HRRR.checkValidBounds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkValidBounds</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Checks whether the given bounding box is valid for the HRRR or HRRRAK
(i.e., intersects with the model domain at all)</p>
<p>Args:
ll_bounds : np.ndarray</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weather model object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">WeatherModel</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the given bounding box is valid for the HRRR or HRRRAK</span>
<span class="sd">    (i.e., intersects with the model domain at all)</span>

<span class="sd">    Args:</span>
<span class="sd">    ll_bounds : np.ndarray</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weather model object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
    <span class="n">aoi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="n">HRRRAK</span><span class="p">()</span>
        <span class="c1"># valid bounds are in 0-&gt;360 to account for dateline crossing</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">aoi</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR-AK weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The requested location is unavailable for HRRR&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Mod</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.HRRR.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Load a weather model into a python weatherModel object, from self.files if no
filename is passed.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load a weather model into a python weatherModel object, from self.files if no</span>
<span class="sd">    filename is passed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span>


    <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">temps</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="n">load_weather_hrrr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># convert geopotential height to geometric height</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">_lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">temps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">qs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">pres</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_xs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_ys</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">proj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="RAiDER.models.MERRA2" class="doc doc-heading">
            <code>MERRA2</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/merra2.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MERRA2</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">import</span> <span class="nn">calendar</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;merra2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;merra2&#39;</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">utcnow</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">enddate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">enddate</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="n">lag_time</span> <span class="o">=</span> <span class="n">utcnow</span> <span class="o">-</span> <span class="n">enddate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">lag_time</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>  <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">0.625</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">0.625</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;MERRA2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="c1"># Projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from GMAO: note we only extract the lat/lon bounds for this weather model; fetching data is not needed here as we don&#39;t actually download any data using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> 

        <span class="c1"># check whether the file already exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># calculate the array indices for slicing the GMAO variable arrays</span>
        <span class="n">lat_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lat_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">lat_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="p">(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span>
        <span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">lon_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="p">(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>
        <span class="p">)</span>

        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1992</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2001</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">elif</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2011</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">400</span>

        <span class="c1"># Earthdata credentials</span>
        <span class="n">earthdata_usr</span><span class="p">,</span> <span class="n">earthdata_pwd</span> <span class="o">=</span> <span class="n">read_EarthData_loginInfo</span><span class="p">(</span><span class="n">EARTHDATA_RC</span><span class="p">)</span>

        <span class="c1"># open the dataset and pull the data</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://goldsmr5.gesdisc.eosdis.nasa.gov/opendap/MERRA2/M2T3NVASM.5.12.4/&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/MERRA2_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_sub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tavg3_3d_asm_Nv.&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.nc4&#39;</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">cas</span><span class="o">.</span><span class="n">urs</span><span class="o">.</span><span class="n">setup_session</span><span class="p">(</span><span class="n">earthdata_usr</span><span class="p">,</span> <span class="n">earthdata_pwd</span><span class="p">,</span> <span class="n">check_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">writeWeatherVarsXarray</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;MERRA-2: Unable to save weathermodel to file&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;MERRA-2 failed with the following error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_model_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the variables from the GMAO link using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># adding the import here should become absolute when transition to netcdf</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="c1"># check this</span>
        <span class="c1"># data cube format should be lats,lons,heights</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># For some reason z is opposite the others</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># assign the regular-grid (lat/lon/h) variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.MERRA2.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/merra2.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.credentials" class="doc doc-heading">
            <code>credentials</code>


</h3>

    <div class="doc doc-contents ">

      <p>API credential information and help url for downloading weather model data
    saved in a hidden file in home directory</p>
<p>api filename      weather models          UID           KEY         URL</p>
<hr />
<p>cdsapirc          ERA5, ERA5T             uid           key         https://cds.climate.copernicus.eu/api/v2
ecmwfapirc        HRES                    email         key         https://api.ecmwf.int/v1
netrc             GMAO, MERRA2            username      password    urs.earthdata.nasa.gov
<N/A>             HRRR [public access]    <N/A>         <N/A>       <N/A></p>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.ecmwf" class="doc doc-heading">
            <code>ecmwf</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.ecmwf.ECMWF" class="doc doc-heading">
            <code>ECMWF</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


      <p>Implement ECMWF models</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/ecmwf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ECMWF</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement ECMWF models</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="s1">&#39;ECMWF&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>  <span class="c1"># Default</span>


    <span class="k">def</span> <span class="nf">__pressure_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_25_HEIGHTS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__model_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span>  <span class="o">=</span> <span class="mi">137</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A_137_HRES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">B_137_HRES</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_load_model_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="c1"># read data from netcdf file</span>
        <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">lnsp</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeDataCubes</span><span class="p">(</span>
            <span class="n">fname</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># ECMWF appears to give me this backwards</span>
        <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lats</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lnsp</span> <span class="o">=</span> <span class="n">lnsp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Lons is usually ok, but we&#39;ll throw in a check to be safe</span>
        <span class="k">if</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lnsp</span> <span class="o">=</span> <span class="n">lnsp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># pyproj gets fussy if the latitude is wrong, plus our</span>
        <span class="c1"># interpolator isn&#39;t clever enough to pick up on the fact that</span>
        <span class="c1"># they are the same</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">hgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculategeoh</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">lnsp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="c1"># ys is latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="n">hgt</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># We want to support both pressure levels and true pressure grids.</span>
        <span class="c1"># If the shape has one dimension, we&#39;ll scale it up to act as a</span>
        <span class="c1"># grid, otherwise we&#39;ll leave it alone.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pres</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">pres</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">pres</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Flip all the axis so that zs are in order from bottom to top</span>
        <span class="c1"># lats / lons are simply replicated to all heights so they don&#39;t need flipped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch a weather model from ECMWF</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>

        <span class="c1"># execute the search at ECMWF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_from_ecmwf</span><span class="p">(</span>
            <span class="n">lat_min</span><span class="p">,</span>
            <span class="n">lat_max</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span>
            <span class="n">lon_min</span><span class="p">,</span>
            <span class="n">lon_max</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span>
            <span class="n">out</span>
        <span class="p">)</span>
        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">_get_from_ecmwf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lat_step</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span>
                        <span class="n">lon_step</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">ecmwfapi</span>

        <span class="n">server</span> <span class="o">=</span> <span class="n">ecmwfapi</span><span class="o">.</span><span class="n">ECMWFDataServer</span><span class="p">()</span>

        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">round_date</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="n">server</span><span class="o">.</span><span class="n">retrieve</span><span class="p">({</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span><span class="p">,</span>  <span class="c1"># ERA-Interim</span>
            <span class="s1">&#39;dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span>
            <span class="s2">&quot;expver&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expver</span><span class="p">),</span>
            <span class="c1"># They warn me against all, but it works well</span>
            <span class="s2">&quot;levelist&quot;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
            <span class="s2">&quot;levtype&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>  <span class="c1"># Model levels</span>
            <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;lnsp/q/z/t&quot;</span><span class="p">,</span>  <span class="c1"># Necessary variables</span>
            <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;oper&quot;</span><span class="p">,</span>
            <span class="c1"># date: Specify a single date as &quot;2015-08-01&quot; or a period as</span>
            <span class="c1"># &quot;2015-08-01/to/2015-08-31&quot;.</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="c1"># type: Use an (analysis) unless you have a particular reason to</span>
            <span class="c1"># use fc (forecast).</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span>
            <span class="c1"># time: With type=an, time can be any of</span>
            <span class="c1"># &quot;00:00:00/06:00:00/12:00:00/18:00:00&quot;.  With type=fc, time can</span>
            <span class="c1"># be any of &quot;00:00:00/12:00:00&quot;,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">),</span>
            <span class="c1"># step: With type=an, step is always &quot;0&quot;. With type=fc, step can</span>
            <span class="c1"># be any of &quot;3/6/9/12&quot;.</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="c1"># grid: Only regular lat/lon grids are supported.</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat_step</span><span class="p">,</span> <span class="n">lon_step</span><span class="p">),</span>
            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span>  <span class="c1"># area: N/W/S/E</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resol&quot;</span><span class="p">:</span> <span class="s2">&quot;av&quot;</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">out</span><span class="p">,</span>    <span class="c1"># target: the name of the output file.</span>
        <span class="p">})</span>


    <span class="k">def</span> <span class="nf">_get_from_cds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lat_min</span><span class="p">,</span>
        <span class="n">lat_max</span><span class="p">,</span>
        <span class="n">lon_min</span><span class="p">,</span>
        <span class="n">lon_max</span><span class="p">,</span>
        <span class="n">acqTime</span><span class="p">,</span>
        <span class="n">outname</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Used for ERA5 &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">cdsapi</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">verify</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span>
            <span class="n">levType</span> <span class="o">=</span> <span class="s1">&#39;pressure_level&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;129/130/133/152&quot;</span>  <span class="c1"># &#39;lnsp&#39;, &#39;q&#39;, &#39;z&#39;, &#39;t&#39;</span>
            <span class="n">levType</span> <span class="o">=</span> <span class="s1">&#39;model_level&#39;</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">]</span>

        <span class="c1"># round to the closest legal time</span>

        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">round_date</span><span class="p">(</span><span class="n">acqTime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="n">acqTime</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">acqTime</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>


        <span class="c1"># I referenced https://confluence.ecmwf.int/display/CKB/How+to+download+ERA5</span>
        <span class="n">dataDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;ea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;expver&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;levelist&quot;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
            <span class="s2">&quot;levtype&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="p">),</span>  <span class="c1"># &#39;ml&#39; for model levels or &#39;pl&#39; for pressure levels</span>
            <span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span>
            <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;oper&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)),</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;%H:%M&#39;</span><span class="p">)),</span>
            <span class="c1"># step: With type=an, step is always &quot;0&quot;. With type=fc, step can</span>
            <span class="c1"># be any of &quot;3/6/9/12&quot;.</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">.25</span><span class="p">],</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s1">&#39;reanalysis-era5-complete&#39;</span><span class="p">,</span> <span class="n">dataDict</span><span class="p">,</span> <span class="n">outname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span>


    <span class="k">def</span> <span class="nf">_download_ecmwf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lat_step</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lon_step</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Used for HRES &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ecmwfapi</span> <span class="kn">import</span> <span class="n">ECMWFService</span>

        <span class="n">server</span> <span class="o">=</span> <span class="n">ECMWFService</span><span class="p">(</span><span class="s2">&quot;mars&quot;</span><span class="p">)</span>

        <span class="c1"># round to the closest legal time</span>
        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">round_date</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;129/130/133/152&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;129.128/130.128/133.128/152&quot;</span>

        <span class="n">server</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span><span class="p">,</span>
                <span class="s1">&#39;dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span>
                <span class="s1">&#39;expver&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expver</span><span class="p">),</span>
                <span class="s1">&#39;resol&#39;</span><span class="p">:</span> <span class="s2">&quot;av&quot;</span><span class="p">,</span>
                <span class="s1">&#39;stream&#39;</span><span class="p">:</span> <span class="s2">&quot;oper&quot;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span>
                <span class="s1">&#39;levelist&#39;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
                <span class="s1">&#39;levtype&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="p">),</span>
                <span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="n">param</span><span class="p">,</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;%H:%M&#39;</span><span class="p">)),</span>
                <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lon_step</span><span class="p">,</span> <span class="n">lat_step</span><span class="p">),</span>
                <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">floorish</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">util</span><span class="o">.</span><span class="n">floorish</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">lon_max</span><span class="p">),</span>
                <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">out</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_load_pressure_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">block</span><span class="p">:</span>
            <span class="c1"># Pull the data</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># ECMWF appears to give me this backwards</span>
        <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lats</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Lons is usually ok, but we&#39;ll throw in a check to be safe</span>
        <span class="k">if</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># pyproj gets fussy if the latitude is wrong, plus our</span>
        <span class="c1"># interpolator isn&#39;t clever enough to pick up on the fact that</span>
        <span class="c1"># they are the same</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>

        <span class="n">geo_hgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># re-assign lons, lats to match heights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="c1"># correct heights for latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Re-structure from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># flip z to go from surface to toa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_makeDataCubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a cube of data representing temperature and relative humidity</span>
<span class="sd">        at specified pressure levels</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># get ll_bounds</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>

        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="p">(((</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span>

            <span class="c1"># mask based on query bounds</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span> <span class="o">&lt;=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">m1</span> <span class="o">&amp;</span> <span class="n">m2</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Pull the data</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">lnsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;lnsp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="n">xs</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;There is no data in z, &#39;</span>
                               <span class="s1">&#39;you may have a problem with your mask&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">lnsp</span><span class="p">,</span> <span class="n">z</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.ecmwf.ECMWF.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/ecmwf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.era5" class="doc doc-heading">
            <code>era5</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.era5.ERA5" class="doc doc-heading">
            <code>ERA5</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.ecmwf.ECMWF" href="#RAiDER.models.ecmwf.ECMWF">ECMWF</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/era5.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ERA5</span><span class="p">(</span><span class="n">ECMWF</span><span class="p">):</span>
    <span class="c1"># I took this from</span>
    <span class="c1"># https://www.ecmwf.int/en/forecasts/documentation-and-support/137-model-levels.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ECMWF</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;ea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;era5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;ERA-5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="n">lag_time</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># months</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">lag_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
            <span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>
        <span class="p">)</span>

        <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">lag_time</span><span class="p">)</span>

        <span class="c1"># Default, need to change to ml</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch a weather model from ECMWF</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="c1"># execute the search at ECMWF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_from_cds</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Load either pressure or model level data&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="si">}</span><span class="s1"> is not a valid model type&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.era5.ERA5.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Load either pressure or model level data</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Load either pressure or model level data&#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="si">}</span><span class="s1"> is not a valid model type&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.era5t" class="doc doc-heading">
            <code>era5t</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.erai" class="doc doc-heading">
            <code>erai</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.generateGACOSVRT" class="doc doc-heading">
            <code>generateGACOSVRT</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.generateGACOSVRT.convertAllFiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convertAllFiles</span><span class="p">(</span><span class="n">dirLoc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>convert all RSC files to VRT files contained in dirLoc</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/generateGACOSVRT.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convertAllFiles</span><span class="p">(</span><span class="n">dirLoc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    convert all RSC files to VRT files contained in dirLoc</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.rsc&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">makeVRT</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.generateGACOSVRT.makeVRT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">makeVRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;Float32&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Use an RSC file to create a GDAL-compatible VRT file for opening GACOS weather model files</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/generateGACOSVRT.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">makeVRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;Float32&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use an RSC file to create a GDAL-compatible VRT file for opening GACOS weather model files</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">readRSC</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">vrtStr</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;X_FIRST&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Y_FIRST&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;X_STEP&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Y_STEP&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.rsc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">writeStringToFile</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.rsc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ztd&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.generateGACOSVRT.writeStringToFile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">writeStringToFile</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Write a string to a VRT file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/generateGACOSVRT.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">writeStringToFile</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Write a string to a VRT file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.gmao" class="doc doc-heading">
            <code>gmao</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.gmao.GMAO" class="doc doc-heading">
            <code>GMAO</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/gmao.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GMAO</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="c1"># I took this from GMAO model level weblink</span>
    <span class="c1"># https://opendap.nccs.nasa.gov/dods/GEOS-5/fp/0.25_deg/assim/inst3_3d_asm_Nv</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;gmao&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;gmao&#39;</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mf">24.0</span><span class="p">)</span>  <span class="c1"># Availability lag time in hours</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>


        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">0.3125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">0.3125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">0.25</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;GMAO&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from GMAO</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">acqTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="c1"># calculate the array indices for slicing the GMAO variable arrays</span>
        <span class="n">lat_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lat_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>

        <span class="n">T0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># round time to nearest third hour</span>
        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">round_date</span><span class="p">(</span><span class="n">acqTime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="n">acqTime</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">acqTime</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="n">DT</span> <span class="o">=</span> <span class="n">corrected_DT</span> <span class="o">-</span> <span class="n">T0</span>
        <span class="n">time_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DT</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">)</span>

        <span class="n">ml_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ml_max</span> <span class="o">=</span> <span class="mi">71</span>
        <span class="k">if</span> <span class="n">corrected_DT</span> <span class="o">&gt;=</span> <span class="n">T0</span><span class="p">:</span>
            <span class="c1"># open the dataset and pull the data</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://opendap.nccs.nasa.gov/dods/GEOS-5/fp/0.25_deg/assim/inst3_3d_asm_Nv&#39;</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">cas</span><span class="o">.</span><span class="n">urs</span><span class="o">.</span><span class="n">setup_session</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">check_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
            <span class="n">qv</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;qv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">[</span>
                <span class="n">time_ind</span><span class="p">,</span>
                <span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;https://portal.nccs.nasa.gov/datashare/gmao/geos-fp/das/Y</span><span class="si">{}</span><span class="s1">/M</span><span class="si">{:02d}</span><span class="s1">/D</span><span class="si">{:02d}</span><span class="s1">&#39;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;GEOS.fp.asm.inst3_3d_asm_Nv.</span><span class="si">{</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">00.V01.nc4&#39;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">corrected_DT</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_raw</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fetching URL: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="n">session</span> <span class="o">=</span> <span class="n">requests_retry_session</span><span class="p">()</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Could not access url for datetime: </span><span class="si">{</span><span class="n">corrected_DT</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="n">fh</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Weather model already exists, skipping download&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">lat_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="p">(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span>
        <span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">lon_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="p">(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Note that lat/lon gets written twice for GMAO because they are the same as y/x</span>
            <span class="n">writeWeatherVarsXarray</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">NoDataValue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">144</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unable to save weathermodel to file&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_load_model_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the variables from the GMAO link using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># adding the import here should become absolute when transition to netcdf</span>
        <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:])</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][:])</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][:])</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][:])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][:])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:])</span>

        <span class="c1"># restructure the 1-D lat/lon in regular 2D grid</span>
        <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="c1"># check this</span>
        <span class="c1"># data cube format should be lats,lons,heights</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># For some reason z is opposite the others</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># assign the regular-grid (lat/lon/h) variables</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.gmao.GMAO.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/gmao.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.hres" class="doc doc-heading">
            <code>hres</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.hres.HRES" class="doc doc-heading">
            <code>HRES</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.ecmwf.ECMWF" href="#RAiDER.models.ecmwf.ECMWF">ECMWF</a></code></p>


      <p>Implement ECMWF models</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/hres.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HRES</span><span class="p">(</span><span class="n">ECMWF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement ECMWF models</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level_type</span><span class="o">=</span><span class="s1">&#39;ml&#39;</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>


        <span class="c1"># 9 km horizontal grid spacing. This is only used for extending the download-buffer, i.e. not in subsequent processing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">9.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># 0.08108115</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;od&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;hres&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;HRES&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1983</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_a_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Before 2013-06-26, there were only 91 model levels. The mapping coefficients below are extracted</span>
        <span class="c1"># based on https://www.ecmwf.int/en/forecasts/documentation-and-support/91-model-levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_91_HEIGHTS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A_91_HRES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">B_91_HRES</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch a weather model from ECMWF</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>

        <span class="c1"># execute the search at ECMWF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_ecmwf</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.hres.HRES.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hres.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_a_b</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">==</span> <span class="s1">&#39;pl&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_pressure_levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.hrrr" class="doc doc-heading">
            <code>hrrr</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.hrrr.HRRR" class="doc doc-heading">
            <code>HRRR</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HRRR</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;pl&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expver</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;hrrr&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;hrrr&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Availability lag time in days</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># 3 km horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">3.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">3.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Nproc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;HRRR&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Npl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="c1"># NOTE: The HRRR projection will get read directly from the downloaded weather model file; however,</span>
        <span class="c1"># we also define it here so that the projection can be used without downloading any data. This is</span>
        <span class="c1"># used for consistency with the other weather models and allows for some nice features, such as</span>
        <span class="c1"># buffering.</span>

        <span class="c1"># See https://github.com/blaylockbk/pyBKB_v2/blob/master/demos/HRRR_earthRelative_vs_gridRelative_winds.ipynb and code lower down</span>
        <span class="c1"># &#39;262.5:38.5:38.5:38.5 237.280472:1799:3000.00 21.138123:1059:3000.00&#39;</span>
        <span class="c1"># &#39;lov:latin1:latin2:latd lon1:nx:dx lat1:ny:dy&#39;</span>
        <span class="c1"># LCC parameters</span>
        <span class="n">lon0</span> <span class="o">=</span> <span class="mf">262.5</span>
        <span class="n">lat0</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">earth_radius</span> <span class="o">=</span> <span class="mi">6371229</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+proj=lcc +lat_1=</span><span class="si">{</span><span class="n">lat1</span><span class="si">}</span><span class="s1"> +lat_2=</span><span class="si">{</span><span class="n">lat2</span><span class="si">}</span><span class="s1"> +lat_0=</span><span class="si">{</span><span class="n">lat0</span><span class="si">}</span><span class="s1"> &#39;</span>\
                 <span class="sa">f</span><span class="s1">&#39;+lon_0=</span><span class="si">{</span><span class="n">lon0</span><span class="si">}</span><span class="s1"> +x_0=</span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1"> +y_0=</span><span class="si">{</span><span class="n">y0</span><span class="si">}</span><span class="s1"> +a=</span><span class="si">{</span><span class="n">earth_radius</span><span class="si">}</span><span class="s1"> &#39;</span>\
                 <span class="sa">f</span><span class="s1">&#39;+b=</span><span class="si">{</span><span class="n">earth_radius</span><span class="si">}</span><span class="s1"> +units=m +no_defs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span> <span class="o">=</span> <span class="n">HRRR_CONUS_COVERAGE_POLYGON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLevelType</span><span class="p">(</span><span class="s1">&#39;nat&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__model_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span>  <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_50_HEIGHTS</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__pressure_levels__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Pressure levels do not go high enough for HRRR.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from HRRR</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">out</span>
        <span class="n">corrected_DT</span> <span class="o">=</span> <span class="n">round_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkTime</span><span class="p">(</span><span class="n">corrected_DT</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">corrected_DT</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Rounded given datetime from  </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">)</span>

        <span class="c1"># HRRR uses 0-360 longitude, so we need to convert the bounds to that</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">360</span><span class="p">)</span>

        <span class="n">download_hrrr_file</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">corrected_DT</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;hrrr&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load a weather model into a python weatherModel object, from self.files if no</span>
<span class="sd">        filename is passed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span>


        <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">temps</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="n">load_weather_hrrr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># convert geopotential height to geometric height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">_lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">temps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">pres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_ys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">proj</span>


    <span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">WeatherModel</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks whether the given bounding box is valid for the HRRR or HRRRAK</span>
<span class="sd">        (i.e., intersects with the model domain at all)</span>

<span class="sd">        Args:</span>
<span class="sd">        ll_bounds : np.ndarray</span>

<span class="sd">        Returns:</span>
<span class="sd">            The weather model object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
        <span class="n">aoi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="n">HRRRAK</span><span class="p">()</span>
            <span class="c1"># valid bounds are in 0-&gt;360 to account for dateline crossing</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">aoi</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR-AK weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The requested location is unavailable for HRRR&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Mod</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.hrrr.HRRR.checkValidBounds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkValidBounds</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Checks whether the given bounding box is valid for the HRRR or HRRRAK
(i.e., intersects with the model domain at all)</p>
<p>Args:
ll_bounds : np.ndarray</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weather model object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">WeatherModel</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the given bounding box is valid for the HRRR or HRRRAK</span>
<span class="sd">    (i.e., intersects with the model domain at all)</span>

<span class="sd">    Args:</span>
<span class="sd">    ll_bounds : np.ndarray</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weather model object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
    <span class="n">aoi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="n">HRRRAK</span><span class="p">()</span>
        <span class="c1"># valid bounds are in 0-&gt;360 to account for dateline crossing</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">aoi</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">aoi</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">Mod</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The HRRR-AK weather model extent does not completely cover your AOI!&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The requested location is unavailable for HRRR&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Mod</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.hrrr.HRRR.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Load a weather model into a python weatherModel object, from self.files if no
filename is passed.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load a weather model into a python weatherModel object, from self.files if no</span>
<span class="sd">    filename is passed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span>


    <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">_lons</span><span class="p">,</span> <span class="n">_lats</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">temps</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="n">load_weather_hrrr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># convert geopotential height to geometric height</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">_lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">temps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">qs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">pres</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_xs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_ys</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">proj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.hrrr.check_hrrr_dataset_availability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_hrrr_dataset_availability</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Note a file could still be missing within the models valid range</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_hrrr_dataset_availability</span><span class="p">(</span><span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Note a file could still be missing within the models valid range&quot;&quot;&quot;</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">Herbie</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span>
               <span class="n">model</span><span class="o">=</span><span class="s1">&#39;hrrr&#39;</span><span class="p">,</span>
               <span class="n">product</span><span class="o">=</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span>
               <span class="n">fxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">grib_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">avail</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.hrrr.download_hrrr_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_hrrr_file</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;hrrr&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span> <span class="n">fxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Download a HRRR weather model using Herbie</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None, writes data to a netcdf file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_hrrr_file</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;hrrr&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span> <span class="n">fxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Download a HRRR weather model using Herbie</span>

<span class="sd">    Args:</span>
<span class="sd">        DATE (Python datetime)  - Datetime as a Python datetime. Herbie will automatically return the closest valid time,</span>
<span class="sd">                                    which is currently hourly.</span>
<span class="sd">        out (string)            - output location as a string</span>
<span class="sd">        model (string)          - model can be &quot;hrrr&quot; or &quot;hrrrak&quot;</span>
<span class="sd">        product (string)        - &#39;prs&#39; for pressure levels, &#39;nat&#39; for native levels</span>
<span class="sd">        fxx (int)               - forecast time in hours. Can be up to 48 for 00/06/12/18</span>
<span class="sd">        verbose (bool)          - True for extra printout of information</span>

<span class="sd">    Returns:</span>
<span class="sd">        None, writes data to a netcdf file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">Herbie</span><span class="p">(</span>
        <span class="n">DATE</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">),</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
        <span class="n">fxx</span><span class="o">=</span><span class="n">fxx</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out</span><span class="p">)),</span>
    <span class="p">)</span>


    <span class="c1"># Iterate through the list of datasets</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds_list</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">xarray</span><span class="p">(</span><span class="s2">&quot;:(SPFH|PRES|TMP|HGT):&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="n">ds_out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Note order coord names are request for `test_HRRR_ztd` matters</span>
    <span class="c1"># when both coord names are retreived by Herbie is ds_list possibly in</span>
    <span class="c1"># Different orders on different machines; `hybrid` is what is expected for the test.</span>
    <span class="n">ds_list_filt_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_list</span> <span class="k">if</span> <span class="s1">&#39;hybrid&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">_coord_names</span><span class="p">]</span>
    <span class="n">ds_list_filt_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_list</span> <span class="k">if</span> <span class="s1">&#39;isobaricInhPa&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">_coord_names</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ds_list_filt_0</span><span class="p">:</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_list_filt_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s1">&#39;hybrid&#39;</span>
    <span class="c1">#  I do not think that this coord name will result in successful processing nominally as variables are</span>
    <span class="c1">#  gh,gribfile_projection for test_HRRR_ztd</span>
    <span class="k">elif</span> <span class="n">ds_list_filt_1</span><span class="p">:</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_list_filt_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s1">&#39;isobaricInhPa&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Herbie did not obtain an HRRR dataset with the expected layers and coordinates&#39;</span><span class="p">)</span>

    <span class="c1"># subset the full file by AOI</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">get_bounds_indices</span><span class="p">(</span>
        <span class="n">ll_bounds</span><span class="p">,</span>
        <span class="n">ds_out</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">ds_out</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="c1"># bookkeepping</span>
    <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;gh&#39;</span><span class="p">:</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="s1">&#39;levels&#39;</span><span class="p">})</span>

    <span class="c1"># projection information</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="s2">&quot;proj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">ds_out</span><span class="o">.</span><span class="n">herbie</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ds_out</span><span class="o">.</span><span class="n">proj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
        <span class="n">ds_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;grid_mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;proj&#39;</span>


    <span class="c1"># pull the grid information</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_cf</span><span class="p">(</span><span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">yl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span>

    <span class="n">grid_x</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># meters</span>
    <span class="n">grid_y</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># meters</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="o">+</span><span class="n">grid_x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">grid_x</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="n">grid_y</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">)</span>

    <span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xs</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ys</span>
    <span class="n">ds_sub</span> <span class="o">=</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">))</span>
    <span class="n">ds_sub</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.hrrr.get_bounds_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bounds_indices</span><span class="p">(</span><span class="n">SNWE</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Convert SNWE lat/lon bounds to index bounds</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_bounds_indices</span><span class="p">(</span><span class="n">SNWE</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert SNWE lat/lon bounds to index bounds</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Unpack the bounds and find the relevent indices</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SNWE</span>

    <span class="c1"># Need to account for crossing the international date line</span>
    <span class="k">if</span> <span class="n">W</span> <span class="o">&lt;</span> <span class="n">E</span><span class="p">:</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="n">lats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">lats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">W</span> <span class="o">&lt;=</span> <span class="n">lons</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="n">lons</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;Longitude is either flipped or you are crossing the international date line;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;if the latter please give me longitudes from 0-360&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="n">lats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">lats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">W</span> <span class="o">&lt;=</span> <span class="n">lons</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="n">lons</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Area of Interest has no overlap with the HRRR model available extent&#39;</span><span class="p">)</span>

    <span class="c1"># Y extent</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">m1_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1_y</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m1_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">m1_y</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># X extent</span>
    <span class="n">m1_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1_x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m1_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">shp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">m1_x</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.hrrr.load_weather_hrrr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather_hrrr</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Loads a weather model from a HRRR file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/hrrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather_hrrr</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Loads a weather model from a HRRR file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># read data from the netcdf file</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>
    <span class="c1"># Pull the relevant data from the file</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">values</span>
    <span class="n">pres</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">xArr</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">yArr</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">temps</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">geo_hgt</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_cf</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

    <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

    <span class="c1"># data cube format should be lats,lons,heights</span>
    <span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">xArr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                            <span class="n">geo_hgt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">yArr</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                            <span class="n">geo_hgt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">temps</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">proj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.merra2" class="doc doc-heading">
            <code>merra2</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.merra2.MERRA2" class="doc doc-heading">
            <code>MERRA2</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/merra2.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MERRA2</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">import</span> <span class="nn">calendar</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>  <span class="c1"># Default, pressure levels are &#39;pl&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;merra2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;merra2&#39;</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">utcnow</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">enddate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">enddate</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="n">lag_time</span> <span class="o">=</span> <span class="n">utcnow</span> <span class="o">-</span> <span class="n">enddate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">lag_time</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>  <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">0.625</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">0.625</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;MERRA2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="c1"># Projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from GMAO: note we only extract the lat/lon bounds for this weather model; fetching data is not needed here as we don&#39;t actually download any data using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> 

        <span class="c1"># check whether the file already exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># calculate the array indices for slicing the GMAO variable arrays</span>
        <span class="n">lat_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lat_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">lat_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="p">(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span>
        <span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">lon_min_ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="p">(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>
        <span class="p">)</span>

        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1992</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2001</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">elif</span> <span class="n">time</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2011</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_sub</span> <span class="o">=</span> <span class="mi">400</span>

        <span class="c1"># Earthdata credentials</span>
        <span class="n">earthdata_usr</span><span class="p">,</span> <span class="n">earthdata_pwd</span> <span class="o">=</span> <span class="n">read_EarthData_loginInfo</span><span class="p">(</span><span class="n">EARTHDATA_RC</span><span class="p">)</span>

        <span class="c1"># open the dataset and pull the data</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://goldsmr5.gesdisc.eosdis.nasa.gov/opendap/MERRA2/M2T3NVASM.5.12.4/&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/MERRA2_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_sub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tavg3_3d_asm_Nv.&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.nc4&#39;</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">cas</span><span class="o">.</span><span class="n">urs</span><span class="o">.</span><span class="n">setup_session</span><span class="p">(</span><span class="n">earthdata_usr</span><span class="p">,</span> <span class="n">earthdata_pwd</span><span class="p">,</span> <span class="n">check_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">pydap</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="n">lat_min_ind</span><span class="p">:</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lon_min_ind</span><span class="p">:</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">writeWeatherVarsXarray</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;MERRA-2: Unable to save weathermodel to file&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;MERRA-2 failed with the following error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types.</span>
<span class="sd">        As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">        t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">        populated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_model_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the variables from the GMAO link using OpenDAP</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># adding the import here should become absolute when transition to netcdf</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="c1"># check this</span>
        <span class="c1"># data cube format should be lats,lons,heights</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># For some reason z is opposite the others</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># assign the regular-grid (lat/lon/h) variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.merra2.MERRA2.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types.
As a result of calling this method, all of the variables (x, y, z, p, q,
t, wet_refractivity, hydrostatic refractivity, e) should be fully
populated.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/merra2.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types.</span>
<span class="sd">    As a result of calling this method, all of the variables (x, y, z, p, q,</span>
<span class="sd">    t, wet_refractivity, hydrostatic refractivity, e) should be fully</span>
<span class="sd">    populated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_level</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.model_levels" class="doc doc-heading">
            <code>model_levels</code>


</h3>

    <div class="doc doc-contents ">

      <p>Pre-defined model levels and a, b constants for the different weather models</p>
<p><strong>NOTE</strong>: The fixed heights used here are from ECMWF's <em>geometric</em> altitudes
(https://confluence.ecmwf.int/display/UDOC/L137+model+level+definitions),
where "geopotential altitude is calculated from a mathematical model that adjusts
the altitude to include the variation of gravity with height, while geometric
altitude is the standard direct vertical distance above mean sea level (MSL)."
- Wikipedia.org, https://en.wikipedia.org/wiki/International_Standard_Atmosphere</p>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.ncmr" class="doc doc-heading">
            <code>ncmr</code>


</h3>

    <div class="doc doc-contents ">

      <p>Created on Wed Sep  9 10:26:44 2020 @author: prashant
Modified by Yang Lei, GPS/Caltech</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.ncmr.NCMR" class="doc doc-heading">
            <code>NCMR</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


      <p>Implement NCMRWF NCUM (named as NCMR) model in future</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/ncmr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NCMR</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement NCMRWF NCUM (named as NCMR) model in future</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize a weather model</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>                     <span class="c1"># q for specific humidity and rh for relative humidity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>                <span class="c1"># Default, pressure levels are &#39;pl&#39;, and model levels are &quot;ml&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;ncmr&#39;</span>                     <span class="c1"># name of the custom weather model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;ncmr&#39;</span>                       <span class="c1"># same name as above</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;NCMR&#39;</span>                          <span class="c1"># name of the new weather model (in Capital)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="c1"># Availability lag time in days/hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># model constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>   <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">.17578125</span>                  <span class="c1"># grid spacing in longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">.11718750</span>                  <span class="c1"># grid spacing in latitude</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">.17578125</span>                  <span class="c1"># same as longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">.11718750</span>                  <span class="c1"># same as latitude</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from NCMR: note we only extract the lat/lon bounds for this weather model;</span>
<span class="sd">        fetching data is not needed here as we don&#39;t actually download data , data exist in same system</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="c1"># Auxillary function:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        download data of the NCMR model and save it in desired location</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_ncmr_file</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load NCMR model variables from existing file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

        <span class="c1"># bounding box plus a buffer</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_makeDataCubes</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_ncmr_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">date_time</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Download weather model data (whole globe) from NCMR weblink, crop it to the region of interest, and save the cropped data as a standard .nc file of RAiDER (e.g. &quot;NCMR_YYYY_MM_DD_THH_MM_SS.nc&quot;);</span>
<span class="sd">        Temporarily download data from NCMR ftp &#39;https://ftp.ncmrwf.gov.in/pub/outgoing/SAC/NCUM_OSF/&#39; and copied in weather_models folder</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>

        <span class="c1">############# Use these lines and modify the link when actually downloading NCMR data from a weblink #############</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">read_NCMR_loginInfo</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ftp://</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">/TEST/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">_raw.nc&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fetching URL: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">local_filename</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Weather model already exists, skipping download&#39;</span><span class="p">)</span>
        <span class="c1">########################################################################################################################</span>

        <span class="c1">############# For debugging: use pre-downloaded files; Remove/comment out it when actually downloading NCMR data from a weblink #############</span>
<span class="c1">#        filepath = os.path.dirname(out) + &#39;/NCUM_ana_mdllev_20180701_00z.nc&#39;</span>
        <span class="c1">########################################################################################################################</span>

        <span class="c1"># calculate the array indices for slicing the GMAO variable arrays</span>
        <span class="n">lat_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">89.94141</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">lat_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">89.94141</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.087890625</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lon_min_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.087890625</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.087890625</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lon_max_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.087890625</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>

        <span class="n">ml_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ml_max</span> <span class="o">=</span> <span class="mi">70</span>

        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">maskandscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][</span><span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">lons1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][</span><span class="n">lon_min_ind</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">lons2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons1</span><span class="p">,</span> <span class="n">lons2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][</span><span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">][</span><span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">][</span><span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">][</span><span class="n">ml_min</span><span class="p">:(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Skipping first pressure levels (below 20 meter)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">q2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_pressure&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_pressure&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;air_pressure&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">level_hgt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;level_height&#39;</span><span class="p">][(</span><span class="n">ml_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">ml_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">surface_alt1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;surface_altitude&#39;</span><span class="p">][</span><span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">surface_alt2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;surface_altitude&#39;</span><span class="p">][</span><span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">surface_alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface_alt1</span><span class="p">,</span> <span class="n">surface_alt2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">surface_alt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;surface_altitude&#39;</span><span class="p">][</span><span class="n">lat_min_ind</span><span class="p">:(</span><span class="n">lat_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_min_ind</span><span class="p">:(</span><span class="n">lon_max_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">hgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">level_hgt</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">surface_alt</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">surface_alt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">level_hgt</span><span class="p">)):</span>
                <span class="n">hgt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">surface_alt</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">level_hgt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

        <span class="c1">############# For debugging: comment it out when using pre-downloaded raw data files and don&#39;t want to remove them for test; Uncomment it when actually downloading NCMR data from a weblink #############</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="c1">########################################################################################################################</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">writeWeatherVarsXarray</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">hgt</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unable to save weathermodel to file&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_makeDataCubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the variables from the saved .nc file (named as &quot;NCMR_YYYY_MM_DD_THH_MM_SS.nc&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>

        <span class="c1"># adding the import here should become absolute when transition to netcdf</span>
        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:])</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][:])</span>
            <span class="n">hgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][:])</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;QV&#39;</span><span class="p">][:])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;PL&#39;</span><span class="p">][:])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:])</span>

        <span class="c1"># re-assign lons, lats to match heights</span>
        <span class="n">_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                                <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="n">_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_lats</span><span class="p">)</span>
        <span class="n">_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_lons</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">hgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hgt</span><span class="p">)</span>

        <span class="c1"># data cube format should be lats,lons,heights</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hgt</span> <span class="o">=</span> <span class="n">hgt</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># assign the regular-grid variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">hgt</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.ncmr.NCMR.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Load NCMR model variables from existing file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/ncmr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load NCMR model variables from existing file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span>

    <span class="c1"># bounding box plus a buffer</span>
    <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_makeDataCubes</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.plotWeather" class="doc doc-heading">
            <code>plotWeather</code>


</h3>

    <div class="doc doc-contents ">

      <p>This set of functions is designed to for plotting WeatherModel
class objects. It is not designed to be used on its own apart
from this class.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.plotWeather.plot_pqt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_pqt</span><span class="p">(</span><span class="n">weatherObj</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="mi">15000</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create a plot with pressure, temp, and humidity at two heights</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/plotWeather.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_pqt</span><span class="p">(</span><span class="n">weatherObj</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="mi">15000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a plot with pressure, temp, and humidity at two heights</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Get the interpolator</span>

    <span class="n">intFcn_p</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">intFcn_e</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_e</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">intFcn_t</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># get the points needed</span>
    <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">z1</span>
    <span class="n">z2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">z2</span>
    <span class="n">pts1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z1a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z2a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">intFcn_p</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">intFcn_e</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">intFcn_t</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">intFcn_p</span><span class="p">(</span><span class="n">pts2</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">intFcn_e</span><span class="p">(</span><span class="n">pts2</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">intFcn_t</span><span class="p">(</span><span class="n">pts2</span><span class="p">)</span>

    <span class="c1"># Now get the data to plot</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">e1</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="n">p2</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">e2</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">t2</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">]</span>
    <span class="c1"># titles = (&#39;P (hPa)&#39;, &#39;E (hPa)&#39;.format(z1), &#39;T (C)&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;)</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;P (hPa)&#39;</span><span class="p">,</span> <span class="s1">&#39;E (hPa)&#39;</span><span class="p">,</span> <span class="s1">&#39;T (C)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># setup the plot</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1"> Pressure/Humidity/Temperature at height </span><span class="si">{</span><span class="n">z1</span><span class="si">}</span><span class="s1">m and </span><span class="si">{</span><span class="n">z2</span><span class="si">}</span><span class="s1">m (values should drop as elevation increases)&#39;</span><span class="p">)</span>

    <span class="n">xind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">yind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># loop over each plot</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)),</span> <span class="n">plots</span><span class="p">,</span> <span class="n">titles</span><span class="p">):</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                       <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span>
                       <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">],</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">mal</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;4%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z2</span><span class="p">))</span>

    <span class="c1"># add plots that show each variable with height</span>
    <span class="n">zdata</span> <span class="o">=</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">[:]</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_p</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">zdata</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (km)&#39;</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pressure (hPa)&#39;</span><span class="p">)</span>

    <span class="n">sp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_e</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="n">zdata</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;E (hPa)&#39;</span><span class="p">)</span>

    <span class="n">sp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_t</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="n">zdata</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temp (C)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                        <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">wd</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_out_name</span><span class="p">))</span>
        <span class="n">f</span>    <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1">_weather_hgt</span><span class="si">{</span><span class="n">z1</span><span class="si">}</span><span class="s1">_and_</span><span class="si">{</span><span class="n">z2</span><span class="si">}</span><span class="s1">m.pdf&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.plotWeather.plot_wh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_wh</span><span class="p">(</span><span class="n">weatherObj</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="mi">15000</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create a plot with wet refractivity and hydrostatic refractivity,
at two different heights</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/plotWeather.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_wh</span><span class="p">(</span><span class="n">weatherObj</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="mi">15000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a plot with wet refractivity and hydrostatic refractivity,</span>
<span class="sd">    at two different heights</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Get the interpolator</span>
    <span class="n">intFcn_w</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_wet_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">intFcn_h</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">((</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># get the points needed</span>
    <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="n">weatherObj</span><span class="o">.</span><span class="n">_ys</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">z1</span>
    <span class="n">z2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">z2</span>
    <span class="n">pts1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z1a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z2a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">w1</span> <span class="o">=</span> <span class="n">intFcn_w</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">intFcn_h</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">intFcn_w</span><span class="p">(</span><span class="n">pts2</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">intFcn_h</span><span class="p">(</span><span class="n">pts2</span><span class="p">)</span>

    <span class="c1"># Now get the data to plot</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span><span class="p">]</span>

    <span class="c1"># titles</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Wet refractivity </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span>
              <span class="s1">&#39;Hydrostatic refractivity </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span>
              <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z2</span><span class="p">),</span>
              <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z2</span><span class="p">))</span>

    <span class="c1"># setup the plot</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1"> Wet and Hydrostatic refractivity at height </span><span class="si">{</span><span class="n">z1</span><span class="si">}</span><span class="s1">m and </span><span class="si">{</span><span class="n">z2</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">)</span>

    <span class="c1"># loop over each plot</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)),</span> <span class="n">plots</span><span class="p">,</span> <span class="n">titles</span><span class="p">):</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">mal</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;4%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">wd</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_out_name</span><span class="p">))</span>
        <span class="n">f</span>    <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weatherObj</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1">_refractivity_hgt</span><span class="si">{</span><span class="n">z1</span><span class="si">}</span><span class="s1">_and_</span><span class="si">{</span><span class="n">z2</span><span class="si">}</span><span class="s1">m.pdf&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.template" class="doc doc-heading">
            <code>template</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.template.customModelReader" class="doc doc-heading">
            <code>customModelReader</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>RAiDER/models/template.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">customModelReader</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>  <span class="c1"># can be &quot;q&quot; (specific humidity) or &quot;rh&quot; (relative humidity)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;pl&#39;</span>  <span class="c1"># Default, pressure levels are &quot;pl&quot;, and model levels are &quot;ml&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="s1">&#39;abcd&#39;</span>  <span class="c1"># name of the custom weather model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="s1">&#39;abcd&#39;</span>  <span class="c1"># same name as above</span>

        <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="c1">#  valid range of the dataset. Users need to specify the start date and end date (can be &quot;present&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span>
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="c1">#  Availability lag time. Can be specified in hours &quot;hours=3&quot; or in days &quot;days=3&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># Availabile time resolution; i.e. minimum rate model is available in hours. 1 is hourly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># model constants (these three constants are borrowed from ECMWF model and currently</span>
        <span class="c1"># set to be default for all other models, which may need to be double checked.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># [K/Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># [K^2/Pa]</span>

        <span class="c1"># horizontal grid spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># grid spacing in latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># grid spacing in longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="mf">3.</span>  <span class="c1"># x-direction grid spacing in the native weather model projection</span>
        <span class="c1">#  (if the projection is in lat/lon, it is the same as &quot;self._lon_res&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="mf">3.</span>  <span class="c1"># y-direction grid spacing in the weather model native projection</span>
        <span class="c1">#  (if the projection is in lat/lon, it is the same as &quot;self._lat_res&quot;)</span>

        <span class="c1"># zlevels specify fixed heights at which to interpolate the weather model variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">LEVELS_137_HEIGHTS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;ABCD&#39;</span>  <span class="c1"># name of the custom weather model (better to be capitalized)</span>

        <span class="c1"># Projections in RAiDER are defined using pyproj (python wrapper around Proj)</span>
        <span class="c1"># If the projection is defined with EPSG code, one can use &quot;self._proj = CRS.from_epsg(4326)&quot;</span>
        <span class="c1"># to replace the following lines to get &quot;self._proj&quot;.</span>
        <span class="c1"># Below we show the example of HRRR model with the parameters of its Lambert Conformal Conic projection</span>
        <span class="n">lon0</span> <span class="o">=</span> <span class="mf">262.5</span>
        <span class="n">lat0</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="mf">38.5</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">earth_radius</span> <span class="o">=</span> <span class="mi">6371229</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="s1">&#39;+proj=lcc +lat_1=</span><span class="si">{lat1}</span><span class="s1"> +lat_2=</span><span class="si">{lat2}</span><span class="s1"> +lat_0=</span><span class="si">{lat0}</span><span class="s1"> +lon_0=</span><span class="si">{lon0}</span><span class="s1"> +x_0=</span><span class="si">{x0}</span><span class="s1"> +y_0=</span><span class="si">{y0}</span><span class="s1"> +a=</span><span class="si">{a}</span><span class="s1"> +b=</span><span class="si">{a}</span><span class="s1"> +units=m +no_defs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat1</span><span class="o">=</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span><span class="o">=</span><span class="n">lat2</span><span class="p">,</span> <span class="n">lat0</span><span class="o">=</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="o">=</span><span class="n">lon0</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">earth_radius</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetch weather model data from the custom weather model &quot;ABCD&quot;</span>
<span class="sd">        Inputs (no need to change in the custom weather model reader):</span>
<span class="sd">        lats - latitude</span>
<span class="sd">        lons - longitude</span>
<span class="sd">        time - datatime object (year,month,day,hour,minute,second)</span>
<span class="sd">        out - name of downloaded dataset file from the custom weather model server</span>
<span class="sd">        Nextra - buffer of latitude/longitude for determining the bounding box</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Auxilliary function:</span>
        <span class="c1"># download dataset of the custom weather model &quot;ABCD&quot; from a server and then save it to a file named out.</span>
        <span class="c1"># This function needs to be writen by the users. For download from the weather model server, the weather model</span>
        <span class="c1"># name, time and bounding box may be needed to retrieve the dataset; for cases where no file is actually</span>
        <span class="c1"># downloaded, e.g. the GMAO and MERRA-2 models using OpenDAP, this function can be omitted leaving the data</span>
        <span class="c1"># retrieval to the following &quot;load_weather&quot; function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_abcd_file</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load weather model variables from the downloaded file named filename</span>
<span class="sd">        Inputs:</span>
<span class="sd">        filename - filename of the downloaded weather model file</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Auxilliary function:</span>
        <span class="c1"># read individual variables (in 3-D cube format with exactly the same dimension) from downloaded file</span>
        <span class="c1"># This function needs to be writen by the users. For downloaded file from the weather model server,</span>
        <span class="c1"># this function extracts the individual variables from the saved file named filename;</span>
        <span class="c1"># for cases where no file is actually downloaded, e.g. the GMAO and MERRA-2 models using OpenDAP,</span>
        <span class="c1"># this function retrieves the individual variables directly from the weblink of the weather model.</span>
        <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">hgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeDataCubes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># extra steps that may be needed to calculate topographic height and pressure level if not provided</span>
        <span class="c1"># directly by the weather model through the above auxilliary function &quot;self._makeDataCubes&quot;</span>

        <span class="c1"># if surface pressure (in logarithm) is provided as &quot;p&quot; along with the surface geopotential &quot;z&quot; (needs to be</span>
        <span class="c1"># added to the auxilliary function &quot;self._makeDataCubes&quot;), one can use the following line to convert to</span>
        <span class="c1"># geopotential, pressure level and geopotential height; otherwise commented out</span>
        <span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">hgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculategeoh</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  <span class="c1"># TODO: z is undefined</span>

        <span class="c1"># if the geopotential is provided as &quot;z&quot; (needs to be added to the auxilliary function &quot;self._makeDataCubes&quot;),</span>
        <span class="c1"># one can use the following line to convert to geopotential height; otherwise, commented out</span>
        <span class="n">hgt</span> <span class="o">=</span> <span class="n">z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g0</span>

        <span class="c1"># if geopotential height is provided/calculated as &quot;hgt&quot;, one can use the following line to convert to</span>
        <span class="c1"># topographic height, which is then automatically assigned to &quot;self._zs&quot;; otherwise commented out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">hgt</span><span class="p">)</span>

        <span class="c1"># if topographic height is provided as &quot;hgt&quot;, use the following line directly; otherwise commented out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">hgt</span>

        <span class="c1">###########</span>

        <span class="c1">######### output of the weather model reader for delay calculations (all in 3-D data cubes) ########</span>

        <span class="c1"># _t: temperture</span>
        <span class="c1"># _q: either relative or specific humidity</span>
        <span class="c1"># _p: must be pressure level</span>
        <span class="c1"># _xs: x-direction grid dimension of the native weather model coordinates (if in lat/lon, _xs = _lons)</span>
        <span class="c1"># _ys: y-direction grid dimension of the native weather model coordinates (if in lat/lon, _ys = _lats)</span>
        <span class="c1"># _zs: must be topographic height</span>
        <span class="c1"># _lats: latitude</span>
        <span class="c1"># _lons: longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">ys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>

        <span class="c1">###########</span>

    <span class="k">def</span> <span class="nf">_download_abcd_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">date_time</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Auxilliary function:</span>
<span class="sd">        Download weather model data from a server</span>
<span class="sd">        Inputs:</span>
<span class="sd">        out - filename for saving the retrieved data file</span>
<span class="sd">        model_name - name of the custom weather model</span>
<span class="sd">        date_time - datatime object (year,month,day,hour,minute,second)</span>
<span class="sd">        bounding_box - lat/lon bounding box for the region of interest</span>
<span class="sd">        Output:</span>
<span class="sd">        out - returned filename from input</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_makeDataCubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Auxilliary function:</span>
<span class="sd">        Read 3-D data cubes from downloaded file or directly from weather model weblink (in which case, there is no</span>
<span class="sd">        need to download and save any file; rather, the weblink needs to be hardcoded in the custom reader, e.g. GMAO)</span>
<span class="sd">        Input:</span>
<span class="sd">        filename - filename of the downloaded weather model file from the server</span>
<span class="sd">        Outputs:</span>
<span class="sd">        lats - latitude (3-D data cube)</span>
<span class="sd">        lons - longitude (3-D data cube)</span>
<span class="sd">        xs - x-direction grid dimension of the native weather model coordinates (3-D data cube; if in lat/lon, _xs = _lons)</span>
<span class="sd">        ys - y-direction grid dimension of the native weather model coordinates (3-D data cube; if in lat/lon, _ys = _lats)</span>
<span class="sd">        t - temperature (3-D data cube)</span>
<span class="sd">        q - humidity (3-D data cube; could be relative humidity or specific humidity)</span>
<span class="sd">        p - pressure level (3-D data cube; could be pressure level (preferred) or surface pressure)</span>
<span class="sd">        hgt - height (3-D data cube; could be geopotential height or topographic height (preferred))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.template.customModelReader.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Load weather model variables from the downloaded file named filename
Inputs:
filename - filename of the downloaded weather model file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/template.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load weather model variables from the downloaded file named filename</span>
<span class="sd">    Inputs:</span>
<span class="sd">    filename - filename of the downloaded weather model file</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Auxilliary function:</span>
    <span class="c1"># read individual variables (in 3-D cube format with exactly the same dimension) from downloaded file</span>
    <span class="c1"># This function needs to be writen by the users. For downloaded file from the weather model server,</span>
    <span class="c1"># this function extracts the individual variables from the saved file named filename;</span>
    <span class="c1"># for cases where no file is actually downloaded, e.g. the GMAO and MERRA-2 models using OpenDAP,</span>
    <span class="c1"># this function retrieves the individual variables directly from the weblink of the weather model.</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">hgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeDataCubes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># extra steps that may be needed to calculate topographic height and pressure level if not provided</span>
    <span class="c1"># directly by the weather model through the above auxilliary function &quot;self._makeDataCubes&quot;</span>

    <span class="c1"># if surface pressure (in logarithm) is provided as &quot;p&quot; along with the surface geopotential &quot;z&quot; (needs to be</span>
    <span class="c1"># added to the auxilliary function &quot;self._makeDataCubes&quot;), one can use the following line to convert to</span>
    <span class="c1"># geopotential, pressure level and geopotential height; otherwise commented out</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">hgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculategeoh</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  <span class="c1"># TODO: z is undefined</span>

    <span class="c1"># if the geopotential is provided as &quot;z&quot; (needs to be added to the auxilliary function &quot;self._makeDataCubes&quot;),</span>
    <span class="c1"># one can use the following line to convert to geopotential height; otherwise, commented out</span>
    <span class="n">hgt</span> <span class="o">=</span> <span class="n">z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g0</span>

    <span class="c1"># if geopotential height is provided/calculated as &quot;hgt&quot;, one can use the following line to convert to</span>
    <span class="c1"># topographic height, which is then automatically assigned to &quot;self._zs&quot;; otherwise commented out</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_heights</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">hgt</span><span class="p">)</span>

    <span class="c1"># if topographic height is provided as &quot;hgt&quot;, use the following line directly; otherwise commented out</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">hgt</span>

    <span class="c1">###########</span>

    <span class="c1">######### output of the weather model reader for delay calculations (all in 3-D data cubes) ########</span>

    <span class="c1"># _t: temperture</span>
    <span class="c1"># _q: either relative or specific humidity</span>
    <span class="c1"># _p: must be pressure level</span>
    <span class="c1"># _xs: x-direction grid dimension of the native weather model coordinates (if in lat/lon, _xs = _lons)</span>
    <span class="c1"># _ys: y-direction grid dimension of the native weather model coordinates (if in lat/lon, _ys = _lats)</span>
    <span class="c1"># _zs: must be topographic height</span>
    <span class="c1"># _lats: latitude</span>
    <span class="c1"># _lons: longitude</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">q</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">xs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">ys</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="n">lats</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="n">lons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.weatherModel" class="doc doc-heading">
            <code>weatherModel</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.weatherModel.WeatherModel" class="doc doc-heading">
            <code>WeatherModel</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


      <p>Implement a generic weather model for getting estimated SAR delays</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WeatherModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement a generic weather model for getting estimated SAR delays</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize model-specific constants/parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># time resolution of the weather model in hours</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_res</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span>   <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="s1">&#39;ml&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">())),</span> 
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
        <span class="p">)</span>  <span class="c1"># Tuple of min/max years where data is available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Availability lag time in days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bbox</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Define fixed constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_R_v</span> <span class="o">=</span> <span class="mf">461.524</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_R_d</span> <span class="o">=</span> <span class="mf">287.06</span>  <span class="c1"># in our original code this was 287.053</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g0</span> <span class="o">=</span> <span class="n">_g0</span>  <span class="c1"># gravity constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zmin</span> <span class="o">=</span> <span class="n">_ZMIN</span>  <span class="c1"># minimum integration height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zmax</span> <span class="o">=</span> <span class="n">_ZREF</span>  <span class="c1"># max integration height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># setup data structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Use generic x/y/z instead of lon/lat/height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span> <span class="o">=</span>  <span class="n">box</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span> <span class="c1"># Shapely box with WSEN bounds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wet_ztd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_ztd</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;======Weather Model class object=====</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Weather model time: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Latitude resolution: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Longitude resolution: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Native projection: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;ZMIN: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zmin</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;ZMAX: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zmax</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;k1 = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_k1</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;k2 = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_k2</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;k3 = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_k3</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Humidity type = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;=====================================</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Class name: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_classname</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Dataset: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;=====================================</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;A: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;B: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Number of points in Lon/Lat = </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Total number of grid points (3D): </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Minimum/Maximum y: </span><span class="si">{: 4.2f}</span><span class="s1">/</span><span class="si">{: 4.2f}</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">),</span> <span class="n">robmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">))</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Minimum/Maximum x: </span><span class="si">{: 4.2f}</span><span class="s1">/</span><span class="si">{: 4.2f}</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">),</span> <span class="n">robmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">))</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;Minimum/Maximum zs/heights: </span><span class="si">{: 10.2f}</span><span class="s1">/</span><span class="si">{: 10.2f}</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span> <span class="n">robmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">))</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;=====================================</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">Model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>


    <span class="k">def</span> <span class="nf">dtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span>


    <span class="k">def</span> <span class="nf">getLLRes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks the input datetime against the valid date range for the model and then</span>
<span class="sd">        calls the model _fetch routine</span>

<span class="sd">        Args:</span>
<span class="sd">        ----------</span>
<span class="sd">        out -</span>
<span class="sd">        ll_bounds - 4 x 1 array, SNWE</span>
<span class="sd">        time = UTC datetime</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># write the error raised by the weather model API to the log</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="k">raise</span>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Placeholder method. Should be implemented in each weather model type class</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">getTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>


    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Set the time for a weather model &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;time&quot; must be a string or a datetime object&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>


    <span class="k">def</span> <span class="nf">get_latlon_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span>


    <span class="k">def</span> <span class="nf">set_latlon_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">,</span> <span class="n">Nextra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Need to correct lat/lon bounds because not all of the weather models have valid</span>
<span class="sd">        data exactly bounded by -90/90 (lats) and -180/180 (lons); for GMAO and MERRA2,</span>
<span class="sd">        need to adjust the longitude higher end with an extra buffer; for other models,</span>
<span class="sd">        the exact bounds are close to -90/90 (lats) and -180/180 (lons) and thus can be</span>
<span class="sd">        rounded to the above regions (either in the downloading-file API or subsetting-</span>
<span class="sd">        data API) without problems.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ex_buffer_lon_max</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="ow">in</span> <span class="s1">&#39;HRRR HRRR-AK HRES&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">Nextra</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># have a bigger buffer</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ex_buffer_lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>

        <span class="c1"># At boundary lats and lons, need to modify Nextra buffer so that the lats and lons do not exceed the boundary</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>

        <span class="c1"># Adjust bounds if they get near the poles or IDL</span>
        <span class="n">pixlat</span><span class="p">,</span> <span class="n">pixlon</span> <span class="o">=</span> <span class="n">Nextra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">Nextra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>

        <span class="n">S</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">S</span> <span class="o">-</span> <span class="n">pixlat</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.0</span> <span class="o">+</span> <span class="n">pixlat</span><span class="p">])</span>
        <span class="n">N</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">N</span> <span class="o">+</span> <span class="n">pixlat</span><span class="p">,</span> <span class="mf">90.0</span> <span class="o">-</span> <span class="n">pixlat</span><span class="p">])</span>
        <span class="n">W</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">W</span> <span class="o">-</span> <span class="p">(</span><span class="n">pixlon</span> <span class="o">+</span> <span class="n">ex_buffer_lon_max</span><span class="p">),</span> <span class="o">-</span><span class="mf">180.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixlon</span><span class="o">+</span><span class="n">ex_buffer_lon_max</span><span class="p">)])</span>
        <span class="n">E</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">E</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixlon</span> <span class="o">+</span> <span class="n">ex_buffer_lon_max</span><span class="p">),</span> <span class="mf">180.0</span> <span class="o">-</span> <span class="n">pixlon</span> <span class="o">-</span> <span class="n">ex_buffer_lon_max</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">output_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span>  <span class="o">=</span> <span class="n">clip_bbox</span><span class="p">([</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="n">output_spacing</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">get_wmLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the path to the direct with the weather model files &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wmLoc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;weather_files&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wmLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span>
        <span class="k">return</span> <span class="n">wmLoc</span>


    <span class="k">def</span> <span class="nf">set_wmLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather_model_directory</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set the path to the directory with the weather model files &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span> <span class="o">=</span> <span class="n">weather_model_directory</span>


    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">_zlevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calls the load_weather method. Each model class should define a load_weather</span>
<span class="sd">        method appropriate for that class. &#39;args&#39; should be one or more filenames.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If the weather file has already been processed, do nothing</span>
        <span class="n">outLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wmLoc</span><span class="p">()</span>
        <span class="n">path_wm_raw</span>    <span class="o">=</span> <span class="n">make_raw_weather_data_filename</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">(</span><span class="n">outLoc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Load the weather just for the query points</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">path_wm_raw</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Process the weather model data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_e</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uniform_in_z</span><span class="p">(</span><span class="n">_zlevels</span><span class="o">=</span><span class="n">_zlevels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkForNans</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_wet_refractivity</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_hydro_refractivity</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_latlon_bounds</span><span class="p">())</span>

            <span class="c1"># Compute Zenith delays at the weather model grid nodes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getZTD</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Placeholder method. Should be implemented in each weather model type class</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotType</span><span class="o">=</span><span class="s1">&#39;pqt&#39;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plotting method. Valid plot types are &#39;pqt&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s1">&#39;pqt&#39;</span><span class="p">:</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_pqt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefig</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s1">&#39;wh&#39;</span><span class="p">:</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_wh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefig</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;WeatherModel.plot: No plotType named </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plotType</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">plot</span>


    <span class="k">def</span> <span class="nf">checkTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks the time against the lag time and valid date range for the given model type</span>

<span class="sd">        Parameters:</span>
<span class="sd">            time    - Python datetime object</span>

<span class="sd">        Raises: </span>
<span class="sd">            Different errors depending on the issue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;time&quot; should be a Python datetime object, instead it is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

        <span class="c1"># This is needed because Python now gets angry if you try to compare non-timezone-aware </span>
        <span class="c1"># objects with time-zone aware objects. </span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Weather model </span><span class="si">%s</span><span class="s1"> is available from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">start_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_time</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>

        <span class="c1"># datetime.datetime.utcnow() is deprecated because Python developers </span>
        <span class="c1"># want everyone to use timezone-aware datetimes. </span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setLevelType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levelType</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Set the level type to model levels or pressure levels&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">levelType</span> <span class="ow">in</span> <span class="s1">&#39;ml pl nat prs&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="n">levelType</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Level type </span><span class="si">{</span><span class="n">levelType</span><span class="si">}</span><span class="s1"> is not recognized&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">levelType</span> <span class="ow">in</span> <span class="s1">&#39;ml nat&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__model_levels__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pressure_levels__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_convertmb2Pa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pres</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Convert pressure in millibars to Pascals</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">pres</span>


    <span class="k">def</span> <span class="nf">_get_heights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">geo_ht_fill</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform geo heights to WGS84 ellipsoidal heights</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">geo_ht_fix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geo_hgt</span> <span class="o">!=</span> <span class="n">geo_ht_fill</span><span class="p">,</span> <span class="n">geo_hgt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">lats_full</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">geo_ht_fix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span>   <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">geo_to_ht</span><span class="p">(</span><span class="n">lats_full</span><span class="p">,</span> <span class="n">geo_ht_fix</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_find_e</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the type of e-calculation needed&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">==</span> <span class="s1">&#39;rh&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_e_from_rh</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_e_from_q</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Not a valid humidity type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">_find_e_from_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate e, partial pressure of water vapor.&quot;&quot;&quot;</span>
        <span class="n">svp</span> <span class="o">=</span> <span class="n">find_svp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
        <span class="c1"># We have q = w/(w + 1), so w = q/(1 - q)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_R_v</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">-</span> <span class="n">svp</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_R_d</span>


    <span class="k">def</span> <span class="nf">_find_e_from_rh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate partial pressure of water vapor.&quot;&quot;&quot;</span>
        <span class="n">svp</span> <span class="o">=</span> <span class="n">find_svp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">svp</span>


    <span class="k">def</span> <span class="nf">_get_wet_refractivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the wet delay from pressure, temperature, and e</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">**</span><span class="mi">2</span>


    <span class="k">def</span> <span class="nf">_get_hydro_refractivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the hydrostatic delay from pressure and temperature</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span>


    <span class="k">def</span> <span class="nf">getWetRefractivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span>


    <span class="k">def</span> <span class="nf">getHydroRefractivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span>


    <span class="k">def</span> <span class="nf">_adjust_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function pads the weather grid with a level at self._zmin, if</span>
<span class="sd">        it does not already go that low.</span>
<span class="sd">        &lt;&lt;The functionality below has been removed.&gt;&gt;</span>
<span class="sd">        &lt;&lt;It also removes levels that are above self._zmax, since they are not needed.&gt;&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">):</span>
            <span class="c1"># first add in a new layer at zmin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmin</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">padLower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">padLower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">padLower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">padLower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">padLower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ll_bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trimExtent</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_getZTD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the full slant tropospheric delay for each weather model grid node, using the reference</span>
<span class="sd">        height zref</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWetRefractivity</span><span class="p">()</span>
        <span class="n">hydro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHydroRefractivity</span><span class="p">()</span>

        <span class="c1"># Get the integrated ZTD</span>
        <span class="n">wet_total</span><span class="p">,</span> <span class="n">hydro_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">wet</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hydro</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">wet_total</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
                <span class="n">wet</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">level</span><span class="p">:],</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>
            <span class="n">hydro_total</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
                <span class="n">hydro</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">level</span><span class="p">:],</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_ztd</span> <span class="o">=</span> <span class="n">hydro_total</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wet_ztd</span> <span class="o">=</span> <span class="n">wet_total</span>


    <span class="k">def</span> <span class="nf">_getExtent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get the bounding box around a set of lats/lons</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">lats</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">lats</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">lons</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">,</span> <span class="n">lons</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lats</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">lats</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">lats</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lons</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">lons</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">,</span> <span class="n">lons</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Not a valid lat/lon shape&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtains the bounding box of the weather model in lat/lon CRS.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            xmin, ymin, xmax, ymax</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">           When `self.files` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_weather_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_wmLoc</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_weather_model</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to save cropped weather model as netcdf&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">xarray</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">path_weather_model</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="n">wm_proj</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>
            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span>     <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">transform_coords</span><span class="p">(</span><span class="n">wm_proj</span><span class="p">,</span> <span class="n">CRS</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
            <span class="c1">## projected weather models may not be aligned N/S</span>
            <span class="c1">## should only matter for warning messages</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="c1"># S, N = np.sort([lats[np.argmin(lons)], lats[np.argmax(lons)]])</span>
            <span class="n">S</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bbox</span> <span class="o">=</span> <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox</span>


    <span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">:</span> <span class="n">weatherModel</span><span class="p">,</span>
            <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                         <span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks whether the given bounding box is valid for the model</span>
<span class="sd">        (i.e., intersects with the model domain at all)</span>

<span class="sd">        Args:</span>
<span class="sd">        ll_bounds : np.ndarray</span>

<span class="sd">        Returns:</span>
<span class="sd">            The weather model object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
        <span class="k">if</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
            <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The requested location is unavailable for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Mod</span>


    <span class="k">def</span> <span class="nf">checkContainment</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">weatherModel</span><span class="p">,</span>
                         <span class="n">ll_bounds</span><span class="p">,</span>
                         <span class="n">buffer_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        Checks containment of weather model bbox of outLats and outLons</span>
<span class="sd">        provided.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----------</span>
<span class="sd">        weather_model : weatherModel</span>
<span class="sd">        ll_bounds: an array of floats (SNWE) demarcating bbox of targets</span>
<span class="sd">        buffer_deg : float</span>
<span class="sd">            For x-translates for extents that lie outside of world bounding box,</span>
<span class="sd">            this ensures that translates have some overlap. The default is 1e-5</span>
<span class="sd">            or ~11.1 meters.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">           True if weather model contains bounding box of OutLats and outLons</span>
<span class="sd">           and False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ymin_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">,</span> <span class="n">xmin_input</span><span class="p">,</span> <span class="n">xmax_input</span> <span class="o">=</span> <span class="n">ll_bounds</span>
        <span class="n">input_box</span>   <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span> <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">world_box</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

        <span class="c1"># Logger</span>
        <span class="n">input_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span>
                                               <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">]]</span>
        <span class="n">weath_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]]</span>

        <span class="n">weath_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weath_box_str</span><span class="p">)</span>
        <span class="n">input_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_box_str</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extent of the weather model is (xmin, ymin, xmax, ymax):&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weath_box_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extent of the input is (xmin, ymin, xmax, ymax): &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_box_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># If the bounding box goes beyond the normal world extents</span>
        <span class="c1"># Look at two x-translates, buffer them, and take their union.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">world_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Considering x-translates of weather model +/-360 &#39;</span>
                        <span class="s1">&#39;as bounding box outside of -180, -90, 180, 90&#39;</span><span class="p">)</span>
            <span class="n">translates</span> <span class="o">=</span> <span class="p">[</span><span class="n">weather_model_box</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                          <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                    <span class="n">xoff</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                          <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                    <span class="n">xoff</span><span class="o">=-</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">)</span>
                          <span class="p">]</span>
            <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">translates</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">weather_model_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">input_box</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_isOutside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extent1</span><span class="p">,</span> <span class="n">extent2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Determine whether any of extent1  lies outside extent2</span>
<span class="sd">        extent1/2 should be a list containing [lower_lat, upper_lat, left_lon, right_lon]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">t4</span> <span class="o">=</span> <span class="n">extent1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">_trimExtent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get the bounding box around a set of lats/lons</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lat</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> \
               <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ma1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        <span class="n">ma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ma1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ma2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Don&#39;t need to remove any points</span>
            <span class="k">return</span>

        <span class="c1"># indices of the part of the grid to keep</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ma1</span><span class="p">))[</span><span class="n">ma1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">index2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ma1</span><span class="p">))[</span><span class="n">ma1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">index3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ma2</span><span class="p">))[</span><span class="n">ma2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">index4</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ma2</span><span class="p">))[</span><span class="n">ma2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

        <span class="c1"># subset around points of interest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">[</span><span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span><span class="p">[</span><span class="n">index1</span><span class="p">:</span><span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">:</span><span class="n">index4</span><span class="p">,</span> <span class="p">:]</span>


    <span class="k">def</span> <span class="nf">_calculategeoh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">lnsp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to calculate pressure, geopotential, and geopotential height</span>
<span class="sd">        from the surface pressure and model levels provided by a weather model.</span>
<span class="sd">        The model levels are numbered from the highest eleveation to the lowest.</span>
<span class="sd">        Inputs:</span>
<span class="sd">            self - weather model object with parameters a, b defined</span>
<span class="sd">            z    - 3-D array of surface heights for the location(s) of interest</span>
<span class="sd">            lnsp - log of the surface pressure</span>
<span class="sd">        Outputs:</span>
<span class="sd">            geopotential - The geopotential in units of height times acceleration</span>
<span class="sd">            pressurelvs  - The pressure at each of the model levels for each of</span>
<span class="sd">                           the input points</span>
<span class="sd">            geoheight    - The geopotential heights</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">calcgeoh</span><span class="p">(</span><span class="n">lnsp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_R_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getProjection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns: the native weather projection, which should be a pyproj object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>


    <span class="k">def</span> <span class="nf">getPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_uniform_in_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_zlevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Interpolate all variables to a regular grid in z</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># new regular z-spacing</span>
        <span class="k">if</span> <span class="n">_zlevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_zlevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlevels</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">_zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">new_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">_zlevels</span><span class="p">,</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># re-assign values to the uniform z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">interpolate_along_axis</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">new_zs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">interpolate_along_axis</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="n">new_zs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="n">interpolate_along_axis</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">,</span> <span class="n">new_zs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">_zlevels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_checkForNans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fill in NaN-values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">fillna3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">fillna3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">1e16</span><span class="p">)</span> <span class="c1"># to avoid division by zero later on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="n">fillna3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">out_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outLoc</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">make_weather_model_filename</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outLoc</span><span class="o">=</span><span class="s1">&#39;weather_files&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a filename to store the weather model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time must be specified before the file can be written&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">make_raw_weather_data_filename</span><span class="p">(</span>
            <span class="n">outLoc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span>
            <span class="n">time</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">f</span>


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        By calling the abstract/modular netcdf writer</span>
<span class="sd">        (RAiDER.utilFcns.write2NETCDF4core), write the weather model data</span>
<span class="sd">        and refractivity to an NETCDF4 file that can be accessed by external programs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Generate the filename</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span>

        <span class="n">attrs_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Conventions&quot;</span><span class="p">:</span> <span class="s1">&#39;CF-1.6&#39;</span><span class="p">,</span>
                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">T%H_%M_%S&quot;</span><span class="p">),</span>
                <span class="s1">&#39;date_created&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">T%H_%M_%S&quot;</span><span class="p">),</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Weather model data and delay calculations&#39;</span><span class="p">,</span>
                <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>

            <span class="p">}</span>

        <span class="n">dimension_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">),</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">),</span>
            <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span>
            <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">),</span>
            <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">),</span>
            <span class="s1">&#39;datetime_utc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">dataset_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;wet&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;hydro&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;wet_total&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_ztd</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="s1">&#39;hydro_total&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_ztd</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="p">}</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="o">=</span><span class="n">dataset_dict</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">dimension_dict</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs_dict</span><span class="p">)</span>

        <span class="c1"># Define units</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dimentionless&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dimentionless&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>

        <span class="c1"># Define standard names</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;humidity&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pressure&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;wet_refractivity&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hydrostatic_refractivity&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total_wet_refractivity&#39;</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total_hydrostatic_refractivity&#39;</span>

        <span class="c1"># projection information</span>
        <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;proj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">proj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;grid_mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;proj&#39;</span>

        <span class="c1"># write to file and return the filename</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="RAiDER.models.weatherModel.WeatherModel.bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bbox</span><span class="p">:</span> <span class="nb">list</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

      <p>Obtains the bounding box of the weather model in lat/lon CRS.</p>
<h6 id="RAiDER.models.weatherModel.WeatherModel.bbox--returns">Returns:</h6>
<p>list
    xmin, ymin, xmax, ymax</p>
<h6 id="RAiDER.models.weatherModel.WeatherModel.bbox--raises">Raises</h6>
<p>ValueError
   When <code>self.files</code> is None.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.checkContainment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkContainment</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">,</span> <span class="n">buffer_deg</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>"
Checks containment of weather model bbox of outLats and outLons
provided.</p>
<h6 id="RAiDER.models.weatherModel.WeatherModel.checkContainment--args">Args:</h6>
<p>weather_model : weatherModel
ll_bounds: an array of floats (SNWE) demarcating bbox of targets
buffer_deg : float
    For x-translates for extents that lie outside of world bounding box,
    this ensures that translates have some overlap. The default is 1e-5
    or ~11.1 meters.</p>
<h6 id="RAiDER.models.weatherModel.WeatherModel.checkContainment--returns">Returns:</h6>
<p>bool
   True if weather model contains bounding box of OutLats and outLons
   and False otherwise.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkContainment</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">weatherModel</span><span class="p">,</span>
                     <span class="n">ll_bounds</span><span class="p">,</span>
                     <span class="n">buffer_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    Checks containment of weather model bbox of outLats and outLons</span>
<span class="sd">    provided.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    weather_model : weatherModel</span>
<span class="sd">    ll_bounds: an array of floats (SNWE) demarcating bbox of targets</span>
<span class="sd">    buffer_deg : float</span>
<span class="sd">        For x-translates for extents that lie outside of world bounding box,</span>
<span class="sd">        this ensures that translates have some overlap. The default is 1e-5</span>
<span class="sd">        or ~11.1 meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">       True if weather model contains bounding box of OutLats and outLons</span>
<span class="sd">       and False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ymin_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">,</span> <span class="n">xmin_input</span><span class="p">,</span> <span class="n">xmax_input</span> <span class="o">=</span> <span class="n">ll_bounds</span>
    <span class="n">input_box</span>   <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span> <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
    <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">world_box</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

    <span class="c1"># Logger</span>
    <span class="n">input_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span>
                                           <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">]]</span>
    <span class="n">weath_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]]</span>

    <span class="n">weath_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weath_box_str</span><span class="p">)</span>
    <span class="n">input_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_box_str</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extent of the weather model is (xmin, ymin, xmax, ymax):&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">weath_box_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extent of the input is (xmin, ymin, xmax, ymax): &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_box_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># If the bounding box goes beyond the normal world extents</span>
    <span class="c1"># Look at two x-translates, buffer them, and take their union.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">world_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Considering x-translates of weather model +/-360 &#39;</span>
                    <span class="s1">&#39;as bounding box outside of -180, -90, 180, 90&#39;</span><span class="p">)</span>
        <span class="n">translates</span> <span class="o">=</span> <span class="p">[</span><span class="n">weather_model_box</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                      <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                <span class="n">xoff</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                      <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                <span class="n">xoff</span><span class="o">=-</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">)</span>
                      <span class="p">]</span>
        <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">translates</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weather_model_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">input_box</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.checkTime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Checks the time against the lag time and valid date range for the given model type</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks the time against the lag time and valid date range for the given model type</span>

<span class="sd">    Parameters:</span>
<span class="sd">        time    - Python datetime object</span>

<span class="sd">    Raises: </span>
<span class="sd">        Different errors depending on the issue</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;time&quot; should be a Python datetime object, instead it is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

    <span class="c1"># This is needed because Python now gets angry if you try to compare non-timezone-aware </span>
    <span class="c1"># objects with time-zone aware objects. </span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s1">&#39;Weather model </span><span class="si">%s</span><span class="s1"> is available from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">start_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_time</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>

    <span class="c1"># datetime.datetime.utcnow() is deprecated because Python developers </span>
    <span class="c1"># want everyone to use timezone-aware datetimes. </span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lag_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatetimeOutsideRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.checkValidBounds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkValidBounds</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Checks whether the given bounding box is valid for the model
(i.e., intersects with the model domain at all)</p>
<p>Args:
ll_bounds : np.ndarray</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weather model object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkValidBounds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">weatherModel</span><span class="p">,</span>
        <span class="n">ll_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the given bounding box is valid for the model</span>
<span class="sd">    (i.e., intersects with the model domain at all)</span>

<span class="sd">    Args:</span>
<span class="sd">    ll_bounds : np.ndarray</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weather model object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>
    <span class="k">if</span> <span class="n">box</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_bounds</span><span class="p">):</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The requested location is unavailable for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Mod</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.fetch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Checks the input datetime against the valid date range for the model and then
calls the model _fetch routine</p>
<h6 id="RAiDER.models.weatherModel.WeatherModel.fetch--args">Args:</h6>
<p>out -
ll_bounds - 4 x 1 array, SNWE
time = UTC datetime</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks the input datetime against the valid date range for the model and then</span>
<span class="sd">    calls the model _fetch routine</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    out -</span>
<span class="sd">    ll_bounds - 4 x 1 array, SNWE</span>
<span class="sd">    time = UTC datetime</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">checkTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="c1"># write the error raised by the weather model API to the log</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filename</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outLoc</span><span class="o">=</span><span class="s1">&#39;weather_files&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Create a filename to store the weather model</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outLoc</span><span class="o">=</span><span class="s1">&#39;weather_files&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a filename to store the weather model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time must be specified before the file can be written&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">make_raw_weather_data_filename</span><span class="p">(</span>
        <span class="n">outLoc</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span>
        <span class="n">time</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.getProjection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getProjection</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Returns: the native weather projection, which should be a pyproj object</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getProjection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns: the native weather projection, which should be a pyproj object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.get_wmLoc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wmLoc</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Get the path to the direct with the weather model files</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_wmLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get the path to the direct with the weather model files &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wmLoc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;weather_files&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wmLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span>
    <span class="k">return</span> <span class="n">wmLoc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_zlevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calls the load_weather method. Each model class should define a load_weather
method appropriate for that class. 'args' should be one or more filenames.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">_zlevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calls the load_weather method. Each model class should define a load_weather</span>
<span class="sd">    method appropriate for that class. &#39;args&#39; should be one or more filenames.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># If the weather file has already been processed, do nothing</span>
    <span class="n">outLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wmLoc</span><span class="p">()</span>
    <span class="n">path_wm_raw</span>    <span class="o">=</span> <span class="n">make_raw_weather_data_filename</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">(</span><span class="n">outLoc</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Load the weather just for the query points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_weather</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">path_wm_raw</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Process the weather model data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_e</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uniform_in_z</span><span class="p">(</span><span class="n">_zlevels</span><span class="o">=</span><span class="n">_zlevels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkForNans</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_wet_refractivity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_hydro_refractivity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_latlon_bounds</span><span class="p">())</span>

        <span class="c1"># Compute Zenith delays at the weather model grid nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getZTD</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

      <p>Placeholder method. Should be implemented in each weather model type class</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Placeholder method. Should be implemented in each weather model type class</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">plotType</span><span class="o">=</span><span class="s1">&#39;pqt&#39;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Plotting method. Valid plot types are 'pqt'</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotType</span><span class="o">=</span><span class="s1">&#39;pqt&#39;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plotting method. Valid plot types are &#39;pqt&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s1">&#39;pqt&#39;</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_pqt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefig</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s1">&#39;wh&#39;</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_wh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;WeatherModel.plot: No plotType named </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plotType</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">plot</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.setLevelType" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setLevelType</span><span class="p">(</span><span class="n">levelType</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Set the level type to model levels or pressure levels</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setLevelType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levelType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Set the level type to model levels or pressure levels&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">levelType</span> <span class="ow">in</span> <span class="s1">&#39;ml pl nat prs&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_level_type</span> <span class="o">=</span> <span class="n">levelType</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Level type </span><span class="si">{</span><span class="n">levelType</span><span class="si">}</span><span class="s1"> is not recognized&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">levelType</span> <span class="ow">in</span> <span class="s1">&#39;ml nat&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model_levels__</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pressure_levels__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.setTime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Set the time for a weather model</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Set the time for a weather model &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;time&quot; must be a string or a datetime object&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.set_latlon_bounds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_latlon_bounds</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">,</span> <span class="n">Nextra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Need to correct lat/lon bounds because not all of the weather models have valid
data exactly bounded by -90/90 (lats) and -180/180 (lons); for GMAO and MERRA2,
need to adjust the longitude higher end with an extra buffer; for other models,
the exact bounds are close to -90/90 (lats) and -180/180 (lons) and thus can be
rounded to the above regions (either in the downloading-file API or subsetting-
data API) without problems.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_latlon_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">,</span> <span class="n">Nextra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Need to correct lat/lon bounds because not all of the weather models have valid</span>
<span class="sd">    data exactly bounded by -90/90 (lats) and -180/180 (lons); for GMAO and MERRA2,</span>
<span class="sd">    need to adjust the longitude higher end with an extra buffer; for other models,</span>
<span class="sd">    the exact bounds are close to -90/90 (lats) and -180/180 (lons) and thus can be</span>
<span class="sd">    rounded to the above regions (either in the downloading-file API or subsetting-</span>
<span class="sd">    data API) without problems.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ex_buffer_lon_max</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="ow">in</span> <span class="s1">&#39;HRRR HRRR-AK HRES&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">Nextra</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># have a bigger buffer</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ex_buffer_lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>

    <span class="c1"># At boundary lats and lons, need to modify Nextra buffer so that the lats and lons do not exceed the boundary</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ll_bounds</span>

    <span class="c1"># Adjust bounds if they get near the poles or IDL</span>
    <span class="n">pixlat</span><span class="p">,</span> <span class="n">pixlon</span> <span class="o">=</span> <span class="n">Nextra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_res</span><span class="p">,</span> <span class="n">Nextra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_res</span>

    <span class="n">S</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">S</span> <span class="o">-</span> <span class="n">pixlat</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.0</span> <span class="o">+</span> <span class="n">pixlat</span><span class="p">])</span>
    <span class="n">N</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">N</span> <span class="o">+</span> <span class="n">pixlat</span><span class="p">,</span> <span class="mf">90.0</span> <span class="o">-</span> <span class="n">pixlat</span><span class="p">])</span>
    <span class="n">W</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">W</span> <span class="o">-</span> <span class="p">(</span><span class="n">pixlon</span> <span class="o">+</span> <span class="n">ex_buffer_lon_max</span><span class="p">),</span> <span class="o">-</span><span class="mf">180.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixlon</span><span class="o">+</span><span class="n">ex_buffer_lon_max</span><span class="p">)])</span>
    <span class="n">E</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">E</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixlon</span> <span class="o">+</span> <span class="n">ex_buffer_lon_max</span><span class="p">),</span> <span class="mf">180.0</span> <span class="o">-</span> <span class="n">pixlon</span> <span class="o">-</span> <span class="n">ex_buffer_lon_max</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">output_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span>  <span class="o">=</span> <span class="n">clip_bbox</span><span class="p">([</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="n">output_spacing</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_ll_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.set_wmLoc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_wmLoc</span><span class="p">(</span><span class="n">weather_model_directory</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Set the path to the directory with the weather model files</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_wmLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather_model_directory</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Set the path to the directory with the weather model files &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wmLoc</span> <span class="o">=</span> <span class="n">weather_model_directory</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.weatherModel.WeatherModel.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>By calling the abstract/modular netcdf writer
(RAiDER.utilFcns.write2NETCDF4core), write the weather model data
and refractivity to an NETCDF4 file that can be accessed by external programs.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    By calling the abstract/modular netcdf writer</span>
<span class="sd">    (RAiDER.utilFcns.write2NETCDF4core), write the weather model data</span>
<span class="sd">    and refractivity to an NETCDF4 file that can be accessed by external programs.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Generate the filename</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_name</span>

    <span class="n">attrs_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Conventions&quot;</span><span class="p">:</span> <span class="s1">&#39;CF-1.6&#39;</span><span class="p">,</span>
            <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">T%H_%M_%S&quot;</span><span class="p">),</span>
            <span class="s1">&#39;date_created&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">T%H_%M_%S&quot;</span><span class="p">),</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Weather model data and delay calculations&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>

        <span class="p">}</span>

    <span class="n">dimension_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">),</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">),</span>
        <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">),</span>
        <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lats</span><span class="p">),</span>
        <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lons</span><span class="p">),</span>
        <span class="s1">&#39;datetime_utc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">dataset_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;wet&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;hydro&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_refractivity</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;wet_total&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wet_ztd</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="s1">&#39;hydro_total&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrostatic_ztd</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
    <span class="p">}</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="o">=</span><span class="n">dataset_dict</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">dimension_dict</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs_dict</span><span class="p">)</span>

    <span class="c1"># Define units</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dimentionless&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dimentionless&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>

    <span class="c1"># Define standard names</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;humidity&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pressure&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;wet_refractivity&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hydrostatic_refractivity&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wet_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total_wet_refractivity&#39;</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hydro_total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total_hydrostatic_refractivity&#39;</span>

    <span class="c1"># projection information</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;proj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">proj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;grid_mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;proj&#39;</span>

    <span class="c1"># write to file and return the filename</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.weatherModel.checkContainment_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkContainment_raw</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">,</span> <span class="n">buffer_deg</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>"
Checks if existing raw weather model contains
requested ll_bounds</p>
<h6 id="RAiDER.models.weatherModel.checkContainment_raw--args">Args:</h6>
<p>path_wm_raw : path to downloaded, uncropped weather model file
ll_bounds: an array of floats (SNWE) demarcating bbox of targets
buffer_deg : float
    For x-translates for extents that lie outside of world bounding box,
    this ensures that translates have some overlap. The default is 1e-5
    or ~11.1 meters.</p>
<h6 id="RAiDER.models.weatherModel.checkContainment_raw--returns">Returns:</h6>
<p>bool
    True if weather model contains bounding box of OutLats and outLons
    and False otherwise.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkContainment_raw</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">,</span>
                        <span class="n">ll_bounds</span><span class="p">,</span>
                        <span class="n">buffer_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    Checks if existing raw weather model contains</span>
<span class="sd">    requested ll_bounds</span>

<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    path_wm_raw : path to downloaded, uncropped weather model file</span>
<span class="sd">    ll_bounds: an array of floats (SNWE) demarcating bbox of targets</span>
<span class="sd">    buffer_deg : float</span>
<span class="sd">        For x-translates for extents that lie outside of world bounding box,</span>
<span class="sd">        this ensures that translates have some overlap. The default is 1e-5</span>
<span class="sd">        or ~11.1 meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if weather model contains bounding box of OutLats and outLons</span>
<span class="sd">        and False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
    <span class="n">ymin_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">,</span> <span class="n">xmin_input</span><span class="p">,</span> <span class="n">xmax_input</span> <span class="o">=</span> <span class="n">ll_bounds</span>
    <span class="n">input_box</span>   <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span> <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ds</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

    <span class="n">world_box</span>  <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

    <span class="c1"># Logger</span>
    <span class="n">input_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin_input</span><span class="p">,</span> <span class="n">ymin_input</span><span class="p">,</span>
                                            <span class="n">xmax_input</span><span class="p">,</span> <span class="n">ymax_input</span><span class="p">]]</span>
    <span class="n">weath_box_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]]</span>

    <span class="n">weath_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weath_box_str</span><span class="p">)</span>
    <span class="n">input_box_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_box_str</span><span class="p">)</span>


    <span class="c1"># If the bounding box goes beyond the normal world extents</span>
    <span class="c1"># Look at two x-translates, buffer them, and take their union.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">world_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Considering x-translates of weather model +/-360 &#39;</span>
                    <span class="s1">&#39;as bounding box outside of -180, -90, 180, 90&#39;</span><span class="p">)</span>
        <span class="n">translates</span> <span class="o">=</span> <span class="p">[</span><span class="n">weather_model_box</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                        <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                <span class="n">xoff</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">),</span>
                        <span class="n">translate</span><span class="p">(</span><span class="n">weather_model_box</span><span class="p">,</span>
                                <span class="n">xoff</span><span class="o">=-</span><span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_deg</span><span class="p">)</span>
                        <span class="p">]</span>
        <span class="n">weather_model_box</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">translates</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weather_model_box</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">input_box</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.weatherModel.find_svp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_svp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate standard vapor presure. Should be model-specific</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_svp</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate standard vapor presure. Should be model-specific</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># From TRAIN:</span>
    <span class="c1"># Could not find the wrf used equation as they appear to be</span>
    <span class="c1"># mixed with latent heat etc. Istead I used the equations used</span>
    <span class="c1"># in ERA-I (see IFS documentation part 2: Data assimilation</span>
    <span class="c1"># (CY25R1)). Calculate saturated water vapour pressure (svp) for</span>
    <span class="c1"># water (svpw) using Buck 1881 and for ice (swpi) from Alduchow</span>
    <span class="c1"># and Eskridge (1996) euation AERKi</span>

    <span class="c1"># TODO: figure out the sources of all these magic numbers and move</span>
    <span class="c1"># them somewhere more visible.</span>
    <span class="c1"># TODO: (Jeremy) - Need to fix/get the equation for the other</span>
    <span class="c1"># weather model types. Right now this will be used for all models,</span>
    <span class="c1"># except WRF, which is yet to be implemented in my new structure.</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="mf">273.15</span>  <span class="c1"># O Celsius</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="mf">250.15</span>  <span class="c1"># -23 Celsius</span>

    <span class="n">tref</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t1</span>
    <span class="n">wgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t2</span><span class="p">)</span>
    <span class="n">svpw</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.1121</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">17.502</span> <span class="o">*</span> <span class="n">tref</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">240.97</span> <span class="o">+</span> <span class="n">tref</span><span class="p">)))</span>
    <span class="n">svpi</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.1121</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">22.587</span> <span class="o">*</span> <span class="n">tref</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.86</span> <span class="o">+</span> <span class="n">tref</span><span class="p">)))</span>

    <span class="n">svp</span> <span class="o">=</span> <span class="n">svpi</span> <span class="o">+</span> <span class="p">(</span><span class="n">svpw</span> <span class="o">-</span> <span class="n">svpi</span><span class="p">)</span> <span class="o">*</span> <span class="n">wgt</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">ix_bound1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">t1</span>
    <span class="n">svp</span><span class="p">[</span><span class="n">ix_bound1</span><span class="p">]</span> <span class="o">=</span> <span class="n">svpw</span><span class="p">[</span><span class="n">ix_bound1</span><span class="p">]</span>
    <span class="n">ix_bound2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t2</span>
    <span class="n">svp</span><span class="p">[</span><span class="n">ix_bound2</span><span class="p">]</span> <span class="o">=</span> <span class="n">svpi</span><span class="p">[</span><span class="n">ix_bound2</span><span class="p">]</span>

    <span class="n">svp</span> <span class="o">=</span> <span class="n">svp</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">svp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.weatherModel.get_mapping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mapping</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get CF-complient projection information from a proj</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_mapping</span><span class="p">(</span><span class="n">proj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Get CF-complient projection information from a proj&#39;&#39;&#39;</span>
    <span class="c1"># In case of WGS-84 lat/lon, keep it simple</span>
    <span class="k">if</span> <span class="n">proj</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span><span class="o">==</span><span class="mi">4326</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;WGS84&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">proj</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.weatherModel.make_raw_weather_data_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_raw_weather_data_filename</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Filename generator for the raw downloaded weather model data</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/weatherModel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_raw_weather_data_filename</span><span class="p">(</span><span class="n">outLoc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Filename generator for the raw downloaded weather model data &#39;&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">outLoc</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">_T%H_%M_%S&#39;</span><span class="p">),</span>
            <span class="s1">&#39;nc&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="RAiDER.models.wrf" class="doc doc-heading">
            <code>wrf</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.wrf.UnitTypeError" class="doc doc-heading">
            <code>UnitTypeError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


      <p>Define a unit type exception for easily formatting
error messages for units</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/wrf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UnitTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define a unit type exception for easily formatting</span>
<span class="sd">    error messages for units</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init___</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varName</span><span class="p">,</span> <span class="n">unittype</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown units for </span><span class="si">{}</span><span class="s2">: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">unittype</span><span class="p">)</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="RAiDER.models.wrf.WRF" class="doc doc-heading">
            <code>WRF</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RAiDER.models.weatherModel.WeatherModel" href="#RAiDER.models.weatherModel.WeatherModel">WeatherModel</a></code></p>


      <p>WRF class definition, based on the WeatherModel base class.</p>

              <details class="quote">
                <summary>Source code in <code>RAiDER/models/wrf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WRF</span><span class="p">(</span><span class="n">WeatherModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    WRF class definition, based on the WeatherModel base class.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># TODO: finish implementing</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">WeatherModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">0.776</span>  <span class="c1"># K/Pa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.233</span>  <span class="c1"># K/Pa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k3</span> <span class="o">=</span> <span class="mf">3.75e3</span>  <span class="c1"># K^2/Pa</span>


        <span class="c1"># Currently WRF is using RH instead of Q to get E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_humidityType</span> <span class="o">=</span> <span class="s1">&#39;rh&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="s1">&#39;WRF&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">TIME_RES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Consistent class method to be implemented across all weather model types</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wm_nodes</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_netcdf</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_wm_nodes</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_netcdf</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>

        <span class="c1"># WRF doesn&#39;t give us the coordinates of the points in the native projection,</span>
        <span class="c1"># only the coordinates in lat/long. Ray transformed these to the native</span>
        <span class="c1"># projection, then used an average to enforce a regular grid. It does matter</span>
        <span class="c1"># for the interpolation whether the grid is regular.</span>
        <span class="n">lla</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_proj</span><span class="p">(</span><span class="n">lla</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">)</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lats</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Expected accuracy here is to two decimal places (five significant digits)</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_ys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_xs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">)</span>

        <span class="c1"># TODO: Not sure if WRF provides this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_get_wm_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeFile</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">netcdf</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="n">nodeFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">maskandscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;XLAT&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Takes only the first date!</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;XLONG&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

        <span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>

    <span class="k">def</span> <span class="nf">_read_netcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weatherFile</span><span class="p">,</span> <span class="n">defNul</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read weather variables from a netCDF file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">defNul</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defNul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># TODO: it&#39;d be cool to use some kind of units package</span>
        <span class="c1"># TODO: extract partial pressure directly (q?)</span>
        <span class="k">with</span> <span class="n">netcdf</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="n">weatherFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">maskandscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">spvar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P_PL&#39;</span><span class="p">]</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T_PL&#39;</span><span class="p">]</span>
            <span class="n">humid</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;RH_PL&#39;</span><span class="p">]</span>
            <span class="n">geohvar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;GHT_PL&#39;</span><span class="p">]</span>

            <span class="n">lon0</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">STAND_LON</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">lat0</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">MOAD_CEN_LAT</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">lat1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">TRUELAT1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">lat2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">TRUELAT2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">checkUnits</span><span class="p">(</span><span class="n">spvar</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s1">&#39;pressure&#39;</span><span class="p">)</span>
            <span class="n">checkUnits</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
            <span class="n">checkUnits</span><span class="p">(</span><span class="n">humid</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">)</span>
            <span class="n">checkUnits</span><span class="p">(</span><span class="n">geohvar</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s1">&#39;geopotential&#39;</span><span class="p">)</span>

            <span class="c1"># _FillValue is not always set, but when it is we want to read it</span>
            <span class="n">tNull</span> <span class="o">=</span> <span class="n">getNullValue</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">hNull</span> <span class="o">=</span> <span class="n">getNullValue</span><span class="p">(</span><span class="n">humid</span><span class="p">)</span>
            <span class="n">gNull</span> <span class="o">=</span> <span class="n">getNullValue</span><span class="p">(</span><span class="n">geohvar</span><span class="p">)</span>
            <span class="n">pNull</span> <span class="o">=</span> <span class="n">getNullValue</span><span class="p">(</span><span class="n">spvar</span><span class="p">)</span>

            <span class="n">sp</span> <span class="o">=</span> <span class="n">spvar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">temps</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">humids</span> <span class="o">=</span> <span class="n">humid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">geoh</span> <span class="o">=</span> <span class="n">geohvar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">spvar</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">humid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">geohvar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Projection</span>
        <span class="c1"># See http://www.pkrc.net/wrf-lambert.html</span>
        <span class="n">earthRadius</span> <span class="o">=</span> <span class="mf">6370e3</span>  <span class="c1"># &lt;- note Ray had a bug here</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;lcc&#39;</span><span class="p">,</span> <span class="n">lat_1</span><span class="o">=</span><span class="n">lat1</span><span class="p">,</span>
                 <span class="n">lat_2</span><span class="o">=</span><span class="n">lat2</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="n">lat0</span><span class="p">,</span>
                 <span class="n">lon_0</span><span class="o">=</span><span class="n">lon0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">earthRadius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">earthRadius</span><span class="p">,</span>
                 <span class="n">towgs84</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">no_defs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span> <span class="o">=</span> <span class="n">p1</span>

        <span class="n">temps</span><span class="p">[</span><span class="n">temps</span> <span class="o">==</span> <span class="n">tNull</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">sp</span><span class="p">[</span><span class="n">sp</span> <span class="o">==</span> <span class="n">pNull</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">humids</span><span class="p">[</span><span class="n">humids</span> <span class="o">==</span> <span class="n">hNull</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">geoh</span><span class="p">[</span><span class="n">geoh</span> <span class="o">==</span> <span class="n">gNull</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">temps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">=</span> <span class="n">humids</span>

        <span class="c1"># Zs are problematic because any z below the topography is nan.</span>
        <span class="c1"># For a temporary fix, I will assign any nan value to equal the</span>
        <span class="c1"># nanmean of that level.</span>
        <span class="n">zmeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">geoh</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">geoh</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">Zmeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">zmeans</span><span class="p">,</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">Zmeans</span> <span class="o">=</span> <span class="n">Zmeans</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">geoh</span><span class="p">)</span>
        <span class="n">geoh</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Zmeans</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">geoh</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span>
                <span class="n">sp</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">sp</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="RAiDER.models.wrf.WRF.load_weather" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_weather</span><span class="p">(</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Consistent class method to be implemented across all weather model types</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/wrf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consistent class method to be implemented across all weather model types</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wm_nodes</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_netcdf</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_wm_nodes</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_netcdf</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>

    <span class="c1"># WRF doesn&#39;t give us the coordinates of the points in the native projection,</span>
    <span class="c1"># only the coordinates in lat/long. Ray transformed these to the native</span>
    <span class="c1"># projection, then used an average to enforce a regular grid. It does matter</span>
    <span class="c1"># for the interpolation whether the grid is regular.</span>
    <span class="n">lla</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_proj</span><span class="p">(</span><span class="n">lla</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span><span class="p">)</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lats</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Expected accuracy here is to two decimal places (five significant digits)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># Re-structure everything from (heights, lats, lons) to (lons, lats, heights)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rh</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_ys</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_xs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="p">)</span>

    <span class="c1"># TODO: Not sure if WRF provides this</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.wrf.checkUnits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkUnits</span><span class="p">(</span><span class="n">unitCheck</span><span class="p">,</span> <span class="n">varName</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Implement a check that the units are as expected</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/wrf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkUnits</span><span class="p">(</span><span class="n">unitCheck</span><span class="p">,</span> <span class="n">varName</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implement a check that the units are as expected</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">unitDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pressure&#39;</span><span class="p">:</span> <span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;geopotential&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">unitCheck</span> <span class="o">!=</span> <span class="n">unitDict</span><span class="p">[</span><span class="n">varName</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">UnitTypeError</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">unitCheck</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="RAiDER.models.wrf.getNullValue" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getNullValue</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get the null (or fill) value if it exists, otherwise set the null value to defNullValue</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/models/wrf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getNullValue</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the null (or fill) value if it exists, otherwise set the null value to defNullValue</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># NetCDF files have the ability to record their nodata value, but in the</span>
    <span class="c1"># particular NetCDF files that I&#39;m reading, this field is left</span>
    <span class="c1"># unspecified and a nodata value of -999 is used. The solution I&#39;m using</span>
    <span class="c1"># is to check if nodata is specified, and otherwise assume it&#39;s -999.</span>
    <span class="n">_default_fill_value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">var_fill</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">_FillValue</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">var_fill</span> <span class="o">=</span> <span class="n">_default_fill_value</span>

    <span class="k">return</span> <span class="n">var_fill</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.processWM" class="doc doc-heading">
            <code>processWM</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.processWM.prepareWeatherModel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepareWeatherModel</span><span class="p">(</span><span class="n">weather_model</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">,</span> <span class="n">download_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">makePlots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_download</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Parse inputs to download and prepare a weather model grid for interpolation</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>weather_model</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>WeatherModel   - instantiated weather model object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>datetime                - Python datetime to request. Will be rounded to nearest available time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ll_bounds</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list/array         - SNWE bounds target area to ensure weather model contains them</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>download_only</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool           - False if preprocessing weather model data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>makePlots</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool               - whether to write debug plots</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_download</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool          - True if you want to download even when the weather model exists</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename of the netcdf file to which the weather model has been written</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/processWM.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepareWeatherModel</span><span class="p">(</span>
        <span class="n">weather_model</span><span class="p">,</span>
        <span class="n">time</span><span class="p">,</span>
        <span class="n">ll_bounds</span><span class="p">,</span>
        <span class="n">download_only</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">makePlots</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">force_download</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse inputs to download and prepare a weather model grid for interpolation</span>

<span class="sd">    Args:</span>
<span class="sd">        weather_model: WeatherModel   - instantiated weather model object</span>
<span class="sd">        time: datetime                - Python datetime to request. Will be rounded to nearest available time</span>
<span class="sd">        ll_bounds: list/array         - SNWE bounds target area to ensure weather model contains them</span>
<span class="sd">        download_only: bool           - False if preprocessing weather model data</span>
<span class="sd">        makePlots: bool               - whether to write debug plots</span>
<span class="sd">        force_download: bool          - True if you want to download even when the weather model exists</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: filename of the netcdf file to which the weather model has been written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## set the bounding box from the in the case that it hasn&#39;t been set</span>
    <span class="k">if</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">get_latlon_bounds</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weather_model</span><span class="o">.</span><span class="n">set_latlon_bounds</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span>

    <span class="c1"># Ensure the file output location exists</span>
    <span class="n">wmLoc</span>     <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">get_wmLoc</span><span class="p">()</span>
    <span class="n">weather_model</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="c1"># get the path to the less processed weather model file</span>
    <span class="n">path_wm_raw</span> <span class="o">=</span> <span class="n">make_raw_weather_data_filename</span><span class="p">(</span><span class="n">wmLoc</span><span class="p">,</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">Model</span><span class="p">(),</span> <span class="n">time</span><span class="p">)</span>

    <span class="c1"># get the path to the more processed (cropped) weather model file</span>
    <span class="n">path_wm_crop</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">out_file</span><span class="p">(</span><span class="n">wmLoc</span><span class="p">)</span>

    <span class="c1"># check whether weather model files exists and/or or should be downloaded</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_wm_crop</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_download</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;Processed weather model already exists, please remove it (&quot;</span><span class="si">%s</span><span class="s1">&quot;) if you want &#39;</span>
            <span class="s1">&#39;to download a new one.&#39;</span><span class="p">,</span> <span class="n">path_wm_crop</span><span class="p">)</span>

    <span class="c1"># check whether the raw weather model covers this area</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="n">checkContainment_raw</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">,</span> <span class="n">ll_bounds</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_download</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;Raw weather model already exists, please remove it (&quot;</span><span class="si">%s</span><span class="s1">&quot;) if you want &#39;</span>
            <span class="s1">&#39;to download a new one.&#39;</span><span class="p">,</span> <span class="n">path_wm_raw</span><span class="p">)</span>

    <span class="c1"># if no weather model files supplied, check the standard location</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">weather_model</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">path_wm_raw</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DatetimeOutsideRange</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TryToKeepGoingError</span>

    <span class="c1"># If only downloading, exit now</span>
    <span class="k">if</span> <span class="n">download_only</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;download_only flag selected. No further processing will happen.&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Otherwise, load the weather model data</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;The processed weather model file already exists,&#39;</span>
            <span class="s1">&#39; so I will use that.&#39;</span>
        <span class="p">)</span>

        <span class="n">containment</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">checkContainment</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">containment</span> <span class="ow">and</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;HRRR&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExistingWeatherModelTooSmall</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="c1"># Logging some basic info</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s1">&#39;Number of weather model nodes: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">getWetRefractivity</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">getWetRefractivity</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape of weather model: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s1">&#39;Bounds of the weather model: </span><span class="si">%.2f</span><span class="s1">/</span><span class="si">%.2f</span><span class="s1">/</span><span class="si">%.2f</span><span class="s1">/</span><span class="si">%.2f</span><span class="s1"> (SNWE)&#39;</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_ys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_ys</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_xs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">_xs</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Weather model: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">Model</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s1">&#39;Mean value of the wet refractivity: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">getWetRefractivity</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s1">&#39;Mean value of the hydrostatic refractivity: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">weather_model</span><span class="o">.</span><span class="n">getHydroRefractivity</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">weather_model</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">makePlots</span><span class="p">:</span>
        <span class="n">weather_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;wh&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">weather_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;pqt&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="n">containment</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">checkContainment</span><span class="p">(</span><span class="n">ll_bounds</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unable to save weathermodel to file&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">CriticalError</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">wm</span> <span class="o">=</span> <span class="n">weather_model</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">weather_model</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">containment</span> <span class="ow">and</span> <span class="n">wm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;HRRR&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ExistingWeatherModelTooSmall</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.s1_azimuth_timing" class="doc doc-heading">
            <code>s1_azimuth_timing</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_azimuth_time_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_azimuth_time_grid</span><span class="p">(</span><span class="n">lon_mesh</span><span class="p">,</span> <span class="n">lat_mesh</span><span class="p">,</span> <span class="n">hgt_mesh</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Source: https://github.com/dbekaert/RAiDER/blob/dev/tools/RAiDER/losreader.py#L601C1-L674C22</p>
<p>lon_mesh, lat_mesh, hgt_mesh are coordinate arrays (this routine makes a mesh to comute azimuth timing grid)</p>
<p>Technically, this is "sensor neutral" since it uses an orb object.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_azimuth_time_grid</span><span class="p">(</span><span class="n">lon_mesh</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">lat_mesh</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">hgt_mesh</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">orb</span><span class="p">:</span> <span class="s1">&#39;isce.core.Orbit&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Source: https://github.com/dbekaert/RAiDER/blob/dev/tools/RAiDER/losreader.py#L601C1-L674C22</span>

<span class="sd">    lon_mesh, lat_mesh, hgt_mesh are coordinate arrays (this routine makes a mesh to comute azimuth timing grid)</span>

<span class="sd">    Technically, this is &quot;sensor neutral&quot; since it uses an orb object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;isce3 is required for this function. Use conda to install isce3`&#39;</span><span class="p">)</span>

    <span class="n">num_iteration</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">residual_threshold</span> <span class="o">=</span> <span class="mf">1.0e-7</span>

    <span class="n">elp</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">()</span>
    <span class="n">dop</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LUT2d</span><span class="p">()</span>
    <span class="n">look</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LookSide</span><span class="o">.</span><span class="n">Right</span>

    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">hgt_mesh</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">az_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;NaT&#39;</span><span class="p">),</span>
                     <span class="c1"># source: https://stackoverflow.com/a/27469108</span>
                     <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ms]&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind_0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind_1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

                <span class="n">hgt_pt</span><span class="p">,</span> <span class="n">lat_pt</span><span class="p">,</span> <span class="n">lon_pt</span> <span class="o">=</span> <span class="p">(</span><span class="n">hgt_mesh</span><span class="p">[</span><span class="n">ind_0</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">],</span>
                                          <span class="n">lat_mesh</span><span class="p">[</span><span class="n">ind_0</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">],</span>
                                          <span class="n">lon_mesh</span><span class="p">[</span><span class="n">ind_0</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">])</span>

                <span class="n">input_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lon_pt</span><span class="p">),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat_pt</span><span class="p">),</span>
                                      <span class="n">hgt_pt</span><span class="p">])</span>

                <span class="n">aztime</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">isce</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geo2rdr</span><span class="p">(</span>
                    <span class="n">input_vec</span><span class="p">,</span> <span class="n">elp</span><span class="p">,</span> <span class="n">orb</span><span class="p">,</span> <span class="n">dop</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="n">look</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">residual_threshold</span><span class="p">,</span>
                    <span class="n">maxiter</span><span class="o">=</span><span class="n">num_iteration</span><span class="p">,</span>
                    <span class="n">delta_range</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

                <span class="n">rng_seconds</span> <span class="o">=</span> <span class="n">sr</span> <span class="o">/</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">speed_of_light</span>
                <span class="n">aztime</span> <span class="o">=</span> <span class="n">aztime</span> <span class="o">+</span> <span class="n">rng_seconds</span>
                <span class="n">aztime_isce</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">reference_epoch</span> <span class="o">+</span> <span class="n">isce</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TimeDelta</span><span class="p">(</span><span class="n">aztime</span><span class="p">)</span>
                <span class="n">aztime_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">aztime_isce</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
                <span class="n">az_arr</span><span class="p">[</span><span class="n">ind_0</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">aztime_np</span>
    <span class="k">return</span> <span class="n">az_arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_inverse_weights_for_dates</span><span class="p">(</span><span class="n">azimuth_time_array</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">inverse_regularizer</span><span class="o">=</span><span class="mf">1e-09</span><span class="p">,</span> <span class="n">temporal_window_hours</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Obtains weights according to inverse weighting with respect to the absolute difference between
azimuth timing array and dates. The output will be a list with length equal to that of dates and
whose entries are arrays each whose shape matches the azimuth_timing_array.</p>
<p>Note: we do not do any checking of the provided dates outside that they are unique so the inferred
<code>temporal_window_hours</code> may be incorrect.</p>
<h5 id="RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--parameters">Parameters</h5>
<p>azimuth_time_array : np.ndarray
    Array of type <code>np.datetime64[ms]</code>
dates : list[datetime.datetime]
    List of datetimes
inverse_regularizer : float, optional
    If a <code>time</code> in the azimuth time arr equals one of the given dates, then the regularlizer ensures that the value
    <code>1 / (|date - time| + inverse_regularizer) = weight</code> is not infinity, by default 1e-9
temporal_window_hours : float, optional
    Values outside of this are masked from inverse weighted.
    If None, then window is minimum abs difference of dates (inferring the temporal resolution), by default None
    No check of equi-spaced dates are done so not specifying temporal window hours requires dates to be derived
    from valid model time steps</p>
<h5 id="RAiDER.s1_azimuth_timing.get_inverse_weights_for_dates--returns">Returns</h5>
<p>list[np.ndarray]
    Weighting per pixel with respect to each date</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_inverse_weights_for_dates</span><span class="p">(</span><span class="n">azimuth_time_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                  <span class="n">dates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
                                  <span class="n">inverse_regularizer</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span>
                                  <span class="n">temporal_window_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtains weights according to inverse weighting with respect to the absolute difference between</span>
<span class="sd">    azimuth timing array and dates. The output will be a list with length equal to that of dates and</span>
<span class="sd">    whose entries are arrays each whose shape matches the azimuth_timing_array.</span>

<span class="sd">    Note: we do not do any checking of the provided dates outside that they are unique so the inferred</span>
<span class="sd">    `temporal_window_hours` may be incorrect.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    azimuth_time_array : np.ndarray</span>
<span class="sd">        Array of type `np.datetime64[ms]`</span>
<span class="sd">    dates : list[datetime.datetime]</span>
<span class="sd">        List of datetimes</span>
<span class="sd">    inverse_regularizer : float, optional</span>
<span class="sd">        If a `time` in the azimuth time arr equals one of the given dates, then the regularlizer ensures that the value</span>
<span class="sd">        `1 / (|date - time| + inverse_regularizer) = weight` is not infinity, by default 1e-9</span>
<span class="sd">    temporal_window_hours : float, optional</span>
<span class="sd">        Values outside of this are masked from inverse weighted.</span>
<span class="sd">        If None, then window is minimum abs difference of dates (inferring the temporal resolution), by default None</span>
<span class="sd">        No check of equi-spaced dates are done so not specifying temporal window hours requires dates to be derived</span>
<span class="sd">        from valid model time steps</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[np.ndarray]</span>
<span class="sd">        Weighting per pixel with respect to each date</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_unique_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
    <span class="n">n_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_unique_dates</span> <span class="o">!=</span> <span class="n">n_dates</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dates provided must be unique&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_dates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No dates provided&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dates must be all datetimes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temporal_window_hours</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">temporal_window_seconds</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">abs</span><span class="p">((</span><span class="n">date</span> <span class="o">-</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temporal_window_seconds</span> <span class="o">=</span> <span class="n">temporal_window_hours</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="c1"># Get absolute differences</span>
    <span class="n">dates_np</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">,</span> <span class="n">dates</span><span class="p">))</span>
    <span class="n">abs_diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">azimuth_time_array</span> <span class="o">-</span> <span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates_np</span><span class="p">]</span>

    <span class="c1"># Get inverse weighting with mask determined by window</span>
    <span class="n">wgts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">diff</span> <span class="o">+</span> <span class="n">inverse_regularizer</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">abs_diff</span><span class="p">]</span>
    <span class="n">masks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">diff</span> <span class="o">&lt;=</span> <span class="n">temporal_window_seconds</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">abs_diff</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No dates provided are within temporal window&#39;</span><span class="p">)</span>

    <span class="c1"># Normalize so that sum of weights is 1</span>
    <span class="n">wgts_masked</span> <span class="o">=</span> <span class="p">[</span><span class="n">wgt</span> <span class="o">*</span> <span class="n">mask</span> <span class="k">for</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wgts</span><span class="p">,</span> <span class="n">masks</span><span class="p">)]</span>
    <span class="n">wgts_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">wgts_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">wgts_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">wgt</span> <span class="o">/</span> <span class="n">wgts_sum</span> <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">wgts_masked</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wgts_norm</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_n_closest_datetimes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_n_closest_datetimes</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">n_target_times</span><span class="p">,</span> <span class="n">time_step_hours</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Gets n closes times relative to the <code>round_to_hour_delta</code> and the
<code>ref_time</code>. Specifically, if one is interetsted in getting 3 closest times
to say 0, 6, 12, 18 UTC times of a ref time <code>dt</code>, then:</p>
<pre><code>dt = datetime.datetime(2023, 1, 1, 11, 0, 0)
get_n_closest_datetimes(dt, 3, 6)
</code></pre>
<p>gives the desired answer of</p>
<pre><code>[datetime.datetime(2023, 1, 1, 12, 0, 0),
 datetime.datetime(2023, 1, 1, 6, 0, 0),
 datetime.datetime(2023, 1, 1, 18, 0, 0)]
</code></pre>
<h5 id="RAiDER.s1_azimuth_timing.get_n_closest_datetimes--parameters">Parameters</h5>
<p>ref_time : datetime.datetime
    Time to round from
n_times : int
    Number of times to get
time_step_hours : int
    If 1, then rounds ref_time to nearest hour(s). If 2, then rounds to
    nearest 0, 2, 4, etc. times. Must be divisible by 24 otherwise is
    not consistent across all days.</p>
<h5 id="RAiDER.s1_azimuth_timing.get_n_closest_datetimes--returns">Returns</h5>
<p>list[datetime.datetime]
    List of closest dates ordered by absolute proximity. If two dates have same distance to ref_time,
    choose earlier one (more likely to be available)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_n_closest_datetimes</span><span class="p">(</span><span class="n">ref_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                            <span class="n">n_target_times</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">time_step_hours</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets n closes times relative to the `round_to_hour_delta` and the</span>
<span class="sd">    `ref_time`. Specifically, if one is interetsted in getting 3 closest times</span>
<span class="sd">    to say 0, 6, 12, 18 UTC times of a ref time `dt`, then:</span>
<span class="sd">    ```</span>
<span class="sd">    dt = datetime.datetime(2023, 1, 1, 11, 0, 0)</span>
<span class="sd">    get_n_closest_datetimes(dt, 3, 6)</span>
<span class="sd">    ```</span>
<span class="sd">    gives the desired answer of</span>
<span class="sd">    ```</span>
<span class="sd">    [datetime.datetime(2023, 1, 1, 12, 0, 0),</span>
<span class="sd">     datetime.datetime(2023, 1, 1, 6, 0, 0),</span>
<span class="sd">     datetime.datetime(2023, 1, 1, 18, 0, 0)]</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_time : datetime.datetime</span>
<span class="sd">        Time to round from</span>
<span class="sd">    n_times : int</span>
<span class="sd">        Number of times to get</span>
<span class="sd">    time_step_hours : int</span>
<span class="sd">        If 1, then rounds ref_time to nearest hour(s). If 2, then rounds to</span>
<span class="sd">        nearest 0, 2, 4, etc. times. Must be divisible by 24 otherwise is</span>
<span class="sd">        not consistent across all days.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[datetime.datetime]</span>
<span class="sd">        List of closest dates ordered by absolute proximity. If two dates have same distance to ref_time,</span>
<span class="sd">        choose earlier one (more likely to be available)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_target_times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">closest_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="p">(</span><span class="mi">24</span> <span class="o">%</span> <span class="n">time_step_hours</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The time step does not evenly divide 24 hours;&#39;</span>
                         <span class="s1">&#39;Time step has period &gt; 1 day and depends when model &#39;</span>
                         <span class="s1">&#39;starts&#39;</span><span class="p">)</span>

    <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">ref_time</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">ts_0</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="p">(</span><span class="n">time_step_hours</span> <span class="o">*</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">ts_1</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="p">(</span><span class="n">time_step_hours</span> <span class="o">*</span> <span class="n">k</span><span class="p">))</span>

        <span class="n">t_ceil</span> <span class="o">=</span> <span class="n">ts_0</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_step_hours</span><span class="si">}</span><span class="s1">H&#39;</span><span class="p">)</span>
        <span class="n">t_floor</span> <span class="o">=</span> <span class="n">ts_1</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_step_hours</span><span class="si">}</span><span class="s1">H&#39;</span><span class="p">)</span>
        <span class="c1"># In the event that t_floor == t_ceil for k = 0</span>
        <span class="n">out_times</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">t_ceil</span><span class="p">,</span> <span class="n">t_floor</span><span class="p">]))</span>
        <span class="n">closest_times</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">out_times</span><span class="p">)</span>
    <span class="c1"># if 2 times have same distance to ref_time, order times by occurence (earlier comes first)</span>
    <span class="n">closest_times</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">closest_times</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ts_rounded</span><span class="p">:</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ts</span> <span class="o">-</span> <span class="n">ts_rounded</span><span class="p">),</span> <span class="n">ts_rounded</span><span class="p">))</span>
    <span class="n">closest_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">closest_times</span><span class="p">]</span>
    <span class="n">closest_times</span> <span class="o">=</span> <span class="n">closest_times</span><span class="p">[:</span><span class="n">n_target_times</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">closest_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_s1_azimuth_time_grid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">hgt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Based on the lon, lat, hgt (3d cube) - obtains an associated s1 orbit
file to calculate the azimuth timing across the cube. Requires datetime of acq
associated to cube.</p>
<h5 id="RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--parameters">Parameters</h5>
<p>lon : np.ndarray
    1 dimensional coordinate array or 3d mesh of coordinates
lat : np.ndarray
    1 dimensional coordinate array or 3d mesh of coordinates
hgt : np.ndarray
    1 dimensional coordinate array or 3d mesh of coordinates
dt : datetime.datetime</p>
<h5 id="RAiDER.s1_azimuth_timing.get_s1_azimuth_time_grid--returns">Returns</h5>
<p>np.ndarray
    Cube whose coordinates are hgt x lat x lon with each pixel</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_s1_azimuth_time_grid</span><span class="p">(</span><span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                             <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                             <span class="n">hgt</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                             <span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Based on the lon, lat, hgt (3d cube) - obtains an associated s1 orbit</span>
<span class="sd">    file to calculate the azimuth timing across the cube. Requires datetime of acq</span>
<span class="sd">    associated to cube.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon : np.ndarray</span>
<span class="sd">        1 dimensional coordinate array or 3d mesh of coordinates</span>
<span class="sd">    lat : np.ndarray</span>
<span class="sd">        1 dimensional coordinate array or 3d mesh of coordinates</span>
<span class="sd">    hgt : np.ndarray</span>
<span class="sd">        1 dimensional coordinate array or 3d mesh of coordinates</span>
<span class="sd">    dt : datetime.datetime</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        Cube whose coordinates are hgt x lat x lon with each pixel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">hgt</span><span class="p">]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">dim</span> <span class="o">==</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All coordinates have same dimension (either 1 or 3 dimensional)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">dim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinates must be 1d or 3d coordinate arrays&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hgt_mesh</span><span class="p">,</span> <span class="n">lat_mesh</span><span class="p">,</span> <span class="n">lon_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">hgt</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span>
                                                   <span class="c1"># indexing keyword argument</span>
                                                   <span class="c1"># Ensures output dimensions</span>
                                                   <span class="c1"># align with order the inputs</span>
                                                   <span class="c1"># height x latitude x longitude</span>
                                                   <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hgt_mesh</span> <span class="o">=</span> <span class="n">hgt</span>
        <span class="n">lat_mesh</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="n">lon_mesh</span> <span class="o">=</span> <span class="n">lon</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lon_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">lat_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">slc_ids</span> <span class="o">=</span> <span class="n">get_slc_id_from_point_and_time</span><span class="p">(</span><span class="n">lon_m</span><span class="p">,</span> <span class="n">lat_m</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No slc id found for the given datetime and grid; returning empty grid&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">hgt_mesh</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">az_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;NaT&#39;</span><span class="p">),</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ms]&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">az_arr</span>

    <span class="n">orb_files</span> <span class="o">=</span> <span class="n">get_orbits_from_slc_ids_hyp3lib</span><span class="p">(</span><span class="n">slc_ids</span><span class="p">)</span>
    <span class="n">orb_files</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">of</span><span class="p">)</span> <span class="k">for</span> <span class="n">of</span> <span class="ow">in</span> <span class="n">orb_files</span><span class="p">]</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">get_isce_orbit</span><span class="p">(</span><span class="n">orb_files</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="n">az_arr</span> <span class="o">=</span> <span class="n">get_azimuth_time_grid</span><span class="p">(</span><span class="n">lon_mesh</span><span class="p">,</span> <span class="n">lat_mesh</span><span class="p">,</span> <span class="n">hgt_mesh</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">az_arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_slc_id_from_point_and_time</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">buffer_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">buffer_deg</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Obtains a (non-unique) SLC id from the lon/lat and datetime of inputs. The buffere ensures that
an SLC id is within the queried start/end times. Note an S1 scene takes roughly 30 seconds to acquire.</p>
<h5 id="RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--parameters">Parameters</h5>
<p>lon : float
lat : float
dt : datetime.datetime
buffer_seconds : int, optional
    Do not recommend adjusting this, by default 600, to ensure enough padding for multiple orbit files</p>
<h5 id="RAiDER.s1_azimuth_timing.get_slc_id_from_point_and_time--returns">Returns</h5>
<p>list
    All slc_ids returned by asf_search</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_slc_id_from_point_and_time</span><span class="p">(</span><span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                   <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                   <span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                   <span class="n">buffer_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
                                   <span class="n">buffer_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtains a (non-unique) SLC id from the lon/lat and datetime of inputs. The buffere ensures that</span>
<span class="sd">    an SLC id is within the queried start/end times. Note an S1 scene takes roughly 30 seconds to acquire.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon : float</span>
<span class="sd">    lat : float</span>
<span class="sd">    dt : datetime.datetime</span>
<span class="sd">    buffer_seconds : int, optional</span>
<span class="sd">        Do not recommend adjusting this, by default 600, to ensure enough padding for multiple orbit files</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        All slc_ids returned by asf_search</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="n">time_delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">buffer_seconds</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">time_delta</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">time_delta</span>

    <span class="c1"># Requires buffer of degrees to get several SLCs and ensure we get correct</span>
    <span class="c1"># orbit files</span>
    <span class="n">slc_ids</span> <span class="o">=</span> <span class="n">_asf_query</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">buffer_degrees</span><span class="o">=</span><span class="n">buffer_deg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">slc_ids</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No results found for input lon/lat and datetime&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">slc_ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_times_for_azimuth_interpolation</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">time_step_hours</span><span class="p">,</span> <span class="n">buffer_in_seconds</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Obtains times needed for azimuth interpolation. Filters 3 closests dates from ref_time
so that all returned dates are within <code>time_step_hours</code> + <code>buffer_in_seconds</code>.</p>
<p>This ensures we request dates that are really needed.</p>
<pre><code>dt = datetime.datetime(2023, 1, 1, 11, 1, 0)
get_times_for_azimuth_interpolation(dt, 1)
</code></pre>
<p>yields</p>
<pre><code>[datetime.datetime(2023, 1, 1, 11, 0, 0),
 datetime.datetime(2023, 1, 1, 12, 0, 0),
 datetime.datetime(2023, 1, 1, 10, 0, 0)]
</code></pre>
<p>whereas</p>
<pre><code>dt = datetime.datetime(2023, 1, 1, 11, 30, 0)
get_times_for_azimuth_interpolation(dt, 1)
</code></pre>
<p>yields</p>
<pre><code>[datetime.datetime(2023, 1, 1, 11, 0, 0),
 datetime.datetime(2023, 1, 1, 12, 0, 0)]
</code></pre>
<h5 id="RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--parameters">Parameters</h5>
<p>ref_time : datetime.datetime
    A time of acquisition
time_step_hours : int
    Weather model time step, should evenly divide 24 hours
buffer_in_seconds : int, optional
    Buffer for filtering absolute times, by default 300 (or 5 minutes)</p>
<h5 id="RAiDER.s1_azimuth_timing.get_times_for_azimuth_interpolation--returns">Returns</h5>
<p>list[datetime.datetime]
    2 or 3 closest times within 1 time step (plust the buffer) and the reference time</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_azimuth_timing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_times_for_azimuth_interpolation</span><span class="p">(</span><span class="n">ref_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                        <span class="n">time_step_hours</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                        <span class="n">buffer_in_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtains times needed for azimuth interpolation. Filters 3 closests dates from ref_time</span>
<span class="sd">    so that all returned dates are within `time_step_hours` + `buffer_in_seconds`.</span>

<span class="sd">    This ensures we request dates that are really needed.</span>
<span class="sd">    ```</span>
<span class="sd">    dt = datetime.datetime(2023, 1, 1, 11, 1, 0)</span>
<span class="sd">    get_times_for_azimuth_interpolation(dt, 1)</span>
<span class="sd">    ```</span>
<span class="sd">    yields</span>
<span class="sd">    ```</span>
<span class="sd">    [datetime.datetime(2023, 1, 1, 11, 0, 0),</span>
<span class="sd">     datetime.datetime(2023, 1, 1, 12, 0, 0),</span>
<span class="sd">     datetime.datetime(2023, 1, 1, 10, 0, 0)]</span>
<span class="sd">    ```</span>
<span class="sd">    whereas</span>
<span class="sd">    ```</span>
<span class="sd">    dt = datetime.datetime(2023, 1, 1, 11, 30, 0)</span>
<span class="sd">    get_times_for_azimuth_interpolation(dt, 1)</span>
<span class="sd">    ```</span>
<span class="sd">    yields</span>
<span class="sd">    ```</span>
<span class="sd">    [datetime.datetime(2023, 1, 1, 11, 0, 0),</span>
<span class="sd">     datetime.datetime(2023, 1, 1, 12, 0, 0)]</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_time : datetime.datetime</span>
<span class="sd">        A time of acquisition</span>
<span class="sd">    time_step_hours : int</span>
<span class="sd">        Weather model time step, should evenly divide 24 hours</span>
<span class="sd">    buffer_in_seconds : int, optional</span>
<span class="sd">        Buffer for filtering absolute times, by default 300 (or 5 minutes)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[datetime.datetime]</span>
<span class="sd">        2 or 3 closest times within 1 time step (plust the buffer) and the reference time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get 3 closest times</span>
    <span class="n">closest_times</span> <span class="o">=</span> <span class="n">get_n_closest_datetimes</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">time_step_hours</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_time</span><span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="n">absolute_time_difference_sec</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">ref_time</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
        <span class="n">upper_bound_seconds</span> <span class="o">=</span> <span class="n">time_step_hours</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">buffer_in_seconds</span>
        <span class="k">return</span> <span class="n">absolute_time_difference_sec</span> <span class="o">&lt;</span> <span class="n">upper_bound_seconds</span>
    <span class="n">out_times</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_time</span><span class="p">,</span> <span class="n">closest_times</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.s1_orbits" class="doc doc-heading">
            <code>s1_orbits</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_orbits.download_eofs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_eofs</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">missions</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Wrapper around sentineleof to first try downloading from ASF and fall back to CDSE</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_orbits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_eofs</span><span class="p">(</span><span class="n">dts</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">missions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper around sentineleof to first try downloading from ASF and fall back to CDSE&quot;&quot;&quot;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ensure_orbit_credentials</span><span class="p">()</span>

    <span class="n">orb_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mission</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">missions</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dt</span><span class="p">]</span>
        <span class="n">mission</span> <span class="o">=</span> <span class="n">mission</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mission</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">mission</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">orb_file</span> <span class="o">=</span> <span class="n">eof</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">download_eofs</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">mission</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">force_asf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Could not download orbit from ASF, trying ESA...&#39;</span><span class="p">)</span>
            <span class="n">orb_file</span> <span class="o">=</span> <span class="n">eof</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">download_eofs</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">mission</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">force_asf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">orb_file</span> <span class="o">=</span> <span class="n">orb_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb_file</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">orb_file</span>
        <span class="n">orb_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orb_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">orb_files</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">orb_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> orbit files! dts=</span><span class="si">{</span><span class="n">dts</span><span class="si">}</span><span class="s1">, orb_files=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">orb_files</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">orb_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_orbits.ensure_orbit_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_orbit_credentials</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensure credentials exist for ESA's CDSE and ASF's S1QC to download orbits</p>
<p>This method will prefer to use CDSE and NASA Earthdata credentials from your <code>~/.netrc</code> file if they exist,
otherwise will look for environment variables and update or create your <code>~/.netrc</code> file. The environment variables
used are:
    CDSE: ESA_USERNAME, ESA_PASSWORD
    S1QC: EARTHDATA_USERNAME, EARTHDATA_PASSWORD</p>
<p>Returns <code>None</code> if the <code>~/.netrc</code> file did not need to be updated and the number of characters written if it did.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_orbits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_orbit_credentials</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure credentials exist for ESA&#39;s CDSE and ASF&#39;s S1QC to download orbits</span>

<span class="sd">    This method will prefer to use CDSE and NASA Earthdata credentials from your `~/.netrc` file if they exist,</span>
<span class="sd">    otherwise will look for environment variables and update or create your `~/.netrc` file. The environment variables</span>
<span class="sd">    used are:</span>
<span class="sd">        CDSE: ESA_USERNAME, ESA_PASSWORD</span>
<span class="sd">        S1QC: EARTHDATA_USERNAME, EARTHDATA_PASSWORD</span>

<span class="sd">     Returns `None` if the `~/.netrc` file did not need to be updated and the number of characters written if it did.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">netrc_file</span> <span class="o">=</span> <span class="n">_netrc_path</span><span class="p">()</span>

    <span class="c1"># netrc needs a netrc file; if missing create an empty one.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">netrc_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">netrc_file</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mo">0o600</span><span class="p">)</span>

    <span class="n">netrc_credentials</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">(</span><span class="n">netrc_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ESA_CDSE_HOST</span> <span class="ow">in</span> <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span> <span class="ow">and</span> <span class="n">NASA_EDL_HOST</span> <span class="ow">in</span> <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">ESA_CDSE_HOST</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ESA_USERNAME&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ESA_PASSWORD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Credentials are required for fetching orbit data from dataspace.copernicus.eu!</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Either add your credentials to ~/.netrc or set the ESA_USERNAME and ESA_PASSWORD &#39;</span>
                             <span class="s1">&#39;environment variables.&#39;</span><span class="p">)</span>

        <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span><span class="p">[</span><span class="n">ESA_CDSE_HOST</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">NASA_EDL_HOST</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EARTHDATA_USERNAME&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EARTHDATA_PASSWORD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Credentials are required for fetching orbit data from s1qc.asf.alaska.edu!</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Either add your credentials to ~/.netrc or set the EARTHDATA_USERNAME and&#39;</span>
                             <span class="s1">&#39; EARTHDATA_PASSWORD environment variables.&#39;</span><span class="p">)</span>

        <span class="n">netrc_credentials</span><span class="o">.</span><span class="n">hosts</span><span class="p">[</span><span class="n">NASA_EDL_HOST</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">netrc_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">netrc_credentials</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_orbits.get_orbits_from_slc_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_orbits_from_slc_ids</span><span class="p">(</span><span class="n">slc_ids</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Download all orbit files for a set of SLCs</p>
<p>This method will ensure that the downloaded orbit files cover the entire acquisition start-&gt;stop time</p>
<p>Returns a list of orbit file paths</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_orbits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_orbits_from_slc_ids</span><span class="p">(</span><span class="n">slc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">directory</span><span class="o">=</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download all orbit files for a set of SLCs</span>

<span class="sd">    This method will ensure that the downloaded orbit files cover the entire acquisition start-&gt;stop time</span>

<span class="sd">    Returns a list of orbit file paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missions</span> <span class="o">=</span> <span class="p">[</span><span class="n">slc_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">slc_id</span> <span class="ow">in</span> <span class="n">slc_ids</span><span class="p">]</span>
    <span class="n">start_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_+&#39;</span><span class="p">,</span> <span class="n">slc_id</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">slc_id</span> <span class="ow">in</span> <span class="n">slc_ids</span><span class="p">]</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_+&#39;</span><span class="p">,</span> <span class="n">slc_id</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">slc_id</span> <span class="ow">in</span> <span class="n">slc_ids</span><span class="p">]</span>

    <span class="n">orb_files</span> <span class="o">=</span> <span class="n">download_eofs</span><span class="p">(</span><span class="n">start_times</span> <span class="o">+</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">missions</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">orb_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.s1_orbits.get_orbits_from_slc_ids_hyp3lib" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_orbits_from_slc_ids_hyp3lib</span><span class="p">(</span><span class="n">slc_ids</span><span class="p">,</span> <span class="n">orbit_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reference: https://github.com/ACCESS-Cloud-Based-InSAR/DockerizedTopsApp/blob/dev/isce2_topsapp/localize_orbits.py#L23</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/s1_orbits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_orbits_from_slc_ids_hyp3lib</span><span class="p">(</span>
    <span class="n">slc_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">orbit_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reference: https://github.com/ACCESS-Cloud-Based-InSAR/DockerizedTopsApp/blob/dev/isce2_topsapp/localize_orbits.py#L23&quot;&quot;&quot;</span>

    <span class="c1"># Populates env variables to netrc as required for sentineleof</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ensure_orbit_credentials</span><span class="p">()</span>
    <span class="n">esa_username</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">esa_password</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span><span class="n">ESA_CDSE_HOST</span><span class="p">)</span>
    <span class="n">esa_credentials</span> <span class="o">=</span> <span class="n">esa_username</span><span class="p">,</span> <span class="n">esa_password</span>

    <span class="n">orbit_directory</span> <span class="o">=</span> <span class="n">orbit_directory</span> <span class="ow">or</span> <span class="s1">&#39;orbits&#39;</span>
    <span class="n">orbit_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">orbit_directory</span><span class="p">)</span>
    <span class="n">orbit_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">orbit_fetcher</span> <span class="o">=</span> <span class="n">get_orb</span><span class="o">.</span><span class="n">downloadSentinelOrbitFile</span>

    <span class="n">orbits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">scene</span> <span class="ow">in</span> <span class="n">slc_ids</span><span class="p">:</span>
        <span class="n">orbit_file</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">orbit_fetcher</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">orbit_dir</span><span class="p">),</span> <span class="n">esa_credentials</span><span class="o">=</span><span class="n">esa_credentials</span><span class="p">,</span> <span class="n">providers</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ASF&#39;</span><span class="p">,</span> <span class="s1">&#39;ESA&#39;</span><span class="p">))</span>
        <span class="n">orbits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orbit_file</span><span class="p">)</span>

    <span class="n">orbits</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">orbits</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">orbits</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="RAiDER.utilFcns" class="doc doc-heading">
            <code>utilFcns</code>


</h2>

    <div class="doc doc-contents ">

      <p>Geodesy-related utility functions.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.calcgeoh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calcgeoh</span><span class="p">(</span><span class="n">lnsp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">R_d</span><span class="p">,</span> <span class="n">num_levels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate pressure, geopotential, and geopotential height
from the surface pressure and model levels provided by a weather model.
The model levels are numbered from the highest eleveation to the lowest.
Args:</p>
<hr />
<pre><code>lnsp: ndarray         - [y, x] array of log surface pressure
t: ndarray            - [z, y, x] cube of temperatures
q: ndarray            - [z, y, x] cube of specific humidity
geopotential: ndarray - [z, y, x] cube of geopotential values
a: ndarray            - [z] vector of a values
b: ndarray            - [z] vector of b values
num_levels: int       - integer number of model levels
</code></pre>
<h5 id="RAiDER.utilFcns.calcgeoh--returns">Returns:</h5>
<pre><code>geopotential - The geopotential in units of height times acceleration
pressurelvs  - The pressure at each of the model levels for each of
               the input points
geoheight    - The geopotential heights
</code></pre>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calcgeoh</span><span class="p">(</span><span class="n">lnsp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">R_d</span><span class="p">,</span> <span class="n">num_levels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate pressure, geopotential, and geopotential height</span>
<span class="sd">    from the surface pressure and model levels provided by a weather model.</span>
<span class="sd">    The model levels are numbered from the highest eleveation to the lowest.</span>
<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">        lnsp: ndarray         - [y, x] array of log surface pressure</span>
<span class="sd">        t: ndarray            - [z, y, x] cube of temperatures</span>
<span class="sd">        q: ndarray            - [z, y, x] cube of specific humidity</span>
<span class="sd">        geopotential: ndarray - [z, y, x] cube of geopotential values</span>
<span class="sd">        a: ndarray            - [z] vector of a values</span>
<span class="sd">        b: ndarray            - [z] vector of b values</span>
<span class="sd">        num_levels: int       - integer number of model levels</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        geopotential - The geopotential in units of height times acceleration</span>
<span class="sd">        pressurelvs  - The pressure at each of the model levels for each of</span>
<span class="sd">                       the input points</span>
<span class="sd">        geoheight    - The geopotential heights</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">geopotential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">pressurelvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">geopotential</span><span class="p">)</span>
    <span class="n">geoheight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">geopotential</span><span class="p">)</span>

    <span class="c1"># log surface pressure</span>
    <span class="c1"># Note that we integrate from the ground up, so from the largest model level to 0</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnsp</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_levels</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;I have here a model with </span><span class="si">{}</span><span class="s1"> levels, but parameters a &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_levels</span><span class="p">)</span> <span class="o">+</span>
            <span class="s1">&#39;and b have lengths </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1"> respectively. Of &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span>
            <span class="s1">&#39;course, these three numbers should be equal.&#39;</span><span class="p">)</span>

    <span class="c1"># Integrate up into the atmosphere from *lowest level*</span>
    <span class="n">z_h</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># initial value</span>
    <span class="k">for</span> <span class="n">lev</span><span class="p">,</span> <span class="n">t_level</span><span class="p">,</span> <span class="n">q_level</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="n">num_levels</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

        <span class="c1"># lev is the level number 1-60, we need a corresponding index</span>
        <span class="c1"># into ts and qs</span>
        <span class="c1"># ilevel = num_levels - lev # &lt;&lt; this was Ray&#39;s original, but is a typo</span>
        <span class="c1"># because indexing like that results in pressure and height arrays that</span>
        <span class="c1"># are in the opposite orientation to the t/q arrays.</span>
        <span class="n">ilevel</span> <span class="o">=</span> <span class="n">lev</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># compute moist temperature</span>
        <span class="n">t_level</span> <span class="o">=</span> <span class="n">t_level</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.609133</span> <span class="o">*</span> <span class="n">q_level</span><span class="p">)</span>

        <span class="c1"># compute the pressures (on half-levels)</span>
        <span class="n">Ph_lev</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">lev</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">lev</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span>
        <span class="n">Ph_levplusone</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">lev</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">lev</span><span class="p">]</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span>

        <span class="n">pressurelvs</span><span class="p">[</span><span class="n">ilevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ph_lev</span>  <span class="c1"># + Ph_levplusone) / 2  # average pressure at half-levels above and below</span>

        <span class="k">if</span> <span class="n">lev</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dlogP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Ph_levplusone</span> <span class="o">/</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlogP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Ph_levplusone</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Ph_lev</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">Ph_lev</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ph_levplusone</span> <span class="o">-</span> <span class="n">Ph_lev</span><span class="p">))</span> <span class="o">*</span> <span class="n">dlogP</span><span class="p">)</span>

        <span class="n">TRd</span> <span class="o">=</span> <span class="n">t_level</span> <span class="o">*</span> <span class="n">R_d</span>

        <span class="c1"># z_f is the geopotential of this full level</span>
        <span class="c1"># integrate from previous (lower) half-level z_h to the full level</span>
        <span class="n">z_f</span> <span class="o">=</span> <span class="n">z_h</span> <span class="o">+</span> <span class="n">TRd</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">z</span>

        <span class="c1"># Geopotential (add in surface geopotential)</span>
        <span class="n">geopotential</span><span class="p">[</span><span class="n">ilevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_f</span>
        <span class="n">geoheight</span><span class="p">[</span><span class="n">ilevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">geopotential</span><span class="p">[</span><span class="n">ilevel</span><span class="p">]</span> <span class="o">/</span> <span class="n">g0</span>

        <span class="c1"># z_h is the geopotential of &#39;half-levels&#39;</span>
        <span class="c1"># integrate z_h to next half level</span>
        <span class="n">z_h</span> <span class="o">+=</span> <span class="n">TRd</span> <span class="o">*</span> <span class="n">dlogP</span>

    <span class="k">return</span> <span class="n">geopotential</span><span class="p">,</span> <span class="n">pressurelvs</span><span class="p">,</span> <span class="n">geoheight</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.clip_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clip_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Clip box to multiple of spacing</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clip_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clip box to multiple of spacing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.convertLons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convertLons</span><span class="p">(</span><span class="n">inLons</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert lons from 0-360 to -180-180</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convertLons</span><span class="p">(</span><span class="n">inLons</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert lons from 0-360 to -180-180&#39;&#39;&#39;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">inLons</span> <span class="o">&gt;</span> <span class="mi">180</span>
    <span class="n">outLons</span> <span class="o">=</span> <span class="n">inLons</span>
    <span class="n">outLons</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">outLons</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="k">return</span> <span class="n">outLons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.cosd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cosd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the cosine of x when x is in degrees.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cosd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the cosine of x when x is in degrees.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.ecef2enu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ecef2enu</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert ECEF xyz to ENU</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ecef2enu</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert ECEF xyz to ENU&#39;&#39;&#39;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sind</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span>

    <span class="n">e</span> <span class="o">=</span> <span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">sind</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.enu2ecef" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enu2ecef</span><span class="p">(</span><span class="n">east</span><span class="p">,</span> <span class="n">north</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <h5 id="RAiDER.utilFcns.enu2ecef--args">Args:</h5>
<p>e1 : float
    target east ENU coordinate (meters)
n1 : float
    target north ENU coordinate (meters)
u1 : float
    target up ENU coordinate (meters)
Results</p>
<hr />
<p>u : float
v : float
w : float</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enu2ecef</span><span class="p">(</span>
    <span class="n">east</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
    <span class="n">north</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
    <span class="n">up</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
    <span class="n">lat0</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
    <span class="n">lon0</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
    <span class="n">h0</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">    ----------</span>
<span class="sd">    e1 : float</span>
<span class="sd">        target east ENU coordinate (meters)</span>
<span class="sd">    n1 : float</span>
<span class="sd">        target north ENU coordinate (meters)</span>
<span class="sd">    u1 : float</span>
<span class="sd">        target up ENU coordinate (meters)</span>
<span class="sd">    Results</span>
<span class="sd">    -------</span>
<span class="sd">    u : float</span>
<span class="sd">    v : float</span>
<span class="sd">    w : float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lat0</span><span class="p">)</span> <span class="o">*</span> <span class="n">up</span> <span class="o">-</span> <span class="n">sind</span><span class="p">(</span><span class="n">lat0</span><span class="p">)</span> <span class="o">*</span> <span class="n">north</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">lat0</span><span class="p">)</span> <span class="o">*</span> <span class="n">up</span> <span class="o">+</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lat0</span><span class="p">)</span> <span class="o">*</span> <span class="n">north</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lon0</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">sind</span><span class="p">(</span><span class="n">lon0</span><span class="p">)</span> <span class="o">*</span> <span class="n">east</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">lon0</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">cosd</span><span class="p">(</span><span class="n">lon0</span><span class="p">)</span> <span class="o">*</span> <span class="n">east</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.floorish" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">floorish</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">frac</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Round a value to the lower fractional part</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">floorish</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">frac</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Round a value to the lower fractional part&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="o">-</span> <span class="p">(</span><span class="n">val</span> <span class="o">%</span> <span class="n">frac</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.geo_to_ht" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">geo_to_ht</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">hts</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert geopotential height to ellipsoidal heights referenced to WGS84.</p>
<p>Note that this formula technically computes height above geoid (geometric height)
but the geoid is actually a perfect sphere;
Thus returned heights are above a reference ellipsoid, which most assume to be
a sphere (e.g., ECMWF - see https://confluence.ecmwf.int/display/CKB/ERA5%3A+compute+pressure+and+geopotential+on+model+levels%2C+geopotential+height+and+geometric+height#ERA5:computepressureandgeopotentialonmodellevels,geopotentialheightandgeometricheight-Geopotentialheight
- "Geometric Height" and also https://confluence.ecmwf.int/display/CKB/ERA5%3A+data+documentation#ERA5:datadocumentation-Earthmodel).
However, by calculating the ellipsoid here we directly reference to WGS84.</p>
<p>Compare to MetPy:
(https://unidata.github.io/MetPy/latest/api/generated/metpy.calc.geopotential_to_height.html)</p>
<h4 id="RAiDER.utilFcns.geo_to_ht--h-geopotential-re-g0-re-geopotential">h = (geopotential * Re) / (g0 * Re - geopotential)</h4>
<h4 id="RAiDER.utilFcns.geo_to_ht--assumes-a-sphere-instead-of-an-ellipsoid">Assumes a sphere instead of an ellipsoid</h4>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ndarray</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>geometric heights. These are approximate ellipsoidal heights referenced to WGS84</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">geo_to_ht</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">hts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert geopotential height to ellipsoidal heights referenced to WGS84.</span>

<span class="sd">    Note that this formula technically computes height above geoid (geometric height)</span>
<span class="sd">    but the geoid is actually a perfect sphere;</span>
<span class="sd">    Thus returned heights are above a reference ellipsoid, which most assume to be</span>
<span class="sd">    a sphere (e.g., ECMWF - see https://confluence.ecmwf.int/display/CKB/ERA5%3A+compute+pressure+and+geopotential+on+model+levels%2C+geopotential+height+and+geometric+height#ERA5:computepressureandgeopotentialonmodellevels,geopotentialheightandgeometricheight-Geopotentialheight</span>
<span class="sd">    - &quot;Geometric Height&quot; and also https://confluence.ecmwf.int/display/CKB/ERA5%3A+data+documentation#ERA5:datadocumentation-Earthmodel).</span>
<span class="sd">    However, by calculating the ellipsoid here we directly reference to WGS84.</span>

<span class="sd">    Compare to MetPy:</span>
<span class="sd">    (https://unidata.github.io/MetPy/latest/api/generated/metpy.calc.geopotential_to_height.html)</span>
<span class="sd">    # h = (geopotential * Re) / (g0 * Re - geopotential)</span>
<span class="sd">    # Assumes a sphere instead of an ellipsoid</span>

<span class="sd">    Args:</span>
<span class="sd">        lats    - latitude of points of interest</span>
<span class="sd">        hts     - geopotential height at points of interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray: geometric heights. These are approximate ellipsoidal heights referenced to WGS84</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g_ll</span> <span class="o">=</span> <span class="n">_get_g_ll</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="c1"># gravity function of latitude</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">get_Re</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="c1"># Earth radius function of latitude</span>

    <span class="c1"># Calculate Geometric Height, h</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">hts</span> <span class="o">*</span> <span class="n">Re</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">g_ll</span> <span class="o">/</span> <span class="n">g0</span> <span class="o">*</span> <span class="n">Re</span> <span class="o">-</span> <span class="n">hts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.getChunkSize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getChunkSize</span><span class="p">(</span><span class="n">in_shape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Create a reasonable chunk size</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getChunkSize</span><span class="p">(</span><span class="n">in_shape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Create a reasonable chunk size&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;RAiDER.utilFcns: getChunkSize - multiprocessing is not available&#39;</span><span class="p">)</span>
    <span class="n">minChunkSize</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">maxChunkSize</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">cpu_count</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="n">chunkSize</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="nb">max</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">maxChunkSize</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="n">cpu_count</span><span class="p">),</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">minChunkSize</span><span class="p">)</span>
        <span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">in_shape</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">chunkSize</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.getTimeFromFile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTimeFromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Parse a filename to get a date-time</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getTimeFromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse a filename to get a date-time</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">_T%H_%M_%S&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{4}</span><span class="s1">_\d</span><span class="si">{2}</span><span class="s1">_\d</span><span class="si">{2}</span><span class="s1">_T\d</span><span class="si">{2}</span><span class="s1">_\d</span><span class="si">{2}</span><span class="s1">_\d</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.get_Re" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_Re</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Returns earth radius as a function of latitude for WGS84</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray of earth radius at each latitude</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import numpy as np
from RAiDER.utilFcns import get_Re
output = get_Re(np.array([0, 30, 45, 60, 90]))
output
 array([6378137., 6372770.5219805, 6367417.56705189, 6362078.07851428, 6356752.])
assert output[0] == 6378137 # (Rmax)
assert output[-1] == 6356752 # (Rmin)</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_Re</span><span class="p">(</span><span class="n">lats</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns earth radius as a function of latitude for WGS84</span>

<span class="sd">    Args:</span>
<span class="sd">        lats    - ndarray of geodetic latitudes in degrees</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray of earth radius at each latitude</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.utilFcns import get_Re</span>
<span class="sd">    &gt;&gt;&gt; output = get_Re(np.array([0, 30, 45, 60, 90]))</span>
<span class="sd">    &gt;&gt;&gt; output</span>
<span class="sd">     array([6378137., 6372770.5219805, 6367417.56705189, 6362078.07851428, 6356752.])</span>
<span class="sd">    &gt;&gt;&gt; assert output[0] == 6378137 # (Rmax)</span>
<span class="sd">    &gt;&gt;&gt; assert output[-1] == 6356752 # (Rmin)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">cosd</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Rmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">sind</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Rmin</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.get_dt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dt</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Helper function for getting the absolute difference in seconds between
two python datetimes</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute difference in seconds between the two inputs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Examples:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import datetime
from RAiDER.utilFcns import get_dt
get_dt(datetime.datetime(2020,1,1,5,0,0), datetime.datetime(2020,1,1,0,0,0))
 18000.0</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_dt</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper function for getting the absolute difference in seconds between</span>
<span class="sd">    two python datetimes</span>

<span class="sd">    Args:</span>
<span class="sd">        t1, t2  - Python datetimes</span>

<span class="sd">    Returns:</span>
<span class="sd">        Absolute difference in seconds between the two inputs</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; import datetime</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.utilFcns import get_dt</span>
<span class="sd">    &gt;&gt;&gt; get_dt(datetime.datetime(2020,1,1,5,0,0), datetime.datetime(2020,1,1,0,0,0))</span>
<span class="sd">     18000.0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t2</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.get_file_and_band" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_and_band</span><span class="p">(</span><span class="n">filestr</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Support file;bandnum as input for filename strings</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_file_and_band</span><span class="p">(</span><span class="n">filestr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Support file;bandnum as input for filename strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>

    <span class="c1"># Defaults to first band if no bandnum is provided</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filestr</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Cannot interpret </span><span class="si">{</span><span class="n">filestr</span><span class="si">}</span><span class="s2"> as valid filename&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.get_nearest_wmtimes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nearest_wmtimes</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">time_delta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>"
Get the nearest two available times to the requested time given a time step</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of datetimes representing the one or two closest</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>available times to the requested time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import datetime
from RAiDER.utilFcns import get_nearest_wmtimes
t0 = datetime.datetime(2020,1,1,11,35,0)
get_nearest_wmtimes(t0, 3)
 (datetime.datetime(2020, 1, 1, 9, 0), datetime.datetime(2020, 1, 1, 12, 0))</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_nearest_wmtimes</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">time_delta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    Get the nearest two available times to the requested time given a time step</span>

<span class="sd">    Args:</span>
<span class="sd">        t0         - user-requested Python datetime</span>
<span class="sd">        time_delta  - time interval of weather model</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: list of datetimes representing the one or two closest</span>
<span class="sd">        available times to the requested time</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import datetime</span>
<span class="sd">    &gt;&gt;&gt; from RAiDER.utilFcns import get_nearest_wmtimes</span>
<span class="sd">    &gt;&gt;&gt; t0 = datetime.datetime(2020,1,1,11,35,0)</span>
<span class="sd">    &gt;&gt;&gt; get_nearest_wmtimes(t0, 3)</span>
<span class="sd">     (datetime.datetime(2020, 1, 1, 9, 0), datetime.datetime(2020, 1, 1, 12, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the closest time available</span>
    <span class="n">tclose</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">roundTo</span> <span class="o">=</span> <span class="n">time_delta</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="c1"># Just calculate both options and take the closest</span>
    <span class="n">t2_1</span> <span class="o">=</span> <span class="n">tclose</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">time_delta</span><span class="p">)</span>
    <span class="n">t2_2</span> <span class="o">=</span> <span class="n">tclose</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">time_delta</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="p">[</span><span class="n">t2_1</span> <span class="k">if</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">t2_1</span><span class="p">,</span> <span class="n">t0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">t2_2</span><span class="p">,</span> <span class="n">t0</span><span class="p">)</span> <span class="k">else</span> <span class="n">t2_2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># If you&#39;re within 5 minutes just take the closest time</span>
    <span class="k">if</span> <span class="n">get_dt</span><span class="p">(</span><span class="n">tclose</span><span class="p">,</span> <span class="n">t0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_THRESHOLD_SECONDS</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">tclose</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t2</span> <span class="o">&gt;</span> <span class="n">tclose</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">tclose</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">t2</span><span class="p">,</span> <span class="n">tclose</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.nodataToNan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nodataToNan</span><span class="p">(</span><span class="n">inarr</span><span class="p">,</span> <span class="n">listofvals</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Setting values to nan as needed</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nodataToNan</span><span class="p">(</span><span class="n">inarr</span><span class="p">,</span> <span class="n">listofvals</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setting values to nan as needed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inarr</span> <span class="o">=</span> <span class="n">inarr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="c1"># nans cannot be integers (i.e. in DEM)</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">listofvals</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inarr</span><span class="p">[</span><span class="n">inarr</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.padLower" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">padLower</span><span class="p">(</span><span class="n">invar</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>add a layer of data below the lowest current z-level at height zmin</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">padLower</span><span class="p">(</span><span class="n">invar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    add a layer of data below the lowest current z-level at height zmin</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">new_var</span> <span class="o">=</span> <span class="n">_least_nonzero</span><span class="p">(</span><span class="n">invar</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">new_var</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">invar</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.projectDelays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">projectDelays</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Project zenith delays to LOS</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">projectDelays</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Project zenith delays to LOS&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">inc</span><span class="o">==</span><span class="mi">90</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ZeroDivisionError</span>
    <span class="k">return</span> <span class="n">delay</span> <span class="o">/</span> <span class="n">cosd</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.requests_retry_session" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">requests_retry_session</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>https://www.peterbe.com/plog/best-practice-with-retries-with-requests</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">requests_retry_session</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; https://www.peterbe.com/plog/best-practice-with-retries-with-requests &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="kn">from</span> <span class="nn">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span>
    <span class="kn">from</span> <span class="nn">requests.packages.urllib3.util.retry</span> <span class="kn">import</span> <span class="n">Retry</span>
    <span class="c1"># add a retry strategy; https://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks/</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">session</span> <span class="ow">or</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
                  <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">status_forcelist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">505</span><span class="p">)))</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.rio_extents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rio_extents</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get a bounding box in SNWE from a rasterio profile</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rio_extents</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get a bounding box in SNWE from a rasterio profile &quot;&quot;&quot;</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">()</span>
    <span class="n">xSize</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
    <span class="n">ySize</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ySize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ySize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">E</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.rio_open" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rio_open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">returnProj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">userNDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads a rasterio-compatible raster file and returns the data and profile</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rio_open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">returnProj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">userNDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads a rasterio-compatible raster file and returns the data and profile</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">rasterio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;RAiDER.utilFcns: rio_open - rasterio is not installed&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

        <span class="c1"># For all bands</span>
        <span class="n">nodata</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">nodatavals</span>

        <span class="c1"># If user requests a band</span>
        <span class="k">if</span> <span class="n">band</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ndv</span> <span class="o">=</span> <span class="n">nodata</span><span class="p">[</span><span class="n">band</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">nodataToNan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">userNDV</span><span class="p">,</span> <span class="n">nodata</span><span class="p">[</span><span class="n">band</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">bnd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">bnd</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
                    <span class="n">nodataToNan</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">[</span><span class="n">userNDV</span><span class="p">,</span> <span class="n">nodata</span><span class="p">[</span><span class="n">bnd</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodataToNan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodata</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">userNDV</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">dlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dlist</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">returnProj</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">profile</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.rio_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rio_profile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads the profile of a rasterio file</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rio_profile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads the profile of a rasterio file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">rasterio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;RAiDER.utilFcns: rio_profile - rasterio is not installed&#39;</span><span class="p">)</span>

    <span class="c1">## need to access subdataset directly</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;S1-GUNW&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;NETCDF:&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot;:science/grids/data/unwrappedPhase&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

    <span class="k">return</span> <span class="n">profile</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.rio_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rio_stats</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read a rasterio-compatible file and pull the metadata.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stats   - a list of stats for the specified band</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>proj    - CRS/projection information for the file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>gt      - geotransform for the data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rio_stats</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read a rasterio-compatible file and pull the metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        fname   - filename to be loaded</span>
<span class="sd">        band    - band number to use for getting statistics</span>

<span class="sd">    Returns:</span>
<span class="sd">        stats   - a list of stats for the specified band</span>
<span class="sd">        proj    - CRS/projection information for the file</span>
<span class="sd">        gt      - geotransform for the data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">rasterio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;RAiDER.utilFcns: rio_stats - rasterio is not installed&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;S1-GUNW&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;NETCDF:&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot;:science/grids/data/unwrappedPhase&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.vrt&#39;</span>

    <span class="c1"># Turn off PAM to avoid creating .aux.xml files</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">GDAL_PAM_ENABLED</span><span class="o">=</span><span class="s2">&quot;NO&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">gt</span>    <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">()</span>
            <span class="n">proj</span>  <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">statistics</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">gt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.robmax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">robmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get the minimum of an array, accounting for empty lists</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">robmax</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the minimum of an array, accounting for empty lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.robmin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">robmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get the minimum of an array, accounting for empty lists</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">robmin</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the minimum of an array, accounting for empty lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.round_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">round_time</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">roundTo</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Round a datetime object to any time lapse in seconds
dt: datetime.datetime object
roundTo: Closest number of seconds to round to, default 1 minute.
Source: https://stackoverflow.com/questions/3463930/how-to-round-the-minute-of-a-datetime-object/10854034#10854034</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">round_time</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">roundTo</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Round a datetime object to any time lapse in seconds</span>
<span class="sd">    dt: datetime.datetime object</span>
<span class="sd">    roundTo: Closest number of seconds to round to, default 1 minute.</span>
<span class="sd">    Source: https://stackoverflow.com/questions/3463930/how-to-round-the-minute-of-a-datetime-object/10854034#10854034</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">min</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span>
    <span class="n">rounding</span> <span class="o">=</span> <span class="p">(</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">roundTo</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">roundTo</span> <span class="o">*</span> <span class="n">roundTo</span>
    <span class="k">return</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rounding</span> <span class="o">-</span> <span class="n">seconds</span><span class="p">,</span> <span class="o">-</span><span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.show_progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_progress</span><span class="p">(</span><span class="n">block_num</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">total_size</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Show download progress</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_progress</span><span class="p">(</span><span class="n">block_num</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">total_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Show download progress&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">progressbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;RAiDER.utilFcns: show_progress - progressbar is not available&#39;</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">pbar</span>
    <span class="k">if</span> <span class="n">pbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">maxval</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">downloaded</span> <span class="o">=</span> <span class="n">block_num</span> <span class="o">*</span> <span class="n">block_size</span>
    <span class="k">if</span> <span class="n">downloaded</span> <span class="o">&lt;</span> <span class="n">total_size</span><span class="p">:</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">downloaded</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.sind" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sind</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the sine of x when x is in degrees.</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sind</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the sine of x when x is in degrees.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.transform_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_bbox</span><span class="p">(</span><span class="n">snwe_in</span><span class="p">,</span> <span class="n">dest_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Transform bbox to lat/lon or another CRS for use with rest of workflow
Returns: SNWE</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform_bbox</span><span class="p">(</span><span class="n">snwe_in</span><span class="p">,</span> <span class="n">dest_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">100.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform bbox to lat/lon or another CRS for use with rest of workflow</span>
<span class="sd">    Returns: SNWE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - Handle dateline crossing</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span>

    <span class="c1"># Handle margin for input bbox in degrees</span>
    <span class="k">if</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">axis_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit_name</span> <span class="o">==</span> <span class="s2">&quot;degree&quot;</span><span class="p">:</span>
        <span class="n">margin</span> <span class="o">=</span> <span class="n">margin</span> <span class="o">/</span> <span class="mf">1.0e5</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">dest_crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">dest_crs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest_crs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">dest_crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="n">dest_crs</span><span class="p">)</span>

    <span class="c1"># If dest_crs is same as src_crs</span>
    <span class="k">if</span> <span class="n">dest_crs</span> <span class="o">==</span> <span class="n">src_crs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">snwe_in</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">dest_crs</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">snwe_in</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">snwe_in</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">margin</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">snwe_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">snwe_in</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">margin</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>

    <span class="c1"># Transform to lat/lon</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

    <span class="c1"># query_area convention</span>
    <span class="n">snwe</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xx</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">snwe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.transform_coords" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_coords</span><span class="p">(</span><span class="n">proj1</span><span class="p">,</span> <span class="n">proj2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Transform coordinates from proj1 to proj2 (can be EPSG or crs from proj).
e.g. x, y = transform_coords(4326, 4087, lon, lat)</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform_coords</span><span class="p">(</span><span class="n">proj1</span><span class="p">,</span> <span class="n">proj2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform coordinates from proj1 to proj2 (can be EPSG or crs from proj).</span>
<span class="sd">    e.g. x, y = transform_coords(4326, 4087, lon, lat)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">proj1</span><span class="p">,</span> <span class="n">proj2</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.writeArrayToRaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">writeArrayToRaster</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">noDataValue</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ENVI&#39;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>write a numpy array to a GDAL-readable raster</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">writeArrayToRaster</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">noDataValue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ENVI&#39;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    write a numpy array to a GDAL-readable raster</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">array_shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;writeArrayToRaster: cannot write an array of shape </span><span class="si">{}</span><span class="s1"> to a raster image&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_shp</span><span class="p">))</span>

    <span class="c1"># Data type</span>
    <span class="k">if</span> <span class="s2">&quot;complex&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span>
    <span class="k">elif</span> <span class="s2">&quot;float&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>

    <span class="c1"># Geotransform</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">gt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="o">.</span><span class="n">from_gdal</span><span class="p">(</span><span class="o">*</span><span class="n">gt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">gt</span>

    <span class="c1">## cant write netcdfs with rasterio in a simple way</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;nc&#39;</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;GTiff&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">width</span><span class="o">=</span><span class="n">array_shp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">array_shp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">noDataValue</span><span class="p">,</span>
                       <span class="n">driver</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="RAiDER.utilFcns.writeDelays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">writeDelays</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">wetDelay</span><span class="p">,</span> <span class="n">hydroDelay</span><span class="p">,</span> <span class="n">wetFilename</span><span class="p">,</span> <span class="n">hydroFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outformat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndv</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Write the delay numpy arrays to files in the format specified</p>

            <details class="quote">
              <summary>Source code in <code>RAiDER/utilFcns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">writeDelays</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">wetDelay</span><span class="p">,</span> <span class="n">hydroDelay</span><span class="p">,</span>
                <span class="n">wetFilename</span><span class="p">,</span> <span class="n">hydroFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">outformat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndv</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Write the delay numpy arrays to files in the format specified &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;pandas is required to write GNSS delays to a file&#39;</span><span class="p">)</span>

    <span class="c1"># Need to consistently handle noDataValues</span>
    <span class="n">wetDelay</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">wetDelay</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ndv</span>
    <span class="n">hydroDelay</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hydroDelay</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ndv</span>

    <span class="c1"># Do different things, depending on the type of input</span>
    <span class="k">if</span> <span class="n">aoi</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;station_file&#39;</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">aoi</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">])</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wetDelay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wetDelay</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hydroDelay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hydroDelay</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;totalDelay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wetDelay</span> <span class="o">+</span> <span class="n">hydroDelay</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">wetFilename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote delays to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">wetFilename</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">projection</span><span class="p">()</span>
        <span class="n">gt</span>   <span class="o">=</span> <span class="n">aoi</span><span class="o">.</span><span class="n">geotransform</span><span class="p">()</span>
        <span class="n">writeArrayToRaster</span><span class="p">(</span>
            <span class="n">wetDelay</span><span class="p">,</span>
            <span class="n">wetFilename</span><span class="p">,</span>
            <span class="n">noDataValue</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="n">outformat</span><span class="p">,</span>
            <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
            <span class="n">gt</span><span class="o">=</span><span class="n">gt</span>
        <span class="p">)</span>
        <span class="n">writeArrayToRaster</span><span class="p">(</span>
            <span class="n">hydroDelay</span><span class="p">,</span>
            <span class="n">hydroFilename</span><span class="p">,</span>
            <span class="n">noDataValue</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="n">outformat</span><span class="p">,</span>
            <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
            <span class="n">gt</span><span class="o">=</span><span class="n">gt</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>